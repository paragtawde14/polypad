/** (c) Mathigon Ltd */
!function(){"use strict";function t(t,e,s,i){var o,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,s,i);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(a=(n<3?o(a):n>3?o(e,s,a):o(e,s))||a);return n>3&&a&&Object.defineProperty(e,s,a),a}function e(t,e,s,i){return new(s||(s=Promise))((function(o,n){function a(t){try{l(i.next(t))}catch(t){n(t)}}function r(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}l((i=i.apply(t,e||[])).next())}))}function s(t=10){return Math.random().toString(36).substr(2,t)}function i(t,...e){return e.includes(t)}function o(t,e){for(const s of Object.keys(e))Object.prototype.hasOwnProperty.call(t,s)||(t[s]=e[s]);return t}const n=(t,e)=>t.concat(e);function a(t,e,s=n){for(const i of Object.keys(e))i in t&&Array.isArray(t[i])&&Array.isArray(e[i])?t[i]=s(t[i],e[i]):i in t&&t[i]instanceof Object&&e[i]instanceof Object?a(t[i],e[i]):t[i]=e[i]}function r(t){return new Promise((e=>setTimeout(e,t)))}function l(){let t=()=>{},e=()=>{};const s=new Promise(((s,i)=>{t=s,e=i}));return s.catch((t=>t)),{promise:s,resolve:t,reject:e}}function h(t){const e=new Map;return function(...s){const i=s.join("--");return e.has(i)||e.set(i,t(...s)),e.get(i)}}function c(t,e=0,s=!1){let i=!1,o=!1;return(...n)=>{i?o=!0:(s?o=!0:t(...n),i=!0,setTimeout((()=>{o&&t(...n),i=o=!1}),e))}}function d(t,e={}){if(!t)return e;try{return JSON.parse(t)||e}catch(t){return e}}function p(t,e){const s=[];for(let i=0;i<e;++i)s.push(t(i));return s}function u(t,e=0){return t[t.length-1-e]}function f(t){return t.reduce(((t,e)=>t+e),0)}function g(t,e,s=!1){return t.slice(0).sort(((t,i)=>{const o=e(t),n=e(i);return o<n?s?1:-1:o>n?s?-1:1:0}))}function m(t){return t.filter(((e,s)=>t.indexOf(e)===s))}function x(t){return t.reduce(((t,e)=>t.concat(Array.isArray(e)?x(e):e)),[])}function b(t,e){const s=[];for(let i=0;i<t.length;i+=e)s.push(t.slice(i,i+e));return s}function v(...t){return t.reduce(((t,e)=>t.concat(e)),[])}function y(t,e=/\s+/){return t?t.trim().split(e):[]}class w{constructor(){this.events=new Map}on(t,e){for(const s of y(t))this.events.has(s)||this.events.set(s,[]),this.events.get(s).push(e)}one(t,e){const s=i=>{this.off(t,s),e(i)};this.on(t,s)}off(t,e){for(const s of y(t))this.events.has(s)&&this.events.set(s,this.events.get(s).filter((t=>t!==e)))}trigger(t,e){for(const s of y(t))if(this.events.has(s))for(const t of this.events.get(s))t(e)}}const $=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,k=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,A=/rgba?\(([0-9,]+), ?([0-9,]+), ?([0-9,]+)(, ?([0-9,]+))?\)/,M=["#22ab24","#009ea6","#0f82f2","#6d3bbf","#cd0e66","#eb4726","#fd8c00"];function C(t,e){if(e<=0)return P.from(t[0]);if(e>=1)return P.from(u(t));const s=Math.floor(e*(t.length-1)),i=e*(t.length-1)-s;return P.mix(t[s+1],t[s],i)}function T(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t}class P{constructor(t,e,s,i=1){this.r=t,this.g=e,this.b=s,this.a=i}get hex(){return"#"+[this.r,this.g,this.b].map((t=>{return 1===(e=Math.round(t).toString(16)).length?"0"+e:e;var e})).join("")}get rgb(){return"rgba("+[this.r,this.g,this.b].map((t=>Math.round(t))).join(",")+","+this.a+")"}get hsl(){const t=this.r/255,e=this.g/255,s=this.b/255,i=Math.max(t,e,s),o=Math.min(t,e,s),n=(o+i)/2,a=i-o;if(i===o)return[0,0,Math.round(100*n)];let r=t===i?(e-s)/a:e===i?2+(s-t)/a:4+(t-e)/a;r=Math.min(60*r,360),r<0&&(r+=360);const l=n<=.5?a/(i+o):a/(2-i-o);return[Math.round(r),Math.round(100*l),Math.round(100*n)]}get chroma(){return Math.max(this.r,this.g,this.b)-Math.min(this.r,this.g,this.b)}toString(){return this.rgb}copy(){return new P(this.r,this.g,this.b,this.a)}static from(t){return"string"!=typeof t?t:t.startsWith("#")?P.fromHex(t):P.fromRgb(t)}static fromRgb(t){const e=t.match(A);if(!e)return new P(0,0,0);const s=e[4]?+e[5]||0:1;return new P(+e[1],+e[2],+e[3],s)}static fromHex(t){t=t.replace($,(function(t,e,s,i){return e+e+s+s+i+i}));const e=k.exec(t);return e?new P(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)):new P(0,0,0)}static fromHsl(t,e,s){if(t/=360,s/=100,0===(e/=100)){const t=Math.round(255*s);return new P(t,t,t)}const i=s<.5?s*(1+e):s+e-s*e,o=2*s-i,n=T(o,i,t+1/3),a=T(o,i,t),r=T(o,i,t-1/3);return new P(Math.round(255*n),Math.round(255*a),Math.round(255*r))}static rainbow(t){return p((e=>C(M,e/(t-1))),t)}static gradient(t,e){return p((s=>C(t,s/(e-1))),e)}static shades(t,e,s=.5){const i=P.mix("#fff",t,s),o=P.mix("#000",t,s);return P.gradient([i,t,o],e)}static mix(t,e,s=.5){return t=P.from(t),e=P.from(e),new P(s*t.r+(1-s)*e.r,s*t.g+(1-s)*e.g,s*t.b+(1-s)*e.b,s*t.a+(1-s)*e.a)}static mixMany(t,e){e||(e=t.map((()=>1)));const s=f(e),i=t.map((t=>t.hsl)),o=i.map((t=>t[0])),n=o.map((t=>t<180?t+360:t)),a=e.map(((e,s)=>e*Math.sqrt(t[s].chroma))),r=f(a),l=f(o.map(((t,e)=>t*a[e])))/r,h=f(n.map(((t,e)=>t*a[e])))/r,c=f(o.map(((t,e)=>Math.abs(t-l)*a[e])))<=f(n.map(((t,e)=>Math.abs(t-h)*a[e])))?l:h%360,d=f(i.map(((t,s)=>e[s]*t[1])))/s,p=f(i.map(((t,s)=>e[s]*t[2])))/s;return P.fromHsl(c,d,p)}}function L(t,e,s=1e-6){return!isNaN(t)&&!isNaN(e)&&Math.abs(t-e)<s}function S(t,e,s,i=1e-6){return e>s&&([e,s]=[s,e]),t>e+i&&t<s-i}const z=/(\d+)(\d{3})/,V=["","k","m","b","t","q"];function Z(t,e=0,s=!0){const i=function(t,e=6){if(!e)return""+t;const s=(""+Math.abs(Math.floor(t))).length,i=t<0?1:0;if(s<=e-i)return""+R(t,e-s-i-1);const o=Math.floor(Math.log10(Math.abs(t))/3);return R(t/Math.pow(10,3*o),e-(s%3||3)-i-1)+V[o]}(t,e).replace("-","–");return s?function(t){let[e,s]=t.split(".");for(;z.test(e);)e=e.replace(z,"$1,$2");return e+(s?"."+s:"")}(i):i}const E=/^-?0,[0-9]+$/,H=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,_=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/;function I(t){return!(t=t.replace(/^–/,"-").trim())||t.match(/[^0-9.,-]/)?NaN:E.test(t)?parseFloat(t.replace(/,/,".")):H.test(t)?parseFloat(t.replace(/,/g,"")):_.test(t)?parseFloat(t.replace(/\./g,"").replace(/,/,".")):NaN}const O=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],D=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],B=[""," thousand"," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"];function N(t){const[e,s,i]=t.split(""),o="0"===e?"":" "+O[+e]+" hundred";return s+i==="00"?o:+s<2?o+" "+O[+(s+i)]:"0"===i?o+" "+D[+s]:o+" "+D[+s]+"-"+O[+i]}function q(t){if(0===t)return"zero";const e=Math.round(Math.abs(t)).toString(),s=Math.ceil(e.length/3),i=e.padStart(3*s,"0");let o="";for(let t=0;t<s;t+=1){const e=i.substr(3*t,3);"000"!==e&&(o+=N(e)+B[s-1-t])}return o.trim()}function R(t,e=0){const s=Math.pow(10,e);return Math.round(t*s)/s}function j(t,e=1){return Math.round(t/e)*e}function U(t,e=-1/0,s=1/0){return Math.min(s,Math.max(e,t))}function K(t,e,s=.5){return t+(e-t)*s}function F(t){return t*t}function G(t,e){return(t%e+e)%e}function W(t,e=0){const s=Q(t.slice(0));return e?s.filter((t=>t.length===e)):s}function Q(t){if(1===t.length)return[[],t];const e=t.pop(),s=Q(t),i=[];for(const t of s)i.push(t,[...t,e]);return i}function X(t){if(1===t)return[];if(function(t){if(t%1!=0||t<2)return!1;if(t%2==0)return 2===t;if(t%3==0)return 3===t;const e=Math.sqrt(t);for(let s=5;s<=e;s+=6){if(t%s==0)return!1;if(t%(s+2)==0)return!1}return!0}(t))return[t];const e=Math.sqrt(t);for(let s=2;s<=e;++s)if(t%s==0)return X(s).concat(X(t/s));return[]}function Y(t){const e=Math.random()*f(t);let s=0;return t.findIndex((t=>(s+=t)>=e))}const J=new Map;function tt(t=.5){return Math.random()<t?1:0}const et=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];function st(t){if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*st(1-t));t-=1;let e=et[0];for(let s=1;s<9;s++)e+=et[s]/(t+s);const s=t+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(s,t+.5)*Math.exp(-s)*e}function it(t,e,s,i=1){let o=0;for(let n=e;n<s;n+=i)o+=t(n)*i||0;return o}var ot=Object.freeze({__proto__:null,shuffle:function(t){for(let e=(t=t.slice(0)).length-1;e>0;--e){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t},integer:function(t,e){const s=void 0===e?t:e-t+1;return(void 0===e?0:t)+Math.floor(s*Math.random())},weighted:Y,find:function(t){return t[Math.floor(t.length*Math.random())]},smart:function(t,e){e||(e=s()),J.has(e)||J.set(e,function(t,e){return new Array(e).fill(t)}(1,t));const i=J.get(e),o=Y(i.map((t=>t*t)));return i[o]-=1,i[o]<=0&&J.set(e,i.map((t=>t+1))),o},bernoulli:tt,binomial:function(t=1,e=.5){let s=0;for(let i=0;i<t;++i)s+=tt(e);return s},poisson:function(t=1){if(t<=0)return 0;const e=Math.exp(-t);let s=1,i=0;for(;s>e;++i)s*=Math.random();return i-1},uniform:function(t=0,e=1){return t+(e-t)*Math.random()},normal:function(t=0,e=1){const s=Math.random(),i=Math.random();return Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*i)*Math.sqrt(e)+t},exponential:function(t=1){return t<=0?0:-Math.log(Math.random())/t},geometric:function(t=.5){if(!(t<=0||t>1))return Math.floor(Math.log(Math.random())/Math.log(1-t))},cauchy:function(){let t,e,s;do{e=2*Math.random()-1,s=2*Math.random()-1,t=e*e+s*s}while(t>=1);return e/s},normalPDF:function(t,e=1,s=0){return Math.exp(-((t-e)**2)/(2*s))/Math.sqrt(2*Math.PI*s)},integrate:it,chiCDF:function(t,e){return 1-it((t=>Math.pow(t,(e-2)/2)*Math.exp(-t/2)),0,t)/Math.pow(2,e/2)/st(e/2)}});const nt=2*Math.PI;function at(t,e){return G(Math.atan2(t.y-(e?e.y:0),t.x-(e?e.x:0)),nt)}class rt{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return L(this.length,0)?new rt(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new rt(-this.x,-this.y)}get flip(){return new rt(this.y,this.x)}get perpendicular(){return new rt(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return rt.distance(this,t.project(this))}clamp(t,e=0){const s=U(this.x,t.xMin+e,t.xMax-e),i=U(this.y,t.yMin+e,t.yMax-e);return new rt(s,i)}changeCoordinates(t,e){const s=e.xMin+(this.x-t.xMin)/t.dx*e.dx,i=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new rt(s,i)}add(t){return rt.sum(this,t)}subtract(t){return rt.difference(this,t)}round(t=1){return new rt(j(this.x,t),j(this.y,t))}floor(){return new rt(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new rt(this.x%t,this.y%e)}angle(t=lt){return at(this,t)}snap(t,e=5){return L(this.x,t.x,e)?new rt(t.x,this.y):L(this.y,t.y,e)?new rt(this.x,t.y):this}static average(...t){const e=f(t.map((t=>t.x)))/t.length,s=f(t.map((t=>t.y)))/t.length;return new rt(e,s)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new rt(t.x+e.x,t.y+e.y)}static difference(t,e){return new rt(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(F(t.x-e.x)+F(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,s=.5){return new rt(K(t.x,e.x,s),K(t.y,e.y,s))}static interpolateList(t,e=.5){const s=t.length-1,i=Math.floor(U(e,0,1)*s);return rt.interpolate(t[i],t[i+1],s*e-i)}static fromPolar(t,e=1){return new rt(e*Math.cos(t),e*Math.sin(t))}static random(t){const e=ot.uniform(t.xMin,t.xMax),s=ot.uniform(t.yMin,t.yMax);return new rt(e,s)}transform(t){const e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],s=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new rt(e,s)}rotate(t,e=lt){if(L(t,0))return this;const s=this.x-e.x,i=this.y-e.y,o=Math.cos(t),n=Math.sin(t),a=s*o-i*n+e.x,r=s*n+i*o+e.y;return new rt(a,r)}reflect(t){const e=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,i=this.x-t.p1.x,o=(e*(this.y-t.p1.y)-s*i)/(e*e+s*s),n=this.x+2*o*s,a=this.y-2*o*e;return new rt(n,a)}scale(t,e=t){return new rt(this.x*t,this.y*e)}shift(t,e=t){return new rt(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return L(this.x,t.x,e)&&L(this.y,t.y,e)}}const lt=new rt(0,0);class ht{constructor(t,e,s){this.c=t,this.start=e,this.angle=s,this.type="arc"}get radius(){return rt.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}get startAngle(){return at(this.start,this.c)}contract(t){return new this.constructor(this.c,this.at(t/2),this.angle*(1-t))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,nt-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,nt-this.angle)}get center(){return this.at(.5)}project(t){const e=this.startAngle,s=e+this.angle;let i=at(t,this.c);return s>nt&&i<s-nt&&(i+=nt),i=U(i,e,s),this.c.shift(this.radius,0).rotate(i,this.c)}at(t){return this.start.rotate(this.angle*t,this.c)}contains(t){return t.equals(this.project(t))}transform(t){return new this.constructor(this.c.transform(t),this.start.transform(t),this.angle)}rotate(t,e=lt){return L(t,0)?this:new this.constructor(this.c.rotate(t,e),this.start.rotate(t,e),this.angle)}reflect(t){return new this.constructor(this.c.reflect(t),this.start.reflect(t),this.angle)}scale(t,e=t){return new this.constructor(this.c.scale(t,e),this.start.scale(t,e),this.angle)}shift(t,e=t){return new this.constructor(this.c.shift(t,e),this.start.shift(t,e),this.angle)}translate(t){return this.shift(t.x,t.y)}equals(){return!1}}class ct extends ht{constructor(){super(...arguments),this.type="sector"}}class dt{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}make(t,e){return new dt(t,e)}get length(){return rt.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return rt.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return at(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new rt(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){const e=rt.sum(t,rt.difference(this.p2,this.p1));return new dt(t,e)}perpendicular(t){return new dt(t,rt.sum(t,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(t){const e=this.project(t);return(t.x-e.x)**2+(t.y-e.y)**2}offset(t){const e=rt.difference(this.p2,this.p1),s=rt.difference(t,this.p1);return rt.dot(e,s)/this.lengthSquared}project(t){return this.at(this.offset(t))}side(t,e){const s=rt.difference(this.p2,this.p1),i=rt.difference(t,this.p1),o=i.x*s.y-i.y*s.x;return L(o,0,e)?0:Math.sign(o)}contains(t,e){return 0===this.side(t,e)}at(t){return rt.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=lt){return L(t,0)?this:new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return this.make(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return this.make(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t,e){return this.contains(t.p1,e)&&this.contains(t.p2,e)}}class pt extends dt{constructor(){super(...arguments),this.type="ray"}make(t,e){return new pt(t,e)}equals(t,e){return"ray"===t.type&&(this.p1.equals(t.p1,e)&&this.contains(t.p2,e))}}class ut extends dt{constructor(){super(...arguments),this.type="segment"}contains(t,e){return!!dt.prototype.contains.call(this,t,e)&&(!(!this.p1.equals(t,e)&&!this.p2.equals(t,e))||(L(this.p1.x,this.p2.x,e)?S(t.y,this.p1.y,this.p2.y):S(t.x,this.p1.x,this.p2.x)))}make(t,e){return new ut(t,e)}project(t){const e=rt.difference(this.p2,this.p1),s=rt.difference(t,this.p1),i=U(rt.dot(e,s)/this.lengthSquared,0,1);return rt.sum(this.p1,e.scale(i))}contract(t){return new ut(this.at(t),this.at(1-t))}equals(t,e,s=!1){return"segment"===t.type&&(this.p1.equals(t.p1,e)&&this.p2.equals(t.p2,e)||!s&&this.p1.equals(t.p2,e)&&this.p2.equals(t.p1,e))}}class ft{constructor(t,e,s){this.a=t,this.b=e,this.c=s,this.type="angle"}static fromDegrees(t){return ft.fromRadians(t*(Math.PI/180))}static fromRadians(t){const e=new rt(1,0),s=e.rotate(t);return new ft(e,lt,s)}get rad(){const t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x);let e=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x)-t;return e<0&&(e+=nt),e}get deg(){return 180*this.rad/Math.PI}get isRight(){return L(this.rad,Math.PI/2,Math.PI/360)}get bisector(){if(this.b.equals(this.a))return;if(this.b.equals(this.c))return;const t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),e=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x);let s=(t+e)/2;t>e&&(s+=Math.PI);const i=Math.cos(s)+this.b.x,o=Math.sin(s)+this.b.y;return new dt(this.b,new rt(i,o))}get sup(){return this.rad<Math.PI?this:new ft(this.c,this.b,this.a)}get arc(){return new ht(this.b,this.a,this.rad)}project(){return this.c}at(){return this.c}contains(){return!1}transform(t){return new ft(this.a.transform(t),this.b.transform(t),this.c.transform(t))}rotate(t,e){return L(t,0)?this:new ft(this.a.rotate(t,e),this.b.rotate(t,e),this.c.rotate(t,e))}reflect(t){return new ft(this.a.reflect(t),this.b.reflect(t),this.c.reflect(t))}scale(t,e=t){return new ft(this.a.scale(t,e),this.b.scale(t,e),this.c.scale(t,e))}shift(t,e=t){return new ft(this.a.shift(t,e),this.b.shift(t,e),this.c.shift(t,e))}translate(t){return new ft(this.a.translate(t),this.b.translate(t),this.c.translate(t))}equals(t){return!1}}class gt{constructor(t=lt,e=1){this.c=t,this.r=e,this.type="circle"}get circumference(){return nt*this.r}get area(){return Math.PI*this.r**2}get arc(){const t=this.c.shift(this.r,0);return new ht(this.c,t,nt)}tangentAt(t){const e=this.at(t),s=this.c.rotate(Math.PI/2,e);return new dt(e,s)}collision(t){const e=this.c.x<t.p.x?t.p.x:this.c.x>t.p.x+t.w?t.p.x+t.w:this.c.x,s=this.c.y<t.p.y?t.p.y:this.c.y>t.p.y+t.h?t.p.y+t.h:this.c.y;return rt.distance(this.c,new rt(e,s))<=this.r}project(t){const e=t.subtract(this.c).unitVector.scale(this.r);return rt.sum(this.c,e)}at(t){const e=nt*t;return this.c.shift(this.r*Math.cos(e),this.r*Math.sin(e))}contains(t){return rt.distance(t,this.c)<=this.r}transform(t){const e=Math.abs(t[0][0])+Math.abs(t[1][1]);return new gt(this.c.transform(t),this.r*e/2)}rotate(t,e=lt){return L(t,0)?this:new gt(this.c.rotate(t,e),this.r)}reflect(t){return new gt(this.c.reflect(t),this.r)}scale(t,e=t){return new gt(this.c.scale(t,e),this.r*(t+e)/2)}shift(t,e=t){return new gt(this.c.shift(t,e),this.r)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return L(this.r,t.r,e)&&this.c.equals(t.c,e)}}function mt(t){return["polygon","polyline","rectangle","triangle"].includes(t.type)}function xt(t){return["polygon","triangle"].includes(t.type)}function bt(t){return"polyline"===t.type}function vt(t){return"rectangle"===t.type}function yt(t){return["line","ray","segment"].includes(t.type)}function wt(t){return"line"===t.type}function $t(t){return"segment"===t.type}function kt(t){return"circle"===t.type}function At(t){return"arc"===t.type}function Mt(t){return"sector"===t.type}function Ct(t){return"point"===t.type}function Tt(t,e){const s=t.p2.x-t.p1.x,i=t.p2.y-t.p1.y,o=F(s)+F(i),n=e.c.x,a=e.c.y,r=(t.p1.x-n)*(t.p2.y-a)-(t.p2.x-n)*(t.p1.y-a),l=F(e.r)*o-F(r);if(l<0)return[];const h=r*i/o,c=-r*s/o;if(L(l,0))return[e.c.shift(h,c)];const d=s*(i<0?-1:1)*Math.sqrt(l)/o,p=Math.abs(i)*Math.sqrt(l)/o;return[e.c.shift(h+d,c+p),e.c.shift(h-d,c-p)]}function Pt(t,e){let s=[];yt(t)&&yt(e)?s=function(t,e){const s=t.p1.x-t.p2.x,i=t.p1.y-t.p2.y,o=e.p1.x-e.p2.x,n=e.p1.y-e.p2.y,a=s*n-i*o;if(L(a,0))return[];const r=t.p1.x*t.p2.y-t.p1.y*t.p2.x,l=e.p1.x*e.p2.y-e.p1.y*e.p2.x;return[new rt((r*o-s*l)/a,(r*n-i*l)/a)]}(t,e):yt(t)&&kt(e)?s=Tt(t,e):kt(t)&&yt(e)?s=Tt(e,t):kt(t)&&kt(e)&&(s=function(t,e){const s=rt.distance(t.c,e.c);if(s>t.r+e.r)return[];if(s<Math.abs(t.r-e.r))return[];if(L(s,0)&&L(t.r,e.r))return[];if(L(s,t.r+e.r))return[new dt(t.c,e.c).midpoint];const i=(F(t.r)-F(e.r)+F(s))/(2*s),o=Math.sqrt(F(t.r)-F(i)),n=(e.c.x-t.c.x)*i/s+(e.c.y-t.c.y)*o/s+t.c.x,a=(e.c.y-t.c.y)*i/s-(e.c.x-t.c.x)*o/s+t.c.y,r=(e.c.x-t.c.x)*i/s-(e.c.y-t.c.y)*o/s+t.c.x,l=(e.c.y-t.c.y)*i/s+(e.c.x-t.c.x)*o/s+t.c.y;return[new rt(n,a),new rt(r,l)]}(t,e));for(const i of[t,e])"segment"===i.type&&(s=s.filter((t=>{return s=t,L((e=i).p1.x,e.p2.x)?S(s.y,e.p1.y,e.p2.y):S(s.x,e.p1.x,e.p2.x);var e,s}))),"ray"===i.type&&(s=s.filter((t=>{return s=t,L((e=i).p1.x,e.p2.x)?(s.y-e.p1.y)/(e.p2.y-e.p1.y)>0:(s.x-e.p1.x)/(e.p2.x-e.p1.x)>0;var e,s})));return s}function Lt(...t){if(t.length<2)return[];if(t.length>2)return x(W(t,2).map((t=>Lt(...t))));let[e,s]=t;if(mt(s)&&([e,s]=[s,e]),mt(e)){const t=yt(s)?e.points.filter((t=>s.contains(t))):[];for(const i of e.edges)t.push(...Lt(i,s));return t}return Pt(e,s)}class St{constructor(...t){this.type="polygon",this.points=t}get circumference(){if(this.points.length<=1)return 0;let t=rt.distance(this.points[0],u(this.points));for(let e=1;e<this.points.length;++e)t+=rt.distance(this.points[e-1],this.points[e]);return t}get signedArea(){const t=this.points,e=t.length;let s=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let i=1;i<e;++i)s+=t[i-1].x*t[i].y-t[i].x*t[i-1].y;return s/2}get area(){return Math.abs(this.signedArea)}get centroid(){const t=this.points,e=t.length;let s=0;for(let i=0;i<e;++i)s+=t[i].x;let i=0;for(let s=0;s<e;++s)i+=t[s].y;return new rt(s/e,i/e)}get edges(){const t=this.points,e=t.length,s=[];for(let i=0;i<e;++i)s.push(new ut(t[i],t[(i+1)%e]));return s}get radius(){const t=this.centroid,e=this.points.map((e=>rt.distance(e,t)));return Math.max(...e)}get oriented(){if(this.signedArea>=0)return this;const t=[...this.points].reverse();return new this.constructor(...t)}cut(t){let e=[];const s=[];for(const i of this.edges){const o=t.side(i.p1),n=t.side(i.p2);if(o&&n&&o!==n){const o=Lt(i,t)[0];e.push(new ut(i.p1,o));const a=new ut(o,i.p2);a.flag=n,e.push(a),s.push(a)}else 0===o&&n&&(s.push(i),i.flag=n),e.push(i)}if(s.length<2)return[this];s.sort(((e,s)=>t.offset(e.p1)-t.offset(s.p1)));const i=(t,s)=>{const i=e.length,o=[];s<t&&(s+=i);for(let n=t;n<=s;n++)o.push(e[n%i]);return o},o=t=>{const i=e.length,o=e[t].flag;let n=t;for(;;)if(n=(n+1)%i,e[n].flag===o&&(e[n].flag=void 0,s.splice(s.indexOf(e[n]),1)),n===t||e[n].flag)return n},n=[];let a=0;for(;s.length>=2;){let t=s[0],r=s[1],l=e.indexOf(t),h=e.indexOf(r),c=!1;if(o(l)===h?c=!0:([t,r]=[r,t],[l,h]=[h,l],o(l)===h&&(c=!0)),c?(a--,n.push(i(l,h)),e=i(h,l),t.flag=r.flag=void 0,s.splice(0,2),s.length<2&&n.push(e)):(a++,s.reverse()),a>1)break}return n.map((t=>new St(...t.map((t=>t.p1)))))}static collision(t,e){if(t.points.some((t=>e.contains(t))))return!0;if(e.points.some((e=>t.contains(e))))return!0;for(const s of t.edges)for(const t of e.edges)if(Lt(s,t)[0])return!0;return!1}static regular(t,e=1){const s=nt/t,i=Math.PI/2-s/2,o=p((t=>rt.fromPolar(i+s*t,e)),t);return new St(...o)}static interpolate(t,e,s=.5){const i=t.points.map(((t,i)=>rt.interpolate(t,e.points[i],s)));return new St(...i)}contains(t){let e=!1;for(const s of this.edges){if(s.p1.equals(t)||s.contains(t))return!1;if(s.p1.y>t.y==s.p2.y>t.y)continue;const i=(s.p2.x-s.p1.x)/(s.p2.y-s.p1.y);t.x<i*(t.y-s.p1.y)+s.p1.x&&(e=!e)}return e}at(t){return rt.interpolateList([...this.points,this.points[0]],t)}project(t){let e,s=1/0;for(const i of this.edges){const o=i.project(t),n=rt.distance(t,o);n<s&&(e=o,s=n)}return e||this.points[0]}transform(t){return new this.constructor(...this.points.map((e=>e.transform(t))))}rotate(t,e=lt){if(L(t,0))return this;const s=this.points.map((s=>s.rotate(t,e)));return new this.constructor(...s)}reflect(t){const e=this.points.map((e=>e.reflect(t)));return new this.constructor(...e)}scale(t,e=t){const s=this.points.map((s=>s.scale(t,e)));return new this.constructor(...s)}shift(t,e=t){const s=this.points.map((s=>s.shift(t,e)));return new this.constructor(...s)}translate(t){return this.shift(t.x,t.y)}equals(t){return!1}}class zt extends St{constructor(){super(...arguments),this.type="polyline"}get length(){let t=0;for(let e=1;e<this.points.length;++e)t+=rt.distance(this.points[e-1],this.points[e]);return t}get edges(){const t=[];for(let e=0;e<this.points.length-1;++e)t.push(new ut(this.points[e],this.points[e+1]));return t}}class Vt extends St{constructor(){super(...arguments),this.type="triangle"}get circumcircle(){const[t,e,s]=this.points,i=2*(t.x*(e.y-s.y)+e.x*(s.y-t.y)+s.x*(t.y-e.y)),o=(t.x**2+t.y**2)*(e.y-s.y)+(e.x**2+e.y**2)*(s.y-t.y)+(s.x**2+s.y**2)*(t.y-e.y),n=(t.x**2+t.y**2)*(s.x-e.x)+(e.x**2+e.y**2)*(t.x-s.x)+(s.x**2+s.y**2)*(e.x-t.x),a=new rt(o/i,n/i),r=rt.distance(a,this.points[0]);return new gt(a,r)}get incircle(){const t=this.edges,e=t.map((t=>t.length)),s=e[0]+e[1]+e[2],[i,o,n]=this.points,a=e[1]*i.x+e[2]*o.x+e[0]*n.x,r=e[1]*i.y+e[2]*o.y+e[0]*n.y,l=new rt(a/s,r/s),h=l.distanceFromLine(t[0]);return new gt(l,h)}get orthocenter(){const[t,e,s]=this.points;return Lt(new dt(t,e).perpendicular(s),new dt(t,s).perpendicular(e))[0]}}class Zt{constructor(t,e=1,s=e){this.p=t,this.w=e,this.h=s,this.type="rectangle"}static aroundPoints(t){let e=1/0,s=-1/0,i=1/0,o=-1/0;for(const n of t)e=e<n.x?e:n.x,s=s>n.x?s:n.x,i=i<n.y?i:n.y,o=o>n.y?o:n.y;return new Zt(new rt(e,i),s-e,o-i)}get center(){return new rt(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){const t=new rt(this.p.x+this.w,this.p.y),e=new rt(this.p.x+this.w,this.p.y+this.h),s=new rt(this.p.x,this.p.y+this.h);return new St(this.p,t,e,s)}collision(t){return this.p.x<t.p.x+t.w&&this.p.x+this.w>t.p.x&&this.p.y<t.p.y+t.h&&this.p.y+this.h>t.p.y}contains(t,e){return S(t.x,this.p.x,this.p.x+this.w,e)&&S(t.y,this.p.y,this.p.y+this.h,e)}project(t){let e;for(const s of this.edges){const i=s.project(t);(!e||rt.distance(t,i)<rt.distance(t,e))&&(e=i)}return e}at(t){return this.p}transform(t){return this.polygon.transform(t)}rotate(t,e=lt){return L(t,0)?this:this.polygon.rotate(t,e)}reflect(t){return this.polygon.reflect(t)}scale(t,e=t){return new Zt(this.p.scale(t,e),this.w*t,this.h*e)}shift(t,e=t){return new Zt(this.p.shift(t,e),this.w,this.h)}translate(t){return this.shift(t.x,t.y)}equals(t){return!1}}class Et{constructor(t,e,s,i){this.xMin=t,this.xMax=e,this.yMin=s,this.yMax=i}contains(t){return this.containsX(t)&&this.containsY(t)}containsX(t){return S(t.x,this.xMin,this.xMax)}containsY(t){return S(t.y,this.yMin,this.yMax)}resize(t,e){return new Et(this.xMin,this.xMax+t,this.yMin,this.yMax+e)}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}get rect(){return new Zt(new rt(this.xMin,this.yMin),this.dx,this.dy)}get center(){return new rt(this.xMin+this.dx/2,this.yMin+this.dy/2)}get flip(){return new Et(this.yMin,this.yMax,this.xMin,this.xMax)}}function Ht(t,e,s){const i=e.x*(s.y-t.y)+t.x*(e.y-s.y)+s.x*(t.y-e.y)>0?1:0,o=rt.distance(e,t);return[t.x,t.y+"A"+o,o,0,i,1,s.x,s.y].join(",")}function _t(t,e={}){let s=t.a;const i=t.b;let o=t.c;const n=e.size||function(t,e={}){return t.isRight&&!e.round?20:24+20*(1-U(t.rad,0,Math.PI)/Math.PI)}(t,e),a=rt.difference(s,i).unitVector,r=rt.difference(o,i).unitVector;s=rt.sum(i,a.scale(n)),o=rt.sum(i,r.scale(n));let l=e.fill?`M${i.x},${i.y}L`:"M";if(t.isRight&&!e.round){const t=rt.sum(s,r.scale(n));l+=`${s.x},${s.y}L${t.x},${t.y}L${o.x},${o.y}`}else l+=Ht(s,i,o);return e.fill&&(l+="Z"),l}function It(...t){return"M"+t.map((t=>t.x+","+t.y)).join("L")}function Ot(t,e){const s=t.perpendicularVector.scale(6),i=t.unitVector.scale(3),o=t.midpoint;switch(e){case"bar":return It(o.add(s),o.add(s.inverse));case"bar2":return It(o.add(i).add(s),o.add(i).add(s.inverse))+It(o.add(i.inverse).add(s),o.add(i.inverse).add(s.inverse));case"arrow":return It(o.add(i.inverse).add(s),o.add(i),o.add(i.inverse).add(s.inverse));case"arrow2":return It(o.add(i.scale(-2)).add(s),o,o.add(i.scale(-2)).add(s.inverse))+It(o.add(s),o.add(i.scale(2)),o.add(s.inverse));default:return""}}function Dt(t,e){if(!t||!e)return"";const s=e.perpendicular,i=t.add(e.scale(9)).add(s.scale(9)),o=t.add(e.scale(9)).add(s.scale(-9));return It(i,t,o)}function Bt(t,e={}){if("angle"===t.type)return _t(t,e);if($t(t)){if(t.p1.equals(t.p2))return"";let s=It(t.p1,t.p2);return e.mark&&(s+=Ot(t,e.mark)),e.arrows&&(s+=function(t,e){let s="";return i(e,"start","both")&&(s+=Dt(t.p1,t.unitVector)),i(e,"end","both")&&(s+=Dt(t.p2,t.unitVector.inverse)),s}(t,e.arrows)),s}if(function(t){return"ray"===t.type}(t)){if(!e.box)return"";const s=Lt(t,e.box)[0];return s?It(t.p1,s):""}if(wt(t)){if(!e.box)return"";const s=Lt(t,e.box);if(s.length<2)return"";let i=It(s[0],s[1]);return e.mark&&(i+=Ot(t,e.mark)),i}if(kt(t))return`M ${t.c.x-t.r} ${t.c.y} a ${t.r},${t.r} 0 1 0 ${2*t.r} 0 a ${t.r} ${t.r} 0 1 0 ${-2*t.r} 0`;if(At(t)){let s="M"+Ht(t.start,t.c,t.end);return e.arrows&&(s+=function(t,e){let s="";if(i(e,"start","both")){const e=new dt(t.c,t.start).perpendicularVector.inverse;s+=Dt(t.start,e)}if(i(e,"end","both")){const e=new dt(t.c,t.end).perpendicularVector;s+=Dt(t.end,e)}return s}(t,e.arrows)),s}return Mt(t)?`M ${t.c.x} ${t.c.y} L ${Ht(t.start,t.c,t.end)} Z`:bt(t)?It(...t.points):xt(t)?It(...t.points)+"Z":vt(t)?It(...t.polygon.points)+"Z":""}function Nt(t,e,s,i){return new(s||(s=Promise))((function(o,n){function a(t){try{l(i.next(t))}catch(t){n(t)}}function r(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}l((i=i.apply(t,e||[])).next())}))}function qt(t){const e=[];for(let s of Object.keys(t)){let i=t[s];s=encodeURIComponent(s),null!=i?(i=Array.isArray(i)?i.join(","):""+i,i=i.replace(/(\r)?\n/g,"\r\n"),i=encodeURIComponent(i),i=i.replace(/%20/g,"+"),e.push(s+"="+i)):e.push(s)}return e.join("&")}function Rt(t,e){return Nt(this,void 0,void 0,(function*(){const s=e instanceof FormData,i={method:"POST",body:s?e:e?qt(e):void 0,headers:{"X-CSRF-Token":window.csrfToken||""}};s||(i.headers["Content-Type"]="application/x-www-form-urlencoded");const o=t.includes("?")?"&xhr=1":"?xhr=1",n=yield fetch(t+o,i);if(!n.ok)throw new Error(`Fetch error ${n.status}: ${t}`);return n.text()}))}function jt(t,e=!1){return new Promise((s=>{const i=new Image;e||(i.crossOrigin="Anonymous"),i.onload=()=>s(i),i.src=t}))}const Ut=new Map;function Kt(t,e){Ut.has(t)?a(Ut.get(t),e,((t,e)=>m(t.concat(e)))):Ut.set(t,e)}function Ft(){if(window.navigator.onLine)for(const[t,e]of Ut)Ut.delete(t),Rt(t,{data:JSON.stringify(e)}).catch((s=>{console.error("Failed to send POST request:",s),Kt(t,e)}))}const Gt=c(Ft,5e3);var Wt;window.addEventListener("online",Gt),window.onbeforeunload=Ft,function(t){t[t.Array=0]="Array",t[t.BinaryOp=1]="BinaryOp",t[t.Call=2]="Call",t[t.Conditional=3]="Conditional",t[t.Identifier=4]="Identifier",t[t.Literal=5]="Literal",t[t.Member=6]="Member",t[t.UnaryOp=7]="UnaryOp"}(Wt||(Wt={}));const Qt={"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"**":(t,e)=>Math.pow(t,e),"<":(t,e)=>t<e,">":(t,e)=>t>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},Xt={"-":t=>-t,"+":t=>+t,"!":t=>!t},Yt={"||":1,"&&":2,"==":3,"!=":3,"===":3,"!==":3,"<":4,">":4,"<=":4,">=":4,"+":5,"-":5,"*":6,"/":6,"%":6,"**":7},Jt={true:!0,false:!1,undefined:void 0},te=/\s/,ee=/[0-9]/,se=/[a-zA-Zα-ωΑ-Ω$_]/,ie=/[0-9a-zA-Zα-ωΑ-Ω$_]/;function oe(t){const e=t.length;let s=0;function i(e){throw new Error(`${e} at character ${s} of "${t}"`)}function o(){for(;te.test(t[s]);)s+=1}function n(){let o=t[s];for(se.test(t[s])||i("Unexpected "+o),s+=1;s<e&&ie.test(t[s]);)o+=t[s++];return o in Jt?{type:Wt.Literal,value:Jt[o]}:{type:Wt.Identifier,name:o}}function a(o){const n=[];let a,r=!1;for(;s<e;){if(t[s]===o){a&&n.push(a),r=!0,s+=1;break}","===t[s]?(n.push(a||{type:Wt.Literal,value:void 0}),s+=1):a=h()}return r||i("Expected "+o),n}function r(){o();for(const e of[3,2,1]){const i=t.substr(s,e);if(i in Qt)return s+=e,i}}function l(){o();const r=t[s];return ee.test(r)||"."===r?function(){let e="";for(;ee.test(t[s]);)e+=t[s++];if("."===t[s])for(e+=t[s++];ee.test(t[s]);)e+=t[s++];const o=t[s];o&&se.test(o)?i(`Variable names cannot start with a number (${e+t[s]})`):"."===o&&i("Unexpected period");return{type:Wt.Literal,value:parseFloat(e)}}():"'"===r||'"'===r?function(){const o=t[s];s+=1;let n=!1,a="";for(;s<e;){const e=t[s++];if(e===o){n=!0;break}a+=e}return n||i(`Unclosed quote after "${a}"`),{type:Wt.Literal,value:a}}():"["===r?(s+=1,{type:Wt.Array,elements:a("]")}):r in Xt?(s+=1,{type:Wt.UnaryOp,operator:r,argument:l()}):se.test(r)||"("===r?function(){let e;if("("===t[s]){if(s+=1,e=h(),o(),")"===t[s])return s+=1,e;i("Unclosed (")}else e=n();for(o();".[(".includes(t[s]);)"."===t[s]?(s++,o(),e={type:Wt.Member,object:e,computed:!1,property:n()}):"["===t[s]?(s++,e={type:Wt.Member,object:e,computed:!0,property:h()},o(),"]"!==t[s]&&i("Unclosed ["),s++):"("===t[s]&&(s++,e={type:Wt.Call,args:a(")"),callee:e}),o();return e}():void i("Expression parsing error")}function h(){const e=function(){let t=l(),e=r();if(!e)return t;let s,o=l();o||i("Expected expression after "+e);const n=[t,e,o];for(;e=r();){const a=Yt[e],r=e;for(;n.length>2&&a<=Yt[n[n.length-2]];)o=n.pop(),e=n.pop(),t=n.pop(),s={type:Wt.BinaryOp,operator:e,left:t,right:o},n.push(s);s=l(),s||i("Expected expression after "+r),n.push(r,s)}let a=n.length-1;for(s=n[a];a>1;)s={type:Wt.BinaryOp,operator:n[a-1],left:n[a-2],right:s},a-=2;return s}();if(o(),!e||"?"!==t[s])return e;{s+=1;const n=h();if(n||i("Expected expression"),o(),":"===t[s]){s++;const t=h();return t||i("Expected expression"),{type:Wt.Conditional,test:e,consequent:n,alternate:t}}i("Expected :")}}const c=h();return s<t.length&&i(`Unexpected "${t[s]}"`),c}const ne=[void 0,void 0];function ae(t,e){switch(t.type){case Wt.Array:const s=t.elements.map((t=>ae(t,e)[0]));return s.some((t=>void 0===t))?ne:[s,void 0];case Wt.BinaryOp:const i=ae(t.left,e)[0],o=ae(t.right,e)[0];return!"+-**/%".includes(t.operator)||void 0!==i&&void 0!==o?[Qt[t.operator](i,o),void 0]:ne;case Wt.Call:const[n,a]=ae(t.callee,e),r=t.args.map((t=>ae(t,e)[0]));return r.some((t=>void 0===t))||"function"!=typeof n?ne:[n.apply(a,r),void 0];case Wt.Conditional:const l=ae(t.consequent,e),h=ae(t.alternate,e);return ae(t.test,e)[0]?l:h;case Wt.Identifier:return[e[t.name],void 0];case Wt.Literal:return[t.value,void 0];case Wt.Member:const c=ae(t.object,e)[0],d=t.computed?ae(t.property,e)[0]:t.property.name;return c?[c[d],c]:[void 0,void 0];case Wt.UnaryOp:const p=ae(t.argument,e)[0];return void 0===p&&"!"!==t.operator?ne:[Xt[t.operator](p),void 0]}}function re(t){const e=oe(t);return e?(t={})=>ae(e,t)[0]:(t={})=>{}}const le=/\${([^}]+)}/g;function he(t){const e=t.split(le),s=e.map(((t,e)=>e%2?re(t.replace(/×/g,"*")):void 0));return t=>e.map(((e,i)=>{if(!(i%2))return e;const o=s[i](t);return"number"==typeof o&&o<0?"–"+-o:o})).join("")}const ce="ontouchstart"in window,de="onpointerdown"in window;function pe(t){if(t.touches){const e=t.targetTouches.length?t.targetTouches:t.changedTouches;return new rt(e[0].clientX,e[0].clientY)}return new rt(t.clientX||0,t.clientY||0)}function ue(t,e){return pe(t).transform(e.inverseTransformMatrix)}function fe(t,e){const s=e.$box||t;let i=pe;"svg"===s.type?i=t=>ue(t,s.$ownerSVG):"canvas"===s.type&&(i=t=>function(t,e){const s=pe(t),i=e.bounds,o=(s.x-i.left)*e.canvasWidth/i.width,n=(s.y-i.top)*e.canvasHeight/i.height;return new rt(o,n)}(t,s));const o=e.justInside?t:je;let n,a,r=!1,l=0;function h(t){if(!n)return;if(l&&t.pointerId!==l)return;t.preventDefault();const s=i(t);rt.distance(s,a)<.5||(!r&&e.start&&e.start(n),e.move&&e.move(s,n,a),a=s,r=!0)}function c(t,s=!1){n&&(l&&t.pointerId!==l||(t.preventDefault(),o.off("pointermove",h),o.off("pointerstop",c),e.up&&e.up(a,n),r&&e.end&&e.end(a,n),r||!e.click||s||e.click(n),n=void 0))}"auto"===t.css("touch-action")&&t.css("touch-action","none"),t.addClass("noselect"),Je.onKey("escape",(()=>{if(!n)return;r&&e.move&&e.move(n,n,a),a=n;const t=document.createEvent("MouseEvent");t.pointerId=l,c(t,!0)})),t.on("pointerdown",(function(t){t.handled||function(t){return t.touches||[]}(t).length>1||(t.preventDefault(),r=!1,l=t.pointerId||0,o.on("pointermove",h),o.on("pointerstop",c),n=a=i(t),e.down&&e.down(n))})),e.justInside&&t.on("mouseleave",c),e.accessible&&(t.setAttr("tabindex","0"),document.addEventListener("keydown",(s=>{if(![37,38,39,40].includes(s.keyCode))return;if(t!==Je.getActiveInput())return;const o=t.boxCenter,n=i({clientX:o.x,clientY:o.y}),a=37===s.keyCode?-25:39===s.keyCode?25:0,r=38===s.keyCode?-25:40===s.keyCode?25:0,l=n.shift(a,r);e.down&&e.down(n),e.start&&e.start(n),e.move&&e.move(l,n,n),e.end&&e.end(l,n)})))}let ge;function me(t){for(const e of t){const t=e.isIntersecting?"enterViewport":"exitViewport";setTimeout((()=>Ne(e.target).trigger(t)))}}function xe(t){if(!t._data.intersectionEvents)if(t._data.intersectionEvents=!0,window.IntersectionObserver)ge||(ge=new IntersectionObserver(me)),ge.observe(t._el);else{let e=!1;je.on("scroll",(()=>{const s=t.isInViewport;e&&!s?(t.trigger("exitViewport"),e=!1):s&&!e&&(t.trigger("enterViewport"),e=!0)}))}}function be(t){if(t._data.pointerPositionEvents)return;t._data.pointerPositionEvents=!0;const e=t.parent;let s;e.on("pointerend",(()=>s=void 0)),e.on("pointermove",(e=>{const i=s,o=function(t){if(t instanceof PointerEvent&&"mouse"===t.pointerType)return Ne(t.target);const e=pe(t);return Ne(document.elementFromPoint(e.x,e.y)||void 0)}(e);s=o.equals(t)||o.hasParent(t),null!=i&&s&&!i&&t.trigger("pointerenter",e),!s&&i&&t.trigger("pointerleave",e)}))}function ve(t,e){e._data["_"+t]||(e._data["_"+t]=!0,de?e.on(t.replace("mouse","pointer"),(s=>{"mouse"===s.pointerType&&e.trigger(t,s)})):ce||e._el.addEventListener(t,(s=>e.trigger(t,s))))}const ye={scrollwheel:"DOMMouseScroll mousewheel",pointerdown:de?"pointerdown":ce?"touchstart":"mousedown",pointermove:de?"pointermove":ce?"touchmove":"mousemove",pointerup:de?"pointerup":ce?"touchend":"mouseup",pointercancel:de?"pointercancel":"touchcancel",pointerstop:de?"pointerup pointercancel":ce?"touchend touchcancel":"mouseup"},we={scroll:function(t){if(t._data.scrollEvents)return;t._data.scrollEvents=!0;let e,s=!1;function i(){const o=t.scrollTop;o!==e?(e=o,t.trigger("scroll",{top:e}),window.requestAnimationFrame(i)):s=!1}function o(){s||window.requestAnimationFrame(i),s=!0}function n(){window.removeEventListener("touchmove",o),window.removeEventListener("touchend",n)}("window"===t.type?window:t._el).addEventListener("scroll",o),t._el.addEventListener("touchstart",(function(t){t.handled||(window.addEventListener("touchmove",o),window.addEventListener("touchend",n))}))},tap:function(t){if(t._data.tapEvent)return;let e;t._data.tapEvent=!0,t.on("pointerdown",(t=>e=pe(t))),t.on("pointerup",(s=>{if(!e)return;const i=pe(s);rt.distance(e,i)<6&&t.trigger("tap",s),e=void 0})),t.on("pointercancel",(()=>e=void 0))},clickOutside:function(t){t._data.clickOutsideEvent||(t._data.clickOutsideEvent=!0,je.on("pointerdown",(e=>{const s=Ne(e.target);s&&(s.equals(t)||s.hasParent(t))||t.trigger("clickOutside",e)})))},key:function(t){t.on("keydown",(e=>{if(e.metaKey||e.ctrlKey)return;if(Je.isAndroid&&229===e.keyCode)return;const s=(e.key||String.fromCharCode(e.which)).toLowerCase();t.trigger("key",{code:e.keyCode,key:s})})),Je.isAndroid&&"input"===t.type&&t.on("input",(e=>{const s=e.data[e.data.length-1].toLowerCase();t.trigger("key",{code:void 0,key:s}),t.value=""}))},mousedown:ve.bind(void 0,"mousedown"),mousemove:ve.bind(void 0,"mousemove"),mouseup:ve.bind(void 0,"mouseup"),pointerenter:be,pointerleave:be,enterViewport:xe,exitViewport:xe,resize:function(t,e=!1){if(e&&(t._data.resizeObserver&&t._data.resizeObserver.disconnect(),t._data.resizeObserver=void 0),!t._data.resizeObserver)if(window.ResizeObserver){const e=new window.ResizeObserver((()=>t.trigger("resize")));e.observe(t._el),t._data.resizeObserver=e}else if(window.MutationObserver){const e=new MutationObserver((()=>t.trigger("resize")));e.observe(t._el,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),t._data.resizeObserver=e}}};function $e(t,e,s,i){if(e in we)we[e](t,!1);else if(e in ye){const o=y(ye[e]);for(const e of o)t._el.addEventListener(e,s,i)}else t._el.addEventListener(e,s,i)}function ke(t,e,s){if(e in we)t._events[e]&&t._events[e].length||we[e](t,!0);else if(s&&e in ye){const i=y(ye[e]);for(const e of i)t._el.removeEventListener(e,s)}else s&&t._el.removeEventListener(e,s)}function Ae(t,e){const s=new Map,i=new Map;let o,n=0;function a(t){o=t;const e=t(f);return o=void 0,e}function r(t){for(const e of s.values())e.has(t)&&e.delete(t)}function l(e,s){i.has(e)&&r(i.get(e));const n=()=>{t[e]=s(f),o===n&&(o=void 0),h(e)};i.set(e,n),a(n)}function h(e){const i=s.get(e);if(i)for(const e of i)e(t)}function c(){for(const e of s.values())for(const s of e)s(t)}function d(e){Object.assign(t,e),c()}function p(){for(n+=1;"_x"+n in t;)n+=1;return"_x"+n}function u(){t={},s.clear(),i.clear(),n=0}const f=new Proxy(t,{get:(i,n)=>"watch"===n?a:"unwatch"===n?r:"setComputed"===n?l:"forceUpdate"===n?c:"assign"===n?d:"getKey"===n?p:"clear"===n?u:"_internal"===n?[t,s]:(o&&(s.has(n)||s.set(n,new Set),s.get(n).add(o)),n in t||function(t){e&&e.watch((()=>f[t]=e[t]))}(n),t[n]),set:(e,s,o)=>(t[s]===o||(t[s]=o,i.has(s)&&(r(i.get(s)),i.delete(s)),h(s)),!0),deleteProperty:(e,o)=>(delete t[o],s.delete(o),i.delete(o),!0)});return f}const Me={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},Ce=/[astvzqmhlc]([^astvzqmhlc]*)/gi,Te=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function Pe(t){const e=[];let s;for(const i of t.match(Ce)||[]){const t=i[0].toUpperCase();if("Z"===t){e.push({type:"Z",points:[]});continue}const o=(i.slice(1).match(Te)||[]).map((t=>+t)),n=t===i[0];for(const[i,a]of b(o,Me[t]).entries()){let o,r=[],l="M"===t&&i>0?"L":t;"H"===t?(l="L",r=[new rt(a[0],n&&(null==s?void 0:s.y)||0)]):"V"===t?(l="L",r=[new rt(n&&(null==s?void 0:s.x)||0,a[0])]):"A"===t?(l="A",r=[new rt(a[5],a[6])],o=a.slice(0,5)):"MLCSQT".includes(t)&&(r=b(a,2).map((t=>new rt(t[0],t[1])))),!n&&s&&(r=r.map((t=>t.translate(s)))),s=u(r),e.push({type:l,points:r,options:o})}}return e}function Le(t){if(!t)return[];return Pe(t).map((t=>u(t.points))).filter((t=>!!t))}class Se{constructor(t){this._el=t,this._data={},this._events={},this.type="default",t._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(t){return this._el===t._el}addClass(t){for(const e of y(t))this._el.classList.add(e)}removeClass(t){for(const e of y(t))this._el.classList.remove(e)}hasClass(t){return this._el.classList.contains(t)}toggleClass(t){return this._el.classList.toggle(t)}setClass(t,e){e?this.addClass(t):this.removeClass(t)}attr(t){return this._el.getAttribute(t)||""}hasAttr(t){return this._el.hasAttribute(t)}setAttr(t,e){void 0===e?this.removeAttr(t):this._el.setAttribute(t,e.toString())}removeAttr(t){this._el.removeAttribute(t)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(t){this._el.innerHTML=t}get text(){return this._el.textContent||""}set text(t){this._el.textContent=t}set textStr(t){this._el.textContent=""+t}blur(){this._el.blur()}focus(){this._el.focus()}getParentModel(){const t=this.parent;return t?t.model||t.getParentModel():void 0}bindModel(t,e=!0){var s;if(!this.model){if(this.model=t,this.hasAttr(":for"))return this.makeDynamicList(t);for(const{name:e,value:s}of this.attributes)this.makeDynamicAttribute(e,s,t);for(const i of this.childNodes)if(i instanceof Text){if(null===(s=i.textContent)||void 0===s?void 0:s.includes("${")){const e=he(i.textContent);t.watch((()=>i.textContent=e(t)||""))}}else e&&i.bindModel(t)}}bindVariable(t,e){}makeDynamicAttribute(t,e,s){if(t.startsWith("@")){const i=t.slice(1),o=re(e);this.on(i,(()=>o(s)))}else if(":show"===t){const t=re(e);s.watch((()=>this.toggle(!!t(s))))}else if(":if"===t){const t=re(e),i=Ne(document.createComment(""));this.insertBefore(i);let o=!0;s.watch((()=>{const e=!!t(s);e!==o&&(e&&i.insertBefore(this),e||this.detach(),o=e)}))}else if(":html"===t){const t=re(e);s.watch((()=>this.html=t(s)||""))}else if(":draw"===t){const t=re(e);s.watch((()=>this.draw(t(s))))}else if(":class"===t){const t=re(e),i=this.attr("class")+" ";s.watch((()=>this.setAttr("class",i+t(s))))}else if(":bind"===t)this.bindVariable(s,e);else if(t.startsWith(":")){const i=re(e),o=t.slice(1);s.watch((()=>this.setAttr(o,i(s))))}else if(e.includes("${")){const i=he(e);s.watch((()=>this.setAttr(t,i(s)||"")))}(t.startsWith("@")||t.startsWith(":"))&&this.removeAttr(t)}makeDynamicList(t){const[e,s]=this.attr(":for").split(" in ");this.removeAttr(":for");const i=re(s),o=Ne(document.createComment(""));this.insertBefore(o),this.detach();const n=[];let a=0;t.watch((()=>{let s=i(t);Array.isArray(s)||(s=[]);for(let t=s.length;t<a;++t)n[t].detach();for(let t=a;t<n.length;++t)o.insertBefore(n[t]);for(let i=n.length;i<s.length;++i){const s=this.copy(!0);s.bindModel(Ae({[e]:void 0},t)),o.insertBefore(s),n.push(s)}a=s.length;for(let t=0;t<a;++t)n[t].model[e]=s[t]}))}get bounds(){return this._el.getBoundingClientRect()}get boundsRect(){const t=this.bounds;return new Zt(new rt(t.x,t.y),t.width,t.height)}contains(t){this.boundsRect.contains(t)}get isInViewport(){if(0===this.height)return!1;const t=this.bounds;return S(t.top,-t.height,Je.height)}get topLeftPosition(){const t=this.bounds;return new rt(t.left,t.top)}get boxCenter(){const t=this.bounds;return new rt(t.left+t.width/2,t.top+t.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}set scrollTop(t){this._el.scrollTop=t,this.trigger("scroll",{top:t,left:this.scrollLeft})}get scrollLeft(){return this._el.scrollLeft}set scrollLeft(t){this._el.scrollLeft=t,this.trigger("scroll",{top:this.scrollTop,left:t})}scrollTo(t,e=1e3,s="cubic"){t<0&&(t=0);const i=this.scrollTop,o=t-i;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=os((t=>{const e=i+o*as(s,t);this.scrollTop=e,this.trigger("scroll",{top:e})}),e)}scrollBy(t,e=1e3,s="cubic"){t&&this.scrollTo(this.scrollTop+t,e,s)}css(t,e){if(void 0===e){if("string"==typeof t)return window.getComputedStyle(this._el).getPropertyValue(t);{const e=Object.keys(t);for(const s of e)this._el.style.setProperty(s,""+t[s])}}else"string"==typeof t&&this._el.style.setProperty(t,""+e)}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){const t=this.transform;if(!t)return[[1,0,0],[0,1,0]];const e=t.match(/matrix\(([0-9,.\s-]*)\)/);if(!e||!e[1])return[[1,0,0],[0,1,0]];const s=e[1].split(",");return[[+s[0],+s[2],+s[4]],[+s[1],+s[3],+s[5]]]}get scale(){const t=this.transformMatrix;return[t[0][0],t[1][1]]}setTransform(t,e=0,s=1){let i="";t&&(i+=`translate(${j(t.x,.1)}px,${j(t.y,.1)}px)`),e&&(i+=` rotate(${e}rad)`),s&&(i+=` scale(${s})`),this._el.style.transform=i}translate(t,e){this.setTransform(new rt(t,e))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),"visibility"===this.data.display?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){"visibility"===this.data.display?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(t){t?this.show():this.hide()}is(t){return this._el.matches?this._el.matches(t):Array.from(document.querySelectorAll(t)).includes(this._el)}index(){let t=0,e=this._el;for(;void 0!==(e=e.previousSibling||void 0);)++t;return t}prepend(t){const e=this._el.childNodes;e.length?this._el.insertBefore(t._el,e[0]):this._el.appendChild(t._el)}append(t){this._el.appendChild(t instanceof Text?t:t._el)}insertBefore(t){this.parent._el.insertBefore(t._el,this._el)}insertAfter(t){const e=this._el.nextSibling;e?this.parent._el.insertBefore(t._el,e):this.parent._el.appendChild(t._el)}get next(){return Ne(this._el.nextSibling)}get prev(){return Ne(this._el.previousSibling)}$(t){return Ne(t,this)}$$(t){return qe(t,this)}get parent(){return Ne(this._el.parentElement||void 0)}parents(t){const e=[];let s=this.parent;for(;s;)t&&!s.is(t)||e.push(s),s=s.parent;return e}hasParent(...t){const e=t.map((t=>t._el));let s=this._el.parentNode;for(;s;){if(i(s,...e))return!0;s=s.parentNode}return!1}get children(){return Array.from(this._el.children||[],(t=>Ne(t)))}get childNodes(){return Array.from(this._el.childNodes,(t=>{if(!(t instanceof Comment))return t instanceof Text?t:Ne(t)})).filter((t=>t))}detach(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}remove(){this.detach()}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}on(t,e,s){for(const i of y(t))i in this._events?this._events[i].includes(e)||this._events[i].push(e):this._events[i]=[e],$e(this,i,e,s)}one(t,e,s){const i=s=>{this.off(t,i),e(s)};this.on(t,i,s)}off(t,e){for(const s of y(t))s in this._events&&(this._events[s]=e?this._events[s].filter((t=>t!==e)):[]),ke(this,s,e)}trigger(t,e={}){for(const s of y(t)){if(!this._events[s])return;for(const t of this._events[s])t.call(this,e)}}onKeyDown(t,e){const s=y(t).map((t=>Ke[t]||t));this._el.addEventListener("keydown",(t=>{s.indexOf(t.keyCode)>=0&&e(t)}))}onAttr(t,e){new MutationObserver((s=>{for(const i of s)"attributes"===i.type&&i.attributeName===t&&e(this.attr(t))})).observe(this._el,{attributes:!0}),e(this.attr(t),!0)}onPromise(t,e=!1){return e?Promise.resolve():new Promise((t=>this.one("solve",(()=>t()))))}animate(t,e=400,s=0,i="ease-in-out"){return rs(this,t,e,s,i)}enter(t="fade",e=500,s=0){return function(t,e="fade",s=500,i=0){if(t.show(),!ss)return is;const o=+t.css("opacity")||1;if("fade"===e)return rs(t,{opacity:[0,o]},s,i);if("pop"===e){const e=t.transform.replace(/scale\([0-9.]*\)/,"").replace(ls,"translate($1px,$2px)");return rs(t,{opacity:[0,o]},s,i),rs(t,{transform:[e+" scale(0.5)",e+" scale(1)"]},s,i,"bounce-in")}if("descend"===e){return rs(t,{opacity:[0,1],transform:["translateY(-50%)","none"]},s,i)}if(e.startsWith("draw")){const o=t.strokeLength;t.css("stroke-dasharray",o+"px"),t.css("opacity")||t.css("opacity",1);const n=rs(t,{"stroke-dashoffset":[o+"px","draw-reverse"===e?2*o+"px":0]},s,i,"linear");return n.promise.then((()=>t.css("stroke-dasharray",""))),n}if(e.startsWith("slide")){const n={opacity:[0,o],transform:["translateY(50px)","none"]};return e.includes("down")&&(n.transform[0]="translateY(-50px)"),e.includes("right")&&(n.transform[0]="translateX(-50px)"),e.includes("left")&&(n.transform[0]="translateX(50px)"),rs(t,n,s,i)}if(e.startsWith("reveal")){const n={opacity:[0,o],height:[0,"auto"]};return e.includes("left")&&(n.transform=["translateX(-50%)","none"]),e.includes("right")&&(n.transform=["translateX(50%)","none"]),rs(t,n,s,i)}return is}(this,t,e,s)}exit(t="fade",e=500,s=0,i=!1){return function(t,e="fade",s=400,i=0,o=!1){if(!t._el)return is;if(!ss)return t.hide(),is;if("none"===t.css("display"))return is;let n;if("fade"===e)n=rs(t,{opacity:[1,0]},s,i);else if("pop"===e){const e=t.transform.replace(/scale\([0-9.]*\)/,"");rs(t,{opacity:[1,0]},s,i),n=rs(t,{transform:[e+" scale(1)",e+" scale(0.5)"]},s,i,"bounce-out")}else if("ascend"===e){n=rs(t,{opacity:[1,0],transform:["none","translateY(-50%)"]},s,i)}else if(e.startsWith("draw")){const o=t.strokeLength;t.css("stroke-dasharray",o);n=rs(t,{"stroke-dashoffset":["draw-reverse"===e?2*o+"px":0,o+"px"]},s,i,"linear")}else if(e.startsWith("slide")){const o={opacity:0,transform:"translateY(50px)"};e.includes("up")&&(o.transform="translateY(-50px)"),n=rs(t,o,s,i)}else if(e.startsWith("reveal")){const o={opacity:0,height:0};e.includes("left")&&(o.transform="translateX(-50%)"),e.includes("right")&&(o.transform="translateX(50%)"),n=rs(t,o,s,i)}return n.promise.then((()=>o?t.remove():t.hide())),n}(this,t,e,s,i)}effect(t){this.one("animationend",(()=>this.removeClass("effects-"+t))),this.addClass("effects-"+t)}copy(t=!0,e=!0,s){const i=Ne(this._el.cloneNode(t));return e&&i.copyInlineStyles(this,t,s),i}copyInlineStyles(t,e=!0,s){const i=window.getComputedStyle(t._el);for(const t of s||Array.from(i))this.css(t,i.getPropertyValue(t));if(e){const e=this.children,i=t.children;for(let t=0;t<e.length;++t)e[t].copyInlineStyles(i[t],!0,s)}}}class ze extends Se{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return Ne(this._el.offsetParent||void 0)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){const t=parseFloat(this.css("padding-left")),e=parseFloat(this.css("padding-right"));return this._el.clientWidth-t-e}get innerHeight(){const t=parseFloat(this.css("padding-bottom")),e=parseFloat(this.css("padding-top"));return this._el.clientHeight-t-e}get outerWidth(){const t=parseFloat(this.css("margin-left")),e=parseFloat(this.css("margin-right"));return this.width+t+e||0}get outerHeight(){const t=parseFloat(this.css("margin-bottom")),e=parseFloat(this.css("margin-top"));return this.height+t+e||0}get positionTop(){let t=this._el,e=0;for(;t;)e+=t.offsetTop,t=t.offsetParent;return e}get positionLeft(){let t=this._el,e=0;for(;t;)e+=t.offsetLeft,t=t.offsetParent;return e}offset(t){if(t._el===this._el.offsetParent){const e=this.offsetTop+t._el.clientTop,s=this.offsetLeft+t._el.clientLeft;return{top:e,left:s,bottom:e+this.height,right:s+this.width}}{const e=t._el.getBoundingClientRect(),s=this._el.getBoundingClientRect();return{top:s.top-e.top,left:s.left-e.left,bottom:s.bottom-e.top,right:s.right-e.left}}}}const Ve=["font-family","font-size","font-style","font-weight","letter-spacing","text-decoration","color","display","visibility","alignment-baseline","baseline-shift","text-anchor","clip","clip-path","clip-rule","mask","opacity","filter","fill","fill-rule","marker","marker-start","marker-mid","marker-end","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-width","text-rendering","transform"];class Ze extends Se{constructor(){super(...arguments),this.type="svg"}get $ownerSVG(){return Ne(this._el.ownerSVGElement||void 0)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){const t=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+t}get positionTop(){const t=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+t}get inverseTransformMatrix(){const t=this._el.getScreenCTM().inverse(),e=[[t.a,t.c,t.e],[t.b,t.d,t.f]];if(Je.isFirefox){const t=this.transformMatrix;e[0][2]-=t[0][2],e[1][2]-=t[1][2]}return e}setTransform(t,e=0,s=1){const i=t?`translate(${j(t.x,.1)} ${j(t.y,.1)})`:"",o=L(e,0)?"":`rotate(${180*e/Math.PI})`,n=L(s,1)?"":`scale(${s})`;this.setAttr("transform",[i,o,n].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();{const t=this.bounds;return 2*t.height+2*t.width}}getPointAtLength(t){if(this._el instanceof SVGGeometryElement){const e=this._el.getPointAtLength(t);return new rt(e.x,e.y)}return new rt(0,0)}getPointAt(t){return this.getPointAtLength(t*this.strokeLength)}get points(){return Le(this.attr("d"))}set points(t){const e=t.length?"M"+t.map((t=>t.x+","+t.y)).join("L"):"";this.setAttr("d",e)}addPoint(t){const e=this.attr("d")+" L "+t.x+","+t.y;this.setAttr("d",e)}get center(){const t=+this.attr("TEXT"===this.tagName?"x":"cx"),e=+this.attr("TEXT"===this.tagName?"y":"cy");return new rt(t,e)}setCenter(t){this.setAttr("TEXT"===this.tagName?"x":"cx",t.x),this.setAttr("TEXT"===this.tagName?"y":"cy",t.y)}setLine(t,e){this.setAttr("x1",t.x),this.setAttr("y1",t.y),this.setAttr("x2",e.x),this.setAttr("y2",e.y)}setRect(t){this.setAttr("x",t.p.x),this.setAttr("y",t.p.y),this.setAttr("width",t.w),this.setAttr("height",t.h)}draw(t,e={}){if(!t)return this.setAttr("d","");const s={mark:this.attr("mark"),arrows:this.attr("arrows"),size:+this.attr("size")||void 0,fill:this.hasClass("fill"),round:this.hasAttr("round")};this.setAttr("d",Bt(t,o(e,s)))}}class Ee extends Ze{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get positionLeft(){return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){return parseInt(this.css("margin-top"))+this.parent.positionTop}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}drawPath(t,e={},s={}){const i=Re("path",e,this);return i.draw(t,s),i}pngImage(t,e,s){return Nt(this,void 0,void 0,(function*(){const i=this.copy(!0,!0,Ve);e||(e=t||this.svgHeight),t||(t=this.svgWidth),i.setAttr("width",t),i.setAttr("height",e),i.setAttr("viewBox",s||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),i.setAttr("xmlns","http://www.w3.org/2000/svg");const o=i.$$('image[href^="http"]');yield Promise.all(o.map((t=>Nt(this,void 0,void 0,(function*(){const e=yield jt(t.attr("href")),s=Re("canvas",{width:e.width,height:e.height});s.ctx.drawImage(e,0,0,e.width,e.height);const i=yield s.pngImage;t.setAttr("href",i)})))));const n=(new XMLSerializer).serializeToString(i._el),a="data:image/svg+xml;utf8,"+encodeURIComponent(n),r=Re("canvas",{width:t,height:e});r.ctx.fillStyle=Ue.css("background-color")||"white",r.ctx.fillRect(0,0,t,e);const l=yield jt(a);return r.ctx.drawImage(l,0,0,t,e),r.pngImage}))}downloadImage(t,e,s,i){const o=Je.isIOS?window.open("","_blank"):void 0;this.pngImage(e,s,i).then((e=>{if(o)return o.location.href=e;Re("a",{download:t,href:e,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}))}}class He extends ze{constructor(){super(...arguments),this.type="window"}get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}set scrollTop(t){document.body.scrollTop=document.documentElement.scrollTop=t,this.trigger("scroll",{top:t,left:this.scrollLeft})}get scrollLeft(){return window.pageXOffset}set scrollLeft(t){document.body.scrollLeft=document.documentElement.scrollLeft=t,this.trigger("scroll",{top:this.scrollTop,left:t})}}class _e extends ze{constructor(){super(...arguments),this.type="form"}get action(){return this._el.action}get formData(){const t={};for(const e of Array.from(this._el.elements)){const s=e.name||e.id;s&&(t[s]=e.value)}return t}get isValid(){return this._el.checkValidity()}}class Ie extends ze{constructor(){super(...arguments),this.type="input"}get checked(){return this._el.checked||!1}set checked(t){this._el.checked=t}get value(){return this._el.value}set value(t){this._el.value=t}bindVariable(t,e){const s="number"===this._el.type,i="checkbox"===this._el.type;if(e in t?i?this.checked=t[e]:this.value=t[e]:this.value&&(t[e]=i?this.checked:this.value),s){const s=this.hasAttr("min")?+this.attr("min"):-1/0,i=this.hasAttr("max")?+this.attr("max"):1/0;this.change((o=>t[e]=U(+o,s,i))),this.on("blur",(()=>this.value=t[e]))}else i?this.on("change",(()=>t[e]=this.checked)):this.change((s=>t[e]=s));t.watch((()=>{i?this.checked=t[e]:this.value=t[e]}))}setInputPattern(t){if(isNaN(+t))return;const e=t.match(/^[0-9]+$/);this.setAttr("inputmode",e?"numeric":"decimal"),e&&this.setAttr("pattern","[0-9]*")}change(t){let e=this.value||"";this.on("change keyup input paste",(()=>{this.value!==e&&(e=this.value.trim(),t(e))}))}validate(t){this.change((e=>this.setValidity(t(e))))}setValidity(t){this._el.setCustomValidity(t)}get isValid(){return this._el.checkValidity()}}class Oe extends ze{constructor(){super(...arguments),this.type="canvas"}getContext(t="2d",e={}){return this._el.getContext(t,e)}get pngImage(){return this._el.toDataURL("image/png")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(t,e={}){this.ctx.save(),function(t,e,s={}){if(s.fill&&(t.fillStyle=s.fill),s.opacity&&(t.globalAlpha=s.opacity),s.stroke&&(t.strokeStyle=s.stroke,t.lineWidth=s.strokeWidth||1,s.lineCap&&(t.lineCap=s.lineCap),s.lineJoin&&(t.lineJoin=s.lineJoin)),t.beginPath(),$t(e))t.moveTo(e.p1.x,e.p1.y),t.lineTo(e.p2.x,e.p2.y);else if(kt(e))t.arc(e.c.x,e.c.y,e.r,0,nt);else if(xt(e)){t.moveTo(e.points[0].x,e.points[0].y);for(const s of e.points.slice(1))t.lineTo(s.x,s.y);t.closePath()}else if(bt(e)){t.moveTo(e.points[0].x,e.points[0].y);for(const s of e.points.slice(1))t.lineTo(s.x,s.y)}s.fill&&t.fill(),s.stroke&&t.stroke()}(this.ctx,t,e),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}fill(t){this.ctx.save(),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.restore()}clearCircle(t,e){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore()}downloadImage(t){Re("a",{download:t,href:this.pngImage,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}}class De extends ze{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}}const Be=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","tspan","pattern","mask","svg","foreignObject","image","use"];function Ne(t,e){if(!t)return;const s=e?e._el:document.documentElement,i="string"==typeof t?s.querySelector(t):t;if(!i)return;if(i._view)return i._view;const o=(i.tagName||"").toLowerCase();return"svg"===o?new Ee(i):"canvas"===o?new Oe(i):"form"===o?new _e(i):"input"===o||"select"===o||"textarea"===o?new Ie(i):"video"===o||"audio"===o?new De(i):Be.includes(o)?new Ze(i):new ze(i)}function qe(t,e){const s=e?e._el:document.documentElement,i=t?s.querySelectorAll(t):[];return Array.from(i,(t=>Ne(t)))}function Re(t,e={},s){const i=Be.includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);for(const[t,s]of Object.entries(e))void 0!==s&&("id"===t?i.id=s:"html"===t?i.innerHTML=s:"text"===t?i.textContent=s:"path"===t?i.setAttribute("d",Bt(s)):i.setAttribute(t,s));const o=Ne(i);return s&&s.append(o),o}const je=new He(document.body),Ue=new He(document.documentElement),Ke={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},Fe="_M",Ge=window.navigator.userAgent.toLowerCase(),We={};for(const[t,e]of Object.entries(Ke))We[e]=t;const Qe=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,Xe=/iphone|ipad|ipod/i,Ye=/^((?!chrome|android).)*safari/i;const Je=window.BoostBrowser||new class{constructor(){var t,e,s;this.isMobile=Qe.test(Ge),this.isRetina=(window.devicePixelRatio||1)>1,this.isTouch=!!window.Touch||"ontouchstart"in window,this.isChrome=!!window.chrome,this.isFirefox=Ge.indexOf("firefox")>=0,this.isAndroid=Ge.indexOf("android")>=0,this.isIOS=Xe.test(Ge),this.isSafari=Xe.test(Ge)||Ye.test(Ge),this.loadQueue=[],this.loaded=!1,this.width=window.innerWidth,this.height=window.innerHeight,this.resizeCallbacks=[],this.theme={name:"light",isDark:!1},this.themeChangedCallbacks=[],this.themeOverride="",this.darkQuery=null===(t=window.matchMedia)||void 0===t?void 0:t.call(window,"(prefers-color-scheme: dark)"),window.onload=()=>this.afterLoad(),document.addEventListener("DOMContentLoaded",(()=>this.afterLoad()));const i=c((()=>this.applyResize()));window.addEventListener("resize",i);try{null===(e=this.darkQuery)||void 0===e||e.addEventListener("change",(()=>this.applyThemeChange()))}catch(t){null===(s=this.darkQuery)||void 0===s||s.addListener((()=>this.applyThemeChange()))}const o=this.getCookie("theme");o&&this.setTheme(o);try{this.localStorage=window.localStorage}catch(t){console.warn("Unable to access Local Storage in this context.")}}afterLoad(){if(!this.loaded){this.loaded=!0;for(const t of this.loadQueue)t();setTimeout((()=>this.resize()))}}ready(t){this.loaded?t():this.loadQueue.push(t)}redraw(){document.body.offsetHeight}applyResize(){const t=window.innerWidth,e=window.innerHeight;if(this.width!==t||this.height!==e){this.width=t,this.height=e;for(const t of this.resizeCallbacks)t({width:this.width,height:this.height});je.trigger("scroll",{top:je.scrollTop})}}onResize(t){t({width:this.width,height:this.height}),this.resizeCallbacks.push(t)}offResize(t){const e=this.resizeCallbacks.indexOf(t);e>=0&&this.resizeCallbacks.splice(e,1)}resize(){this.applyResize()}applyThemeChange(){const t=this.theme.name,e="dark"===t||"auto"===t&&this.darkQuery.matches;if(e!==this.theme.isDark){this.theme.isDark=e,Ue.setAttr("theme",this.themeOverride||(e?"dark":"light"));for(const t of this.themeChangedCallbacks)t(this.theme)}}setTheme(t){t!==this.theme.name&&(this.theme.name=t,this.setCookie("theme",t),this.applyThemeChange())}onThemeChange(t){this.themeChangedCallbacks.push(t)}getHash(){return window.location.hash.slice(1)}setHash(t){const e=document.body.scrollTop;window.location.hash=t,document.body.scrollTop=e}setURL(t,e=""){window.history.replaceState({},e,t),e&&(window.document.title=e)}getCookies(){const t=document.cookie.split(";"),e={};for(let s=0,i=t.length;s<i;++s){const i=t[s].split("=");e[decodeURIComponent(i[0]).trim()]=decodeURIComponent(i[1])}return e}getCookie(t){const e=document.cookie.match(new RegExp(`(^|;) ?${t}=([^;]*)(;|$)`));return e?e[2]:void 0}setCookie(t,e,s=31536e3){const i=window.location.hostname.replace(/^[a-z]{2}\./,"");document.cookie=`${t}=${e};path=/;max-age=${s};domain=${i}`}deleteCookie(t){this.setCookie(t,"",-1)}setStorage(t,e){var s,i;const o=(t||"").split("."),n=d((null===(s=this.localStorage)||void 0===s?void 0:s.getItem(Fe))||void 0);let a=n;for(let t=0;t<o.length-1;++t)null==a[o[t]]&&(a[o[t]]={}),a=a[o[t]];a[o[o.length-1]]=e,null===(i=this.localStorage)||void 0===i||i.setItem(Fe,JSON.stringify(n))}getStorage(t){var e;let s=d((null===(e=this.localStorage)||void 0===e?void 0:e.getItem(Fe))||void 0);if(!t)return s;const i=(t||"").split("."),o=i.pop();for(const t of i){if(!(t in s))return;s=s[t]}return s[o]}deleteStorage(t){var e;t?this.setStorage(t,void 0):null===(e=this.localStorage)||void 0===e||e.setItem(Fe,"")}getActiveInput(){const t=document.activeElement;return t===document.body?void 0:Ne(t)}onKey(t,e,s=!1){const i=y(t),o=s?"keyup":"keydown";document.addEventListener(o,(t=>{const s=We[t.keyCode]||t.key;if(!i.includes(s))return;const o=this.getActiveInput();o&&o.is("input, textarea, [contenteditable]")||o&&["space","enter","tab"].includes(s)&&o.is("button, a, [tabindex]")||e(t,s)}))}};window.BoostBrowser=Je;const ts=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/.test(navigator.userAgent)||+(navigator.userAgent.match(/\bEdge\/12\.(\d+)\b/)||[])[1]<10547||+(navigator.userAgent.match(/\bAppleWebKit\/(\d+)\b/)||[])[1]<537,es={};let ss=!1;setTimeout((()=>ss=!0));const is={cancel:()=>{},promise:Promise.resolve()};function os(t,e){if(0===e)return t(1,0,(()=>{})),is;const s=Date.now(),i=l();let o=0,n=!0;const a=()=>{n=!1,i.reject()};return function r(){n&&(!e||o<=e)&&window.requestAnimationFrame(r);const l=Date.now()-s;t(e?Math.min(1,l/e):l,l-o,a),e&&l>=e&&i.resolve(),o=l}(),{cancel:a,promise:i.promise}}function ns(t,e=0,s=0){switch(t){case"quad":return Math.pow(e,2);case"cubic":return Math.pow(e,3);case"quart":return Math.pow(e,4);case"quint":return Math.pow(e,5);case"circ":return 1-Math.sqrt(1-Math.pow(e,2));case"sine":return 1-Math.cos(e*Math.PI/2);case"exp":return e<=0?0:Math.pow(2,10*(e-1));case"back":return s||(s=1.70158),e*e*((s+1)*e-s);case"elastic":return s||(s=.3),-Math.pow(2,10*(e-1))*Math.sin((2*(e-1)/s-.5)*Math.PI);case"swing":return.5-Math.cos(e*Math.PI)/2;case"spring":return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e);case"bounce":return e<1/11?1/64-7.5625*(.5/11-e)*(.5/11-e):e<3/11?1/16-7.5625*(2/11-e)*(2/11-e):e<7/11?1/4-7.5625*(5/11-e)*(5/11-e):1-7.5625*(1-e)*(1-e);default:return e}}function as(t,e=0,s=0){if(0===e)return 0;if(1===e)return 1;const[i,o]=t.split("-");return"in"===o?ns(i,e,s):"out"===o?1-ns(i,1-e,s):e<=.5?ns(i,2*e,s)/2:1-ns(i,2*(1-e),s)/2}function rs(t,e,s=400,i=0,o="ease-in-out"){if(!ss)return Object.keys(e).forEach((s=>{const i=e[s];t.css(s,Array.isArray(i)?i[1]:i)})),is;"bounce-in"===o&&(o="cubic-bezier(0.175, 0.885, 0.32, 1.275)"),"bounce-out"===o&&(o="cubic-bezier(0.68, -0.275, 0.825, 0.115)");let n="";Je.isSafari&&(n=t._el.style.transition,t.css("transition","none"),Je.redraw());const a=t._data.animation;a&&a.cancel();const r={},h={},c=l(),d=window.getComputedStyle(t._el);Object.keys(e).forEach((s=>{const o=e[s],n=s.toLowerCase().replace(/^-/,"").replace(/-(.)/g,((t,e)=>e.toUpperCase()));h[n]=Array.isArray(o)?o[0]:d.getPropertyValue(s),r[n]=Array.isArray(o)?o[1]:o,i&&t.css(s,h[n])}));const p=r.height;let u;"auto"===r.height&&(r.height=f(t.children.map((t=>t.outerHeight)))+"px");let g=!1;!function(t,e=0){e?setTimeout(t,e):t()}((()=>{g||(u=t._el.animate([h,r],{duration:s,easing:o,fill:"forwards"}),u.onfinish=()=>{t._el&&Object.keys(e).forEach((e=>t.css(e,"height"===e?p:r[e]))),Je.isSafari&&t.css("transition",n),c.resolve(),u.cancel()})}),i);const m={cancel(){g=!0,t._el&&Object.keys(e).forEach((e=>t.css(e,t.css(e)))),u&&u.cancel()},promise:c.promise};return setTimeout((()=>t._data.animation=m)),m}const ls=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;class hs extends w{constructor(t,e,s={}){let i;super(),this.$el=t,this.position=new rt(0,0),this.disabled=!1,this.width=0,this.height=0,this.options=o(s,{moveX:!0,moveY:!0}),this.setDimensions(e),fe(t,{start:()=>{this.disabled||(i=this.position,this.trigger("start"),Ue.addClass("grabbing"))},move:(t,e)=>{this.disabled||(this.setPosition(i.x+t.x-e.x,i.y+t.y-e.y),this.trigger("drag",this.position))},end:(t,e)=>{this.disabled||(this.trigger(t.equals(e)?"click":"end"),Ue.removeClass("grabbing"))},accessible:!0}),Je.onResize((()=>{const t=this.width,s=this.height;this.setDimensions(e),this.setPosition(this.position.x*this.width/t||0,this.position.y*this.height/s||0)}))}setDimensions(t){"svg"===t.type?(this.width=this.options.width||t.svgWidth,this.height=this.options.height||t.svgHeight):(this.width=this.options.width||t.width,this.height=this.options.height||t.height)}setPosition(t,e){const s=this.options.margin||0;let i=new rt(this.options.moveX?t:0,this.options.moveY?e:0).clamp(new Et(0,this.width,0,this.height),s).round(this.options.snap||1);this.options.round&&(i=this.options.round(i)),i.equals(this.position)||(this.position=i,this.options.useTransform?this.$el.translate(i.x,i.y):(this.options.moveX&&this.$el.css("left",i.x+"px"),this.options.moveY&&this.$el.css("top",i.y+"px")),this.trigger("move",i))}}function cs(t,e){const s=e.regex.exec(t);if(s){s.shift();const t={};for(const[i,o]of e.params.entries())t[o]=s[i];return t}}let ds="complete"===document.readyState;window.addEventListener("load",(()=>setTimeout((()=>ds=!0)))),"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");const ps=new class extends w{constructor(){super(...arguments),this.$viewport=je,this.views=[],this.active={path:"",hash:""},this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(t={}){t.$viewport&&(this.$viewport=t.$viewport),t.initialise&&(this.initialise=t.initialise),t.preloaded&&(this.preloaded=t.preloaded),t.transition&&(this.transition=t.transition),t.noLoad&&(this.noLoad=t.noLoad),t.click&&je.on("click",(t=>this.onLinkClick(t))),t.history&&window.addEventListener("popstate",(t=>Nt(this,void 0,void 0,(function*(){var e;if(!ds||!(null===(e=t.state)||void 0===e?void 0:e.path))return;(yield this.load(t.state.path,t.state.hash))||window.history.pushState(this.active,"",this.active.path+this.active.hash)}))))}view(t,{enter:e,exit:s,template:i}={}){const o=(t.match(/:\w+/g)||[]).map((t=>t.substr(1))),n=t.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")+"\\/?",a=t.includes("?")?"":"(\\?.*)?",r={regex:new RegExp("^"+n+a+"$","i"),params:o,enter:e,exit:s,template:i};this.views.push(r);const l=window.location.pathname+window.location.search,h=cs(l,r);h&&(this.active={path:l,hash:window.location.hash},window.history.replaceState(this.active,"",this.active.path+this.active.hash),Je.ready((()=>{setTimeout((()=>{this.preloaded?(this.initialise(this.$viewport,h),r.enter&&r.enter(this.$viewport,h)):this.loadView(r,h)}))})))}paths(...t){for(const e of t)this.view(e)}getView(t){for(const e of this.views){const s=cs(t,e);if(s)return{view:e,params:s}}}load(t,e){return Nt(this,void 0,void 0,(function*(){if(t===this.active.path&&e!==this.active.hash)return this.trigger("hashChange",e.slice(1)),this.trigger("change",t+e),this.active={path:t,hash:e},!0;const s=this.getView(t);return!!s&&(!(this.beforeChange&&!(yield this.beforeChange()))&&(this.active={path:t,hash:e},this.trigger("change",t+e),window.ga&&window.ga("send","pageview",t+e),this.noLoad?s.view.enter&&s.view.enter(this.$viewport,s.params):this.loadView(s.view,s.params),!0))}))}loadView(t,e={}){return Nt(this,void 0,void 0,(function*(){this.showLoadingBar();const s=this.active.path,i=yield function(t,e,s){return Nt(this,void 0,void 0,(function*(){return t.template?"string"==typeof t.template?t.template:t.template(e):(yield fetch(s+(s.indexOf("?")>=0?"&xhr=1":"?xhr=1"))).text()}))}(t,e,s);if(this.active.path!==s)return;yield this.$viewport.animate({opacity:0},200).promise,this.$viewport.removeChildren(),je.scrollTop=0,this.$viewport.html=i,Je.resize(),function(){if(!ts)return;Array.from(document.querySelectorAll("svg > use")).forEach((function(t){const e=t.getAttribute("xlink:href"),[s,i]=e.split("#");if(!s.length||!i)return;const o=t.parentNode;o.removeChild(t),s in es||(es[s]=fetch(s).then((t=>t.text()))),es[s].then((t=>{const e=document.implementation.createHTMLDocument("");e.documentElement.innerHTML=t;const s=e.getElementById(i).cloneNode(!0),n=document.createDocumentFragment();for(;s.childNodes.length;)n.appendChild(s.firstChild);o.appendChild(n)}))}))}(),this.$viewport.animate({opacity:1},200),this.hideLoadingBar();const o=this.$viewport.$("title");o&&(document.title=o.text),this.initialise(this.$viewport,e),t.enter&&t.enter(this.$viewport,e),this.trigger("afterChange",{$viewport:this.$viewport})}))}onLinkClick(t){if(t.metaKey||t.ctrlKey||t.shiftKey)return;if(t.defaultPrevented)return;let e=t.target;for(;e&&"A"!==e.nodeName;)e=e.parentNode;if(!e||"A"!==e.nodeName)return;const s=e;if(s.target)return;if(s.origin!==window.location.origin)return;if(s.hasAttribute("download")||"external"===s.getAttribute("rel"))return;const i=s.getAttribute("href");i&&i.indexOf("mailto:")>-1||this.getView(s.pathname+s.search)&&(t.preventDefault(),this.goTo(s.pathname+s.search,s.hash))}goTo(t,e=""){return Nt(this,void 0,void 0,(function*(){const s=this.active.path+this.active.hash;(yield this.load(t,e))&&s!==this.active.path+this.active.hash&&window.history.pushState(this.active,"",t+e)}))}replace(t,e=""){this.active={path:t,hash:e},window.history.replaceState(this.active,"",t+e)}back(){window.history.back()}forward(){window.history.forward()}showLoadingBar(){this.$loadingBar||(this.$loadingBar=Re("div",{style:"position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #0f82f2; pointer-events: none; z-index: 9999; will-change: transform;"},je)),this.$loadingBar.css({transform:"translateX(-100%)",opacity:1}),this.$loadingBar.show(),this.animation=os((t=>{this.$loadingBar.css("transform",`translateX(-${10+90*Math.exp(-4*t)}%)`)}),3e3)}hideLoadingBar(){var t,e,s;return Nt(this,void 0,void 0,(function*(){null===(t=this.animation)||void 0===t||t.cancel(),yield null===(e=this.$loadingBar)||void 0===e?void 0:e.animate({transform:"none",opacity:0}).promise,null===(s=this.$loadingBar)||void 0===s||s.hide()}))}};function us(t){const e=[];for(const s of Array.from(t.children))s.tagName.startsWith("X-")?e.push(s):e.push(...us(s));return e}const fs=new Map;class gs extends HTMLElement{constructor(){super(...arguments),this.wasConnected=!1,this.isReady=!1}connectedCallback(){return Nt(this,void 0,void 0,(function*(){if(this.wasConnected)return void this._view.trigger("connected");this.wasConnected=!0,this.isReady=!1,this._view.created();const t=fs.get(this._view.tagName)||{};t.template&&function(t,e){const s=Array.from(t.childNodes);t.innerHTML=e;const i={};for(const e of Array.from(t.querySelectorAll("slot")))i[e.getAttribute("name")||""]=e;for(const t of s){const e=i[t.getAttribute&&t.getAttribute("slot")||""]||i[""];e&&e.parentNode.insertBefore(t,e)}for(const t of Object.values(i))t.parentNode.removeChild(t)}(this,t.template);const e=us(this).filter((t=>!t.isReady)).map((t=>new Promise((e=>t.addEventListener("ready",e)))));yield Promise.all(e),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0}))}disconnectedCallback(){this._view.trigger("disconnected")}}class ms extends ze{created(){}ready(){}}function xs(t,e={}){return function(s){fs.set(t.toUpperCase(),e),window.customElements.define(t,class extends gs{constructor(){super(),this._view=new s(this)}})}}function bs(t,e,s,i){let o,n;t:for(const[a,r]of s)for(const s of e){const e=(i?i(a,s):a).subtract(s),l=e.length;if(l<t&&(t=l,o=e,n=r,l<1))break t}return o?{shift:o,target:n}:void 0}function vs(t){if(Ct(t))return[t];if(mt(t))return t.points;if($t(t))return[t.p1,t.p2];if(kt(t))return[t.c.shift(t.r,0),t.c.shift(-t.r,0),t.c.shift(0,t.r),t.c.shift(0,-t.r)];if(Mt(t)||At(t)){const e=[t.start,t.end];Mt(t)&&e.push(t.c);const s=t.radius;for(const[i,o]of[[s,0],[0,s],[-s,0],[0,-s]]){const s=t.c.shift(i,o);t.contains(s)&&e.push(s)}return e}return[]}function ys(...t){return Zt.aroundPoints(function*(){for(const e of t)for(const t of vs(e))yield t}())}function ws(t,e,s=0){if(!t.size&&!e.size)return new Et(0,100,0,100);const i=Zt.aroundPoints(function*(){for(const e of t)if(e.transformed)for(const t of vs(e.transformed))yield t;for(const t of e){yield t.segments[0].p1;for(const e of t.segments)yield e.p2}}());return new Et(i.p.x-s,i.p.x+i.w+s,i.p.y-s,i.p.y+i.h+s)}function $s(t,e,s){if(Ct(e))return t.contains(e);if(xt(e))return St.collision(t.polygon,e);if(vt(e))return e.collision(t);if(yt(e))return Lt(e,t).length>0||t.contains(e.p1);if(kt(e))return"geo"===s?Lt(e,t).length>0||t.contains(e.at(0)):e.collision(t);if(Mt(e)){const s=new St(e.c,e.start,e.at(.25),e.at(.5),e.at(.75),e.end);return St.collision(t.polygon,s)}return!1}const ks=new Map;function As(t){if(!t||!Je.theme.isDark)return t;if(ks.has(t))return ks.get(t);const e=P.fromHex(t).hsl;S(e[2],20,80)||(e[2]=100-e[2]);const s=P.fromHsl(...e).hex;return ks.set(t,s),s}const Ms=180/Math.PI,Cs=Math.PI/180,Ts={grey:"#cccccc",darkGrey:"#242436",red:"#cd0e66",orange:"#eb4726",yellow:"#fd8c00",lime:"#bfc212",green:"#22ab24",teal:"#009ea6",blue:"#0f82f2",purple:"#6d3bbf"},Ps=new Map;class Ls{constructor(t,e,i){this.$parent=t,this.type="tile",this.options="",this.colour="",this.posn=lt,this.rot=0,this.flipped=!1,this.locked=!1,this.isActive=!1,this.snapAngles=[0,90],this.rotateAroundOrigin=!1,this.showSelectionOutline=!1,this.hideSelectionOutline=!1,this.canDragToSelect=!0,this.keepOnTop=!1,this.canRotate=!0,this.canMove=!0,this.$el=i||Re("g",{class:"tile"},t.$tiles),t.tiles.add(this),Ps.set(this.$el._el,this),this.id=e||s(10),t.tileMap.set(this.id,this)}makeHandle(t,e,s){const i=Re("c"===t?"circle":"path",{class:"handle"},this.$el);"h"===t&&i.setAttr("d","M12.5,0H0V25H12.5a12.5,12.5,0,0,0,0-25Z"),"v"===t&&i.setAttr("d","M0,0V12.5a12.5,12.5,0,0,0,25,0V0Z"),"c"===t&&i.setAttr("r",10);let o,n="";return this.$parent.events.listen(i,{start:()=>{this.$parent.selection.add(this,!0),n=this.options,o=this.size},move:({posn:t})=>e(this.relativePosn(t),t),click:()=>null==s?void 0:s(),end:()=>{this.options===n&&this.size===o||this.$parent.change({tilesChanged:[this]})}}),i}setColour(t){this.colour=t}setSize(t){this.size=t}flip(t){this.flipped=!this.flipped}click(t){}select(){this.isActive=!0,this.$parent.$activeTiles.append(this.$el)}deselect(){this.isActive=!1,this.$parent.$tiles.append(this.$el)}moveStart(){this.startPosn=this.posn}move(t,e){t&&(this.posn=this.startPosn.add(t),this.transform(!0))}moveEnd(){}transform(t=!1){const e=this.rot*Cs;this.$el.setTransform(this.posn,e),this.customTransform(this.posn,e),!t&&this.path&&(this.transformed=this.path.rotate(e).translate(this.posn),this.snapPoints=this.getSnapPoints().map((t=>t.rotate(e).translate(this.posn))),this.snapLines=this.getSnapLines().map((t=>t.rotate(e).translate(this.posn))))}customTransform(t,e){}setTransform(t,e=this.rot){this.posn=t,this.rot=G(e,360),this.transform()}static makeThumbnail(t,e,s,i){}getSnapPoints(){return this.path?Ct(this.path)?[this.path]:mt(this.path)?this.path.points:yt(this.path)?[this.path.p1,this.path.p2]:kt(this.path)?[this.path.c,this.path.c.shift(0,this.path.r),this.path.c.shift(0,-this.path.r),this.path.c.shift(this.path.r,0),this.path.c.shift(-this.path.r,0)]:Mt(this.path)?[this.path.c,this.path.start,this.path.end]:At(this.path)?[this.path.start,this.path.end]:[]:[]}getSnapLines(){return[]}delete(){this.$parent.selection.remove(this),this.$parent.tiles.delete(this),this.$parent.tileMap.delete(this.id),Ps.delete(this.$el._el),this.$el.remove(),this.$parent.trigger("delete-tile",{tile:this})}copy(t={},e=25){const s=new this.constructor(this.options,this.$parent);return this.colour&&s.setColour(this.colour),this.flipped&&s.flip(),s.setTransform(this.posn.shift(e,e),this.rot),this.size&&s.setSize(this.size),s}relativePosn(t){return t.subtract(this.posn).rotate(-this.rot*Cs)}get center(){return this.path?ys(this.path).center:lt}get ariaDescription(){return`${this.type}: ${this.options}`}static action(t,e,s,i){}toJSON(){return{id:this.id,name:this.type,options:this.options,x:this.posn.x,y:this.posn.y,rot:this.rot,size:this.size,flipped:this.flipped,locked:this.locked,colour:this.colour}}static unSerialize(t,e){if(!t.name)return;const s=e.newTile(t.name,t.options||"",t.id);return t.flipped&&s.flip(),s.setTransform(new rt(t.x,t.y),t.rot),t.colour&&s.setColour(t.colour),t.size&&s.setSize(t.size),s}}function Ss(t,e,s,i=!1){const o=e||t,n=s||t,a=Math.atan2(n.y-o.y,n.x-o.x)+(i?Math.PI:0),r=.15*rt.distance(o,n);return t.shift(Math.cos(a)*r,Math.sin(a)*r)}class zs{constructor(t,e,i,o,n){this.$parent=t,this.brush=o,this.path="",this.$el=Re("path",{class:`stroke ${o}`},t.$strokes),this.setColor(i),t.strokes.add(this),1===e.length&&e.push(e[0].shift(.01)),this.draw(e),this.id=n||s(10),t.strokeMap.set(this.id,this)}setColor(t){this.color=t,this.$el.setAttr("stroke",As(t))}addPoint(t){this.segments.push(new ut(u(this.segments).p2,t)),this.path+=`L${t.x},${t.y}`,this.$el.setAttr("d",this.path)}setLine(t){this.segments=[t],this.path=Bt(t),this.$el.setAttr("d",this.path)}makeSnapPoints(){this.snapPoints=v(...this.segments.map((t=>[t.p1,t.p2]))),this.snapLines=this.segments}simplify(){const t=this.segments.map((t=>t.p1));t.push(u(this.segments).p2);const e=[t[0]];let s=0;for(let i=2;i<t.length;++i){const o=new ut(u(e),t[i]);t.slice(s+1,i).every((t=>o.contains(t,3)))||(e.push(t[i-1]),s=i-1)}e.push(u(t)),this.draw(e)}draw(t){this.path=function(t){return t.length<=2?Bt(new zt(...t)):t.map(((e,s)=>{if(0===s)return`M${e.x} ${e.y}`;if(rt.distance(t[s-1],e)<4)return`L${e.x},${e.y}`;const i=Ss(t[s-1],t[s-2],e),o=Ss(e,t[s-1],t[s+1],!0);return`C${i.x},${i.y} ${o.x},${o.y} ${e.x},${e.y}`})).join("")}(t),this.segments=new zt(...t).edges,this.$el.setAttr("d",this.path)}hitTest(t,e){const s=e**2;return this.segments.some((e=>e.distanceSquared(t)<s))}delete(){this.$parent.strokeMap.delete(this.id),this.$parent.strokes.delete(this),this.$el.remove()}serialize(){return{points:this.path.slice(0,16e3),colour:this.color,brush:this.brush,id:this.id}}static unSerialize(t,e){const s=Le(t.points),i=new zs(e,s,t.colour||"#000",t.brush||"",t.id);return 2===s.length&&i.makeSnapPoints(),i}}class Vs{constructor(t,e){this.$canvas=t,this.defaultCallbacks=e,this.callbacks=new WeakMap,this.isMoving=!1,this.shiftKey=!1,this.altKey=!1,this.cancelled=!1,setTimeout((()=>{document.addEventListener("keydown",(t=>{this.shiftKey=t.shiftKey,this.altKey=t.altKey})),document.addEventListener("keyup",(t=>{this.shiftKey=t.shiftKey,this.altKey=t.altKey})),document.addEventListener("visibilitychange",(()=>{this.shiftKey=this.altKey=!1}))}),2e3),t.css("touch-action","none"),t.on("pointerdown",(t=>this.startEvent(t))),t.on("contextmenu",(t=>t.preventDefault())),e.hover&&t.on("pointermove",(s=>{this.isMoving||e.hover({posn:ue(s,t),event:s})}))}listen(t,e){this.callbacks.set(t._el,e),t.hasParent(this.$canvas)||(t.css("touch-action","none"),t.on("pointerdown",(t=>this.startEvent(t))))}startEvent(t){if(t.handled)return;this.isMoving=!0,this.cancelled=!1,t.preventDefault();const e=Je.getActiveInput();e&&e.blur();const s=t.pointerId,i=this.getCallbacks(t.target);"shiftKey"in t&&(this.shiftKey=t.shiftKey);const o=ue(t,this.$canvas);let n=o,a=!1;const r=t=>{if(t.pointerId&&t.pointerId!==s)return;if(t.preventDefault(),this.cancelled)return l(t);const e=ue(t,this.$canvas);rt.distance(e,n)<.5||(!a&&i.start&&i.start({posn:o,event:t}),i.move&&i.move({posn:e,startPosn:o,lastPosn:n,event:t}),a||!1===i.cursor||Ue.addClass("grabbing"),n=e,a=!0)},l=t=>{t.pointerId&&t.pointerId!==s||(t.preventDefault(),je.off("pointermove",r),je.off("pointerstop",l),a&&i.end&&i.end({posn:n,lastPosn:n,startPosn:o,event:t}),a||this.cancelled||!i.click||i.click({posn:o,event:t}),Ue.removeClass("grabbing"),this.isMoving=!1)};i.down&&i.down({posn:o,event:t}),je.on("pointermove",r),je.on("pointerstop",l)}getCallbacks(t){for(;t;){const e=this.callbacks.get(t);if(e&&(!e.checkIfActive||e.checkIfActive()))return e;t=t.parentNode||void 0}return this.defaultCallbacks}cancel(){this.cancelled=!0}}function Zs(t,e,s){return t.hasAttr(e)?"no"!==t.attr(e):s}const Es={hasGeoModel:!0,pi:Math.PI,point:(t,e)=>void 0!==t&&void 0!==e?new rt(t,e):void 0,angle:(t,e,s)=>t&&e&&s?new ft(t,e,s):void 0,line:(t,e)=>t&&e&&!t.equals(e)?new dt(t,e):void 0,ray:(t,e)=>t&&e&&!t.equals(e)?new pt(t,e):void 0,segment:(t,e)=>t&&e&&!t.equals(e)?new ut(t,e):void 0,circle:(t,e)=>t&&e?new gt(t,e):void 0,arc:(t,e,s)=>t&&e&&s?new ht(t,e,s):void 0,sector:(t,e,s)=>t&&e&&s?new ct(t,e,s):void 0,polygon:(...t)=>t.every((t=>t))?new St(...t):void 0,polyline:(...t)=>t.every((t=>t))?new zt(...t):void 0,triangle:(t,e,s)=>t&&e&&s?new Vt(t,e,s):void 0,rectangle:(t,e,s)=>t?new Zt(t,e,s):void 0,distance:rt.distance,round:(t,e=0)=>R(t,e),sqrt:Math.sqrt,floor:Math.floor,ceil:Math.ceil,intersections:Lt};function Hs(t,e){return yt(t)?t.offset(e):kt(t)?new dt(t.c,e).angle/2/Math.PI:At(t)?new ft(t.start,t.c,e).rad/t.angle:.5}const _s=Ae({});_s.assign(Es);const Is=new Map,Os=new Map,Ds=/^_x[0-9]+\.at\([0-9-.e]+\)$/,Bs=/^intersections\(|\.midpoint$|\.centroid$/;class Ns extends Ls{constructor(t,e,s){super(e,s,Re("path",{class:"geo-path"},e.$geoPaths)),this.$parent=e,this.type="geo",this.hideSelectionOutline=!0,this.isProjection=!1,this.parentIDs=[],this.deleted=!1,this.onDraw=()=>this.draw(),this.$shadow=Re("path",{class:"geo-shadow"},e.$geoShadows),this.options=t;let[i,o]=t.split("=");o||(o=i,i=_s.getKey()),this.key=i,Is.set(i,this),this.snapPoints=this.snapLines=this.snapAngles=[],this.setExpr(o),_s.watch(this.onDraw),this.setColour(e.penColour)}setExpr(t,e=!1){const s=re(t);_s.setComputed(this.key,s),e||(this.options=`${this.key}=${t}`,this.expr=t,this.setParentIDs(t.match(/_x[0-9]+/g)||[]),this.isProjection=Ds.test(t),this.locked=Bs.test(t),this.$el.setClass("locked",this.locked))}draw(){let t=_s[this.key];if(t===this.path)return;this.path=t,this.$el.toggle(!!t),this.isActive&&!t&&this.$shadow.hide();const e=null==t?void 0:t.type;if(e!==this.geoType){this.$el.setClass("geo-point","point"===e),this.$el.setClass("geo-path","point"!==e);("point"===e?this.$parent.$geoPoints:this.$parent.$geoPaths).append(this.$el),this.geoType=e}t&&("point"===e&&(t=new gt(t,this.locked?3.5:6)),this.$el.draw(t,{box:this.$parent.canvasBounds.rect}),this.$shadow.setAttr("d",this.$el.attr("d")),this.transform())}setParentIDs(t){var e;for(const t of this.parentIDs)null===(e=Os.get(t))||void 0===e||e.delete(this.key);this.parentIDs=t;for(const e of t)Os.has(e)||Os.set(e,new Set),Os.get(e).add(this.key)}get parents(){return this.parentIDs.map((t=>Is.get(t))).filter((t=>t))}get children(){const t=Os.get(this.key);return t?Array.from(t).map((t=>Is.get(t))).filter((t=>t)):[]}get ariaDescription(){var t;return`${null===(t=this.path)||void 0===t?void 0:t.type} ${this.key}: ${this.expr}`}select(){var t;this.isActive=!0,this.path&&this.$shadow.show(),null===(t=this.$el.parent)||void 0===t||t.append(this.$el)}deselect(){this.isActive=!1,this.$shadow.hide()}hover(t=!0){!this.isActive&&this.path&&(t?this.$shadow.show():this.$shadow.hide())}transform(){this.transformed=this.path,this.pending||(this.snapPoints=this.path&&Ct(this.path)?[this.path]:[],this.snapLines=!this.path||Ct(this.path)?[]:[this.path])}setTransform(){this.transform()}setColour(t){var e,s;this.colour=t,null===(e=this.$el)||void 0===e||e.css("color",As(t)),null===(s=this.$shadow)||void 0===s||s.css("color",As(t))}copy(t={}){if(!this.path)return;if(t[this.key])return t[this.key];let e=this.expr;if(Ct(this.path))e=`point(${this.path.x+25},${this.path.y+25})`;else for(const s of this.parents){const i=t[s.key]||s.copy(t);e=e.replace(s.key,i.key)}return t[this.key]=new Ns(e,this.$parent)}delete(){this.deleted=!0,super.delete(),_s.unwatch(this.onDraw),_s[this.key]=void 0,Is.delete(this.key),this.$shadow.remove();for(const t of this.parents)"point"!==t.geoType||t.deleted||t.parentIDs.length||t.children.length||t.delete();for(const t of this.children)t.delete()}setPending(t=!0){this.pending=t,t||this.transform();for(const e of this.children)e.setPending(t)}moveStart(){if(!this.locked&&this.path){if(this.isProjection){if(this.$parent.selection.size>1)return;this.setParentIDs([])}this.setPending(!0);for(const t of this.parents)t.moveStart();this.moveStartValue=this.transformed}}move(t,e){if(t&&this.path&&this.moveStartValue)if(Ct(this.path))this.snapTarget=e,this.$el.setClass("locked",this.locked||!!(null==e?void 0:e.intersection)),_s[this.key]=this.moveStartValue.translate(t);else for(const e of this.parents)e.move(t)}moveEnd(){var t,e,s,i;if(this.moveStartValue){for(const t of this.parents)t.moveEnd();if(this.setPending(!1),null===(t=this.snapTarget)||void 0===t?void 0:t.intersection)this.setExpr(this.snapTarget.intersection.expr);else if("geo"===(null===(s=null===(e=this.snapTarget)||void 0===e?void 0:e.tile)||void 0===s?void 0:s.type)){const t=null===(i=this.snapTarget)||void 0===i?void 0:i.tile;if(t.path&&Ct(t.path)){for(const e of this.children)e.setExpr(e.expr.replace(this.key,t.key));return this.$parent.selection.add(t),this.delete()}if(t.path){const e=Hs(t.path,_s[this.key]);this.setExpr(`${t.key}.at(${e})`)}}}}static computeIntersections(t){t.intersections.clear();const e=Array.from(Is.values()).filter((t=>t.path&&!Ct(t.path))),s=e.length;for(let i=0;i<s;++i)for(let o=i+1;o<s;++o){const s=Lt(e[i].path,e[o].path);for(const[n,a]of s.entries())t.intersections.add({value:a,expr:`intersections(${e[i].key},${e[o].key})[${n}]`})}}static getInferredShape(t){const e=t.filter((t=>"geo"===t.type&&t.path));if(!e.length)return;if(1===e.length)return{type:e[0].path.type,expr:e[0].key};const s=e.filter((t=>Ct(t.path))),i=e.filter((t=>yt(t.path)||kt(t.path)));if(1===i.length&&s.length===e.length-1){const t=i[0].path;if(s.every((e=>t.contains(e.path))))return{type:t.type,expr:i[0].key}}const o=i.filter((t=>yt(t.path)));if(s.length+o.length!==e.length)return;for(const t of o)if($t(t.path)){const e=t.parentIDs.map((t=>Is.get(t)));for(const t of e)s.includes(t)||s.push(t)}else if(s.filter((e=>t.path.contains(e.path))).length<2)return;const n=s.map((t=>t.key)).join(",");return 2===s.length?{type:"segment",expr:`segment(${n})`}:3===s.length?{type:"triangle",expr:`triangle(${n})`}:{type:"polygon",expr:`polygon(${n})`}}static construct(t,e,s){if((t=t.replace(/\$0/g,e||"")).includes("$1"))s.tools.geoPending.enable(t);else{const e=new Ns(t,s);s.selection.add(e,!0);const i=Ct(e.path)?"pop":"draw";e.$el.enter(i,400),e.$shadow.enter(i,400),Ns.computeIntersections(s)}}static redrawLines(t){for(const e of Is.values())e.path&&wt(e.path)&&(e.$el.draw(e.path,{box:t}),e.$shadow.setAttr("d",e.$el.attr("d")))}static clearModel(){_s.clear(),_s.assign(Es)}}function qs(t){const e=Math.cos(2*Math.PI/t);return 1/Math.sqrt(2-2*e)}const Rs=t=>G(Math.round(t.angle*Ms),180),js=t=>t.map((t=>`${R(t.x,3)} ${R(t.y,3)}`)).join(",");function Us(t,e){const s=new rt(-t/2,-e/2);return js(new Zt(s,t,e).points)}const Ks=50,Fs=Math.sqrt(3)/4*Ks,Gs=new dt(lt,new rt(0,1)),Ws={"equ-triangle":new St(new rt(-25,Fs),new rt(25,Fs),new rt(0,-Fs)),square:St.regular(4,Ks*qs(4)),"reg-pentagon":St.regular(5,Ks*qs(5)),"reg-hexagon":St.regular(6,Ks*qs(6)),"reg-heptagon":St.regular(7,Ks*qs(7)),"reg-octagon":St.regular(8,Ks*qs(8)),"reg-decagon":St.regular(10,Ks*qs(10)),"reg-dodecagon":St.regular(12,Ks*qs(12)),rectangle:new Zt(new rt(-50,-25),100,Ks).polygon,trapezium:new St(new rt(-50,Fs),new rt(Ks,Fs),new rt(25,-Fs),new rt(-25,-Fs)),rhombus:new St(new rt(-37.5,Fs),new rt(12.5,Fs),new rt(37.5,-Fs),new rt(-12.5,-Fs)),"right-triangle":new St(new rt(-25,-25),new rt(25,-25),new rt(-25,25)),"rhombus-2":new St(new rt(25-Fs,12.5),new rt(-Fs-25,12.5),new rt(Fs-25,-12.5),new rt(Fs+25,-12.5)),chevron:new St(new rt(-37.5,2*Fs),new rt(12.5,2*Fs),new rt(37.5,0),new rt(12.5,-2*Fs),new rt(-37.5,-2*Fs),new rt(-12.5,0)),"right-triangle-2":new St(new rt(-2*Fs,-25),new rt(-2*Fs,25),new rt(2*Fs,-25)),kite:new St(new rt(0,-50),new rt(2*Fs,-25),new rt(0,Ks),new rt(-2*Fs,-25)),dart:new St(new rt(2*Fs,37.5),new rt(0,-37.5),new rt(-2*Fs,37.5),new rt(0,12.5))},Qs=["","","",Ts.yellow,Ts.blue,Ts.green,Ts.red,Ts.teal,Ts.purple,"",Ts.lime,"",Ts.orange],Xs={trapezium:Ts.red,"right-triangle":Ts.green,"rhombus-2":Ts.orange,chevron:Ts.orange,kite:Ts.purple,dart:Ts.teal},Ys={"equ-triangle":Ts.green,square:Ts.yellow,"reg-pentagon":Ts.blue,"reg-hexagon":"#ffd615","reg-decagon":Ts.red,rectangle:Ts.yellow,trapezium:"#cc1030",rhombus:Ts.blue,"rhombus-2":"#e6e2c6",chevron:"#cc1030","right-triangle-2":"#ffd615",kite:"#134791",dart:Ts.purple};function Js(t){if(t in Ws)return Ws[t];if(t.match(/^[0-9.,\-\s]+$/)){const e=t.split(",").map((t=>new rt(...t.split(" ").map((t=>+t)))));return new St(...e)}throw new Error("Unknown polygon type.")}const ti=["trapezium","rhombus","rhombus-2","rectangle","right-triangle","right-triangle-2"],ei=["equ-triangle","square","reg-pentagon","reg-hexagon","reg-heptagon","reg-octagon","reg-decagon","reg-dodecagon","rectangle","trapezium","kite","dart"];class si extends Ls{constructor(t,e,s){super(e,s),this.type="polygon",this.options=t,this.path=Js(t),this.snapAngles=m(this.path.edges.map(Rs)),this.symmetric=ei.includes(t);const i=e.options.altColors?Ys:Xs;this.colour=i[t]||Qs[this.path.points.length];const o=Zt.aroundPoints(this.path.points),n=new rt(o.center.x,o.p.y);this.showSelectionOutline=rt.distance(n,this.path.project(n))>5;const a={class:"polygon-tile",path:this.path,fill:this.colour};this.$path=Re("path",a,this.$el),this.$outline=Re("path",{class:"outline",path:this.path},this.$el)}static makeThumbnail(t,e,s,i){const o=ti.includes(t)?30:40;let n=Js(t);const a=Math.max(...n.points.map((t=>t.length)));n=n.scale(36/a).shift(40,o);const r=Re("svg",{width:80,height:2*o},e),l=Re("path",{class:"polygon-tile",path:n},r);s.options.watch((e=>{const s=e.altColors?Ys:Xs,o=i||s[t]||Qs[n.points.length];l.setAttr("fill",o)}))}setColour(t){super.setColour(t),this.$path.setAttr("fill",As(this.colour))}flip(t){t&&(this.posn=new rt(2*t.x-this.posn.x,this.posn.y)),this.rot=-this.rot,this.flipped=!this.flipped,this.symmetric||(this.path=this.path.reflect(Gs),this.$path.draw(this.path),this.$outline.draw(this.path)),this.transform()}static action(t,e,s){if("flip"===t){for(const t of e)t.flip(s);e.values().next().value.$parent.selection.update()}}}const ii=[[0,-.2],[1.2,-1],[.6,1],[-.6,1],[-1.2,-.2]].map((t=>new rt(50*t[0],50*t[1])));class oi extends si{constructor(t,e,s){super(t||js(ii),e,s),this.type="custom-polygon",this.$handles=[],this.showSelectionOutline=!0;for(const[t,e]of this.path.points.entries())this.makeVertex(e,t);let i;this.updatePath(),this.$parent.events.listen(this.$outline,{down:({posn:t})=>{t=this.relativePosn(t);const e=this.path.edges.findIndex((e=>t.distanceFromLine(e)<5));i=this.makeVertex(t,(e+1)%this.$handles.length),this.updatePath()},move:({posn:t})=>{i&&this.moveVertex(i,t)},end:()=>{i&&this.$parent.change({tilesChanged:[this]})}}),this.$outline.css("cursor","crosshair")}makeVertex(t,e){if(this.$handles.length>=24)return;const s=this.makeHandle("c",((t,e)=>this.moveVertex(s,e)),(()=>this.deleteVertex(s)));return s.setCenter(t),s.setAttr("r",8),s.css("cursor","move"),this.$handles.splice(e,0,s),s}deleteVertex(t){t.remove(),this.$handles.splice(this.$handles.indexOf(t),1),this.updatePath()}moveVertex(t,e){var s;const i=null===(s=this.$parent.snap([e]))||void 0===s?void 0:s.shift;t.setCenter(this.relativePosn(i?e.add(i):e)),this.updatePath()}updatePath(){const t=this.$handles.map((t=>t.center));this.path=new St(...t),this.$path.draw(this.path),this.$outline.draw(this.path),this.transform(),this.snapAngles=m(this.path.edges.map(Rs)),this.options=js(t),this.$parent.selection.update()}flip(t){t&&(this.posn=new rt(2*t.x-this.posn.x,this.posn.y)),this.rot=-this.rot,this.transform();for(const t of this.$handles)t.setCenter(t.center.reflect(Gs));this.updatePath()}lock(){const t=new si(this.options,this.$parent);t.setColour(this.colour),t.setTransform(this.posn,this.rot),this.$parent.selection.add(t),this.delete()}static makeThumbnail(t,e){const s=new St(...ii).scale(.5).shift(40),i=Re("svg",{width:80,height:80},e);Re("path",{class:"polygon-tile",path:s,fill:Ts.green},i);for(const t of s.points)Re("circle",{cx:t.x,cy:t.y,r:3,fill:"white"},i)}static action(t,e){if("lock"===t)for(const t of Array.from(e))t.lock()}}const ni=12.5,ai=[[[0,2],[0,-4],[-2,-4],[-2,4],[2,4],[2,2],[0,2]],[[0,0],[0,-4],[-2,-4],[-2,2],[0,2],[0,4],[2,4],[2,0],[0,0]],[[-5,-1],[5,-1],[5,1],[-5,1]],[[-3,-2],[-3,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2]],[[3,-2],[3,0],[1,0],[1,-2],[-1,-2],[-1,2],[5,2],[5,-2],[3,-2]],[[-1,-3],[-1,-1],[-3,-1],[-3,3],[-1,3],[-1,1],[1,1],[1,-1],[3,-1],[3,-3],[-1,-3]],[[1,1],[1,-3],[-1,-3],[-1,1],[-3,1],[-3,3],[3,3],[3,1],[1,1]],[[1,-1],[1,-3],[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,1],[3,1],[3,-1],[1,-1]],[[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-4,-2],[-4,0],[-2,0],[-2,2],[0,2],[0,0],[4,0],[4,-2],[-4,-2]],[[-1,-3],[-1,1],[-3,1],[-3,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-1,-3],[-1,1],[-5,1],[-5,3],[1,3],[1,-3],[-1,-3]],[[-1,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2],[-3,0],[-1,0]],[[-3,2],[-3,0],[-1,0],[-1,-2],[3,-2],[3,0],[1,0],[1,2]],[[-3,2],[-3,-2],[3,-2],[3,0],[-1,0],[-1,2]],[[-2,2],[2,2],[2,-2],[-2,-2]],[[-4,1],[4,1],[4,-1],[-4,-1]]].map((t=>t.map((t=>new rt(t[0]*ni,t[1]*ni))))),ri=[[2,4],[4,4],[5,9],[7,2],[7,6],[11,3],[13,7],[15,3],[17,7],[20,2],[21,5],[23,7],[3,2],[7,2],[5,6],[10,4],[8,7]],li=[...P.rainbow(12).map((t=>t.hex)),Ts.red,Ts.blue,Ts.green,Ts.yellow,Ts.purple];class hi extends si{constructor(t,e,s){super(js(ai[+t]),e,s),this.type="pentomino",this.options=t,this.setColour(li[+t])}static makeThumbnail(t,e){const s=ri[+t],i=new St(...ai[+t]).scale(.8);e.draw(i.shift(10*s[0],10*s[1]).shift(1,1)),e.setAttr("fill",li[+t])}}const ci=[[[-4,-2],[0,2],[4,-2]],[[-4,-2],[0,2],[4,-2]],[[-2,0],[0,-2],[2,0],[0,2]],[[-3,1],[1,1],[3,-1],[-1,-1]],[[0,-1],[2,1],[-2,1]],[[0,-1],[2,1],[-2,1]],[[-2,-2],[2,-2],[2,2]]],di=[Ts.red,Ts.blue,Ts.green,Ts.yellow,Ts.orange,Ts.teal,Ts.purple],pi=[[2,4],[4,2],[6,4],[3,7],[7,2],[4,5],[6,6]],ui=[-90,0,0,0,-90,0,90];class fi extends si{constructor(t,e,s){super(js(ci[+t].map((t=>new rt(...t).scale(25)))),e,s),this.type="tangram",this.snapAngles=[0,45,90,135],this.options=t,this.setColour(di[+t]),this.rot=ui[+t],this.transform()}static makeThumbnail(t,e,s,i){const o=pi[+t],n=ci[+t].map((e=>new rt(...e).rotate(ui[+t]*Cs).shift(...o).scale(18).shift(2,2))),a=new St(...n);e.draw(a),e.setAttr("fill",i||di[+t])}getSnapLines(){return this.path.edges}}const gi=(1+Math.sqrt(5))/2*25,mi=25*Math.sqrt((5+Math.sqrt(5))/2),xi=gi*(Math.sqrt(5)-1)/2,bi=[`0 ${-gi},${mi} ${-xi},0 ${gi},${-mi} ${-xi}`,`0 ${2*xi-gi},${mi} ${xi},0 ${-gi},${-mi} ${xi}`],vi=[["M29.4-30.9C25.3-18.2,13.4-9.5,0-9.5c-13.4,0-25.3-8.6-29.4-21.4","M29.4,0C20.8-6.2,10.6-9.5,0-9.5c-10.6,0-20.8,3.3-29.4,9.5"],["M18.2,15.5C20.1,9.6,19,3.3,15.5-1.7C11.9-6.6,6.1-9.5,0-9.5c-6.1,0-11.9,2.9-15.5,7.9c-3.6,4.9-4.6,11.3-2.7,17.1","M18.2-15.5C12.9-11.6,6.5-9.5,0-9.5c-6.5,0-12.9-2.1-18.2-5.9"]],yi=[Ts.red,Ts.blue];class wi extends si{constructor(t,e,s){super(bi[+t],e,s),this.type="penrose",this.setColour(yi[+t]),this.options=t;const i=Re("g",{class:"penrose-circles"});this.$path.insertAfter(i);for(const e of vi[+t])Re("path",{d:e},i)}static makeThumbnail(t,e,s,i){const o=+t,n=Re("svg",{width:80,height:80,viewBox:"-50 -50 100 100"},e);Re("polygon",{points:bi[o],class:"polygon-tile",fill:i||yi[o]},n);const a=Re("g",{class:"penrose-circles"},n);for(const t of vi[o])Re("path",{d:t},a)}}const $i=["M13.9-13.9,2.8-25H-2.8L-25-2.8V2.8L-2.8,25H2.8L13.9,13.9C21.6,6.6,21.6-6.6,13.9-13.9Zm-2.8,25L0,22.2-22.2,0,0-22.2,11.1-11.1A15.8,15.8,0,0,1,11.1,11.1Z","M25-2.8,13.9-13.9c-7.3-7.7-20.5-7.7-27.8,0L-25-2.8V2.8l11.1,11.1c7.3,7.7,20.5,7.7,27.8,0L25,2.8ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1a15.8,15.8,0,0,1,22.2,0L22.2,0Z","M-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0s7.6-20.5,0-27.8L2.8-25H-2.8ZM15.7,0a15.9,15.9,0,0,1-4.6,11.1,15.8,15.8,0,0,1-22.2,0L-22.2,0,0-22.2,11.1-11.1A15.9,15.9,0,0,1,15.7,0Z","M-25-2.8V2.8L-2.8,25H2.8L25,2.8V-2.8L2.8-25H-2.8Zm25,25L-22.2,0,0-22.2,22.2,0Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8c-7.6,7.3-7.6,20.5,0,27.8s20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1c-5.8,6.1-16.3,6.1-22.2,0a15.8,15.8,0,0,1,0-22.2,15.8,15.8,0,0,1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8L-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1c5.9-6.1,16.4-6.1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z"];class ki extends si{constructor(t,e,s){super("square",e,s),this.type="kolam",this.setColour(Ts.orange),this.options=t,Re("path",{d:$i[+t],fill:"white"},this.$el),Re("circle",{r:3,fill:"white"},this.$el),this.$el.append(this.$outline),this.$path.css("stroke-width",".5px")}static makeThumbnail(t,e){const s=Re("svg",{width:60,height:60},e);Re("rect",{class:"polygon-tile",fill:Ts.orange,x:5,y:5,width:50,height:50},s),Re("path",{d:$i[+t],fill:"white",transform:"translate(30 30)"},s),Re("circle",{r:3,cx:30,cy:30,fill:"white"},s)}}const Ai=["M-32.3,6.5,0,84.3H0L32.3,6.5A80.4,80.4,0,0,0,0,0,86.6,86.6,0,0,0-32.3,6.5Z","M-32.3,6.5,0,84.3H0L32.3,6.5A80.4,80.4,0,0,0,0,0,86.6,86.6,0,0,0-32.3,6.5Z","M-42.1,0A288.5,288.5,0,0,0-20.2,110.2a287.6,287.6,0,0,0,62.3,93.3V0Z","M-42.1,0V203.5a289.5,289.5,0,0,0,62.4-93.3A286.5,286.5,0,0,0,42.1,0Z","M0 0L-101.7 101.7L101.7 101.7Z","M0 0L-101.7 101.7L101.7 101.7Z","M0 0L-59.6 59.6L59.6 59.6Z","M42.1.1H-42.2l-59.5,59.6A143.4,143.4,0,0,0,0,101.8,143,143,0,0,0,101.7,59.7Z","M42.1.1H-42.2l-59.5,59.6A143.4,143.4,0,0,0,0,101.8,143,143,0,0,0,101.7,59.7Z"],Mi=[[66,-17.5,-22.5],[82,-17.5,22.5],[23,-36.5,45],[125,-36.5,-45],[56,47.3,135],[92,47.3,-135],[74,101,180],[41,98,45],[107,98,-45]],Ci={0:1,1:1,2:3,3:2,7:8,8:7},Ti=[Ts.lime,Ts.teal,Ts.blue,Ts.red,Ts.yellow,Ts.green,Ts.grey,Ts.orange,Ts.purple];class Pi extends si{constructor(t,e,s){super(js(Le(Ai[+t])),e,s),this.type="egg",this.snapAngles=[0,45,90,135],this.options=t,this.$path.setAttr("d",Ai[+t]),this.$outline.setAttr("d",Ai[+t]),this.setColour(Ti[+t]),this.rot=Mi[+t][2],this.transform(),+t<=1&&this.snapAngles.push(22.5,67.5,112.5,157.5)}flip(t){super.flip(t);const e=this.flipped&&Ci[this.options]||this.options;this.$path.setAttr("d",Ai[+e]),this.$outline.setAttr("d",Ai[+e])}static makeThumbnail(t,e){e.setAttr("d",Ai[+t]);const s=Mi[+t];e.css("transform",`translate(${s[0]}px, ${s[1]}px) rotate(${s[2]}deg) scale(0.5)`),e.setAttr("fill",Ti[+t]),e.css("stroke-width","2px")}}const Li=1/Math.sqrt(3),Si=50/Li,zi=[Ts.blue,Ts.purple,Ts.red,Ts.orange,Ts.yellow],Vi=St.regular(6,Si).rotate(Math.PI/6).points;Vi.splice(3,1),Vi.splice(2,0,new rt(2*Vi[1].x,Vi[0].y));class Zi extends si{constructor(t,e,s){super(js(Vi.map((e=>e.scale(Li**+t)))),e,s),this.type="fractal",this.setColour(zi[+t]),this.options=t}static makeThumbnail(t,e){let s=new St(...Vi).scale(.6*Li**+t);const i=Zt.aroundPoints(s.points),o=Re("svg",{width:20+i.w,height:20+i.h},e);s=s.shift(10-i.center.x+i.w/2,10-i.center.y+i.h/2),Re("path",{class:"polygon-tile",path:s,fill:zi[+t]},o)}}const Ei=50;class Hi extends Ls{constructor(t,e,s){super(e,s),this.canRotate=!1,this.canDragToSelect=!1,this.$el.addClass("utensil"),this.width=+t,this.absoluteEnd=new rt(this.width,0),this.setup(),this.$handles=[0,1].map((t=>this.makeHandle("c",((e,s)=>{var i;const o=t?this.posn:this.absoluteEnd,n=null===(i=this.$parent.snap([s]))||void 0===i?void 0:i.shift;s=n?s.add(n):s.snap(o,10),rt.distance(s,o)<75&&(s=new gt(o,75).project(s)),t?this.absoluteEnd=s:this.posn=s,this.rot=this.absoluteEnd.angle(this.posn)*Ms,this.width=this.absoluteEnd.subtract(this.posn).length,this.update(),this.transform()})))),this.update()}moveEnd(){this.absoluteEnd=new rt(this.width,0).rotate(this.rot).add(this.posn)}update(){this.options=""+this.width,this.$handles[1].setCenter({x:this.width,y:0})}}const _i=["ruler","protractor"];function Ii(t){return _i.includes(t.type)}class Oi extends Hi{constructor(){super(...arguments),this.type="ruler"}setup(){this.$glass=Re("rect",{x:-20,height:60,class:"glass",rx:5},this.$el),this.$ticks=Re("path",{class:"ticks"},this.$el),this.$labels=p((t=>Re("text",{text:t,x:Ei*t,y:31},this.$el)),21)}update(){this.path=new ut(lt,new rt(this.width,0));const t=this.path.length+.1;this.$glass.setAttr("width",t+40);let e="";for(let s=0;s<=t;s+=5){e+=`M${s} 0L${s} ${[10,15,20][s%Ei?s%25?0:1:2]}`}this.$ticks.setAttr("d",e);for(const[e,s]of this.$labels.entries())s.toggle(e<=t/Ei);super.update()}getSnapPoints(){const t=this.path.length;return p((e=>this.path.at(e*Ei/t)),t/Ei)}getSnapLines(){return[this.path]}}class Di extends Hi{constructor(){super(...arguments),this.type="protractor"}setup(){this.$glass=Re("path",{d:"",class:"glass"},this.$el),this.$ticks=Re("path",{class:"ticks"},this.$el),this.$labels=p((t=>Re("text",{text:10*t,transform:`rotate(${90-10*t})`},this.$el)),19)}update(){const t=this.width;this.path=new ht(lt,new rt(-this.width,0),Math.PI),this.$glass.setAttr("d",function(t){return`M0-${t}A${t},${t},0,0,0-${t},0V3a5,5,0,0,0,5,5H${t-5}a5,5,0,0,0,5-5V0A${t},${t},0,0,0,0-${t}Z`}(t));let e="";const s=this.width<100?5:1;for(let i=0;i<=180;i+=s){const s=!(i%10),o=rt.fromPolar(-i*Cs),n=t-(s?30:20);e+=`M${o.x*t} ${o.y*t}L${o.x*n} ${o.y*n}`,s&&(e+=`M${8*o.x} ${8*o.y}L${o.x*(t-50)} ${o.y*(t-50)}`)}this.$ticks.setAttr("d",e);for(const[e,s]of this.$labels.entries()){const i=t>160||!(e%3);s.toggle(i),i&&s.setAttr("y",44-t)}super.update()}getSnapPoints(){return[lt,this.path.start,this.path.at(.5),this.path.end]}getSnapLines(){return[]}}class Bi extends Hi{constructor(){super(...arguments),this.type="compass"}setup(){}update(){}getSnapPoints(){return[]}getSnapLines(){return[]}}const Ni=["M-25,34.4a81.3,81.3,0,0,1,50,0h0A81.1,81.1,0,0,0,40.4-13.1h.1A81.5,81.5,0,0,1,0-42.5H0A81.5,81.5,0,0,1-40.5-13.2h.1A81.1,81.1,0,0,0-25,34.4Z","M-15.4-21.3A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3a80.6,80.6,0,0,1,50,0A80.3,80.3,0,0,1,25,8.1,80.4,80.4,0,0,1,40.4,55.7,80.2,80.2,0,0,1,0,26.3,80.2,80.2,0,0,1-40.4,55.7,80.4,80.4,0,0,1-25,8.1,80.3,80.3,0,0,1-65.4-21.3,80.6,80.6,0,0,1-15.4-21.3Z","M65.4-21.3A80.5,80.5,0,0,1,0,12.1,80.5,80.5,0,0,1-65.4-21.3a80.6,80.6,0,0,1,50,0A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3,80.6,80.6,0,0,1,65.4-21.3Z","M80.9-47.5h0A81.5,81.5,0,0,1,40.4-76.9,80.4,80.4,0,0,0,0-47.5,80.2,80.2,0,0,0-40.5-76.9h0A80.8,80.8,0,0,1-80.9-47.6h0A80.3,80.3,0,0,1-65.5,0,80.3,80.3,0,0,1-80.9,47.5h0A80.8,80.8,0,0,1-40.5,76.9h0A80.2,80.2,0,0,0,0,47.5,80.4,80.4,0,0,0,40.4,76.9,81.5,81.5,0,0,1,80.9,47.6h0A80.3,80.3,0,0,1,65.5,0,80.3,80.3,0,0,1,80.9-47.5Z","M0-47.5A80.3,80.3,0,0,1,15.5,0,80.3,80.3,0,0,1,0,47.5,80.3,80.3,0,0,1-15.5,0,80.3,80.3,0,0,1,0-47.5Z","M130.9,153.8a80.5,80.5,0,0,1,15.4-47.5,80.2,80.2,0,0,1-40.4-29.4A80.1,80.1,0,0,1,90.5,29.4a80.6,80.6,0,0,1-50,0A80.6,80.6,0,0,1,0,0,80.3,80.3,0,0,1-40.4,29.4a80.9,80.9,0,0,1-50.1,0,80.8,80.8,0,0,1-15.4,47.5,80.9,80.9,0,0,1-40.5,29.4,79.9,79.9,0,0,1,15.5,47.5,81.3,81.3,0,0,1,50,0A80.9,80.9,0,0,1,0,72.9a80.9,80.9,0,0,1,80.9,80.9A81.3,81.3,0,0,1,130.9,153.8Z","M40.4-13.2A80.4,80.4,0,0,0,0-42.5,80.7,80.7,0,0,0-40.4-13.1,80.9,80.9,0,0,0-25,34.4a80.6,80.6,0,0,0,50,0A81.2,81.2,0,0,0,40.4-13.2Z","M40.4-13.1A82,82,0,0,1,0-42.5,81.1,81.1,0,0,1-40.5-13.2,81.3,81.3,0,0,1-25,34.4a81.3,81.3,0,0,1,50,0A81.6,81.6,0,0,1,40.4-13.1Z"],qi=["M16.2-.3a5.5,5.5,0,0,1-4.4,6.4A5.3,5.3,0,0,1,5.5,1.8,5.4,5.4,0,0,1,9.8-4.6,5.5,5.5,0,0,1,16.2-.3Zm8-8A3.8,3.8,0,0,0,28-4.5a3.7,3.7,0,0,0,3.7-3.8A3.6,3.6,0,0,0,28-12,3.7,3.7,0,0,0,24.2-8.3ZM19,23.4a4.9,4.9,0,0,0,4.8-4.8A4.8,4.8,0,0,0,19,13.9a4.7,4.7,0,0,0-4.7,4.7A4.8,4.8,0,0,0,19,23.4ZM-11.7,6.1A5.3,5.3,0,0,0-5.4,1.8,5.4,5.4,0,0,0-9.7-4.6,5.5,5.5,0,0,0-16.1-.3,5.5,5.5,0,0,0-11.7,6.1ZM-27.9-4.5a3.8,3.8,0,0,0,3.8-3.8A3.7,3.7,0,0,0-27.9-12a3.6,3.6,0,0,0-3.7,3.7A3.7,3.7,0,0,0-27.9-4.5ZM20.9-22A139.9,139.9,0,0,1,3-19.5a1.1,1.1,0,0,1-.1.5L1-15.2V30H-1V-15.2L-2.9-19a1.1,1.1,0,0,1-.1-.5,127,127,0,0,1-17.8-2.6A80.8,80.8,0,0,0,0-41.7,83.3,83.3,0,0,0,20.9-22ZM-3.8-26.7A3.2,3.2,0,0,0-7-30a3.3,3.3,0,0,0-3.3,3.3A3.2,3.2,0,0,0-7-23.5,3.2,3.2,0,0,0-3.8-26.7ZM6.5-30a3.2,3.2,0,0,0-3.2,3.3,3.2,3.2,0,0,0,3.2,3.2,3.2,3.2,0,0,0,3.3-3.2A3.3,3.3,0,0,0,6.5-30ZM-23.7,18.6a4.9,4.9,0,0,0,4.8,4.8,4.8,4.8,0,0,0,4.7-4.8,4.7,4.7,0,0,0-4.7-4.7A4.8,4.8,0,0,0-23.7,18.6Z","M-16.9-4.7l-17.7-6.1a.8.8,0,0,1-.5-.9.8.8,0,0,1,.9-.5L-16.5-6a.7.7,0,0,1,.5.9.7.7,0,0,1-.7.4ZM-24.6-13l9.7,5.4h.3a.9.9,0,0,0,.7-.3.9.9,0,0,0-.3-1l-9.7-5.4a.8.8,0,0,0-1,.2A.8.8,0,0,0-24.6-13ZM-7.8-4.9l5.9,1.2h.5c.2-.1.3-.2.3-.4l.3-1.4a.6.6,0,0,0-.5-.8L-7.2-7.7h-.6l-.3.4-.3,1.4A.8.8,0,0,0-7.8-4.9ZM2.8-2.5a.9.9,0,0,0,.7.6h.2l1.6-.3a1,1,0,0,0,.5-.4.7.7,0,0,0,.1-.5l-1.4-6a.8.8,0,0,0-.9-.6L2-9.4l-.5.3a1.3,1.3,0,0,0-.1.6ZM10.9.4a.7.7,0,0,0-.1-.5L10-1.3a.8.8,0,0,0-1-.2L4,1.9c-.2.1-.3.2-.3.4a.7.7,0,0,0,.1.5L4.6,4a.6.6,0,0,0,.6.3h.4l5-3.4ZM-4.5-1l-1.4-.3a.4.4,0,0,0-.5.1c-.2.1-.3.2-.3.4L-8.2,5.1a.7.7,0,0,0,.5.8l1.4.4h.5a.5.5,0,0,0,.3-.5L-4-.1A.7.7,0,0,0-4.5-1Zm-12.1-.6a.7.7,0,0,0,.7-.6c.1-.4-.2-.7-.6-.8l-11-1.7a.8.8,0,0,0-.8.6c0,.4.2.8.6.8l11,1.7Zm16.1,6H-1c-.2,0-.3.1-.5.3l-.8,1.1a.8.8,0,0,0,.1,1l4.9,3.6.4.2h.1l.4-.3.9-1.1c.2-.4.2-.8-.1-1Zm-9.4,8.8a.7.7,0,0,0-1,.1L-22.2,28.2a.7.7,0,0,0,.1,1l.4.2a.9.9,0,0,0,.6-.3l11.3-15A.6.6,0,0,0-9.9,13.2Zm-11.2,5.6c.2.2.3.3.5.3l.5-.2,8.2-7.6a.7.7,0,0,0,0-1,.8.8,0,0,0-1,0L-21,17.8A.7.7,0,0,0-21.1,18.8Zm14-4.9a.8.8,0,0,0-1,.4L-13,24.2a.6.6,0,0,0,.3.9h.3a.6.6,0,0,0,.6-.4l5-9.9A.8.8,0,0,0-7.1,13.9Zm17.4-.7a.8.8,0,0,0-1-.2.8.8,0,0,0-.2,1L19.9,29.4a.5.5,0,0,0,.5.3h.4a.7.7,0,0,0,.2-1ZM7,14.4A.7.7,0,0,0,6,14a.7.7,0,0,0-.3.9L10.3,25a.8.8,0,0,0,.7.4h.3a.8.8,0,0,0,.3-1Zm4-2.8,7.8,7.8.5.2.5-.2a.7.7,0,0,0,0-1L12,10.6a.7.7,0,0,0-1,1ZM34.4-11.2a.7.7,0,0,0-.8-.5l-18,5.5a.7.7,0,0,0-.4.9.6.6,0,0,0,.6.5c.1,0,.2,0,.2-.1l18-5.4A.7.7,0,0,0,34.4-11.2ZM26.7-4l-11,1.3a.6.6,0,0,0-.6.8.7.7,0,0,0,.7.6h.1l11-1.3c.4,0,.6-.4.6-.8S27.1-4,26.7-4ZM14-7.3h.3l9.8-5.1a.7.7,0,0,0,.3-1,.7.7,0,0,0-.9-.3L13.6-8.6a.8.8,0,0,0-.3,1A.8.8,0,0,0,14-7.3ZM-.5-16.6h0a.7.7,0,0,0,.7-.6L.6-36a.7.7,0,0,0-.7-.7.7.7,0,0,0-.7.7l-.4,18.7A.7.7,0,0,0-.5-16.6Zm3.2,1.2h.2a.7.7,0,0,0,.7-.6L5.7-26.9a.7.7,0,0,0-.5-.8.8.8,0,0,0-.9.6L2.2-16.3A.7.7,0,0,0,2.7-15.4Zm-6.1-.1h.1c.4-.1.7-.5.6-.8l-1.8-11c0-.4-.4-.6-.8-.6a.8.8,0,0,0-.6.8l1.8,11A.9.9,0,0,0-3.4-15.5Z","M60.8-16.2l-3.6-2.5,1.4-3.9-.9-.3-1.3,3.5h0l-9.5,3,2.8-7.8h-1l-3,8.3-9.5,3.1,4.4-11.8H39.5L35-12.5,25.5-9.4l5-14.7H29.4L24.3-9.1l-9.1,3,6-16.3-1.2.3L14-5.7l-1.8.5a50.6,50.6,0,0,0,5.3-16.2l-1.9.6-.4.2L1-9.8v-10L14.4-30.3c0-.4-.1-.8-.1-1.2L1-21.1v-10l11.7-9.1-.3-1.1L1-32.4v-10l8.9-6.9a3,3,0,0,0-.4-1L1-43.7v-10l5.2-4a4.1,4.1,0,0,0-.5-.9l-5.2,4h-1l-5.2-4a4.1,4.1,0,0,0-.5.9l5.2,4v10l-8.5-6.6a3,3,0,0,0-.4,1L-1-42.4v10l-11.4-8.9-.3,1.1L-1-31.1v10L-14.3-31.5c0,.4-.1.8-.1,1.2L-1-19.8v10L-15.2-20.6l-.4-.2-1.9-.6A50.6,50.6,0,0,0-12.2-5.2L-14-5.7l-6-16.4-1.2-.3,6,16.3-9.1-3L-29.4-24h-1.1l5,14.7L-35-12.5l-4.5-12.2h-1.1l4.4,11.8L-45.7-16l-3-8.3h-1l2.8,7.8-9.5-3h0l-1.3-3.5-.9.3,1.4,3.9-3.6,2.5.7.7,3.1-2.2v.2l9.4,3-6.8,4.8.7.7,7.3-5.1,9.6,3.1L-47.3-3.8l.9.6,10.8-7.4,9.5,3.1-13,8.9,1,.5,13.2-9,9.6,3-14.4,10,1.2.4,14.3-9.9h.4l3,1C-9.8-1-8.9.5-7.9,1.9L-18.4,9.4l1.3.3,9.8-7a64.2,64.2,0,0,0,6.6,8H.7a64.2,64.2,0,0,0,6.6-8l9.8,7,1.3-.3L7.9,1.9C8.9.5,9.8-1,10.8-2.6l3-1h.4L28.5,6.3l1.2-.4L15.3-4.1l9.6-3,13.2,9,1-.5-13-8.9,9.5-3.1L46.4-3.2l.9-.6L36.8-11l9.6-3.1L53.7-9l.7-.7-6.8-4.8,9.4-3v-.2l3.1,2.2Zm-76-3.2L-1-8.5V.6l-9.7-7.4A45.9,45.9,0,0,1-15.2-19.4ZM0,8.5A66.6,66.6,0,0,1-9.6-4.7L-1,1.8V6.3a1,1,0,0,0,1,1,1,1,0,0,0,1-1V1.8L9.6-4.7A71,71,0,0,1,0,8.5ZM10.7-6.8,1,.6V-8.5L15.2-19.4A45.9,45.9,0,0,1,10.7-6.8Z","M65-1V1.1A81.6,81.6,0,0,1,40,5c-8.9,0-12.7-.4-20.6-2.9A1,1,0,0,1,18.8.8.9.9,0,0,1,20,.2C27.7,2.7,31.2,3,40,3A79.7,79.7,0,0,0,64.7-.9ZM-64.6,1.1A82.4,82.4,0,0,0-39.4,5c8.8,0,12.6-.4,20.5-2.9A1.2,1.2,0,0,0-18.2.8,1,1,0,0,0-19.5.2C-27.2,2.7-30.7,3-39.4,3A79.9,79.9,0,0,1-64.2-.9H-65V1ZM-45.8,36a6.7,6.7,0,0,1,6.7-6.7A6.7,6.7,0,0,1-32.4,36a6.7,6.7,0,0,1-6.7,6.7A6.7,6.7,0,0,1-45.8,36Zm2,0a4.7,4.7,0,0,0,4.7,4.7A4.7,4.7,0,0,0-34.4,36a4.7,4.7,0,0,0-4.7-4.7A4.7,4.7,0,0,0-43.8,36Zm10.4-71.4a5.7,5.7,0,0,0-5.7-5.7,5.6,5.6,0,0,0-5.7,5.7,5.7,5.7,0,0,0,5.7,5.7A5.8,5.8,0,0,0-33.4-35.4ZM4.9-37.1a2.2,2.2,0,0,0,2.2,2.2,2.2,2.2,0,0,0,2.2-2.2,2.2,2.2,0,0,0-2.2-2.2A2.2,2.2,0,0,0,4.9-37.1ZM38.7,42.7h0A6.8,6.8,0,0,1,32,36a6.7,6.7,0,1,1,6.7,6.7ZM43.4,36a4.7,4.7,0,1,0-4.7,4.7h0A4.7,4.7,0,0,0,43.4,36ZM0,42.9c4.1.7,8.7-9.6,11.4-17.9A78.6,78.6,0,0,0,15.3.3c0-6.7-1.3-13.7-3.2-21.6-.6-1.6-3.4-4.2-5.8-5.1,2.2-2,1.8-2.9,2.3-3.7s.1-3.3,0-3.8c-4.5,1.1-6.3-2.7-4.3-5.5C9-44,19.3-53.3,29-55.2a6.4,6.4,0,0,0,1,1.3,3.1,3.1,0,0,0,1.8.5,2.9,2.9,0,0,0,2.4-1.2h0a3,3,0,0,0-.6-4.2,2.9,2.9,0,0,0-4.2.7,2.6,2.6,0,0,0-.5.9C19-55.4,8.7-46.5,3.6-41.5A33.5,33.5,0,0,1-.2-42.6l-3.7,1.2c-5-4.9-15.3-13.9-25.4-15.8a2.7,2.7,0,0,0-.5-1.1,3,3,0,0,0-4.2-.6,3,3,0,0,0-.6,4.2h0a3,3,0,0,0,2.4,1.2,3.2,3.2,0,0,0,1.8-.6,3.1,3.1,0,0,0,.9-1.1c10.1,2,20.8,11.8,25.2,16.3,1.3,2.5-.4,5.8-4.2,5-.1.6-.5,3,0,4s.6,1.5,2.3,3.5c-2.4.7-6,4-6.3,5.3-1.6,7-3,15.5-3,21.4a78.8,78.8,0,0,0,4,24.7C-8.8,33.3-3.5,43.8,0,42.9Zm-5.2-80a2.2,2.2,0,0,0-2.2-2.2,2.2,2.2,0,0,0-2.2,2.2,2.2,2.2,0,0,0,2.2,2.2A2.2,2.2,0,0,0-5.2-37.1ZM33-35.4a5.8,5.8,0,0,0,5.7,5.7,5.7,5.7,0,0,0,5.7-5.7,5.6,5.6,0,0,0-5.7-5.7A5.7,5.7,0,0,0,33-35.4Z","M.9,33.4v-9l12.7-9.9.3-1.4L.9,23.2v-10l14-10.9V1L.9,12V2L14.5-8.6c0-.3-.1-.7-.1-1.1L.9.8v-10l11.9-9.3a3.6,3.6,0,0,1-.2-1L.9-10.4v-10l9.2-7.1a4.2,4.2,0,0,0-.4-1L.9-21.6v-9.9h0l5.6-4.3L6-36.8.4-32.4H-.4L-6-36.8l-.5.9L-1-31.6a.1.1,0,0,0-.1.1v9.8l-8.6-6.8a4.2,4.2,0,0,0-.4,1l9,7v10l-11.5-9a3.6,3.6,0,0,1-.2,1L-1.1-9.3V.7L-14.4-9.7c0,.4-.1.8-.1,1.1L-1.1,1.9v10L-14.9,1V2.3L-1.1,13.1v10l-12.8-10,.3,1.4,12.5,9.8v9l-9.6-7.5.6,1.8,9,7v4.1a1,1,0,0,0,1,1,.9.9,0,0,0,1-1v-4l9.2-7.1.6-1.7Z","M0,.8A76.2,76.2,0,0,0,7.8,9.9c-1.6,1.9-5.4,7.6-6.6,21.6h-2C-2,17.1-6,11.4-7.6,9.7A72.7,72.7,0,0,0,0,.8ZM124.3,117.2c-6.5,4.7-6.3,16,.5,25.4a30,30,0,0,0,5.8,6,81.7,81.7,0,0,1,8.3-31.1C133.6,114.7,128.1,114.4,124.3,117.2ZM-82.6,86.3A82.8,82.8,0,0,0-104,75l-1.2,1.7A81,81,0,0,1-83.8,87.9a79.9,79.9,0,0,1,17.6,17.7l.3.5,1.3-1.7A81.3,81.3,0,0,0-82.6,86.3Zm47.3-33.1a80,80,0,0,1-3.9-23.7l-1.1.4-.9.2a83.5,83.5,0,0,0,4,23.7A79.9,79.9,0,0,0-25.8,76.6l2-.6-.3-.4A78.4,78.4,0,0,1-35.3,53.2Zm-81,62.7.6-1.9c-11.9-5.1-16.5-10-18.1-12.4a81.4,81.4,0,0,1-11.8,4.9,85.1,85.1,0,0,1,5.8,9.4C-138.6,115.3-132.2,112.1-116.3,115.9ZM-90,30.1a81.7,81.7,0,0,1-.8,11.1c2,.4,8.7,2.3,18.5,13.8l1.7-1.2c-6.9-11.4-7.6-18.1-7.4-20.9A99.4,99.4,0,0,1-90,30.1ZM38,53.8a85.2,85.2,0,0,0,4.1-23.4l-1.8-.5h-.2a81.5,81.5,0,0,1-4,23.4A81.4,81.4,0,0,1,24.6,75.5l-.4.6,2,.7h0A83,83,0,0,0,38,53.8Zm68.4,24.7-.9-1.3-.3-.4a82,82,0,0,1-17.3,17,82,82,0,0,1-22.5,11.3h-.2l1.2,1.7A85.2,85.2,0,0,0,89.1,95.4,81.6,81.6,0,0,0,106.4,78.5ZM70.8,54.6l1.6,1.2c9.9-11.4,16.5-13.4,18.5-13.7a80.8,80.8,0,0,1-.9-12,97.8,97.8,0,0,1-11.9,2.8C78.4,35.1,78.4,42.1,70.8,54.6ZM126.3,152a28,28,0,0,0-3.9-7.7,26.3,26.3,0,0,0-11.9-9.5c-4.6-1.6-8.8-1.3-12,1s-5.5,8.3-4.3,14.4A82.6,82.6,0,0,1,126.3,152Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z"],Ri=[Ts.red,Ts.blue,Ts.green,Ts.yellow,Ts.green,Ts.teal,Ts.orange,Ts.purple],ji=["-30 -35 60 60","-35 -42 70 70","-35 -60 70 70","-45 -45 90 90","-15 -30 30 60","-75 28 150 100","-30 -35 60 60","-30 -35 60 60"],Ui=[.7,.6,.3,.6,.3,.6,.7,.7];class Ki extends si{constructor(t,e,s){super(js(Le(Ni[+t])),e,s),this.type="garden",this.options=t;const i=+t;this.$path.setAttr("d",Ni[i]),this.$outline.setAttr("d",Ni[i]);const o=Re("path",{d:qi[i],fill:"black",opacity:Ui[i]});this.$path.insertAfter(o),this.symmetric=!0,this.setColour(Ri[i])}static makeThumbnail(t,e){const s=+t,i=Re("svg",{width:4===s?40:5===s?120:80,height:80,viewBox:ji[s]},e),o=Re("g",{transform:"scale(0.5)"},i);Re("path",{d:Ni[s],fill:Ri[s],class:"polygon-tile"},o),Re("path",{d:qi[s],fill:"black",opacity:Ui[s]},o)}}const Fi=["M34,0a16,16,0,0,1,6.3-12.7l-9-15.7A34.1,34.1,0,0,0,16,0,34.1,34.1,0,0,0,31.3,28.4l9-15.7A16,16,0,0,1,34,0Z","M-25,9.3a33.7,33.7,0,0,0-15.2,3.6l9,15.7A14.4,14.4,0,0,1-25,27.3a16.1,16.1,0,0,1,15.9,14h18A34,34,0,0,0-25,9.3Z","M-25-9.3a33.7,33.7,0,0,1-15.2-3.6l9-15.7A14.4,14.4,0,0,0-25-27.3a16.1,16.1,0,0,0,15.9-14h18A34,34,0,0,1-25-9.3Z","M-8.9,41.3h18A16.1,16.1,0,0,1,25,27.3a14.4,14.4,0,0,1,6.2,1.3l9-15.7A33.9,33.9,0,0,0-8.9,41.3Z","M-31.3-28.4l-9,15.6A65.9,65.9,0,0,1-9.1,41.3h18A83.7,83.7,0,0,0-31.3-28.4Z","M-8.9,41.3h18A65.9,65.9,0,0,1,40.3-12.8l-9-15.6A83.7,83.7,0,0,0-8.9,41.3Z","M-40.3 12.9L-31.3 28.4L40.3 -12.9L31.3 -28.4Z","M-40.2,12.9l9,15.6A65.7,65.7,0,0,1,0,20.6a65.7,65.7,0,0,1,31.2,7.9l9-15.6A82.6,82.6,0,0,0,0,2.6,82.6,82.6,0,0,0-40.2,12.9Z","M31.3,28.4l9-15.6A65.9,65.9,0,0,1,9.1-41.3h-18A83.7,83.7,0,0,0,31.3,28.4Z"],Gi=[[6,3,2],[6,4,8],[7,2,5],[7,5,2],[2,6,3],[8,6,4],[5,7,2],[2,7,5],[3,2,6],[4,8,6],[2,5,7],[5,2,7],[0,1,2],[0,2,1]],Wi="#242436",Qi=[Ts.red,Ts.green,Ts.yellow];function Xi(t,e){const s=Gi[t].map(((t,e)=>[t,e])).sort(((t,e)=>e[0]-t[0]));for(const[t,i]of s)Re("path",{d:Fi[t],class:"tantrix","stroke-width":2.8,stroke:Wi,fill:Qi[i]},e)}class Yi extends si{constructor(t,e,s){super("reg-hexagon",e,s),this.type="tantrix",this.color=Wi,this.options=t,this.$path.setAttr("fill",Wi),Xi(+t,this.$el)}setColour(t){super.setColour(t||Wi);for(const e of this.$el.$$(".tantrix"))e.setAttr("stroke",t||Wi)}static makeThumbnail(t,e){const s=Re("svg",{width:60,height:60,viewBox:"-54 -54 108 108"},e);Re("path",{class:"polygon-tile",path:Js("reg-hexagon"),fill:Wi},s),Xi(+t,s)}}const Ji=25,to={100:Ts.yellow,10:Ts.blue};function eo(t,e,s){return Re("rect",{class:"number-tile",width:t,height:t,fill:s},e)}function so(t,e,s,i,o,n){t.setAttr("x",o+e%s*i),t.setAttr("y",n+Math.floor(e/s)*i)}class io extends Ls{constructor(t,e,s){super(e,s),this.type="number-tile",this.options=t;const[i,o]=t.split(":").map((t=>+t));this.count=o,this.colour=to[o]||Ts.red,this.$tiles=p((()=>eo(Ji,this.$el,this.colour)),o),this.$outline=Re("path",{class:"outline"},this.$el),o>1&&(this.$handle=this.makeHandle("h",(t=>this.setWidth(Math.round(t.x/Ji))))),this.setWidth(i,!0)}setWidth(t,e=!1){var s;if((t=U(t,1,this.count))!==this.width){this.value=this.count,this.width=t,this.options=`${t}:${this.count}`;for(let e=0;e<this.count;++e)so(this.$tiles[e],e,t,Ji,-12.5,-12.5);this.path=function(t,e,s,i){const o=i.shift(t*s,0),n=o.shift(0,Math.floor(e/t)*s),a=i.shift(0,Math.ceil(e/t)*s),r=a.shift(e%t*s,0),l=r.shift(0,e%t?-s:0);return new St(i,o,n,l,r,a)}(t,this.count,Ji,new rt(-12.5,-12.5)),this.$outline.draw(this.path),null===(s=this.$handle)||void 0===s||s.setTransform(new rt((t-.5)*Ji,-12.5)),this.transform(),e||this.$parent.selection.update()}}setColour(t){this.colour=t;for(const e of this.$tiles)e.setAttr("fill",As(t))}static makeThumbnail(t,e){let[s,i]=t.split(":").map((t=>+t));s=Math.min(s,i);const o=Re("svg",{width:1===i?40:80,height:80},e),n=(1===i?20:40)-s/2*7,a=40-Math.ceil(i/s)/2*7,r=to[i]||Ts.red;for(let t=0;t<i;++t)so(eo(7,o,r),t,s,7,n,a)}getSnapPoints(){const t=new rt(-12.5,-12.5),e=[t];for(let s=1;s<=this.width;++s)e.push(t.shift(s*Ji,0));const s=Math.ceil(this.count/this.width);for(let i=1;i<=s;++i)e.push(t.shift(0,i*Ji));for(let s=0;s<this.count;++s)e.push(t.shift((s%this.width+1)*Ji,Math.floor(s/this.width+1)*Ji));return e}split(){if(1===this.count)return;const t=p((t=>{const e=t%this.width*Ji,s=Math.floor(t/this.width)*Ji,i=this.posn.shift(e,s).rotate(this.rot*Cs,this.posn);return oo(1,1,this.$parent,i,this.rot,this.colour)}),this.count);this.$parent.selection.select(t),this.delete()}static action(t,e){if("split"===t)for(const t of e)t.split();else if("merge"===t){const t=Array.from(e),s=f(t.map((t=>t.count))),i=u(g(t,(t=>t.count))),o=i.$parent,n=Math.min(...t.map((t=>t.posn.x))),a=Math.min(...t.map((t=>t.posn.y))),r=oo(s,Math.max(...t.map((t=>Math.ceil((t.posn.x-n)/Ji)+t.width))),o,new rt(n,a),i.rot,i.colour);for(const t of e)t.delete();o.selection.add(r)}}}function oo(t,e,s,i,o,n){const a=new io(`${e}:${t}`,s);return a.setColour(n),a.setTransform(i,o),a}const no=[Ts.yellow,"#f15e19","#e1343b",Ts.red,"#8d2ca1","#4e53d0",Ts.blue,Ts.teal,Ts.green,Ts.lime],ao=["#e6e2c6","#cc1030",Ts.green,Ts.red,"#ffd615",Ts.teal,"#181824","#9a2e13",Ts.blue,Ts.yellow];class ro extends si{constructor(t,e,s){super(Us(25*+t,25),e,s),this.type="number-bar",this.options=t,this.value=+t,this.$text=Re("text",{text:t,class:"polygon-label",y:6},this.$el),this.setColour((e.options.altColors?ao:no)[+t-1])}customTransform(){this.$text.css("transform",`rotate(${-this.rot}deg)`)}static makeThumbnail(t,e,s){const i=+t,o=new Zt(new rt(1,1),20*i,20),n=Re("svg",{width:20*i+2,height:22},e),a=Re("path",{class:"polygon-tile",path:o},n);Re("text",{html:t,class:"polygon-label",x:10*i+1,y:16},n),s.options.watch((t=>a.setAttr("fill",(t.altColors?ao:no)[i-1])))}}class lo extends Ls{constructor(t,e,s){super(e,s),this.type="number-line",this.$el.addClass("number-line"),this.$fill=Re("path",{fill:"transparent"},this.$el),this.$lines=Re("path",{class:"number-line-ticks"},this.$el),this.$labels=Re("g",{},this.$el),this.setColour(Ts.darkGrey);const[i,o,n,a,r]=t.split(":").map((t=>+t)),l={start:i,step:o,width:n,size:a,minor:r},h=e.bindSettingsPanel(this,'<h3>Number Line</h3><label class="row"><div class="label">Start:</div><input class="input-field" type="number" :bind="start"></label><label class="row"><div class="label">Step Size:</div><input class="input-field" type="number" :bind="step" min="0"></label><label class="row"><div class="label">Width:</div><input class="input-field" type="number" :bind="size" min="1" max="25"></label><label class="row"><div class="label">Divisions:</div><input class="input-field" type="number" :bind="minor" min="1" max="25"></label>',l);this.$start=this.makeHandle("h",(t=>{const e=Math.round(t.x/25/h.size);e&&(this.setTransform(this.posn.shift(25*e*h.size,0),this.rot),h.width-=e,h.start=R(h.start+e*h.step,5))})),this.$start.setTransform({x:-25,y:-2.5},Math.PI),this.$end=this.makeHandle("h",(t=>{const e=t.x/25/h.size;h.width=U(Math.round(e),1,100)})),h.watch((()=>{h.start=R(h.start,4),h.step=R(h.step,4),h.size=Math.round(h.size),h.minor=Math.round(h.minor),this.setDimensions(h)}))}setDimensions({start:t,step:e,width:s,size:i,minor:o}){const n=`${t}:${e}:${s}:${i}:${o}`;if(n===this.options)return;this.options=n,this.$labels.removeChildren();let a=`M0 10L${s*(i*=25)} 10`;for(let n=0;n<=s*o;n+=1){const s=n*i/o,r=!(n%o),l=Z(t+n*e/o,4);a+=`M${s} ${r?0:5}L${s} ${r?20:15}`,r&&Re("text",{text:l,x:s,y:40},this.$labels)}this.$lines.setAttr("d",a),this.$end.setTransform({x:s*i,y:-2.5}),this.linePoints=p((t=>new rt(t*i,10)),s+1),this.line=new ut(new rt(0,10),new rt(s*i,10)),this.path=new Zt(lt,s*i,44),this.$fill.draw(this.path),this.transform(),this.$parent.selection.update(),this.$parent.change({tilesChanged:[this]})}getSnapPoints(){return this.linePoints}getSnapLines(){return[this.line]}customTransform(){for(const t of this.$labels.children)t.css("transform",`rotate(${-this.rot}deg)`)}setColour(t){super.setColour(t),this.$lines.setAttr("stroke",As(t)),this.$labels.setAttr("fill",As(t))}static makeThumbnail(t,e){const s=Re("svg",{width:240,height:40,class:"number-line"},e);let i="M20 10L220 10";for(let t=0;t<=10;t+=1){const e=20+20*t;i+=`M${e} 5L${e} 15`,Re("text",{text:t,x:e,y:30},s)}Re("path",{d:i,class:"number-line-ticks"},s)}}const ho=2*Math.PI,co={1:Ts.grey,2:Ts.yellow,3:Ts.green,5:Ts.blue,7:Ts.purple};function po(t,e,s=1){const i=t.y*e.x-t.x*e.y>0?s:1-s;return[t.x,t.y+"A"+t.length,t.length,0,i,s,e.x,e.y].join(",")}function uo(t,e,s=50){if(1===e)return"M0-xAx,x,0,0,0-x,0,x,x,0,0,0,0,x,x,x,0,0,0,x,0,x,x,0,0,0,0-xZM0,yAz,z,0,0,1-y,0,z,z,0,0,1,0-y,z,z,0,0,1,y,0,z,z,0,0,1,0,yZ".replace(/x/g,""+s).replace(/y/g,""+.4*s).replace(/z/g,""+(.4*s+.1));const i=ho/e,o=-Math.PI/2-i/2,n=rt.fromPolar(o+i*t,s),a=rt.fromPolar(o+i*(t+1),s);return`M${po(n,a)}L${po(a.scale(.4),n.scale(.4),0)}Z`}function fo(t){return 1===t?[1]:X(t).reverse()}class go extends Ls{constructor(t,e,s){super(e,s),this.type="prime-disk",this.$segments=[],this.factors=[],this.path=new gt(lt,50),Re("circle",{class:"prime-background",r:50},this.$el),this.$segmentWrap=Re("g",{},this.$el),this.$label=Re("text",{class:"prime-label",y:5},this.$el),this.$outline=Re("path",{class:"outline",path:this.path},this.$el),this.setValue(+t)}setValue(t){t=this.value=U(Math.round(t),1,9999999),this.options=this.$label.text=""+t,this.factors=fo(t);const e=this.factors.length;for(let t=0;t<e;++t){const s=this.getSegment(t);s.setAttr("fill",co[this.factors[t]]||Ts.red),s.setAttr("d",uo(t,e)),s.show()}for(let t=e;t<this.$segments.length;++t)this.$segments[t].hide()}multiply(t){this.setValue(+this.options*t)}getSegment(t){if(this.$segments[t])return this.$segments[t];const e=Re("path",{class:"polygon-tile"},this.$segmentWrap);return this.$parent.events.listen(e,{down:()=>{this.locked||this.$parent.selection.add(this,!this.$parent.events.shiftKey)},start:()=>{this.isActive&&(this.$parent.selection.add(this,!0),e.addClass("prime-move"),this.$parent.$activeTiles.append(e))},move:t=>{this.isActive&&(e.setTransform(this.posn.add(t.posn).subtract(t.startPosn)),this.setCollision(this.findNearbyTile(t.posn)))},end:s=>{if(!this.isActive)return;e.removeClass("prime-move"),e.setTransform(),this.$segmentWrap.append(e);const i=s.lastPosn.subtract(s.startPosn);if(i.length>50){if(this.collision)this.collision.multiply(this.factors[t]),this.$parent.selection.add(this.collision,!0),this.setCollision();else{const e=this.$parent.newTile("prime-disk",""+this.factors[t]);e.setTransform(this.posn.add(i)),this.$parent.selection.add(e,!0)}this.setValue(+this.options/this.factors[t]),this.$parent.change({tilesChanged:[this]})}},checkIfActive:()=>this.factors.length>1}),this.$segments[t]=e,e}setColour(t){if(this.colour=t,t)for(const t of this.$segments)t.setAttr("fill",As(this.colour))}findNearbyTile(t){for(const e of this.$parent.tiles)if(e!==this&&"prime-disk"===e.type&&rt.distance(e.posn,t)<50)return e}setCollision(t){this.collision&&t!==this.collision&&this.collision.$outline.removeClass("active"),this.collision=t,t&&t.$outline.addClass("active")}move(t){super.move(t),this.$parent.selection.tiles.size>1||this.setCollision(this.findNearbyTile(this.posn))}moveEnd(){this.collision&&(this.collision.multiply(+this.options),this.$parent.selection.add(this.collision,!0),this.setCollision(),this.delete())}static makeThumbnail(t,e){const s=Re("svg",{width:54,height:54},e),i=Re("g",{transform:"translate(27 27)"},s);e.onAttr("data-options",(t=>(t=>{i.removeChildren();const e=fo(t);for(let s=0;s<e.length;++s)Re("path",{fill:co[e[s]]||Ts.red,d:uo(s,e.length,25),class:"polygon-tile"},i),Re("text",{text:t,y:4,fill:"white",style:"font-size: 11px; text-anchor: middle"},i)})(Math.round(+t))))}}const mo=25;class xo extends Ls{constructor(t,e,s){super(e,s),this.type="decimal-grid",this.$handles=[],this.$tiles=Re("g",{},this.$el),this.$outline=Re("path",{class:"outline"},this.$el),this.$handles[0]=this.makeHandle("h",(t=>this.setDimensions(t.x/mo,this.height,this.size))),this.$handles[1]=this.makeHandle("v",(t=>this.setDimensions(this.width,t.y/mo,this.size))),this.$handles[2]=this.makeHandle("c",(t=>this.setDimensions(this.width,this.height,(t.x+t.y)/2/mo))),this.$handles[1].css("cursor","ns-resize"),this.$handles[2].css("cursor","nwse-resize");const[i,o,n]=t.split(":");this.setDimensions(+i,+o,+n)}setDimensions(t,e,s){const i=[t=this.width=U(Math.round(t),1,100),e=this.height=U(Math.round(e),1,100),s=this.size=U(Math.round(s),2,Math.max(t,e))].join(":");if(i===this.options)return;this.options=i,this.$tiles.removeChildren();const o=Math.floor(t/s)*s,n=Math.floor(e/s)*s,a=s*mo;for(let t=0;t<o;t+=s)for(let e=0;e<n;e+=s)this.drawRect(t*mo,e*mo,a,a,Ts.yellow);for(let e=o;e<t;++e)for(let t=0;t<n;t+=s)this.drawRect(e*mo,t*mo,mo,a,Ts.blue);for(let t=0;t<o;t+=s)for(let s=n;s<e;++s)this.drawRect(t*mo,s*mo,a,mo,Ts.blue);for(let s=o;s<t;++s)for(let t=n;t<e;++t)this.drawRect(s*mo,t*mo,mo,mo,Ts.red);this.$handles[0].setTransform({x:t*mo,y:0}),this.$handles[1].setTransform({x:0,y:e*mo}),this.$handles[2].setTransform({x:a,y:a}),this.path=new Zt(lt,t*mo,e*mo),this.$outline.draw(this.path),this.$parent.selection.update(),this.transform()}drawRect(t,e,s,i,o){Re("rect",{x:t,y:e,width:s,height:i,fill:this.colour||o,class:"polygon-tile"},this.$tiles)}setColour(t){this.colour=t;for(const e of this.$tiles.children)e.setAttr("fill",As(t))}static makeThumbnail(t,e){const s=Re("svg",{width:140,height:80},e),i=(t,e,i,o,n)=>Re("rect",{x:5+t,y:5+e,width:i,height:o,fill:n,class:"polygon-tile"},s);for(let t=0;t<2;++t)i(50*t,0,50,50,Ts.yellow);for(let t=0;t<3;++t)i(100+10*t,0,10,50,Ts.blue);for(let t=0;t<2;++t)for(let e=0;e<2;++e)i(50*t,50+10*e,50,10,Ts.blue);for(let t=0;t<3;++t)for(let e=0;e<2;++e)i(100+10*t,50+10*e,10,10,Ts.red)}}class bo extends Ls{constructor(t,e,s){super(e,s),this.type="dot-machine",this.canRotate=!1,this.canDragToSelect=!1,this.cells=[],this.isAnimating=!1;const[i,o]=t.split(":").map((t=>+t)),n={base:i,boxes:o};this.model=e.bindSettingsPanel(this,'<h3>Dot Machine</h3><label class="row"><div class="label">Base:</div><input class="input-field" type="number" :bind="base" min="2" max="25"></label><label class="row"><div class="label">Boxes:</div><input class="input-field" type="number" :bind="boxes" min="1" max="10"></label>',n),this.$outline=Re("rect",{class:"outline",rx:12},this.$el),this.model.watch((()=>this.draw(this.model))),this.setColour(Ts.purple),this.onMove=()=>{const t=Array.from(e.selection.tiles).filter((t=>"dot"===t.type));for(const e of this.cells)e.hover(t.some((t=>e.contains(t.posn))))},this.onMoveEnd=()=>{for(const t of this.cells)t.hover(!1)},e.on("move-selection",this.onMove),e.on("move-end",this.onMoveEnd),this.onChange=()=>this.rearrangeDots(),setTimeout((()=>{this.rearrangeDots(),e.on("change",this.onChange)}))}delete(){this.$parent.off("move-selection",this.onMove),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}select(){this.isActive=!0,this.$outline.show();for(const t of this.cells)t.hover()}deselect(){this.isActive=!1,this.$outline.hide();for(const t of this.cells)t.hover(!1);this.$parent.$tiles.prepend(this.$el)}draw(t){const e=Math.round(t.base),s=Math.round(t.boxes);if(this.options=`${e}:${s}`,this.cells.length>s)for(let t=s;t<this.cells.length;++t)this.cells[t].delete(),this.cells=this.cells.slice(0,s);else if(this.cells.length<s)for(let t=this.cells.length;t<s;++t){const e=new vo(this,t);this.cells.push(e),e.setColour(this.colour)}for(const t of this.cells)t.setBase(e);const i=150*(s-1)+10;this.path=new Zt(new rt(-i,-10),i+160,170),this.$outline.setRect(this.path),this.transform(),this.$parent.selection.update()}getSnapPoints(){return[]}setColour(t){super.setColour(t);for(const e of this.cells)e.setColour(t)}moveEnd(){super.moveEnd();for(const t of this.cells)for(const e of[...t.dots,...t.antiDots])e.cell=void 0}rearrangeDots(){if(!this.isAnimating){for(const t of this.cells)t.clear();for(const t of this.$parent.tiles)if("dot"===t.type&&!t.deleted)for(const e of this.cells)(t.cell===e||!t.cell&&e.contains(t.posn))&&e.addDot(t);for(const t of this.cells)t.rearrange()}}static makeThumbnail(t,e){const s=Re("svg",{width:160,height:60},e);for(const t of[105,55,5])Re("rect",{x:t,y:5,width:50,height:50,class:"dot-cell",stroke:"#eee",style:"stroke-width: 6px"},s),Re("circle",{cx:t+25,cy:5,r:2},s),Re("circle",{cx:t+25,cy:55,r:2},s)}static action(t,s){return e(this,void 0,void 0,(function*(){if("explode"===t)for(const t of s)t.isAnimating||t.cells[0].explode();else if("annihilate"===t)for(const t of s)t.isAnimating||t.cells[0].annihilate()}))}}class vo{constructor(t,e=0){this.machine=t,this.index=e,this.dots=[],this.antiDots=[];const s=-150*e;this.$el=Re("rect",{class:"dot-cell",width:150,height:150,x:s}),this.$label=Re("text",{class:"dot-label",x:75+s,y:154,"font-size":"12px"},t.$el),this.$value=Re("text",{class:"dot-label",x:75+s,y:6,text:0,"font-size":"18px"},t.$el),this.bounds=new Zt(new rt(s,0),150,150),t.$el.prepend(this.$el)}setBase(t){this.$label.text=Z(Math.pow(t,this.index))}delete(){this.$el.remove(),this.$label.remove(),this.$value.remove()}setColour(t){this.$el.setAttr("stroke",t),this.machine.isActive&&this.$el.css("fill",t)}hover(t=!0){this.machine.isActive&&!t||this.$el.css("fill",t?this.machine.colour:"none")}contains(t){return this.bounds.translate(this.machine.posn).contains(t)}clear(){this.dots=[],this.antiDots=[]}addDot(t){("1"===t.options?this.dots:this.antiDots).push(t),t.cell=this}rearrange(){this.$value.text=Z(this.dots.length-this.antiDots.length);const t=[...this.dots,...this.antiDots];if(!t.length)return;const e=Math.ceil(Math.sqrt(t.length)),s=Math.ceil(t.length/e),i=t.length<=16?30:t.length<=25?25:20,o=this.bounds.center.add(this.machine.posn).shift(-i*(e-1)/2,-i*(s-1)/2),n=p((t=>o.shift(t%e*i,Math.floor(t/e)*i)),t.length);return this.animatePoints(t,n)}animatePoints(t,e){const s=t.map((t=>t.posn));for(const[s,i]of t.entries())i.setTransform(e[s]);return os((i=>{var o;for(const[n,a]of t.entries()){const t=rt.interpolate(s[n],e[n],as("quad",i));a.$el.setTransform(t),a.transformed=null===(o=a.path)||void 0===o?void 0:o.translate(t)}this.machine.$parent.selection.update()}),240).promise}getDotsToExplode(){const t=this.machine.model.base;return this.dots.length>=t?this.dots.splice(0,t):this.antiDots.length>=t?this.antiDots.splice(0,t):void 0}explode(){return e(this,void 0,void 0,(function*(){const t=this.machine.cells[this.index+1];if(!t)return this.machine.isAnimating=!1,void this.machine.$parent.change({tilesChanged:this.dots});this.machine.isAnimating=!0;const e=this.getDotsToExplode();if(!e)return t.explode();t.addDot(e[0]);for(const t of e.slice(1))t.popOut();return t.rearrange(),yield r(400),this.rearrange(),yield r(400),this.explode()}))}annihilate(){return e(this,void 0,void 0,(function*(){this.machine.isAnimating=!0;const t=Math.min(this.dots.length,this.antiDots.length);if(t){const e=this.dots.splice(0,t),s=this.antiDots.splice(0,t);for(const t of[...e,...s])t.popOut();this.rearrange(),yield r(600)}const e=this.machine.cells[this.index+1];if(e)return e.annihilate();this.machine.isAnimating=!1,this.machine.$parent.change({tilesChanged:this.dots})}))}}const yo=12.5;class wo extends Ls{constructor(t,e,s){super(e,s),this.type="dot",this.deleted=!1,this.options=t,this.$path=Re("circle",{r:yo,class:"polygon-tile"},this.$el),this.$outline=Re("circle",{r:yo,class:"outline"},this.$el),this.path=new gt(lt,yo),this.setColour(Ts.blue)}setColour(t){this.colour=t,this.$path.setAttr("fill","-1"===this.options?Ts.red:this.colour)}getSnapPoints(){return[]}getCell(){for(const t of this.$parent.tiles)if("dot-machine"===t.type&&!t.isActive)for(const e of t.cells)if(e.contains(this.posn))return e}moveEnd(){const t=this.cell,e=this.cell=this.getCell();if(!t||!e||t===e)return;if(t.machine!==e.machine)return;const s=Math.abs(t.index-e.index),i=t.machine.model.base**s;if(t.index<e.index){const e="1"===this.options?t.dots:t.antiDots;if(e.length<i)return this.cell=t;for(const t of e.filter((t=>!t.isActive)).slice(0,i-1))t.popOut()}else for(let t=0;t<i-1;++t){const t=new wo(this.options,this.$parent);t.posn=this.posn,t.cell=e}}static makeThumbnail(t,e){const s="1"===t?Ts.blue:Ts.red,i=Re("svg",{width:40,height:40},e);Re("circle",{class:"polygon-tile",cx:20,cy:20,r:yo,fill:s},i)}negate(){this.options="-1"===this.options?"1":"-1",this.setColour(Ts.blue)}popOut(){return e(this,void 0,void 0,(function*(){this.deleted=!0,yield this.$path.exit("pop").promise,this.delete()}))}static action(t,e){if("negate"===t)for(const t of e)t.negate()}}function $o(t){return 0===t?Ts.grey:t>0?t%2?Ts.orange:Ts.blue:t%2?Ts.red:Ts.teal}function ko(t){return+t.replace("–","-")}function Ao(t,e,s=40,i=50){e=U(Math.round(e),-9999,9999);const o=(t.text=Z(e)).length;return t.css("font-size",(o>=6?.625:o>=4?.75:1)*s+"px"),t.setAttr("y",(o>=6?.9:o>=4?.94:1)*i),e}class Mo extends Ls{constructor(t,e,s){super(e,s),this.type="number-card",this.path=new Zt(lt,75),this.$path=Re("rect",{class:"polygon-tile",rx:10,width:75,height:75},this.$el),this.$label=Re("text",{x:37.5,fill:"white",style:"text-anchor: middle"},this.$el),this.$outline=Re("rect",{class:"outline",rx:10,width:75,height:75},this.$el),this.setValue(ko(t))}setValue(t){this.value=Ao(this.$label,t),this.options=""+this.value,this.setColour()}setColour(t){super.setColour(t||$o(this.value)),this.$path.setAttr("fill",As(this.colour))}findNearbyTile(t){for(const e of this.$parent.tiles)if(e!==this&&"number-card"===e.type&&rt.distance(e.posn,t)<40&&S(e.value+this.value,-9999,9999))return e}setCollision(t){this.collision&&t!==this.collision&&this.collision.$outline.removeClass("active"),this.collision=t,t&&t.$outline.addClass("active")}move(t){super.move(t),this.$parent.selection.tiles.size>1||this.setCollision(this.findNearbyTile(this.posn))}moveEnd(){this.collision&&(this.collision.setValue(this.collision.value+this.value),this.$parent.selection.add(this.collision,!0),this.setCollision(),this.delete())}static makeThumbnail(t,e){const s=Re("svg",{width:60,height:60},e),i=Re("rect",{x:5,y:5,width:50,height:50,class:"polygon-tile",rx:5},s),o=Re("text",{fill:"white",x:30,style:"text-anchor: middle"},s);e.onAttr("data-options",(t=>{const e=Ao(o,ko(t),30,39);i.setAttr("fill",$o(e))}))}}const Co=50,To=[Ts.yellow,"#f15e19","#e1343b",Ts.red,"#8d2ca1","#4e53d0",Ts.blue,"#0595bf","#0ba27b",Ts.green,"#8bba18","#dbc607"];function Po(t,e,s,i,o=0){const n=Re("g",{class:"fraction"},i);Re("text",{text:1,x:e,y:.42*s+o},n),Re("text",{text:t,x:e,y:2.5+.77*s+o},n);const a=t>=10?.2:.14;return Re("line",{x1:e-a*s,y1:s/2+o,x2:e+a*s,y2:s/2+o},n),n}function Lo(t,e,s,i,o,n,a=-e/2,r=-e/2){const l=Re("g",{transform:`translate(${t*i+a} ${r})`},o);return[l,Re("rect",{width:t,height:e,fill:n,class:"polygon-tile"},l),Po(s,t/2,e,l)]}class So extends Ls{constructor(t,e,s){super(e,s),this.type="fraction-bar",this.count=0,this.$parts=[],this.options=t;const[i,o]=t.split(":").map((t=>+t));this.denominator=i,this.tileWidth=500/i,this.colour=To[i-1],this.$fraction=Re("g",{},this.$el),this.$outline=Re("path",{class:"outline"},this.$el),this.$handle=this.makeHandle("h",(t=>this.setCount(Math.round(t.x/this.tileWidth)))),this.setCount(o)}setCount(t){if((t=U(t,1,20))!==this.count){if(this.value=t/this.denominator,t<this.count){for(let e=t;e<this.count;e+=1)this.$parts[e][0].remove();this.$parts=this.$parts.slice(0,t)}else for(let e=this.count;e<t;e+=1)this.$parts.push(Lo(this.tileWidth,Co,this.denominator,e,this.$fraction,this.colour));this.count=t,this.options=`${this.denominator}:${t}`,this.path=new Zt(new rt(-25,-25),t*this.tileWidth,Co),this.$outline.draw(this.path),this.$handle.setTransform(new rt(t*this.tileWidth-25,-25)),this.transform(),this.$parent.selection.update()}}setColour(t){this.colour=t;for(const e of this.$parts)e[1].setAttr("fill",As(t))}customTransform(){for(const t of this.$parts)t[2].css("transform",`rotate(${-this.rot}deg)`)}static makeThumbnail(t,e){const[s,i]=t.split(":").map((t=>+t)),o=Re("svg",{width:222,height:22},e),n=To[s-1],a=220/s;for(let t=0;t<i;++t)Lo(a,20,s,t,o,n,1,1)}getSnapPoints(){const t=[];for(let e=0;e<=this.count;e+=1)t.push(new rt(e*this.tileWidth-25,-25)),t.push(new rt(e*this.tileWidth-25,25));return t}split(){if(1===this.count)return;const t=p((t=>{const e=this.posn.shift(t*this.tileWidth,0).rotate(this.rot*Cs,this.posn),s=new So(`${this.denominator}:1`,this.$parent);return s.setTransform(e,this.rot),s.setColour(this.colour),s}),this.count);this.$parent.selection.select(t),this.delete()}static action(t,e){if("split"===t)for(const t of e)t.split();else if("merge"===t){const t=Array.from(e),s=Math.min(...t.map((t=>t.posn.x))),i=Math.min(...t.map((t=>t.posn.y))),o=t.map((t=>t.count)),n=f(o),a=new So(`${t[0].denominator}:${n}`,t[0].$parent);a.setColour(P.mixMany(t.map((t=>P.from(t.colour))),o).hex),a.setTransform(new rt(s,i),t[0].rot);for(const t of e)t.delete();t[0].$parent.selection.add(a)}}}class zo extends Ls{constructor(t,e,s){super(e,s),this.type="fraction-circle",this.rotateAroundOrigin=!0,this.options=t;const i={class:"polygon-tile",path:this.path,fill:this.colour};this.$path=Re("path",i,this.$el),this.$outline=Re("path",{class:"outline",path:this.path},this.$el);const o=+t;if(this.value=1/o,o>1){const t=new rt(0,-100).rotate(-Math.PI/o),e=this.path=new ct(lt,t,2*Math.PI/o);this.snapAngles=[0,at(t)*Ms,at(e.end)*Ms]}else this.path=new gt(lt,100);if(this.$path.draw(this.path),this.$outline.draw(this.path),o>1){const t=-75-2.5*(o-2);this.$label=Po(o,0,50,this.$el,t)}this.colour=To[o-1],this.$path.setAttr("fill",this.colour)}customTransform(){var t;null===(t=this.$label)||void 0===t||t.css("transform",`rotate(${-this.rot}deg)`)}setColour(t){this.colour=t,this.$path.setAttr("fill",As(t))}static makeThumbnail(t,e){const s=+t,i=Re("svg",{width:80,height:44},e),o=Re("path",{class:"polygon-tile"},i),n=new rt(40,2).rotate(-Math.PI/s,new rt(40,42)),a=s>1?new ct(new rt(40,42),n,2*Math.PI/s):new gt(new rt(40,22),20);if(o.draw(a),o.setAttr("fill",To[s-1]),s>1){const t=Re("g",{class:"fraction"},i);t.translate(40,12-s),Po(s,0,25,t)}}}const Vo={1:Ts.yellow,x:Ts.green,x2:Ts.blue},Zo={1:1,x:5,x2:25,"-1":-1,"-x":-5,"-x2":-25};function Eo(t){return t.replace("-","–").replace("2","²")}function Ho(t){return"-"===t[0]?Ts.red:Vo[t]}function _o(t){return"algebra-tile"===t.type}class Io extends si{constructor(t,e,s){super(function(t){return Us(i(t,"x2","-x2")?135:25,i(t,"1","-1")?25:135)}(t.toLowerCase()),e,s),this.type="algebra-tile",this.options=t.toLowerCase(),this.value=Zo[this.options],this.$text=Re("text",{text:Eo(this.options),class:"polygon-label",y:6},this.$el),this.setColour(Ho(this.options))}setColour(t=this.colour){super.setColour(t),this.$path.setAttr("fill",As(this.collision?"#ddd":this.colour)),this.$text.text=this.collision?"0":Eo(this.options)}customTransform(){this.$text.css("transform",`rotate(${-this.rot}deg)`)}setCollision(t){this.collision=t,this.setColour()}move(t){if(super.move(t),this.collision){if(rt.distance(this.posn,this.collision.posn)<23.75)return;this.collision.setCollision(),this.setCollision()}const e="-"===this.options[0]?this.options.slice(1):"-"+this.options;for(const t of this.$parent.tiles)if(_o(t)&&!t.collision&&t!==this&&t.options===e&&!(rt.distance(this.posn,t.posn)>=23.75))return this.setCollision(t),void t.setCollision(this)}static makeThumbnail(t,e){const s=i(t,"x2","-x2")?78:20,o=i(t,"1","-1")?20:78,n=i(t,"x2","-x2")?80:54,a=new Zt(new rt((n-s)/2,40-o/2),s,o),r=Re("svg",{width:n,height:80},e);Re("path",{class:"polygon-tile",path:a,fill:Ho(t)},r),Re("text",{text:Eo(t),class:"polygon-label",x:n/2,y:45},r)}negate(){this.options.startsWith("-")?this.options=this.options.slice(1):this.options="-"+this.options,this.value=Zo[this.options],this.setColour(Ho(this.options)),this.$text.text=Eo(this.options)}static action(t,e){if("negate"===t)for(const t of e)t.negate()}}const Oo=25;function Do(t,e,s,i,o){return new St(new rt(-o,-o),new rt(-o,t),new rt(o,t),new rt(o,-o),new rt(e,-o),new rt(e,o),new rt(o,o),new rt(o,s),new rt(-o,s),new rt(-o,o),new rt(i,o),new rt(i,-o))}class Bo extends Ls{constructor(t,e,s){super(e,s),this.type="grid",this.showSelectionOutline=!0,this.canDragToSelect=!1,this.options=t,this.dimensions=new rt,this.$axes=p((()=>Re("line",{class:"grid-axis",stroke:"#777"},this.$el)),2),this.$fill=Re("path",{fill:"transparent"},this.$el),this.$handles=[0,1].map((t=>this.makeHandle("c",(e=>{const s=t?this.dimensions.x:Math.round(e.x/Oo-1),i=t?Math.round(e.y/Oo-1):this.dimensions.y;this.setDimensions(s,i)})))),this.$handles[1].css("cursor","ns-resize");const i=t.split(":");this.setDimensions(+i[0],+i[1])}setDimensions(t,e){t=U(t,1,100),e=U(e,1,100),t===this.dimensions.x&&e===this.dimensions.y||(this.dimensions=new rt(t,e),this.options=`${t}:${e}`,this.path=Do(-1.5,t+1,e+1,-1.5,.5).scale(Oo),this.$axes[0].setLine({x:-37.5,y:0},{x:(t+1)*Oo,y:0}),this.$axes[1].setLine({x:0,y:-37.5},{x:0,y:(e+1)*Oo}),this.$handles[0].setCenter({x:(t+1)*Oo,y:0}),this.$handles[1].setCenter({x:0,y:(e+1)*Oo}),this.$fill.draw(this.path),this.transform(),this.$parent.selection.update())}setColour(t){this.colour=t;for(const e of this.$axes)e.setAttr("stroke",As(t))}static makeThumbnail(t,e){const s=Re("svg",{width:80,height:80},e);Re("line",{x1:20,y1:0,x2:20,y2:80,stroke:"white","stroke-width":2},s),Re("line",{x1:0,y1:20,x2:80,y2:20,stroke:"white","stroke-width":2},s)}}const No=new Map;let qo;const Ro=Re("div",{class:"snackbar"},je);let jo=class extends ms{ready(){var t;Ro.append(this),No.set(this.attr("key"),this),null===(t=this.$("button"))||void 0===t||t.on("click",(()=>this.close()))}open(t=2e3){return e(this,void 0,void 0,(function*(){qo!==this&&(qo&&(yield qo.close()),qo=this,yield this.enter("pop",300).promise,this.setAttr("role","alert"),t&&setTimeout((()=>this.close()),t))}))}close(){return e(this,void 0,void 0,(function*(){qo===this&&(qo=void 0,this.removeAttr("role"),yield this.exit("pop",300).promise)}))}};function Uo(t,e=4e3){var s;return null===(s=No.get(t))||void 0===s?void 0:s.open(e)}jo=t([xs("x-alert")],jo);const Ko=new Map,Fo=t=>t.type+t.options+t.colour,Go=t=>{var e,s;return null!==(s=null!==(e=t.value)&&void 0!==e?e:Ko.get(Fo(t)))&&void 0!==s?s:1};function Wo(t,e){const s={};let i=0;const o=(t,e=1)=>{i+=e*Go(t),void 0===t.value&&(s[Fo(t)]=(s[Fo(t)]||0)+e)};for(const e of t)o(e,1);for(const t of e)o(t,-1);if(L(i,0))return;const n=Object.keys(s).filter((t=>s[t])),a=n.filter((t=>!Ko.has(t)))[0]||u(n);if(!a)return!0;const r=Ko.get(a)||1;Ko.set(a,r-i/s[a])}const Qo="M120,0C120,16,66.3,20,0,20S-120,16-120,0Z",Xo="M0,26A18.1,18.1,0,0,0-18,44V72H18V44A18.1,18.1,0,0,0,0,26Z",Yo=["text","grid","number-line","spinner","decimal-grid","custom-spinner","ruler","protractor","compass","geo","dot-machine","axes"],Jo=new Zt(new rt(0,-180),240,180),tn=15;function en(t,e){var s;const i=t.posn.shift(0,e);t.$el.setTransform(i,t.rot*Cs),t.transformed=null===(s=t.path)||void 0===s?void 0:s.rotate(t.rot).translate(i)}class sn extends Ls{constructor(t,e,s){super(e,s),this.type="balance",this.canRotate=!1,this.canDragToSelect=!1,this.level=0,this.left=[],this.right=[],this.isAnimating=!1,this.level=+t||0,this.options=t||"0",this.$beam=Re("path",{class:"balance-beam"},this.$el),this.$left=Re("path",{d:Qo,class:"balance"},this.$el),this.$right=Re("path",{d:Qo,class:"balance"},this.$el),this.$base=Re("path",{d:Xo,class:"balance"},this.$el),this.setColour("#bbb"),this.customTransform(),this.draw();const i=Re("path",{path:Jo,class:"balance-target"},this.$el),o=Re("path",{path:Jo,class:"balance-target"},this.$el);this.onMoveStart=()=>{if(!function(t,e){for(const s of t)if(!e(s))return!1;return!0}(e.selection.tiles,(t=>Yo.includes(t.type)))){i.setTransform({x:-280,y:this.level*tn}),o.setTransform({x:40,y:-this.level*tn});for(const t of[i,o])t.show()}},this.onMoveEnd=()=>{for(const t of[i,o])t.hide()},this.onChange=()=>{this.checkTileOverlaps(),this.rebalance()},e.on("move-start",this.onMoveStart),e.on("move-end",this.onMoveEnd),setTimeout((()=>{this.checkTileOverlaps(),e.on("change",this.onChange)}))}delete(){this.$parent.off("move-start",this.onMoveStart),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}checkTileOverlaps(){const t=Jo.translate(this.posn).shift(-280,this.level*tn),e=Jo.translate(this.posn).shift(40,-this.level*tn);this.left=[],this.right=[];for(const s of this.$parent.tiles)s.transformed&&"balance"!==s.type&&!Yo.includes(s.type)&&($s(t,s.transformed)?this.left.push(s):$s(e,s.transformed)&&this.right.push(s))}draw(t=this.level){const e=new rt(-160,15*t),s=new rt(160,15*-t);this.$beam.draw(new zt(e.shift(0,10),e.shift(0,44),s.shift(0,44),s.shift(0,10))),this.$left.setTransform(e),this.$right.setTransform(s)}rebalance(t=400){return e(this,void 0,void 0,(function*(){const e=f(this.left.map((t=>Go(t)))),s=f(this.right.map((t=>Go(t)))),i=L(e,s)?0:e<s?-1:1;if(i===this.level||this.isAnimating)return;const o=this.level,n=(i-o)*tn;this.level=i,this.options=i.toString();for(const t of this.left)t.setTransform(t.posn.shift(0,n));for(const t of this.right)t.setTransform(t.posn.shift(0,-n));this.isAnimating=!0,yield os((t=>{this.draw(K(o,i,t));for(const e of this.left)en(e,(t-1)*n);for(const e of this.right)en(e,(1-t)*n);this.$parent.selection.update()}),t).promise,this.isAnimating=!1,this.transform(),this.$parent.selection.update()}))}customTransform(){const t=this.level*tn;this.path=new St(new rt(-280,t),new rt(-40,t),new rt(-40,25),new rt(40,25),new rt(40,-t),new rt(280,-t),new rt(280,48-t),new rt(40,48-t),new rt(40,72),new rt(-40,72),new rt(-40,t+48),new rt(-280,t+48))}getSnapPoints(){return[]}getSnapLines(){const t=this.level*tn;return[new ut(new rt(-280,t),new rt(-40,t)),new ut(new rt(40,-t),new rt(280,-t))]}setColour(t){this.colour=t,this.$beam.css("stroke",t);for(const e of[this.$base,this.$left,this.$right])e.css("fill",As(t))}static makeThumbnail(t,e){const s=Re("svg",{width:250,height:50,viewBox:"-290 -10 580 82",class:"scale"},e);Re("path",{d:"M-160 10v34h320v-34",fill:"transparent",stroke:"#bbb","stroke-width":10},s),Re("path",{d:Qo,transform:"translate(-160 0)",fill:"#bbb"},s),Re("path",{d:Qo,transform:"translate(160 0)",fill:"#bbb"},s),Re("path",{d:Xo,fill:"#bbb"},s)}static action(t,s){return e(this,void 0,void 0,(function*(){if("balance"===t)for(const t of s){Wo(t.left,t.right)&&Uo("balance-error"),t.rebalance()}}))}}const on={circle:"M -25 0a25,25 0 1 0 50 0a25 25 0 1 0 -50 0",square:"M0 -25L25 0L0 25L-25 0Z",cross:"M25 -9L9 -9L9 -25L-9 -25L-9 -9L-25 -9L-25 9L-9 9L-9 25L9 25L9 9L25 9L25 -9Z",weight:"M24.3,22.1,17.7-6.1A4,4,0,0,0,14-9H8a10.3,10.3,0,0,0,2-6A10,10,0,0,0,0-25,10,10,0,0,0-10-15,10.3,10.3,0,0,0-8-9h-6a4,4,0,0,0-3.7,2.9l-6.6,28.2A2.2,2.2,0,0,0-22,25H22A2.2,2.2,0,0,0,24.3,22.1ZM0-11a4,4,0,0,1-4-4,4,4,0,0,1,4-4,4,4,0,0,1,4,4A4,4,0,0,1,0-11Z",star:"M0 15.7L15.5 23.8L12.5 6.6L25 -5.6L7.7 -8.1L0 -23.8L-7.7 -8.1L-25 -5.6L-12.5 6.6L-15.5 23.8L0 15.7Z",heart:"M3.4,20.8a4.9,4.9,0,0,1-6.7-.1l-.3-.2C-16.7,8.6-25.3.8-25-8.9a13.7,13.7,0,0,1,5.9-10.7A14.4,14.4,0,0,1,0-16.8a14.4,14.4,0,0,1,19.1-2.8A13.7,13.7,0,0,1,25-8.9C25.3.8,16.7,8.6,3.6,20.5Z"},nn={weight:"M24.3,22.1,17.7-6.1A4,4,0,0,0,14-9H8a10.3,10.3,0,0,0,2-6A10,10,0,0,0,0-25,10,10,0,0,0-10-15,10.3,10.3,0,0,0-8-9h-6a4,4,0,0,0-3.7,2.9l-6.6,28.2A2.2,2.2,0,0,0-22,25H22A2.2,2.2,0,0,0,24.3,22.1Z"},an={circle:Ts.orange,square:Ts.purple,cross:Ts.green,weight:Ts.blue,star:Ts.yellow,heart:Ts.red};class rn extends si{constructor(t,e,s){super("square",e,s),this.type="token",this.options=t,this.$path.setAttr("d",on[t]),this.$outline.setAttr("d",nn[t]||on[t]),this.setColour(an[t])}static makeThumbnail(t,e){const s=Re("svg",{width:36,height:36},e),i=Re("path",{d:on[t],class:"polygon-tile"},s);i.setTransform({x:18,y:18},0,.6),i.setAttr("fill",an[t])}}class ln extends Error{constructor(t,e){super(e),this.name=t}static undefinedVariable(t){return new ln("EvalError",`Undefined variable “${t}”.`)}static undefinedFunction(t){return new ln("EvalError",`Undefined function “${t}”.`)}static invalidCharacter(t){return new ln("SyntaxError",`Unknown symbol “${t}”.`)}static conflictingBrackets(t){return new ln("SyntaxError",`Conflicting brackets “${t}”.`)}static unclosedBracket(t){return new ln("SyntaxError",`Unclosed bracket “${t}”.`)}static startOperator(t){return new ln("SyntaxError",`A term cannot start with a “${t}”.`)}static endOperator(t){return new ln("SyntaxError",`A term cannot end with a “${t}”.`)}static consecutiveOperators(t,e){return new ln("SyntaxError",`A “${t}” cannot be followed by a “${e}”.`)}static invalidExpression(){return new ln("SyntaxError","This expression is invalid.")}}const hn={pi:Math.PI,"π":Math.PI,e:Math.E},cn={"(":")","[":"]","{":"}"},dn={"*":"·","**":"∗","//":"//","+-":"±","–":"−","-":"−",xx:"×",sum:"∑",prod:"∏",int:"∫",del:"∂",grad:"∇",aleph:"ℵ",not:"¬",AA:"∀",EE:"∃","'":"’","!=":"≠","<=":"≤",">=":"≥",in:"∈","!in":"∉","==":"≡","~=":"≅","~~":"≈",sub:"⊂",sube:"⊆",prop:"∝",oo:"∞",cap:"∩",cup:"∪","<-":"←","->":"→","=>":"⇒","<=>":"⇔","|->":"↦",uarr:"↑",darr:"↓",lArr:"⇐"},pn={Gamma:"Γ",Delta:"Δ",Theta:"Θ",Lambda:"Λ",Xi:"Ξ",Pi:"Π",Sigma:"Σ",Phi:"Φ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ɛ",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",pi:"π",rho:"ρ",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",CC:"ℂ",NN:"ℕ",QQ:"ℚ",RR:"ℝ",ZZ:"ℤ"},un="abcdefghijklmnopqrstuvwxyz",fn=[...un.split(""),...un.toUpperCase().split(""),...Object.values(pn),"$"],gn=[..."|()[]{}÷,!<>=*/+-–−~^_…°•∥⊥'∠:%∼△",...Object.values(dn)],mn={_:"sub","^":"sup","//":"/","÷":"/"},xn={"<":"&lt;",">":"&gt;"};function bn(t){return t in xn?xn[t]:t}const vn=new Set(["sin","cos","tan","sec","csc","cot","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","exp","log","ln","det","dim","mod","gcd","lcm","min","max"]);function yn(t){return vn.has(t)}const wn={"+":"plus","−":"minus","·":"times","×":"times","/":"over","//":"divided by","%":"percent","!":"factorial","±":"plus-minus","=":"equals","≠":"does not equal","<":"is less than",">":"is greater than","≤":"is less than or equal to","≥":"is greater than or equal to","π":"pi","≅":"is congruent to","∥":"is parallel to","⊥":"is perpendicular to"};for(const t of Object.keys(pn))wn[pn[t]]=t;class $n{evaluate(t={}){return NaN}substitute(t={}){return this}get simplified(){return this}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(t={}){return""}toMathML(t={}){return""}}class kn extends $n{constructor(t){super(),this.n=t}evaluate(){return this.n}toString(){return""+this.n}toVoice(){return""+this.n}toMathML(){return`<mn>${this.n}</mn>`}}class An extends $n{constructor(t){super(),this.i=t}evaluate(t={}){if(this.i in t)return t[this.i];if(this.i in hn)return hn[this.i];throw ln.undefinedVariable(this.i)}toMathML(){return`<mi${yn(this.i)?' mathvariant="normal"':""}>${this.i}</mi>`}substitute(t={}){return t[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in wn?wn[this.i]:1===this.i.length?`_${this.i}_`:this.i}}class Mn extends $n{constructor(t){super(),this.s=t}evaluate(t={}){if(this.s in t)return t[this.s];throw ln.undefinedVariable(this.s)}toString(){return'"'+this.s+'"'}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}}class Cn extends $n{toString(){return" "}toMathML(){return"<mspace></mspace>"}}class Tn extends $n{constructor(t){super(),this.o=t}toString(){return this.o.replace("//","/")}toVoice(){return wn[this.o]||this.o}get functions(){return[this.o]}toMathML(){const t=bn(this.toString());return`<mo value="${t}">${t}</mo>`}}const Pn=y("+ − * × · / ÷ // sup sub subsup"),Ln=y("sub sup subsup"),Sn='<mo value="," lspace="0">,</mo>';function zn(t,e){return!!Pn.includes(e)&&(t instanceof Hn||t instanceof En&&(!!Pn.includes(t.fn)&&(!(!Ln.includes(t.fn)||!Ln.includes(e))||Pn.indexOf(e)>Pn.indexOf(t.fn))))}function Vn(t,e){return t instanceof Hn||t instanceof En?`<mrow>${e}</mrow>`:e}function Zn(t){return"2"===t?"squared":"3"===t?"cubed":`to the power of ${t}`}class En extends $n{constructor(t,e=[]){super(),this.fn=t,this.args=e}evaluate(t={}){const e=this.args.map((e=>e.evaluate(t)));if(this.fn in t)return t[this.fn](...e);switch(this.fn){case"+":return e.reduce(((t,e)=>t+e),0);case"−":return e.length>1?e[0]-e[1]:-e[0];case"*":case"·":case"×":return e.reduce(((t,e)=>t*e),1);case"/":return e[0]/e[1];case"sin":case"cos":case"tan":return Math.sin(e[0]);case"log":return Math.log(e[0])/Math.log(e[1]||Math.E);case"sup":return Math.pow(e[0],e[1]);case"sqrt":return Math.sqrt(e[0]);case"root":return Math.pow(e[0],1/e[1]);case"(":return e[0]}throw ln.undefinedFunction(this.fn)}substitute(t={}){return new En(this.fn,this.args.map((e=>e.substitute(t))))}collapse(){return"("===this.fn?this.args[0].collapse():new En(this.fn,this.args.map((t=>t.collapse())))}get simplified(){return this}get variables(){return m(x(this.args.map((t=>t.variables))))}get functions(){return m([this.fn,...x(this.args.map((t=>t.functions)))])}toString(){const t=this.args.map((t=>zn(t,this.fn)?"("+t.toString()+")":t.toString()));return"−"===this.fn?t.length>1?t.join(" − "):"−"+t[0]:"sup"===this.fn?t.join("^"):"sub"===this.fn?t.join("_"):"subsup"===this.fn?`${t[0]}_${t[1]}^${t[2]}`:y("+ * × · / = < > ≤ ≥ ≈").includes(this.fn)?t.join(" "+this.fn+" "):i(this.fn,"(","[","{")?this.fn+this.args.join(", ")+cn[this.fn]:"abs"===this.fn?`|${this.args.join(", ")}|`:i(this.fn,"!","%")?t[0]+this.fn:`${this.fn}(${t.join(", ")})`}toMathML(t={}){const e=this.args.map((e=>e.toMathML(t))),s=this.args.map(((t,s)=>{return i=t,o=this.fn,n=e[s],zn(i,o)?`<mfenced>${n}</mfenced>`:n;var i,o,n}));if(this.fn in t){const s=e.map(((t,e)=>({toString:()=>t,val:this.args[e]})));return t[this.fn](...s)}if("−"===this.fn)return s.length>1?s.join('<mo value="−">−</mo>'):'<mo rspace="0" value="−">−</mo>'+s[0];if(i(this.fn,"+","=","<",">","≤","≥","≈")){const t=bn(this.fn);return s.join(`<mo value="${t}">${t}</mo>`)}if(i(this.fn,"*","×","·")){let t=s[0];for(let e=1;e<s.length-1;++e){t+=(this.args[0]instanceof kn&&this.args[1]instanceof kn?'<mo value="×">×</mo>':"")+s[1]}return t}if("//"===this.fn)return s.join('<mo value="/">/</mo>');if("sqrt"===this.fn)return`<msqrt>${s[0]}</msqrt>`;if(i(this.fn,"/","root")){const t="/"===this.fn?"mfrac":"mroot";return`<${t}>${this.args.map(((t,s)=>Vn(t,e[s]))).join("")}</${t}>`}if(i(this.fn,"sup","sub")){const t=[Vn(this.args[0],s[0]),Vn(this.args[1],e[1])];return`<m${this.fn}>${t.join("")}</m${this.fn}>`}if("subsup"===this.fn){return`<msubsup>${[Vn(this.args[0],s[0]),Vn(this.args[1],e[1]),Vn(this.args[2],e[2])].join("")}</msubsup>`}if(i(this.fn,"(","[","{"))return`<mfenced open="${this.fn}" close="${cn[this.fn]}">${s.join(Sn)}</mfenced>`;if(i(this.fn,"!","%"))return s[0]+`<mo value="${this.fn}" lspace="0">${this.fn}</mo>`;if("abs"===this.fn)return`<mfenced open="|" close="|">${s.join(Sn)}</mfenced>`;if("bar"===this.fn)return`<mover>${Vn(this.args[0],s[0])}<mo value="‾">‾</mo></mover>`;if("vec"===this.fn)return`<mover>${Vn(this.args[0],s[0])}<mo value="→">→</mo></mover>`;return`<mi${yn(this.fn)?' mathvariant="normal"':""}>${this.fn}</mi><mfenced>${s.join(Sn)}</mfenced>`}toVoice(t={}){const e=this.args.map((e=>e.toVoice(t))),s=e.join(" ");if(this.fn in t){const s=e.map(((t,e)=>({toString:()=>t,val:this.args[e]})));return t[this.fn](...s)}return i(this.fn,"(","[","{")?s:"sqrt"===this.fn?`square root of ${s}`:"%"===this.fn?`${s} percent`:"!"===this.fn?`${s} factorial`:"/"===this.fn?`${e[0]} over ${e[1]}`:"//"===this.fn?`${e[0]} divided by ${e[1]}`:"sub"===this.fn?s:"subsup"===this.fn?`${e[0]} ${e[1]} ${Zn(e[2])}`:"sup"===this.fn?`${e[0]} ${Zn(e[1])}`:wn[this.fn]?e.join(` ${wn[this.fn]} `):yn(this.fn)?`${this.fn} ${s}`:`${this.fn} of ${s}`}}class Hn extends $n{constructor(t){super(),this.items=t}evaluate(t={}){return this.collapse().evaluate(t)}substitute(t={}){return this.collapse().substitute(t)}get simplified(){return this.collapse().simplified}get variables(){return m(v(...this.items.map((t=>t.variables))))}get functions(){return this.collapse().functions}toString(){return this.items.map((t=>t.toString())).join(" ")}toMathML(t={}){return this.items.map((e=>e.toMathML(t))).join("")}toVoice(t={}){return this.items.map((e=>e.toVoice(t))).join(" ")}collapse(){return function(t){if(!(t=t.filter((t=>!(t instanceof Cn)))).length)throw ln.invalidExpression();if(Dn(t[0],"%!"))throw ln.startOperator(t[0]);for(let e=0;e<t.length;++e)Dn(t[e],"%!")&&(t.splice(e-1,2,new En(t[e].o,[t[e-1]])),e-=1);Nn(t,"= < > ≤ ≥"),Nn(t,"// ÷"),Dn((t=Rn(t,"× * ·",!0))[0],"− ±")&&t.splice(0,2,new En(t[0].o,[t[1]]));Nn(t,"− ±"),Dn(t[0],"+")&&(t=t.slice(1));if((t=Rn(t,"+")).length>1)throw ln.invalidExpression();return t[0]}(this.items).collapse()}}var _n;function In(t,e){if(e===_n.STR)return new Mn(t);if(t&&e){if(e===_n.SPACE&&t.length>1)return new Cn;if(e===_n.NUM){if(isNaN(+t))throw ln.invalidExpression();return new kn(+t)}return e===_n.VAR?t in pn?new An(pn[t]):t in dn?new Tn(dn[t]):new An(t):e===_n.OP?new Tn(t in dn?dn[t]:t):void 0}}function On(t,e){const s=[[]];for(const i of t)e(i)?s.push([]):u(s).push(i);return s}function Dn(t,e){return t instanceof Tn&&y(e).includes(t.o)}function Bn(t){return t instanceof En&&"("===t.fn?t.args[0]:t}function Nn(t,e){if(Dn(t[0],e))throw ln.startOperator(t[0]);if(Dn(u(t),e))throw ln.endOperator(u(t));for(let s=1;s<t.length-1;++s){if(!Dn(t[s],e))continue;const i=t[s],o=t[s-1],n=t[s+1];if(o instanceof Tn)throw ln.consecutiveOperators(o.o,i.o);if(n instanceof Tn)throw ln.consecutiveOperators(i.o,n.o);const a=t[s+2];if("^ _"===e&&Dn(i,"_ ^")&&Dn(a,"_ ^")&&i.o!==a.o){const e=t[s+3];if(e instanceof Tn)throw ln.consecutiveOperators(a.o,e.o);const r=[Bn(o),Bn(n),Bn(e)];"^"===i.o&&([r[1],r[2]]=[r[2],r[1]]),t.splice(s-1,5,new En("subsup",r)),s-=4}else{const e=mn[i.o]||i.o,a=[Bn(o),Bn(n)];t.splice(s-1,3,new En(e,a)),s-=2}}}function qn(t){return Nn(t,"^ _"),Nn(t,"/"),(e=t).length>1||e[0]instanceof Tn?new Hn(e):e[0];var e}function Rn(t,e,s=!1){const i=[];let o=[],n=!1;function a(){if(n)throw ln.invalidExpression();o.length&&(i.push(o.length>1?new En(e[0],o):o[0]),o=[])}for(const r of t)if(Dn(r,e)){if(n||!o.length)throw ln.invalidExpression();n=!0}else if(r instanceof Tn)a(),i.push(r),n=!1;else{const t=!s||r instanceof kn;if(o.length&&!n&&t)throw ln.invalidExpression();o.push(r),n=!1}return a(),i}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPACE=1]="SPACE",t[t.STR=2]="STR",t[t.NUM=3]="NUM",t[t.VAR=4]="VAR",t[t.OP=5]="OP"}(_n||(_n={}));const jn={numEquals:function(t,e){try{const s=m([...t.variables,...e.variables]),i=t.collapse(),o=e.collapse();let n=0;for(let t=0;t<5;++t){const t={};for(const e of s)t[e]=hn[e]||5*Math.random();const e=i.evaluate(t),a=o.evaluate(t);if(!isNaN(e)&&!isNaN(a)){if(!L(e,a))return!1;n+=1}}return!!n}catch(t){return!1}},parse:h((function(t,e=!1,s){const i=function(t,e){const s=[[]],i=["π",...(null==e?void 0:e.variables)||[]];for(const e of t){const t=u(s).length?u(s)[0].o:void 0;if(Dn(e,") ] }")){if(!Dn(e,cn[t]))throw ln.conflictingBrackets(e.o);const o=s.pop(),n=u(s),a=u(n),r=Dn(e,")")&&a instanceof An&&!i.includes(a.i)?n.pop().i:o[0].o,l=On(o.slice(1),(t=>Dn(t,",")));n.push(new En(r,l.map(qn)))}else Dn(e,"( [ {")?s.push([e]):u(s).push(e)}if(s.length>1)throw ln.unclosedBracket(u(s)[0].o);return qn(s[0])}(function(t){const e=[];let s="",i=_n.UNKNOWN;for(const o of t){if('"'===o){const t=i===_n.STR?_n.UNKNOWN:_n.STR,o=In(s,i);o&&e.push(o),s="",i=t;continue}if(i===_n.STR){s+=o;continue}const t=o.match(/[0-9.]/)?_n.NUM:fn.includes(o)?_n.VAR:gn.includes(o)?_n.OP:o.match(/\s/)?_n.SPACE:_n.UNKNOWN;if(!t)throw ln.invalidCharacter(o);if(!i||i===_n.NUM&&t!==_n.NUM||i===_n.VAR&&t!==_n.VAR&&t!==_n.NUM||i===_n.OP&&!(s+o in dn)||i===_n.SPACE&&t!==_n.SPACE){const o=In(s,i);o&&e.push(o),s="",i=t}s+=o}const o=In(s,i);return o&&e.push(o),e}(t),s);return e?i.collapse():i}))};const Un=50;class Kn extends Ls{constructor(t,e,s){super(e,s),this.type="axes",this.canRotate=!1,this.canDragToSelect=!1,this.functions=[],this.$fill=Re("path",{fill:"transparent"},this.$el),this.$grid=Re("path",{class:"axis-gridlines"},this.$el),this.$axes=Re("path",{class:"grid-axis"},this.$el),this.$functions=Re("g",{},this.$el),this.$labels=Re("g",{class:"axis-labels"},this.$el),this.setColour(Ts.darkGrey),e.options.watch((t=>this.$grid.toggle("none"===t.grid)));const[i,o,n,a,r,l]=t.split(":").map((t=>+t)),h={xMin:i,xMax:n,xStep:o,yMin:a,yMax:l,yStep:r},c=this.model=e.bindSettingsPanel(this,'<h3>Coordinate System</h3><label class="row"><div class="label">X Step:</div><input class="input-field" type="number" :bind="xStep" min="0"></label><label class="row"><div class="label">Y Step:</div><input class="input-field" type="number" :bind="yStep" min="0"></label>',h);this.$handles=[this.makeHandle("c",(t=>c.xMin=U(Math.round(t.x/Un),-20,0))),this.makeHandle("c",(t=>c.xMax=U(Math.round(t.x/Un),0,20))),this.makeHandle("c",(t=>c.yMin=U(Math.round(-t.y/Un),-20,0))),this.makeHandle("c",(t=>c.yMax=U(Math.round(-t.y/Un),0,20)))];for(const t of[2,3])this.$handles[t].css("cursor","ns-resize");c.watch((()=>this.setSizes(c)))}setSizes({xMin:t,xMax:e,yMin:s,yMax:i,xStep:o,yStep:n}){const a=`${t}:${o}:${e}:${s}:${n}:${i}`;if(a===this.options)return;this.options=a;const r=Un;this.$handles[0].setCenter({x:t*r,y:0}),this.$handles[1].setCenter({x:e*r,y:0}),this.$handles[2].setCenter({x:0,y:-s*r}),this.$handles[3].setCenter({x:0,y:-i*r}),this.$labels.removeChildren();let l="",h=`M${t*r} 0L${e*r} 0M0 ${-s*r}L0 ${-i*r}`;h+=`M0 ${-i*r-3}l5 8h-10ZM${e*r+3} 0l-8 5v-10Z`;for(let n=t+1;n<e;++n)n&&(h+=`M${n*r} 0L${n*r} 5`,l+=`M${n*r} ${-s*r}L${n*r} ${-i*r}`,Re("text",{text:Z(n*o,4),x:n*r,y:21,"text-anchor":"middle"},this.$labels));for(let o=s+1;o<i;++o)o&&(h+=`M0 ${-o*r}L-5 ${-o*r}`,l+=`M${t*r} ${-o*r}L${e*r} ${-o*r}`,Re("text",{text:Z(o*n,4),x:-10,y:-o*r+5,"text-anchor":"end"},this.$labels));this.$axes.setAttr("d",h),this.$grid.setAttr("d",l),this.path=Do(-i*Un,e*Un,-s*Un,t*Un,15),this.$fill.draw(this.path);for(const t of this.functions)this.drawFunctions(t);this.transform(),this.$parent.selection.update(),this.$parent.change({tilesChanged:[this]})}addFunction(t){this.functions.push(jn.parse(t))}drawFunctions(t){const{xMin:e,xMax:s,yMin:i,yMax:o,xStep:n,yStep:a}=this.model,r=t.variables[0]||"x";let l="",h=!1;for(let c=e;c<s;c+=.05){const e=c*Un,s=t.evaluate({[r]:c*n})/a*Un,d=S(s,i*Un-.01,o*Un+.01);d&&(l+=(h?"L":"M")+`${e},${-s}`),h=d}Re("path",{d:l,class:"geo-path",style:"color:red"},this.$labels)}getSnapPoints(){const{xMin:t,xMax:e,yMin:s,yMax:i}=this.model,o=[];for(let n=t;n<=e;++n)for(let t=s;t<=i;++t)o.push(new rt(n*Un,-t*Un));return o}getSnapLines(){const{xMin:t,xMax:e,yMin:s,yMax:i}=this.model;return[new ut(new rt(t*Un,0),new rt(e*Un,0)),new ut(new rt(0,-s*Un),new rt(0,-i*Un))]}setColour(t){super.setColour(t);for(const e of[this.$axes,this.$labels])e.setAttr("fill",As(t));for(const e of[this.$axes,this.$grid])e.setAttr("stroke",As(t))}static makeThumbnail(t,e){const s=Re("svg",{width:180,height:180},e);Re("path",{d:"M30 10v160M60 10v160M120 10v160M150 10v160M10 30h160M10 60h160M10 120h160M10 150h160",class:"axis-gridlines",stroke:"white"},s);Re("path",{d:"M10 90h160M90 10v160M90 8l4 6h-8ZM172 90l-6 4v-8Z",class:"grid-axis",fill:"white"},s)}}const Fn=2*Math.PI;class Gn{constructor(){this.translation=new Wn(0,0,0),this.rotation=new Wn(0,0,0),this.scale=new Wn(1,1,1)}}class Wn{constructor(t,e,s){this.x=t,this.y=e,this.z=s}rotate(t){this.rotateProperty(t.z,"x","y"),this.rotateProperty(t.y,"x","z"),this.rotateProperty(t.x,"y","z")}rotateProperty(t,e,s){if(!t||L(t%Fn,0))return;const i=Math.cos(t),o=Math.sin(t),n=this[e],a=this[s];this[e]=n*i-a*o,this[s]=a*i+n*o}equals(t){return L(this.x,t.x)&&L(this.y,t.y)&&L(this.z,t.z)}add(t){return this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}transform(t){return this.multiply(t.scale),this.rotate(t.rotation),this.add(t.translation),this}lerp(t,e){return new Wn(K(this.x,t.x||0,e),K(this.y,t.y||0,e),K(this.z,t.z||0,e))}}const Qn=new P(0,0,0);class Xn{constructor(){this.transform=new Gn,this.visible=!0}}class Yn extends Xn{constructor(t,e={},s){super(),this.children=[],this.sorting=!1,this.$el=Re("g",e,s);for(const e of t)this.addChild(e)}addChild(t){t.parent&&t.parent.removeChild(t),this.children.push(t),this.$el&&t.$el&&this.$el.append(t.$el),t.parent=this}removeChild(t){const e=this.children.indexOf(t);e>=0&&this.children.splice(e,1),t.$el&&t.$el.remove(),t.parent=void 0}render(){if(this.visible){if(this.sorting)for(const t of g(this.children,(t=>t.zIndex)))this.$el.append(t.$el);for(const t of this.children)t.render()}}get zIndex(){return(t=this.children.map((t=>t.zIndex))).length?f(t)/t.length:0;var t}}class Jn extends Xn{constructor(t,e={}){super(),this.path=t,this.backface=!0,this.perspective=120,this.commands=Pe(t),this.$el=Re("path",e)}getTransformed(t,e=0,s=!1){const i=new Wn(t.x,t.y,e);let o=this;do{s?i.rotate(o.transform.rotation):i.transform(o.transform)}while(o=o.parent);return i}project(t){const e=Math.exp(t.z/this.perspective);return t.x*e+","+t.y*e}render(){if(!this.visible)return;if(!this.backface){const t=this.getTransformed(lt,1).z>this.zIndex;if(this.$el.toggle(t),!t)return}if(this.color){const t=this.getTransformed(lt,1,!0).z,e=P.mix(this.color,Qn,(t+1)/2);this.$el.setAttr("fill",e),this.$el.setAttr("stroke",e)}const t=this.commands.map((t=>t.type+t.points.map((t=>this.project(this.getTransformed(t)))).join(","))).join("");this.$el.setAttr("d",t)}get zIndex(){return this.getTransformed(lt).z}}class ta extends Jn{constructor(t,e={}){super(kt(t)?function(t){const e=t.r,s=t.c.x,i=t.c.y,o=.5523*e;return`M${s} ${i-e}C${s+o} ${i-e} ${s+e} ${i-o} ${s+e} ${i}C${s+e} ${i+o} ${s+o} ${i+e} ${s} ${i+e}C${s-o} ${i+e} ${s-e} ${i+o} ${s-e} ${i}C${s-e} ${i-o} ${s-o} ${i-e} ${s} ${i-e}`}(t):Bt(t),e)}}const ea=19,sa=[[],[[0,0]],[[-.9,-.9],[.9,.9]],[[-1,-1],[0,0],[1,1]],[[-.9,-.9],[.9,-.9],[.9,.9],[-.9,.9]],[[-1,-1],[1,-1],[1,1],[-1,1],[0,0]],[[-.9,-1.1],[-.9,0],[-.9,1.1],[.9,-1.1],[.9,0],[.9,1.1]],[[0,-1.2],[0,0],[0,1.2],[1,-.6],[1,.6],[-1,-.6],[-1,.6]],[[0,-1.1],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]],[[0,-1.1],[0,0],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]]],ia=new Zt(new rt(-19,-19),38,38),oa=[[0,0],[Math.PI/2,0],[Math.PI,0],[-Math.PI/2,0],[0,Math.PI/2],[0,-Math.PI/2]],na=["#656073",Ts.teal,Ts.blue,Ts.purple,Ts.red,Ts.orange,Ts.yellow,Ts.lime,Ts.green,Ts.teal];class aa extends Ls{constructor(t,e,s){super(e,s),this.type="dice",this.isAnimating=!1,this.options=t;const[i,o]=t.split(":");this.faces=o||"1,2,3,4,5,6";const n=this.faces.split(",").map((t=>{const e=new ta(ia,{class:"dice-face",fill:na[+t],stroke:na[+t]}),s=sa[+t].map((t=>new ta(new gt(new rt(t[0]*ea/2,t[1]*ea/2),4),{class:"dice-dot"})));for(const t of s)t.transform.translation.z=2;return new Yn([e,...s])}));n[0].transform.translation.z=ea,n[1].transform.translation.x=-19,n[1].transform.rotation.y=Math.PI/2,n[2].transform.translation.y=ea,n[2].transform.rotation.x=-Math.PI/2,n[3].transform.translation.y=-19,n[3].transform.rotation.x=Math.PI/2,n[4].transform.translation.x=ea,n[4].transform.rotation.y=-Math.PI/2,n[5].transform.translation.z=-19,n[5].transform.rotation.y=Math.PI,this.die=new Yn(n,{},this.$el),this.die.sorting=!0,this.setValue(+i||ot.integer(1,6)),this.path=new Zt(new rt(-25,-25),50,50),this.$outline=Re("path",{class:"outline",path:this.path},this.$el)}setColour(t){this.colour="#000"===t||"#000000"===t?"":t;for(const t of this.die.children)t.children[0].color=As(this.colour);this.die.render()}setValue(t){this.value!==t&&(this.value=t,this.options=`${t}:${this.faces}`,this.die.transform.rotation.x=oa[t-1][0],this.die.transform.rotation.y=oa[t-1][1],this.die.render())}roll(t=2e3){return e(this,void 0,void 0,(function*(){if(this.isAnimating)return;this.isAnimating=!0;const e=ot.integer(1,6),s=oa[this.value-1],i=4*Math.PI+oa[e-1][0]-s[0],o=4*Math.PI+oa[e-1][1]-s[1];yield os((t=>{const e=as("sine",t);this.die.transform.translation.z=4*e*(1-e)*ea,this.die.transform.rotation.x=s[0]+e*i,this.die.transform.rotation.y=s[1]+e*o,this.die.render()}),t).promise,this.setValue(e),this.isAnimating=!1}))}static makeThumbnail(t,e){if("net"===e.data.thumb){const s=Re("svg",{width:58,height:76},e),i=t.split(":")[1].split(",").map((t=>+t)),o=e.data.colour,n=[new rt(20,2),new rt(20,20),new rt(20,38),new rt(20,56),new rt(2,20),new rt(38,20)];for(const[t,e]of n.entries()){const n=o||na[+i[t]];Re("path",{path:new Zt(e,18,18),class:"polygon-tile",fill:n},s);for(const o of sa[i[t]])Re("circle",{cx:e.x+9+4.5*o[0],cy:e.y+9+4.5*o[1],r:1.8,class:"dice-dot"},s)}}else{const t=Re("svg",{width:60,height:60},e);Re("rect",{x:6,y:6,width:48,height:48,rx:4,class:"polygon-tile",fill:Ts.orange},t);for(const e of sa[5])Re("circle",{cx:30+12*e[0],cy:30+12*e[1],r:4,class:"dice-dot"},t)}}static action(t,s,i,o){return e(this,void 0,void 0,(function*(){if("roll"===t){const t=Array.from(s);o.selection.clear(),yield Promise.all(t.map((t=>t.roll()))),o.selection.select(t)}o.change({tilesChanged:Array.from(s)})}))}}const ra="M12.9,9.7C13.9,3,4,5.3,4,1.2H4C9.4-3.7,7.6-14,.1-14.3S-9.3-3.9-4,1.3c-.1,3.8-9.8,1.9-8.9,8.4h0C-5.5,13.2,5.2,13.2,12.9,9.7Z",la=[Ts.red,Ts.blue],ha=["M0 7.4L8.6 12L7 2.4L13.9 -4.4L4.3 -5.8L0 -14.5L-4.3 -5.8L-13.9 -4.4L-7 2.4L-8.6 12L0 7.4",ra];class ca extends Ls{constructor(t,e,s){super(e,s),this.type="coin",this.isAnimating=!1;const i=new gt(lt,23),o=la.map(((t,e)=>{const s=new ta(i,{class:"dice-face",fill:t,stroke:t}),o=new Jn(ha[e],{class:"dice-dot"});return o.transform.translation.z=1,new Yn([s,o])}));o[0].transform.translation.z=.5,o[1].transform.rotation.x=Math.PI,o[1].transform.translation.z=-.5,this.coin=new Yn(o,{},this.$el),this.coin.sorting=!0,this.setValue(t?+t:ot.integer(0,1)),this.path=new gt(lt,25),this.$outline=Re("path",{class:"outline",path:this.path},this.$el)}setValue(t){this.value!==t&&(this.value=t,this.options=""+t,this.coin.transform.rotation.x=t?Math.PI:0,this.coin.render())}setColour(t){this.colour=t}roll(t=2e3){return e(this,void 0,void 0,(function*(){if(this.isAnimating)return;this.isAnimating=!0;const e=ot.integer(0,1),s=this.value?Math.PI:0,i=6*Math.PI+(e?Math.PI:0)-s;yield os((t=>{const e=as("sine",t);this.coin.transform.translation.z=4*e*(1-e)*23,this.coin.transform.rotation.x=s+e*i,this.coin.transform.rotation.y=.4*Math.sin(8*e*Math.PI),this.coin.render()}),t).promise,this.setValue(e),this.isAnimating=!1}))}static makeThumbnail(t,e){const s=Re("svg",{width:60,height:60},e);Re("circle",{cx:30,cy:30,r:28,class:"polygon-tile",fill:Ts.blue},s);Re("path",{d:ra,class:"dice-dot"},s).setTransform({x:30,y:30},0,1.2)}}const da=2*Math.PI,pa=Math.PI/2,ua="M9.8-39.1,0-63-9.8-39.1-3-43V60a2.9,2.9,0,0,0,3,3,2.9,2.9,0,0,0,3-3V-43Z";function fa(t,e,s,i=75,o=lt){const n=s?P.shades(s,e.length):P.rainbow(e.length);t.removeChildren();for(const[s,a]of e.entries()){const r=e[s+1]?e[s+1]-a:da-a+e[0];Re("path",{path:new ct(o,rt.fromPolar(a-pa,i).add(o),r),class:"polygon-tile",fill:n[s]},t)}}class ga extends Ls{constructor(t,e,s){super(e,s),this.type="spinner",this.angle=0,this.isAnimating=!1,this.path=new gt(lt,75),this.$sectors=Re("g",{},this.$el),this.$arrow=Re("path",{d:ua,class:"spinner"},this.$el),this.$outline=Re("path",{class:"outline",path:this.path},this.$el),this.setupHandles(),Re("circle",{r:4,class:"spinner"},this.$el),e.events.listen(this.$arrow,{move:({posn:t})=>{const e=this.relativePosn(t).angle()+pa;this.$arrow.setTransform(void 0,e)},end:({lastPosn:t})=>{const e=this.relativePosn(t).angle()+pa;this.setValue(e*Ms)},click:()=>this.roll()}),this.$arrow.css("cursor","pointer");const[i,o]=t.split(":");this.drawSectors(+o),this.setValue(+i||0)}setupHandles(){this.$handle=this.makeHandle("c",(t=>{const e=(t.angle()+pa)%da;this.drawSectors(da/e)})),this.$handle.css("cursor","move")}drawSectors(t){const e=U(Math.round(t),2,16);if(e===this.sectors)return;this.sectors=e,this.options=`${this.angle}:${e}`;const s=da/e;fa(this.$sectors,p((t=>s*t),e),this.colour),this.$handle.setCenter(rt.fromPolar(s-pa,75))}setColour(t){this.colour=t;const e=this.$sectors.children,s=P.shades(t,e.length);for(const[t,i]of e.entries())i.setAttr("fill",s[t])}setValue(t){t=G(Math.round(t),360),this.angle!==t&&(this.angle=t,this.options=`${t}:${this.sectors}`,this.$arrow.setTransform(void 0,this.angle*Cs))}roll(t=2e3){return e(this,void 0,void 0,(function*(){if(this.isAnimating)return;this.isAnimating=!0;const e=this.angle,s=360*(4+Math.random());yield os((t=>{const i=K(e,s,as("sine",t));this.$arrow.setTransform(void 0,i*Cs)}),t).promise,this.setValue(s),this.isAnimating=!1}))}static makeThumbnail(t,e){const s=Re("svg",{width:80,height:80},e),i=new rt(40,40);fa(s,p((t=>da/5*t),5),"",36,i);Re("path",{d:ua,class:"spinner"},s).setTransform(i,-.8,.5)}}const ma=2*Math.PI,xa=Math.PI/2;class ba extends ga{constructor(t,e,s){super(`${t.split(":")[0]}:1`,e,s),this.type="custom-spinner",this.$handles=[];for(const e of t.split(":")[1].split(","))this.makeVertex(rt.fromPolar(+e*Cs-xa,75))}setupHandles(){let t;this.$parent.events.listen(this.$outline,{down:({posn:e})=>t=this.makeVertex(this.relativePosn(e)),move:({posn:e})=>this.moveVertex(this.relativePosn(e),t),end:()=>this.$parent.change({tilesChanged:[this]})}),this.$outline.css("cursor","crosshair")}drawSectors(){if(!this.$handles||this.$handles.length<2)return;const t=this.$handles.map((t=>(t.center.angle()+xa)%ma)).sort();this.sectors=t.map((t=>Math.round(t*Ms))).join(",");const e=`${this.angle}:${this.sectors}`;e!==this.options&&(this.options=e,fa(this.$sectors,t,this.colour))}makeVertex(t){if(this.$handles.length>=24)return;let e=this.makeHandle("c",(t=>{e&&(t.length>150?(this.deleteVertex(e),e=void 0):this.moveVertex(t,e))}),(()=>{e&&this.deleteVertex(e)}));return e.setAttr("r",8),e.css("cursor","move"),this.$handles.push(e),this.moveVertex(t,e),e}deleteVertex(t){this.$handles.length<=2||(t.remove(),this.$handles.splice(this.$handles.indexOf(t),1),this.drawSectors())}moveVertex(t,e){if(!e)return;const s=j(t.angle()*Ms,10)*Cs;e.setCenter(rt.fromPolar(s,75)),this.drawSectors()}static makeThumbnail(t,e){const s=Re("svg",{width:80,height:80},e),i=new rt(40,40),o=t.split(":")[1].split(",").map((t=>+t*Cs));fa(s,o,"",36,i);Re("path",{d:ua,class:"spinner"},s).setTransform(i,.4,.5);for(const t of o){const e=rt.fromPolar(t-xa,36).add(i);Re("circle",{cx:e.x,cy:e.y,r:3,fill:"white"},s)}}}const va=function(t){let e=0;return()=>t[e++%t.length]}(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]);class ya{constructor(t){this.index=t,this.color=va(),this.tilt=Math.floor(10*Math.random())-10,this.tiltAngleIncrement=.07*Math.random()+.05,this.tiltAngle=0,this.x=Math.random()*Je.width,this.y=(Math.random()-1)*Je.height,this.r=ot.uniform(10,30)}draw(t){t.beginPath(),t.lineWidth=this.r/2,t.strokeStyle=this.color,t.moveTo(this.x+this.tilt+this.r/4,this.y),t.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),t.stroke()}update(t,e){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(t)+3+this.r/2)/2,this.x+=Math.sin(t),this.tilt=15*Math.sin(this.tiltAngle-this.index/3),this.x<-20?(this.x=-20,this.y=Math.random()*Je.height,this.tilt=Math.floor(10*Math.random())-20):this.x>Je.width+20?(this.x=Je.width+20,this.y=Math.random()*Je.height,this.tilt=Math.floor(10*Math.random())-20):e&&this.y>Je.height&&(this.x=Math.random()*Je.width,this.y=-10,this.tilt=Math.floor(10*Math.random())-20)}}let wa;const $a="M7.7-5.7l-.2-.4-.3-.2c-.1-.1-.3,0-.4,0A36.6,36.6,0,0,0-3,2.1,36.1,36.1,0,0,0-7.8-.8h-.5l-1,.9a.4.4,0,0,0-.1.3c0,.2,0,.3.1.4a72.1,72.1,0,0,1,6.6,7h.4l.4-.2C1.9,1,3.8-1.8,7.5-5.2,7.7-5.3,7.7-5.5,7.7-5.7Z",ka={fill:"none",style:"touch-action: none",stroke:Ts.green};class Aa{constructor(t){this.$el=Re("g",{}),this.$ring=Re("circle",Object.assign({opacity:.6},ka),this.$el),this.$burst=Re("path",ka,this.$el),this.$mark=Re("g",{class:"problem-marker"},this.$el),this.$circle=Re("circle",{r:13},this.$mark),this.$cross=Re("path",{d:"M7,4,2.3-.3,6.6-5a1.2,1.2,0,0,0,0-1.5l-.4-.3a1,1,0,0,0-1.4,0L0-2.5-4.8-6.8a1,1,0,0,0-1.4,0l-.4.3A1.2,1.2,0,0,0-6.6-5L-2.3-.3-7,4a1.1,1.1,0,0,0-.1,1.4l1.5,1.4a.9.9,0,0,0,1.3,0L0,2.1,4.3,6.8a.9.9,0,0,0,1.3,0L7.1,5.4A1.1,1.1,0,0,0,7,4Z",fill:"white"},this.$mark),this.$check=Re("path",{d:$a,fill:"white"},this.$mark),this.isAnimating=!1,t.append(this.$el)}show(t=!1,e=!0){this.$cross.toggle(!t),this.$check.toggle(t),this.$circle.setAttr("fill",t?Ts.green:Ts.red),this.$mark.addClass("show"),e&&t&&this.burst()}hide(){this.$mark.removeClass("show")}burst(t=1e3,s=60,i=20){return e(this,void 0,void 0,(function*(){this.isAnimating||(this.isAnimating=!0,yield os((t=>{const e=as("sine-out",t);this.$ring.setAttr("r",.6*e*s),this.$ring.setAttr("stroke-width",.25*(1-e)*s);const o=as("exp-out",t),n=(.4+.6*o)*s,a=(.1+.9*o)*s;let r="";for(let t=0;t<i;++t){const e=Math.cos(2*Math.PI*t/i),s=Math.sin(2*Math.PI*t/i);r+=`M${e*a} ${s*a}L${e*n} ${s*n}`}this.$burst.setAttr("d",r)}),t).promise,this.isAnimating=!1)}))}}class Ma extends Ls{constructor(t,e,s){super(e,s),this.type="question-blank",this.size=100,this.canRotate=!1,this.keepOnTop=!0,this.solution="",this.submitted="",this.attempts=0,this.correct=!1,this.focussed=!1,this.colour=e.penColour,this.options=t||"Pw::0";const[i,o,n]=this.options.split(":");this.solution=atob(i),this.submitted=o,this.attempts=+n||0,this.$box=Re("rect",{class:"problem-box",rx:6},this.$el),this.$text=Re("text",{class:"problem-text",text:this.text,y:36},this.$el),this.mark=new Aa(this.$el),this.$input=Re("input",{class:"problem-text"},e.$html),this.$input.onKeyDown("enter",(()=>this.$input.blur())),this.$input.on("blur",(()=>this.blur())),this.$parent.canEditQuestions?(this.$handle=this.makeHandle("c",(t=>this.setSize(t.x))),this.$handle.css("cursor","ew-resize")):(this.$input.setInputPattern(this.solution),this.checkAnswer(!1),this.canMove=!1),this.setSize(100)}setSize(t){var e;super.setSize(j(U(t,50,400),25)),this.path=new Zt(lt,this.size,50),this.$input.css({width:this.size+"px",height:"50px"}),this.$box.setRect(this.path),this.$text.setAttr("x",this.size/2),this.mark.$el.setTransform({x:this.size,y:0}),null===(e=this.$handle)||void 0===e||e.setCenter({x:this.size,y:50}),this.transform()}delete(){super.delete(),this.$input.remove()}get text(){return(this.$parent.canEditQuestions?this.solution:this.submitted)||"?"}click(){this.focussed||this.$parent.events.shiftKey||this.correct&&!this.$parent.canEditQuestions||(this.focussed=!0,this.$parent.selection.add(this,!0),setTimeout((()=>{this.$el.removeClass("correct incorrect"),this.mark.hide()})),this.$input.css({top:this.posn.y+"px",left:this.posn.x+"px"}),this.$input.value=this.text,this.$text.hide(),this.$input.show(),this.$input.focus(),document.execCommand("selectAll",!1))}blur(){if(!this.focussed)return;this.focussed=!1,this.$input.hide(),this.$text.show();const t=this.text,e=this.$input.value.trim();this.$parent.canEditQuestions?(this.solution=e,this.options=`${btoa(e)}::0`):(e&&e!==this.submitted&&(this.attempts+=1),this.submitted="?"===e?"":e,this.options=`${btoa(this.solution)}:${e}:${this.attempts}`,setTimeout((()=>{this.checkAnswer(),Ma.gradeWorksheet(this.$parent)}))),this.$text.text=this.text,this.text!==t&&this.$parent.change({tilesChanged:[this]})}isCorrect(){if(!this.submitted||!this.solution)return!1;if(this.submitted.toLowerCase()===this.solution.toLowerCase())return!0;const t=I(this.solution),e=I(this.submitted);return L(e,t)||q(t)===this.submitted||this.solution===q(e)}checkAnswer(t=!0){this.correct=this.isCorrect(),this.submitted&&this.mark.show(this.correct,t),this.$el.setClass("correct",this.correct),this.$el.setClass("incorrect",!!this.submitted&&!this.correct)}static gradeWorksheet(t){const e=[0,0,0,0];for(const s of t.tiles)"question-blank"===s.type&&(e[0]+=1,s.submitted&&(e[s.correct?s.attempts<=1?1:2:3]+=1));e[0]===e[1]+e[2]&&function(t=2e3,e=150){wa||(wa=Re("canvas",{style:"position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999"},je)),wa.setAttr("width",Je.width),wa.setAttr("height",Je.height),wa.show();const s=wa.ctx,i=p((t=>new ya(t)),e),o=os((e=>{s.clearRect(0,0,Je.width,Je.height);const n=e<t;let a=0;for(const t of i)t.draw(s),t.update(e,n),t.y<Je.height&&(a+=1);a||(o.cancel(),wa.hide())}))}()}static makeThumbnail(t,e){const s=Re("svg",{width:130,height:70},e);Re("rect",{x:15,y:15,width:100,height:50,class:"problem-box",rx:6},s),Re("text",{x:65,y:50,text:"?",class:"problem-text"},s),Re("circle",{cx:115,cy:15,r:13,fill:Ts.blue},s),Re("path",{d:$a,fill:"white",transform:"translate(115 15)"},s)}}const Ca=h(jt);class Ta extends Ls{constructor(t,e,s){super(e,s),this.type="image",this.path=new Zt(lt,0,0),this.aspectRatio=1,this.options=t,this.$image=Re("image",{href:t,crossorigin:"anonymous"},this.$el),this.$outline=Re("path",{class:"outline"},this.$el),Ca(t).then((t=>{this.aspectRatio=t.height/t.width,this.setSize(this.size||t.width)})),this.$handle=this.makeHandle("c",(t=>this.setSize(t.x))),this.$handle.css("cursor","nwse-resize")}setHref(t){this.options=t,this.$image.setAttr("href",t),Ca(t)}setSize(t){const e=Math.max(50,50*this.aspectRatio),s=Math.min(1e3,1e3/this.aspectRatio);this.size=U(t,e,s),this.$image.setAttr("width",this.size),this.$image.setAttr("height",this.aspectRatio*this.size),this.path=new Zt(lt,this.size,this.aspectRatio*this.size),this.$outline.draw(this.path),this.$handle.setCenter({x:this.size,y:this.aspectRatio*this.size}),this.transform(),this.$parent.selection.update()}}class Pa extends Ls{constructor(t,e,s){super(e,s),this.type="text",this.size=0,this.keepOnTop=!0,this.focussed=!1,this.timeout=0,this.$box=Re("rect",{fill:"transparent"},this.$el),this.$text=Re("text",{class:"text-tile"},this.$el),this.$outline=Re("path",{class:"outline"},this.$el),this.setColour(e.penColour),this.updateText(t||"Text"),this.$parent.$textEdit.on("blur",(()=>this.blur()))}setSize(t){super.setSize(U(t,-5,10)),this.$text.css("font-size",this.fontSize),this.updateOutline(),this.transform()}get fontSize(){return 20*1.2**this.size}static action(t,s,i,o){return e(this,void 0,void 0,(function*(){if("larger"===t)for(const t of s)t.setSize(t.size+1);else if("smaller"===t)for(const t of s)t.setSize(t.size-1);o.selection.update(),o.change({tilesChanged:Array.from(s)})}))}getSnapPoints(){return[]}click(){const t=Date.now();t-this.timeout<500&&this.focus(),this.timeout=t}updateOutline(){const t=this.$text.children,e=t.map((t=>t._el.getComputedTextLength())),s=Math.ceil(Math.max(...e)),i=1.4*this.fontSize,o=i*t.length;for(const[e,s]of t.entries())s.setAttr("dy",i-(e?0:(this.fontSize-5)/3));this.path=new Zt(lt,s+16,o+4),this.$box.setRect(this.path),this.$outline.draw(this.path)}updateText(t){this.options=t,this.$text.removeChildren();for(const e of t.split("\n"))Re("tspan",{x:8,text:e},this.$text);this.updateOutline(),this.transform()}setColour(t){this.colour=t,this.$text.setAttr("fill",As(this.colour))}focus(){if(this.focussed)return;this.focussed=!0,this.$parent.selection.clear();const t=this.posn.subtract(this.$parent.origin).scale(this.$parent.zoom);this.$parent.$textEdit.setTransform(t,this.rot*Cs,this.$parent.zoom),this.$parent.$textEdit.text=this.options||"",this.$parent.$textEdit.css("color",this.colour),this.$parent.$textEdit.css("font-size",this.fontSize+"px"),this.$text.hide(),this.$parent.$textEdit.show(),this.$parent.$textEdit.focus(),document.execCommand("selectAll",!1)}blur(){if(!this.focussed)return;this.focussed=!1,this.$parent.$textEdit.hide();const t=this.$parent.$textEdit.text.trim(),e=this.options!==t;t?(this.$text.show(),this.updateText(t),this.$parent.selection.add(this)):this.delete(),e&&this.$parent.change({tilesChanged:[this]})}}class La extends Ls{constructor(t,e){super(e),this.type="equation",this.focussed=!1}}function Sa(t){switch(t){case"number-bar":return ro;case"number-tile":return io;case"polygon":return si;case"pentomino":return hi;case"tangram":return fi;case"fraction-bar":return So;case"fraction-circle":return zo;case"text":return Pa;case"algebra-tile":return Io;case"grid":return Bo;case"custom-polygon":return oi;case"image":return Ta;case"dice":return aa;case"coin":return ca;case"number-line":return lo;case"penrose":return wi;case"kolam":return ki;case"prime-disk":return go;case"balance":return sn;case"decimal-grid":return xo;case"spinner":return ga;case"custom-spinner":return ba;case"token":return rn;case"egg":return Pi;case"geo":return Ns;case"fractal":return Zi;case"ruler":return Oi;case"protractor":return Di;case"compass":return Bi;case"dot-machine":return bo;case"dot":return wo;case"garden":return Ki;case"tantrix":return Yi;case"axes":return Kn;case"question-blank":return Ma;case"equation":return La;case"number-card":return Mo}throw Error(`Unknown tile type: ${t}`)}const za=Math.PI/180;let Va,Za;const Ea=new Set,Ha=new Set;function _a(t,e,s){const i=G(t-e,s);return i>s/2?i-s:i}function Ia(t,e){for(const s of t)if(e(s))return!0;return!1}class Oa{constructor(t){this.$parent=t,this.angle=0,this.startAngle=0,this.hasChanged=!1,this.isMoving=!1,this.tiles=new Set,this.$tools=t.$(".transform-tools"),this.$rect=this.$tools.$(".group-outline"),this.$rotateBar=this.$tools.$(".rotate-bar"),this.$rotateCircle=this.$tools.$(".rotate-circle"),t.events.listen(this.$rotateCircle,{start:()=>{this.startAngle=this.angle,this.rotateStart()},move:({startPosn:t,posn:e})=>{this.rotate(this.startAngle-new ft(e,this.center,t).deg)},end:()=>this.rotateEnd()}),Je.onKey("up down left right r R",((t,e)=>{if(!this.tiles.size)return;if("r"===e||"R"===e){if(Array.from(this.tiles).some((t=>!t.canRotate)))return;return this.rotateStart(),this.rotate(this.angle+("R"===e?-15:15)),void this.rotateEnd()}const s=lt,i=this.$parent.events.shiftKey?5:25,o="left"===e?-i:"right"===e?i:0,n="up"===e?-i:"down"===e?i:0,a=s.shift(o,n);this.moveStart(),this.move({posn:a,startPosn:s}),this.moveEnd()})),Je.onKey("escape",(()=>this.clear()))}get size(){return this.tiles.size}add(t,e=!1,s=!1){e&&this.clear(),t.isActive||this.select([t],s)}select(t,e=!1){for(const e of t)e.isActive||(this.tiles.add(e),e.select(),this.hasChanged=!0);e||this.update(!0)}remove(t,e=!1){t.isActive&&(t.deselect(),this.hasChanged=!0,this.tiles.delete(t),e||this.update(!0))}copy(t=!1,e=25){if(!this.$parent.options.canCopy||!this.tiles.size)return;const s={},i=Array.from(this.tiles).map((t=>t.copy(s,e)));this.clear();for(const t of i)this.add(t);if(!t){this.$parent.change({tilesAdded:i});for(const t of i)this.$parent.trigger("copy-tile",{tile:t})}}delete(){if(!this.$parent.options.canDelete||!this.tiles.size)return;const t=Array.from(this.tiles);for(const t of this.tiles)t.delete();Ns.computeIntersections(this.$parent),this.$parent.change({tilesDeleted:t}),this.$parent.newTileShift=0}clear(){for(const t of this.tiles)t.deselect();this.tiles.size&&(this.hasChanged=!0),this.tiles.clear(),this.update(!0)}getTileProperty(t){if(!this.size)return;const e=Array.from(this.tiles),s=t(e[0]);return e.slice(1).some((e=>t(e)!==s))?void 0:s}update(t=!1){if(t&&!this.hasChanged)return;if(this.hasChanged=!1,!this.size)return this.$tools.hide(),void this.$parent.trigger("change-selection",{tiles:[],color:void 0});const e=Array.from(this.tiles);this.angle=this.getTileProperty((t=>t.rot))||0;const s=ys(...e.map((t=>t.transformed.rotate(-this.angle*za)))),i=s.p.shift(s.w/2,s.h/2).rotate(this.angle*za).shift(-s.w/2,-s.h/2);this.rect=new Zt(i,s.w,s.h),this.center=this.rect.center;let o=!!this.$parent.options.canRotate&&e.every((t=>t.canRotate));if(1===e.length&&kt(e[0].transformed)&&(o=!1),o&&this.getTileProperty((t=>t.rotateAroundOrigin))){const t=e[0].posn;e.slice(1).every((e=>e.posn.equals(t)))&&(this.center=t,this.angle&&1===e.length&&(this.rect=ys(e[0].transformed.rotate(-this.angle*za,t))))}this.$rotateBar.toggle(o),this.$rotateCircle.toggle(o);const n=this.getTileProperty((t=>t.hideSelectionOutline));n||this.positionTools(),this.$rect.toggle(this.size>1||e[0].showSelectionOutline),this.$tools.toggle(!n);const a=this.getTileProperty((t=>t.colour));this.$parent.trigger("change-selection",{tiles:e,color:a})}positionTools(){this.$rect.draw(this.rect.rotate(this.angle*za,this.center));const t=new rt(this.center.x,this.rect.p.y),e=new ut(t,t.shift(0,-28)).rotate(this.angle*za,this.center);this.$rotateBar.setLine(e.p1,e.p2),this.$rotateCircle.setCenter(e.p2)}moveStart(){for(const t of this.tiles)if(!t.canMove)return;this.isMoving=!0;for(const t of this.tiles)t.moveStart();this.startSnapPoints=[];for(const t of this.tiles)for(const e of t.snapPoints)this.startSnapPoints.some((t=>e.equals(t)))||this.startSnapPoints.push(e);Za=this.rect,Va=this.center,this.$parent.newTileShift=0,this.$parent.trigger("move-start")}move({posn:t,startPosn:e}){if(!this.isMoving)return;let s=t.subtract(e);const i=this.startSnapPoints.map((t=>t.add(s))),o=this.$parent.snap(i);o&&(s=s.add(o.shift));const n=1===this.tiles.size?null==o?void 0:o.target:void 0;for(const t of this.tiles)t.move(s,n);this.rect=Za.translate(s),this.center=Va.add(s),this.positionTools(),this.$parent.trigger("move-selection")}moveEnd(){if(this.isMoving){for(const t of this.tiles)t.transform(),t.moveEnd();Ns.computeIntersections(this.$parent),this.$parent.trigger("move-end"),this.$parent.change({tilesChanged:Array.from(this.tiles)}),this.isMoving=!1}}rotateStart(){Ha.clear();for(const t of this.tiles)for(const e of t.snapAngles)Ha.add(G(e+t.rot,180));Ea.clear(),Ea.add(0);for(const t of this.$parent.tiles)if(!t.isActive&&Ia(this.tiles,(e=>rt.distance(e.posn,t.posn)<140)))for(const e of t.snapAngles)Ea.add(G(e+t.rot,180));this.$parent.newTileShift=0}rotate(t){if((t=j(t,3))===this.angle)return;let e=1/0;for(const s of Ha)for(const i of Ea){const o=_a(i,s+t-this.startAngle,180);Math.abs(o)<Math.abs(e)&&(e=o)}if(Math.abs(e)<8&&(t+=e),t===this.angle)return;const s=t-this.angle;this.angle=t;for(const t of this.tiles)t.posn=t.posn.rotate(s*Math.PI/180,this.center),t.rot=G(t.rot+s,360),t.transform(!0);this.positionTools(),this.$parent.trigger("rotate-selection")}rotateEnd(){for(const t of this.tiles)t.transform();this.$parent.change({tilesChanged:Array.from(this.tiles)})}action(t,e){if("copy"===e)return this.copy();if("delete"===e)return this.delete();Sa(t.split(" ")[0]).action(e,this.tiles,this.center,this.$parent),this.$parent.change({tilesChanged:Array.from(this.tiles)})}}class Da{constructor(t){this.$parent=t}getTileAt(t,e=!0){var s,i;const o=this.$parent.snap([t.posn],e,!0,"geo");if("geo"===(null===(i=null===(s=null==o?void 0:o.target)||void 0===s?void 0:s.tile)||void 0===i?void 0:i.type))return o.target.tile;let n=t.event.target;for(;n;){const t=Ps.get(n);if(t&&!t.locked&&"geo"!==t.type)return t;if(n=n.parentNode||void 0,n===this.$parent._el)return}}hoverGeoTile(t){var e;this.hoveringTile!==t&&(null===(e=this.hoveringTile)||void 0===e||e.hover(!1)),null==t||t.hover(),this.hoveringTile=t}down(t){}start(t){}move(t){}end(t){}click(t){}hover(t){}cancel(){}}class Ba extends Da{down(t){const e=this.activeTile=this.getTileAt(t,!1);this.previousSelection=void 0,e?(e.isActive&&this.$parent.events.shiftKey?this.$parent.selection.remove(e):!this.$parent.events.shiftKey&&e.isActive||this.$parent.selection.add(e,!this.$parent.events.shiftKey),Ue.addClass("grabbing")):this.$parent.events.shiftKey?this.previousSelection=new Set(this.$parent.selection.tiles):this.$parent.selection.clear()}start(){this.activeTile?(this.$parent.events.altKey&&this.$parent.selection.copy(!0,0),this.$parent.selection.moveStart()):this.$parent.$selection.show()}move(t){var e;if(this.activeTile)return void this.$parent.selection.move(t);const s=Zt.aroundPoints([t.startPosn,t.posn]);this.$parent.$selection.setRect(s);for(const t of this.$parent.tiles){if(t.locked||!t.canDragToSelect||!t.transformed)continue;const i=$s(s,t.transformed,t.type);(this.$parent.events.shiftKey&&(null===(e=this.previousSelection)||void 0===e?void 0:e.has(t))?!i:i)?this.$parent.selection.add(t,!1,!0):this.$parent.selection.remove(t,!0)}this.$parent.selection.update(!0)}end(){this.activeTile?this.$parent.selection.moveEnd():this.$parent.$selection.hide(),Ue.removeClass("grabbing")}click(t){this.activeTile?this.activeTile.click(t):this.$parent.selection.clear()}hover(t){const e=this.getTileAt(t,!1);this.hoverGeoTile("geo"===(null==e?void 0:e.type)?e:void 0),this.$parent.$svg.css("cursor",(null==e?void 0:e.locked)?"pointer":e?"grab":"")}}class Na extends Da{constructor(){super(...arguments),this.erasedTiles=[],this.erasedStrokes=[]}down({posn:t}){this.erase(t)}move({posn:t,lastPosn:e}){const s=rt.distance(t,e)/4;for(let i=0;i<s;++i)this.erase(rt.interpolate(t,e,i/s))}shouldErase(t,e,s){return Ct(e)?rt.distance(e,t)<10:yt(e)?e.distanceSquared(t)<100:bt(e)?e.edges.some((e=>e.distanceSquared(t)<100)):kt(e)&&"geo"===s?Math.abs(rt.distance(t,e.c)-e.r)<10:e.contains(t)}erase(t){for(const e of this.$parent.tiles)if(e.transformed&&e.canDragToSelect&&this.shouldErase(t,e.transformed,e.type))return e.delete(),void this.erasedTiles.push(e);for(const e of this.$parent.strokes)if(e.hitTest(t,10))return e.delete(),void this.erasedStrokes.push(e)}end(){(this.erasedTiles.length||this.erasedStrokes.length)&&this.$parent.change({tilesDeleted:this.erasedTiles,strokesDeleted:this.erasedStrokes}),this.erasedTiles=[],this.erasedStrokes=[]}}class qa extends Da{down({posn:t}){const e=this.$parent.newTile("text","");e.setTransform(t.shift(-10,-15)),this.$parent.trigger("add-tile",{tile:e}),e.focus()}}class Ra extends Da{constructor(){super(...arguments),this.brush="pen"}getUtensil(t){for(const e of this.$parent.tiles.values()){if(!e.transformed||!Ii(e))continue;const s=e.transformed.project(t);if(rt.distance(t,s)<30)return e.transformed}}getPoint(t){if("straight"===this.brush){const e=this.$parent.snap([t]);return e?t.add(e.shift):this.startPoint?t.snap(this.startPoint,5):t}return this.utensil?this.utensil.project(t):t}down({posn:t}){this.utensil=this.getUtensil(t),this.startPoint=this.getPoint(t),this.stroke=new zs(this.$parent,[this.startPoint],this.$parent.penColour,this.brush)}move({posn:t}){const e=this.getPoint(t);"straight"===this.brush?this.stroke.setLine(new ut(this.startPoint,e)):this.stroke.addPoint(this.getPoint(e))}end(){var t;"straight"===this.brush?null===(t=this.stroke)||void 0===t||t.makeSnapPoints():this.stroke.simplify(),this.$parent.change({strokesAdded:[this.stroke]}),this.$parent.trigger("add-stroke",{stroke:this.stroke}),this.stroke=this.startPoint=this.utensil=void 0}}class ja extends Da{constructor(){super(...arguments),this.type="line"}expr(t,e){switch(this.type){case"line":return`segment(${t},${e})`;case"circle":return`circle(${t},distance(${t},${e}))`;case"rect":return`rectangle(${t},${e}.x-${t}.x,${e}.y-${t}.y)`}}snapPoint(t){var e,s,i,o;const n=this.$parent.snap([t]);n&&(t=t.add(n.shift));let a="";const r="geo"===(null===(s=null===(e=null==n?void 0:n.target)||void 0===e?void 0:e.tile)||void 0===s?void 0:s.type)?null===(i=null==n?void 0:n.target)||void 0===i?void 0:i.tile:void 0;return(null==r?void 0:r.path)&&Ct(r.path)&&(a=r.key),(null===(o=null==n?void 0:n.target)||void 0===o?void 0:o.intersection)&&(a=n.target.intersection.expr),{point:t,tile:r,expr:a||`point(${t.x},${t.y})`}}getOrMakePointTile(t){var e,s;if((null===(e=null==t?void 0:t.tile)||void 0===e?void 0:e.path)&&Ct(t.tile.path))return t.tile;if(null===(s=null==t?void 0:t.tile)||void 0===s?void 0:s.path){const e=Hs(t.tile.path,t.point),s=new Ns(`${t.tile.key}.at(${e})`,this.$parent);return this.$parent.trigger("add-tile",{tile:s}),s}const i=new Ns(t.expr,this.$parent);return this.$parent.trigger("add-tile",{tile:i}),i}drawPendingPoint(t){var e,s;const i="point"===(null===(s=null===(e=t.tile)||void 0===e?void 0:e.path)||void 0===s?void 0:s.type),o=t.expr.startsWith("intersection");this.$parent.$pendingPoint.toggle(!i),i||(this.$parent.$pendingPoint.setCenter(t.point),this.$parent.$pendingPoint.setClass("locked",o),this.$parent.$pendingPoint.setAttr("r",o?3.5:6))}down({posn:t}){const e=this.snapPoint(t);this.startPoint=this.getOrMakePointTile(e),this.createdNewStart=!e.tile}start(){var t;this.path=new Ns("",this.$parent),this.startPoint.pending=this.path.pending=!0,null===(t=this.$parent.$pendingPoint)||void 0===t||t.show(),this.hoverGeoTile(void 0)}move({posn:t}){var e;this.endSnap=this.snapPoint(t),this.path.setExpr(this.expr(this.startPoint.key,this.endSnap.expr),!0),this.drawPendingPoint(this.endSnap),this.hoverGeoTile(null===(e=this.endSnap)||void 0===e?void 0:e.tile)}end(){var t;const e=rt.distance(this.startPoint.path,this.endSnap.point)<8;let s;if(e?this.path.delete():(s=this.getOrMakePointTile(this.endSnap),this.path.setExpr(this.expr(this.startPoint.key,s.key)),this.path.setPending(!1),this.$parent.trigger("add-tile",{tile:this.path})),this.startPoint.setPending(!1),null===(t=this.$parent.$pendingPoint)||void 0===t||t.hide(),this.hoverGeoTile(void 0),Ns.computeIntersections(this.$parent),this.createdNewStart||!e){const t=[];this.createdNewStart&&t.push(this.startPoint),this.path&&t.push(this.path),s&&t.push(s),this.$parent.change({tilesAdded:t})}this.startPoint=this.path=this.endSnap=void 0}click(){this.createdNewStart&&this.$parent.change({tilesAdded:[this.startPoint]})}hover(t){var e;const s=this.snapPoint(t.posn);this.drawPendingPoint(s),this.hoverGeoTile("geo"===(null===(e=null==s?void 0:s.tile)||void 0===e?void 0:e.type)?s.tile:void 0)}cancel(){this.$parent.$pendingPoint.hide(),this.path&&this.path.delete(),this.startPoint=this.path=this.endSnap=void 0}}class Ua extends ja{constructor(){super(...arguments),this.startId="",this.expression=""}enable(t){var e;this.expression=t,this.$parent.selection.clear(),this.$parent.setActiveTool("geoPending"),(null===(e=window.event)||void 0===e?void 0:e.clientX)&&this.hover({posn:ue(window.event,this.$parent.$svg)})}makePath(){return this.path=new Ns("",this.$parent),this.path.$el.css("opacity",.5),this.path.pending=!0,this.path}down(t){if(!this.expression)return;super.down(t);const e=this.path||this.makePath();e.$el.css("opacity",1),e.setExpr(this.expression.replace(/\$1/g,this.startPoint.key)),e.pending=!1,this.path=void 0,this.$parent.setActiveTool("move"),this.$parent.selection.add(e,!0),this.$parent.change({tilesAdded:[e]}),Ns.computeIntersections(this.$parent),this.$parent.trigger("add-tile",{tile:e})}hover({posn:t}){var e;if(!this.expression)return;const s=this.snapPoint(t);this.drawPendingPoint(s),this.hoverGeoTile("geo"===(null===(e=null==s?void 0:s.tile)||void 0===e?void 0:e.type)?s.tile:void 0),this.path||this.makePath(),this.path.setExpr(this.expression.replace(/\$1/g,s.expr))}cancel(){super.cancel(),this.expression=""}}class Ka extends Ra{constructor(){super(...arguments),this.brush="straight"}enable(t){this.tiles=t;for(const t of this.tiles)t.$outline.addClass("active");this.$parent.selection.clear(),this.$parent.setActiveTool("cutPolygon")}down(){}start({posn:t}){this.tiles&&(this.utensil=this.getUtensil(t),this.startPoint=this.getPoint(t),this.$stroke=Re("line",{class:"stroke cut"},this.$parent.$strokes))}move({posn:t}){var e;this.lastPoint=this.getPoint(t),null===(e=this.$stroke)||void 0===e||e.setLine(this.startPoint,this.lastPoint)}end(){var t;const e=new dt(this.startPoint,this.lastPoint);let s=!1;const i=[],o=[];for(const t of this.tiles||[]){const n=t.transformed.cut(e);if(n.length>1){for(const e of n){const s=new si(js(e.points),this.$parent);s.setColour(t.colour),s.transform(),o.push(s)}t.delete(),i.push(t),s=!0}else t.$outline.removeClass("active")}s&&this.$parent.change({tilesAdded:o,tilesDeleted:i}),null===(t=this.$stroke)||void 0===t||t.remove(),this.$stroke=this.tiles=this.startPoint=this.lastPoint=void 0,this.$parent.setActiveTool("move")}click(){this.cancel()}cancel(){var t;for(const t of this.tiles||[])t.$outline.removeClass("active");null===(t=this.$stroke)||void 0===t||t.remove(),this.$stroke=this.tiles=this.startPoint=this.lastPoint=void 0,setTimeout((()=>this.$parent.setActiveTool("move")))}}const Fa=new Et(-2e3,4e3,-2e3,4e3),Ga=25,Wa=Ga*Math.sqrt(3)/2,Qa=t=>`${t.xMin} ${t.yMin} ${t.dx} ${t.dy}`;let Xa=class extends ms{constructor(){super(...arguments),this.tiles=new Set,this.strokes=new Set,this.tileMap=new Map,this.strokeMap=new Map,this.penColour="#242436",this.initial={},this.intersections=new Set,this.margins=[20,20,20,20],this.origin=lt,this.zoom=1,this.newTileShift=0,this.options=Ae({grid:"none",canEdit:!0,changeCount:0}),this.canEditQuestions=!1,this.canPinchPan=!1,this.setup=!1,this.undoStack=[],this.redoStack=[]}ready(){var t;this.$svg=this.$("svg.canvas"),this.$tiles=this.$svg.$(".tiles:not(.active)"),this.$activeTiles=this.$svg.$(".tiles.active"),this.$selection=this.$svg.$(".selection"),this.$strokes=this.$svg.$(".strokes"),this.$grid=this.$svg.$(".grid"),this.$html=this.$(".html-overlay"),this.$panels=this.$(".panels"),this.$geoShadows=this.$svg.$(".geo-shadows"),this.$geoPaths=this.$svg.$(".geo-paths"),this.$geoPoints=this.$svg.$(".geo-points"),this.$pendingPoint=Re("circle",{class:"geo-point pending",hidden:!0},this.$geoPoints),this.$textEdit=this.$(".text-edit"),this.$textEdit.onKeyDown("escape",(t=>{t.stopPropagation(),this.$textEdit.blur()})),this.tools={move:new Ba(this),pen:new Ra(this),geo:new ja(this),geoPending:new Ua(this),eraser:new Na(this),text:new qa(this),cutPolygon:new Ka(this)},this.activeTool=this.tools.move,this.setAttr("data-tool","move"),this.events=new Vs(this.$svg,{down:t=>this.activeTool.down(t),start:t=>this.activeTool.start(t),move:t=>this.activeTool.move(t),end:t=>this.activeTool.end(t),click:t=>this.activeTool.click(t),hover:t=>this.activeTool.hover(t),cursor:!1}),this.canEditQuestions="teacher"===this.attr("user-type")&&(null===(t=this.initial.canEdit)||void 0===t||t),this.canEditQuestions&&(this.$svg.copy=function(t=!0,e=!0,s){const i=Se.prototype.copy.call(this,t,e,s);for(const t of i.$$(".problem-text"))t.text="?";return i}),this.selection=new Oa(this),this.options.canRotate=Zs(this,"rotate",!0),this.options.canDelete=Zs(this,"delete",!0),this.options.canCopy=Zs(this,"copy",!0),this.options.grid=this.attr("grid")||"none",this.setViewport(lt,1),this.options.watch((t=>{this.$grid.setAttr("fill","none"!==t.grid?`url(#${t.grid})`:"none"),this.$grid.setRect(this.canvasBounds.rect)})),Zs(this,"pan",!1)&&this.enablePinchPan(),Je.onKey("backspace",(()=>this.selection.delete())),this.$svg.on("focusin",(()=>{const t=Array.from(this.tiles);this.focusTile(this.events.shiftKey?u(t):t[0])})),this.$svg.on("focusout",(()=>this.focussed=void 0)),je.on("keydown",(t=>{if(9!==t.keyCode||!this.focussed)return;const e=Array.from(this.tiles);this.focusTile(e[e.indexOf(this.focussed)+(t.shiftKey?-1:1)]),this.focussed&&t.preventDefault()})),Je.onThemeChange((()=>{for(const t of this.tiles)t.setColour(t.colour);for(const t of this.strokes)t.setColor(t.color)}))}focusTile(t){this.focussed=t,this.$svg.setAttr("aria-description",t?t.ariaDescription:"Empty Canvas"),t&&this.selection.add(t,!0)}*snapPoints(t,e){for(const s of this.tiles)if(!(t&&s.isActive||s.pending||e&&s.type!==e))for(const t of s.snapPoints)yield[t,{tile:s}];for(const t of this.strokes)if(t.snapPoints)for(const e of t.snapPoints)yield[e,{stroke:t}];for(const t of this.intersections)yield[t.value,{intersection:t}]}*gridPoints(t){if("none"===this.options.grid)return;const e=this.options.grid.split("-")[0],s=Zt.aroundPoints(t);let i=new Et(s.p.x-Ga,s.p.x+s.w+50,s.p.y-Ga,s.p.y+s.h+50);if(e.startsWith("square")){const t=("square2"===e?2:1)*Ga,s=j(i.xMin,t);for(let e=j(i.yMin,t);e<i.yMax;e+=t)for(let o=s;o<i.xMax;o+=t)yield[new rt(o,e),{}]}else if(e.startsWith("tri")){const t="tri2"===e;t&&(i=i.flip);const s=j(i.xMin,Ga);for(let e=Math.floor(i.yMin/Wa);e*Wa<i.yMax;++e)for(let o=s+(e%2?12.5:0);o<i.xMax;o+=Ga){const s=new rt(o,e*Wa);yield[t?s.flip:s,{}]}}}*snapLines(t,e){for(const s of this.tiles)if(!(t&&s.isActive||s.pending||e&&s.type!==e))for(const t of s.snapLines)yield[t,{tile:s}];for(const t of this.strokes)if(t.snapLines)for(const e of t.snapLines)yield[e,{stroke:t}]}snap(t,e=!0,s=!1,i){return bs(8,t,this.snapPoints(e,i))||!s&&bs(18,t,this.gridPoints(t))||bs(6,t,this.snapLines(e,i),((t,e)=>t.project(e)))}enablePinchPan(){this.canPinchPan=!0,this.on("wheel",(t=>{if(t.preventDefault(),t.ctrlKey){const e=this.zoom*(1-t.deltaY/100);this.setViewport(this.origin,e,ue(t,this.$svg))}else{const e=this.origin.shift(t.deltaX/this.zoom,t.deltaY/this.zoom);this.setViewport(e,this.zoom)}}));let t=0,e=this.origin;this.on("gesturestart",(s=>{s.preventDefault(),e=new rt(s.pageX,s.pageY).subtract(this.origin),t=this.zoom,this.events.cancel()})),this.on("gesturechange",(s=>{s.preventDefault();const i=t*s.scale,o=new rt(s.pageX,s.pageY).subtract(e);this.setViewport(o,i,ue(s,this.$svg))})),this.on("gestureend",(t=>t.preventDefault()))}enableImageDrop(t,s){const i=Re("div",{class:"image-drop"},this);this.on("dragenter dragover dragleave drop",(t=>t.preventDefault())),this.on("dragenter dragover",(()=>i.show())),this.on("dragleave drop",(()=>i.hide()));const o=(s,i)=>e(this,void 0,void 0,(function*(){const e=Array.from((null==s?void 0:s.files)||[]).slice(0,10).map(((e,s)=>this.newImage(e,i.shift(25*s),t))),o=yield Promise.all(e);this.change({tilesAdded:o})}));this.on("drop",(t=>o(t.dataTransfer,ue(t,this.$svg)))),null==s||s.on("change",(()=>e(this,void 0,void 0,(function*(){yield o(s._el,this.canvasBounds.center),s.value=""}))))}bindSettingsPanel(t,e,s){const i=Re("div",{class:"polypad-settings",html:e},this.$panels);this.on("change-selection",(({tiles:e})=>{i.toggle(1===e.length&&e[0]===t)}));const o=Ae(s);return i.bindModel(o),o}enableHotkeys(){Je.onKey("z",(t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.shiftKey?this.redo():this.undo())})),Je.onKey("y",(t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.redo())})),Je.onKey("c",(t=>{Je.getActiveInput()||t.ctrlKey||t.metaKey||this.selection.copy()})),je.on("cut copy",(t=>{var e;if(Je.getActiveInput()||!this.selection.tiles.size)return;const s=Array.from(this.selection.tiles).map((t=>t.toJSON()));null===(e=window.navigator.clipboard)||void 0===e||e.writeText(JSON.stringify(s)),"cut"===t.type&&this.selection.delete()})),je.on("paste",(()=>e(this,void 0,void 0,(function*(){var t;if(Je.getActiveInput())return;const e=yield null===(t=window.navigator.clipboard)||void 0===t?void 0:t.readText();if(e)try{const t=JSON.parse(e);if(!t.length)return;const s=t.map((t=>Ls.unSerialize(t,this))).filter((t=>t));this.selection.clear();const i=ys(...s.map((t=>t.transformed))).center,o=this.canvasBounds.center.subtract(i).shift(25*this.newTileShift);for(const t of s)t.setTransform(t.posn.add(o)),this.selection.add(t);this.change({tilesAdded:s}),this.newTileShift+=1}catch(t){const s=this.newTile("text",e);s.setTransform(this.canvasBounds.center.subtract(s.center)),this.selection.add(s,!0),this.change({tilesAdded:[s]})}}))))}newImage(t,s,i){return e(this,void 0,void 0,(function*(){const e=new FileReader;e.readAsDataURL(t),yield new Promise((t=>e.onloadend=t));const o=this.newTile("image",(e.result||"").toString());return o.setTransform(s),this.selection.add(o,!0),yield null==i?void 0:i(t,o),o}))}newTile(t,e,s){return new(Sa(t))(e,this,s)}setViewport(t,e=1,s){if(e=U(e,1/3,3),s){const i=this.zoom/e;t=s.subtract(s.subtract(this.origin).scale(i))}const i=this.width/e,o=this.height/e;this.zoom=e,this.origin=t.clamp(Fa.resize(-i,-o)),this.canvasBounds=new Et(this.origin.x,this.origin.x+i,this.origin.y,this.origin.y+o),this.$svg.setAttr("viewBox",this.attr("viewBox")||Qa(this.canvasBounds)),this.$html.setTransform(this.origin.inverse.scale(this.zoom),0,this.zoom);const n=this.canvasBounds.rect;"none"!==this.options.grid&&this.$grid.setRect(n),Ns.redrawLines(n),this.trigger("viewport")}resetViewport(){if(!this.tiles.size&&!this.strokes.size)return this.setViewport(lt,1);const t=ws(this.tiles,this.strokes,0),[e,s,i,o]=this.margins,n=(this.width-o-s)/t.dx,a=(this.height-e-i)/t.dy,r=U(Math.min(n,a),1/3,1),l=new rt(this.width+o-s,this.height+e-i),h=t.center.subtract(l.scale(.5/r));this.setViewport(h,r)}bindSource(t,e,s,i,o){let n;Sa(e).makeThumbnail(s,t,this,o);const a=null==i?void 0:i.$(".tiles.active");this.events.listen(t,{down:()=>this.trigger("add-tile-start"),start:({posn:r})=>{n=this.newTile(e,t.data.options||s),o&&n.setColour(o),n.setTransform(r),this.selection.add(n,!0),this.selection.moveStart(),i&&this.canPinchPan&&i.setAttr("viewBox",Qa(this.canvasBounds)),(a||this.$tiles).append(n.$el),this.trigger("add-tile",{tile:n})},move:t=>this.selection.move(t),end:()=>{this.$activeTiles.append(n.$el),this.selection.moveEnd()},click:()=>{const i=this.newTile(e,t.data.options||s);i.setTransform(this.canvasBounds.center.subtract(i.center).shift(25*this.newTileShift)),o&&i.setColour(o),this.selection.add(i,!0),i.moveEnd(),this.trigger("add-tile",{tile:i}),this.change({tilesAdded:[i]}),this.newTileShift+=1}})}setColour(t="#242436"){this.penColour=t,this.$pendingPoint.css("color",As(t));for(const e of this.selection.tiles)e.setColour(t||"");this.selection.tiles.size&&this.change({tilesChanged:Array.from(this.selection.tiles)})}setActiveTool(t){this.activeTool.cancel(),this.activeTool=this.tools[t],this.setAttr("data-tool",t),this.selection.clear()}clear(t=!0){this.selection.clear();for(const t of this.tiles)t.delete();for(const t of this.strokes)t.delete();t&&this.setViewport(lt,1),this.change()}thumbnail(t,e){const s=ws(this.tiles,this.strokes,50);return this.$svg.pngImage(t,e,Qa(s))}downloadImage(t){var e;this.selection.clear();const s=t||(null===(e=this.options.title)||void 0===e?void 0:e.replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase())||"polypad",i=ws(this.tiles,this.strokes,50);this.$svg.downloadImage(`${s}.png`,i.dx,i.dy,Qa(i))}change(t){this.setup||(this.trigger("change",t||{}),this.undoStack.push(this.serialize()),this.undoStack.length>20&&this.undoStack.shift(),this.redoStack=[],this.options.canUndo=!0,this.options.canRedo=!1,this.options.changeCount+=1)}undo(){this.undoStack.length&&(this.redoStack.push(this.undoStack.pop()),this.unSerialize(u(this.undoStack)||this.initial),this.trigger("change"),this.options.canUndo=!!this.undoStack.length,this.options.canRedo=!0,this.options.changeCount-=1,this.trigger("undo"))}redo(){this.redoStack.length&&(this.undoStack.push(this.redoStack.pop()),this.unSerialize(u(this.undoStack)||this.initial),this.trigger("change"),this.options.canUndo=!0,this.options.canRedo=!!this.redoStack.length,this.options.changeCount+=1,this.trigger("redo"))}serialize(){var t;return{title:null===(t=this.options.title)||void 0===t?void 0:t.slice(0,30),grid:this.options.grid||"none",background:this.options.background,noLabels:this.options.noLabels,tiles:Array.from(this.tiles).slice(0,2e3).map((t=>t.toJSON())),strokes:Array.from(this.strokes).slice(0,1e3).map((t=>t.serialize()))}}unSerialize(t){if(t){this.setup=!0,this.clear(!1),Ns.clearModel();for(const e of t.tiles||[])Ls.unSerialize(e,this);for(const e of t.strokes||[])zs.unSerialize(e,this);Ns.computeIntersections(this);for(const t of this.tiles)t.move();this.setup=!1}}load(t){var e,s;this.initial=t,this.unSerialize(t),this.undoStack=this.redoStack=[],this.options.key=t.key,this.options.grid=t.grid||"none",this.options.thumbnail=t.thumbnail,this.options.title=t.title||"Untitled",this.options.canEdit=null===(e=t.canEdit)||void 0===e||e,this.options.noLabels=null!==(s=t.noLabels)&&void 0!==s?s:this.options.noLabels||!1,this.options.canUndo=!1,this.options.changeCount=0,this.resetViewport()}};Xa=t([xs("x-polypad",{template:'<svg class="canvas" tabindex="0"><defs><pattern class="grid-pattern" id="square2-grid" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect x="0" y="0" width="50" height="50" opacity="0.1"></rect></pattern><pattern class="grid-pattern" id="square-dots" x="-4" y="-4" width="25" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="4" r="2" opacity="0.15"></circle></pattern><pattern class="grid-pattern" id="square-grid" x="0" y="0" width="125" height="125" patternUnits="userSpaceOnUse"><g opacity="0.1"><line x1="25" y1="0" x2="25" y2="125"></line><line x1="0" y1="25" x2="125" y2="25"></line><line x1="50" y1="0" x2="50" y2="125"></line><line x1="0" y1="50" x2="125" y2="50"></line><line x1="75" y1="0" x2="75" y2="125"></line><line x1="0" y1="75" x2="125" y2="75"></line><line x1="100" y1="0" x2="100" y2="125"></line><line x1="0" y1="100" x2="125" y2="100"></line></g><rect x="0" y="0" width="125" height="125" opacity="0.25"></rect></pattern><pattern class="grid-pattern" id="tri-dots" x="0" y="-4" width="25" height="43.30127018922193" patternUnits="userSpaceOnUse"><circle cx="0" cy="4" r="2" opacity="0.15"></circle><circle cx="25" cy="4" r="2" opacity="0.15"></circle><circle cx="12.5" cy="25.650635094610966" r="2" opacity="0.15"></circle></pattern><pattern class="grid-pattern" id="tri-grid" x="0" y="0" width="25" height="43.30127018922193" patternUnits="userSpaceOnUse"><g opacity="0.1"><line x1="0" y1="0" x2="25" y2="0"></line><line x1="0" y1="21.650635094610966" x2="25" y2="21.650635094610966"></line><line x1="0" y1="43.30127018922193" x2="25" y2="43.30127018922193"></line><line x1="0" y1="0" x2="25" y2="43.30127018922193"></line><line x1="25" y1="0" x2="0" y2="43.30127018922193"></line></g></pattern><pattern class="grid-pattern" id="tri2-dots" x="-4" y="0" width="43.30127018922193" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="0" r="2" opacity="0.15"></circle><circle cx="4" cy="25" r="2" opacity="0.15"></circle><circle cx="25.650635094610966" cy="12.5" r="2" opacity="0.15"></circle></pattern><pattern class="grid-pattern" id="tri2-grid" x="0" y="0" width="43.30127018922193" height="25" patternUnits="userSpaceOnUse"><g opacity="0.1"><line x1="0" y1="0" x2="0" y2="25"></line><line x1="21.650635094610966" y1="0" x2="21.650635094610966" y2="25"></line><line x1="43.30127018922193" y1="0" x2="43.30127018922193" y2="25"></line><line x1="0" y1="0" x2="43.30127018922193" y2="25"></line><line x1="0" y1="25" x2="43.30127018922193" y2="0"></line></g></pattern><pattern class="grid-pattern" id="square-checked" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect class="filled" x="0" y="0" width="25" height="25" opacity="0.1"></rect><rect class="filled" x="25" y="25" width="25" height="25" opacity="0.1"></rect></pattern><marker id="axis-arrow" refX="3" refY="3" markerWidth="6" markerHeight="6" orient="auto"><path d="M 0 0 L 6 3 L 0 6 z"></path></marker><filter id="handdrawn" x="-20%" y="-20%" width="140%" height="140%"><feTurbulence type="fractalNoise" basefrequency="0.004 0.004" numoctaves="26" stitchtiles="stitch" result="turbulence"></feTurbulence><feDisplacementMap in="SourceGraphic" in2="turbulence" scale="20" xchannelselector="R" ychannelselector="G" result="displacementMap"></feDisplacementMap></filter><filter id="pencil" x="-10%" y="-10%" width="110%" height="110%" filterUnits="objectBoundingBox"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="3" result="noise"></feTurbulence><feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="2" in="SourceGraphic" result="newSource"></feDisplacementMap></filter></defs><rect class="grid"></rect><g class="tiles"></g><g class="transform-tools" hidden><path class="group-outline"></path><line class="rotate-bar"></line><circle class="rotate-circle" r="10"></circle></g><g class="tiles active"></g><g class="strokes"></g><g class="geo-shadows"></g><g class="geo-paths"></g><g class="geo-points"></g><rect class="selection"></rect></svg><div class="html-overlay"></div><div class="text-edit" hidden contenteditable></div><div class="panels"></div><slot></slot>'})],Xa);const Ya=Re("div",{class:"modal-background"},je);let Ja,tr,er;function sr(){tr&&tr.canClose&&tr.close()}Ya.on("click",sr),Je.onKey("escape",sr),ps.on("change",sr),Ya.on("scrollwheel touchmove",(t=>{t.preventDefault(),t.stopPropagation()})),Je.onKey("space up down pagedown pageup",(t=>{tr&&(t.preventDefault(),t.stopPropagation())}));let ir=class extends ms{constructor(){super(...arguments),this.isOpen=!1,this.canClose=!0}ready(){this.canClose=!this.hasAttr("no-close"),this.$iframe=this.$("iframe[data-src]"),this.$video=this.$("video");const t=qe(`[data-modal=${this.id}]`);for(const e of t)e.on("click",(()=>this.open()));ps.on("afterChange",(({$viewport:t})=>{const e=t.$$(`[data-modal=${this.id}]`);for(const t of e)t.on("click",(()=>this.open()))})),this.hasClass("open")&&!tr&&this.open(!0),this.$("input")&&this.addClass("interactive");const e=this.$(".close");e&&e.on("click",(()=>this.close()));for(const t of this.$$(".btn"))t.on("click",(()=>this.trigger("btn-click",t)))}open(t=!1){if(this.isOpen)return;Ya.setClass("light",this.hasClass("light")),tr?tr.close(!0):t?Ya.show():"block"===Ya.css("display")?null==Ja||Ja.cancel():Ya.enter("fade",250),this.isOpen=!0,tr=this,this.$iframe&&this.$iframe.setAttr("src",this.$iframe.data.src),this.$video&&this.$video.play(),t?this.show():this.enter("pop",250).promise.then((()=>this.css("transform",""))),this.setAttr("role","dialog"),this.trigger("open"),er=document.activeElement;const e=this.$('input, a, button, textarea, [tabindex="0"]');e&&e.focus()}close(t=!1,e=!1){this.isOpen&&(this.isOpen=!1,this.removeAttr("role"),tr=void 0,this.$iframe&&this.$iframe.setAttr("src",""),this.$video&&this.$video.pause(),t||(Ja=Ya.exit("fade",250)),this.exit("pop",250).promise.then((()=>this.css("transform",""))),e||this.trigger("close"),er&&er.focus())}static confirm(t){var s;return e(this,void 0,void 0,(function*(){const e=Ne(t);if(!e)return"";e.open();const i=yield new Promise((t=>e.one("close btn-click",t)));return e.close(),(null===(s=null==i?void 0:i.data)||void 0===s?void 0:s.prompt)||""}))}};ir=t([xs("x-modal")],ir);let or=class extends ms{ready(){const t=this.children.filter((t=>["H2","H3","H4"].includes(t.tagName))),e=t.map((t=>t.data.key)),s=this.attr("storage"),i=s?e.indexOf(Je.getStorage(s)):-1;let o=t[i>=0?i:0];for(const[i,n]of t.entries()){const t=n.next;t.toggle(n===o),t.css("overflow","hidden"),n===o&&n.addClass("active"),n.setAttr("tabindex","0"),n.on("click",(()=>{n===o?(n.removeClass("active"),t.exit("reveal",300),o=void 0,s&&Je.setStorage(s,"")):(null==o||o.removeClass("active"),null==o||o.next.exit("reveal",300),t.enter("reveal",300),n.addClass("active"),o=n,s&&Je.setStorage(s,e[i]||i)),n.blur()}))}}};or=t([xs("x-accordion")],or);const nr=new Map;function ar(t,s=!1){return e(this,void 0,void 0,(function*(){if(s&&nr.has(t))return nr.get(t);const e=yield fetch(t);if(!e.ok)return Promise.reject(e.statusText);const i=yield e.json();return nr.set(t,i),i}))}let rr=class extends ms{constructor(){super(...arguments),this.savedCount=0,this.classes={}}ready(){ps.setup({preloaded:!0,click:!0,history:!0,noLoad:!0}),ps.paths("/polypad","/polypad/:key"),this.$buttons=this.$$(".sidebar-header button"),this.$panels=this.$$(".sidebar-panel"),this.savedCount=this.$$("#saved .canvas").length;for(const[t,e]of this.$buttons.entries())e.on("click",(()=>this.toggleTab(t)));this.on("clickOutside",(()=>{Je.width<680&&this.close()}));const t=this.$$(".sidebar-panel").length-1;let e=U(+Je.getStorage("polypad.sidebar")||0,-1,t);Je.width<680&&(e=-1),this.active=e>=0?e:void 0,e>=0&&(this.setPanelClasses(e),this.$panels[e].show()),this.show()}bindPolypad(t,s){const i=this.model=t.options;for(const t of this.$$(".primes, .current"))t.bindModel(i);i.save=()=>this.saveChanges(t),i.saveCopy=()=>this.saveChanges(t,!0),i.deleteMe=()=>this.delete(t);for(const e of this.$$(".source")){const i=e.data.type,o=e.data.options;t.bindSource(e,i,o,s,e.data.colour)}t.on("add-tile",(()=>{Je.width<680&&this.close()})),this.on("toggle",(e=>t.margins[3]=e.open?324:32)),window.onbeforeunload=()=>{if(window.user&&0!==i.changeCount)return"Your changes may not be saved."},ps.beforeChange=()=>e(this,void 0,void 0,(function*(){return!window.user||0===i.changeCount||"yes"===(yield ir.confirm("#unsaved"))})),ps.on("change",(e=>this.load(e.slice(9),t))),this.setupClassroom(t,i)}setPanelClasses(t){for(const[e,s]of this.$panels.entries())s.setClass("left",e<t),s.setClass("right",e>t);this.addClass("open"),this.$buttons[t].addClass("active")}toggleTab(t){if(this.active===t)return this.close();clearTimeout(this.timeout),void 0===this.active?(this.setPanelClasses(t),this.$panels[t].show(),this.trigger("toggle",{open:!0})):(this.$panels[t].show(),Je.redraw(),this.setPanelClasses(t),this.$buttons[this.active].removeClass("active")),this.active=t,Je.setStorage("polypad.sidebar",t),this.timeout=setTimeout((()=>{for(const[e,s]of this.$panels.entries())s.toggle(e===t)}),400)}close(){void 0!==this.active&&(clearTimeout(this.timeout),this.trigger("toggle",{open:!1}),this.$buttons[this.active].removeClass("active"),this.removeClass("open"),this.active=void 0,Je.setStorage("polypad.sidebar",-1),this.timeout=setTimeout((()=>{for(const t of this.$panels)t.hide()}),400))}focus(){var t;null===(t=this.$("button, input, [tabindex]"))||void 0===t||t.focus()}get isOpen(){return void 0!==this.active}load(t,s){return e(this,void 0,void 0,(function*(){if(t){ps.showLoadingBar();try{s.load(yield ar(`/polypad/data/${t}`))}catch(t){Uo("load-error"),s.load({}),Je.setURL("/polypad")}ps.hideLoadingBar()}else s.load({})}))}saveChanges(t,s=!1){var i;return e(this,void 0,void 0,(function*(){if(!t.tiles.size&&!t.strokes.size)return Uo("no-content");if(this.savedCount>=100)return Uo("max-save");if(this.model.loading)return;this.model.loading=!0,t.selection.clear();const e=yield t.thumbnail(432,288),o=(yield(yield fetch(e)).arrayBuffer()).slice(0,1e6),n=new FormData;n.append("thumbnail",new Blob([o],{type:"image/png"})),n.append("polypad",JSON.stringify(t.serialize()));const a=this.model.key,r=s||!this.model.key||!this.model.canEdit;let l=r?void 0:this.model.key;r&&this.model.key&&n.append("parent",this.model.key);try{const t="/polypad"+(l?"/"+l:""),e=JSON.parse(yield Rt(t,n));if(this.model.key=e.key,this.model.thumbnail=e.thumbnail,!l){l=this.model.key,this.model.canEdit=!0,ps.replace(`/polypad/${l}`),this.savedCount+=1;const t=Re("a",{href:`/polypad/${l}`,class:"canvas",html:'<div class="thumb"></div><div class="title"></div>',key:l});null===(i=this.$("#saved"))||void 0===i||i.prepend(t),t.enter("pop")}Uo("save-success")}catch(t){Uo("save-error")}const h=this.$(`#assigned a.canvas[key="${a}"]`);null==h||h.setAttr("key",this.model.key),null==h||h.setAttr("href",`/polypad/${this.model.key}`);for(const t of this.$links)t.$(".thumb").css("background-image",`url(${this.model.thumbnail})`),t.$(".title").text=this.model.title||"";this.model.changeCount=0,this.model.loading=!1}))}delete(t){return e(this,void 0,void 0,(function*(){if(!this.model.loading&&this.model.key&&this.model.canEdit&&"yes"===(yield ir.confirm("#delete"))){this.model.loading=!0;try{yield Rt(`/polypad/${this.model.key}/delete`)}catch(t){return Uo("delete-error")}for(const t of this.$links)t.exit("pop",500,0,!0);t.load({}),ps.replace("/polypad"),this.model.loading=!1,Uo("delete-success")}}))}get $links(){return this.$$(`a.canvas[key="${this.model.key}"]`)}setupClassroom(t,e){var s;const i=this.$(".classroom");if(!i)return;i.bindModel(e);for(const t of this.$$("x-popup"))null===(s=t.$("x-select"))||void 0===s||s.on("change",(()=>t.close()));const o=i.$("x-select");for(const[t,e]of Object.entries(o.$options)){const s={};for(const t of e.attr("assigned").split(","))s[t]=!0;this.classes[t]={title:e.text,polypads:s}}const n=Je.getStorage("polypad.classCode");n&&this.classes[n]&&(e.classCode=n),e.setAssigned=t=>this.setAssigned(t),e.refreshStudents=()=>this.loadStudentData(),e.hideNames=!!Je.getStorage("polypad.hideNames"),e.toggleNames=()=>{e.hideNames=!e.hideNames,Je.setStorage("polypad.hideNames",e.hideNames?"1":void 0)},e.watch((()=>{var t;const e=this.model.classCode;Je.setStorage("polypad.classCode",e),this.model.className=e?null===(t=this.classes[e])||void 0===t?void 0:t.title:""})),e.watch((()=>{var s;const i=t.initial,o=(null==i?void 0:i.parent)||(e.key&&e.canEdit?{key:e.key,thumbnail:e.thumbnail}:void 0);this.model.assignment=o,this.model.assigned=!(!e.classCode||!o)&&(null===(s=this.classes[e.classCode])||void 0===s?void 0:s.polypads[o.key])})),e.watch((()=>this.loadStudentData(!0)))}loadStudentData(t=!1){var s;return e(this,void 0,void 0,(function*(){const e=null===(s=this.model.assignment)||void 0===s?void 0:s.key,i=this.model.classCode;if(i&&e){this.model.loadingStudents=!0;try{this.model.students=yield ar(`/polypad/${e}/class/${i}?format=json`,t)}catch(t){Uo("student-list-error")}this.model.loadingStudents=!1}}))}setAssigned(t){var s;return e(this,void 0,void 0,(function*(){const e=this.model.classCode,i=null===(s=this.model.assignment)||void 0===s?void 0:s.key;if(t!==this.model.assigned&&i&&e){this.model.assigned=this.classes[e].polypads[i]=t;try{yield Rt("/polypad/assign",{class:e,key:i,assigned:t}),Uo(t?"assign-success":"unassign-success")}catch(s){Uo("assign-error"),this.model.classCode===e&&this.model.key===i&&(this.model.assigned=!t)}}}))}};rr=t([xs("x-polypad-sidebar")],rr);const lr=["#fd8c00","#eb4726","#cd0e66","#6d3bbf","#0f82f2","#009ea6","#22ab24","#bfc212"],hr=[];for(const t of lr)hr.push(P.mix(t,"#fff",.5));hr.push(P.fromHex("#eee"));for(const t of lr)hr.push(P.fromHex(t));hr.push(P.fromHex("#777"));for(const t of lr)hr.push(P.mix(t,"#000",.7));function cr(t,e,s,i,o,n){return`linear-gradient(90deg, rgb(${t},${e},${s}), rgb(${i},${o},${n}))`}function dr(t,e){return"r"===e?t.r:"g"===e?t.g:t.b}hr.push(P.fromHex("#111"));let pr=class extends ms{constructor(){super(...arguments),this.sliders=[],this.swatches=[]}ready(){this.$("x-select").on("change",(t=>{"palette"===t.data.value?this.removeClass("custom"):this.addClass("custom")}));const t=this.$(".palette");this.swatches=hr.map((e=>{const s=Re("button",{style:`background: ${e.hex}`},t);return s.on("click",(()=>{this.setColor(e),this.trigger("click-swatch")})),{$el:s,color:e}})),this.sliders=this.$$(".slider").map(((t,e)=>{const s=["r","g","b"][e],i=t.$(".handle"),o=new hs(i,t,{moveY:!1,width:210});return o.on("start",(()=>i.addClass("active"))),o.on("end",(()=>i.removeClass("active"))),o.on("drag",(t=>{const e=this.color.copy();!function(t,e,s){"r"===e&&(t.r=s),"g"===e&&(t.g=s),"b"===e&&(t.b=s)}(e,s,255*t.x/190),this.setColor(e,!0)})),{$el:t,c:s,drag:o}})),this.setColor(new P(0,0,0))}setColor(t,e=!1,s=!1){if("string"==typeof t&&(t=P.fromHex(t)),!this.color||this.color.hex!==t.hex){if(this.color=t,this.$activeSwatch&&(this.$activeSwatch.removeClass("active"),this.$activeSwatch=void 0),!e){for(const e of this.swatches)if(e.color.hex===t.hex){e.$el.addClass("active"),this.$activeSwatch=e.$el;break}for(const e of this.sliders)e.drag.setPosition(dr(t,e.c)/255*190,0)}this.sliders[0].$el.css("background",cr(0,t.g,t.b,255,t.g,t.b)),this.sliders[1].$el.css("background",cr(t.r,0,t.b,t.r,255,t.b)),this.sliders[2].$el.css("background",cr(t.r,t.g,0,t.r,t.g,255)),s||this.trigger("change",t)}}};pr=t([xs("x-color-picker",{template:'<x-select><button class="switch" data-value="palette" title="Colour Swatches"><svg class="icon" viewBox="0 0 24 24" width="32" height="32"><path d="M4,8H8V4H4Zm6,12h4V16H10ZM4,20H8V16H4Zm0-6H8V10H4Zm6,0h4V10H10ZM16,4V8h4V4ZM10,8h4V4H10Zm6,6h4V10H16Zm0,6h4V16H16Z"/>></svg></button><button class="switch" data-value="sliders" title="RGB Sliders"><svg class="icon" viewBox="0 0 24 24" width="32" height="32"><path d="M3,18a1.1,1.1,0,0,0,1,1H9V17H4A1.1,1.1,0,0,0,3,18ZM3,6A1,1,0,0,0,4,7h9V5H4A1,1,0,0,0,3,6ZM13,20V19h7a1,1,0,0,0,0-2H13V16a1,1,0,0,0-2,0v4a1,1,0,0,0,2,0ZM7,10v1H4a1,1,0,0,0,0,2H7v1a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V10A.9.9,0,0,0,8,9,.9.9,0,0,0,7,10Zm14,2a1,1,0,0,0-1-1H11v2h9A1,1,0,0,0,21,12ZM16,9a1,1,0,0,0,1-1V7h3a1,1,0,0,0,0-2H17V4a1,1,0,0,0-2,0V8A.9.9,0,0,0,16,9Z"/>></svg></button></x-select><div class="color-content"><div class="palette"></div><div class="sliders"><div class="slider-row"><label>Red</label><div class="slider"><div class="handle"></div></div></div><div class="slider-row"><label>Green</label><div class="slider"><div class="handle"></div></div></div><div class="slider-row"><label>Blue</label><div class="slider"><div class="handle"></div></div></div></div></div>'})],pr);const ur=["pen","text","geo"];let fr=class extends ms{ready(){this.bindModel(Ae({tool:"move",penType:"normal",brush:"pen",geoType:"line"})),this.$imageUpload=this.$("#image-upload")}bindPolypad(t){this.model.watch((e=>t.tools.geo.type=e.geoType)),this.model.watch((e=>t.tools.pen.brush=e.brush)),this.model.action=(e,s)=>{var i;t.selection.action(e,s),null===(i=window.ga)||void 0===i||i.call(window,"send","event","Polypad",`action:${s}`)},this.model.construct=e=>{var s,i;Ns.construct(e,null===(s=this.model.geo)||void 0===s?void 0:s.expr,t),null===(i=window.ga)||void 0===i||i.call(window,"send","event","Polypad",`construct:${e}`)},this.model.cutPolygon=()=>{var e;const s=Array.from(t.selection.tiles);t.tools.cutPolygon.enable(s),null===(e=window.ga)||void 0===e||e.call(window,"send","event","Polypad","action:cut-polygon")},this.model.tileType=t=>{const e=t.split(" ");for(const t of this.model.tiles||[])if(!e.includes(t.type))return!1;return!0},this.model.canSplitNumberTiles=()=>{var t;return null===(t=this.model.tiles)||void 0===t?void 0:t.every((t=>t.count>1))},this.model.canMergeFractionBars=()=>{var t,e,s;const i=null===(e=null===(t=this.model.tiles)||void 0===t?void 0:t[0])||void 0===e?void 0:e.denominator;return null===(s=this.model.tiles)||void 0===s?void 0:s.every((t=>t.denominator===i))};const e=this.$("x-popup.color-picker"),s=this.$("x-color-picker"),i=this.$(".color-picker .popup-target"),o=(t,e)=>{null==i||i.setClass("rainbow",!t),null==i||i.css("background-color",t||""),this.model.color=t||"",e||null==s||s.setColor(t||"#aaa",!1,!0)};null==s||s.on("change",(e=>{o(e.hex,!0),t.setColour(As(e.hex))})),null==s||s.on("click-swatch",(()=>null==e?void 0:e.close())),t.on("change-selection",(({tiles:t,color:e})=>{this.model.tiles=t,this.model.geo=Ns.getInferredShape(t),o(t.length?As(e):void 0,!1)})),t.on("add-tile-start",(()=>this.model.tool="move")),t.on("add-tile",(({tile:t})=>{"text"===t.type&&(this.model.tool="move")})),this.model.watch((e=>{t.setActiveTool(e.tool),ur.includes(e.tool)&&o(As(t.penColour))})),Je.onThemeChange((()=>o(As(t.penColour)))),this.show()}focus(){var t;null===(t=this.$("button, input, [tabindex]"))||void 0===t||t.focus()}};fr=t([xs("x-polypad-toolbar")],fr);let gr=class extends ms{bindPolypad(t){const e=this.parents(".polypad")[0],s=t.options;this.bindModel(s),s.fullscreen=!1,s.expand=()=>{s.fullscreen=!s.fullscreen,s.fullscreen?null==e||e._el.requestFullscreen():document.exitFullscreen()},document.addEventListener("fullscreenchange",(()=>{s.fullscreen=!!document.fullscreenElement})),s.undo=()=>t.undo(),s.redo=()=>t.redo(),s.resetZoom=()=>t.resetViewport(),s.download=()=>t.downloadImage(),s.zoom=e=>{const s=t.canvasBounds.center;t.setViewport(t.origin,t.zoom*e,s)},this.watch(s,"altColors"),this.watch(s,"noLabels",(t=>null==e?void 0:e.setClass("no-labels",t))),this.watch(s,"handdrawn",(e=>t.setClass("handdrawn",e))),this.model.showHanddrawn=Je.isChrome&&!Je.isMobile;const i=Ne("#share x-share"),o=Ne("#share .warn");t.options.watch((t=>{null==o||o.toggle(0!==t.changeCount),null==i||i.setAttr("title","Polypad – "+(t.title||"Virtual Manipulatives")),null==i||i.setAttr("url","https://mathigon.org/polypad"+(t.key?"/"+t.key:"")),null==i||i.setAttr("img",t.thumbnail||"https://mathigon.org/images/og-tile/polypad.jpg")}))}watch(t,e,s){var i;const o="polypad."+e;t[e]=null!==(i=t[e])&&void 0!==i?i:Je.getStorage(o)||!1,t.watch((t=>{Je.setStorage(o,t[e]),null==s||s(!!t[e])}))}focus(){var t;null===(t=this.$("button, input, [tabindex]"))||void 0===t||t.focus()}};gr=t([xs("x-polypad-settings")],gr);const mr=[["sidebar",["polygons","tangram","polyominoes","utensils","penrose","kolam","fractals","tantrix","number-tiles","number-bars","number-line","primes","dots","fraction-bars","fraction-circles","algebra-tiles","balance","probability","non-trans-dice"]],["toolbar",["move","pen","geo","text","eraser","color"]],["settings",["fullscreen","undo","grid","options","download","zoom"]]];let xr=class extends ms{ready(){this.bindModel(Ae({}));const t=Ne("x-polypad");null==t||t.options.watch((t=>this.model.key=t.key?"/"+t.key:"")),this.model.watch((t=>{const e=[];for(const[s,i]of mr)t[s]?i.every((e=>t[e]))||e.push(s+"="+i.filter((e=>t[e])).join(",")):e.push(s+"=hidden");t.copy||e.push("copy=no"),t.delete||e.push("delete=no"),t.rotate||e.push("rotate=no"),t.pan&&e.push("pan=yes"),this.model.query=e.length?"?"+e.join("&"):""}))}};xr=t([xs("x-polypad-embed")],xr);let br=class extends ms{constructor(){super(...arguments),this.$options={}}ready(){const t=this.children;this.$active=this.$(".active")||t[0],this.$active.addClass("active");for(const[e,s]of t.entries())i(s.tagName,"A","BUTTON")||s.hasAttr("tabindex")||s.setAttr("tabindex",0),s.on("click",(()=>this.makeActive(s))),this.$options[s.attr("value")||e]=s;this.trigger("change",this.$active)}makeActive(t){t!==this.$active&&(this.$active.removeClass("active"),this.$active=t,t.addClass("active"),this.trigger("change",t))}bindVariable(t,e){t[e]=this.$active.attr("value"),this.on("change",(s=>t[e]=s.attr("value"))),t.watch((()=>{const s=this.$options[t[e]];s&&this.makeActive(s)}))}};br=t([xs("x-select")],br);let vr=class extends ms{constructor(){super(...arguments),this.isOpen=!1}ready(){this.animation=this.attr("animation")||"pop",this.$bubble=this.$(".popup-body"),this.$bubble.hide();this.$(".popup-target").on("click",(()=>this.toggle())),this.on("clickOutside",(()=>this.close()));for(const t of this.$bubble.$$("a"))t.on("click",(()=>this.close()));Je.onKey("escape",(()=>this.close()))}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.addClass("active"),this.$bubble.enter(this.animation,150),this.$bubble.setAttr("role","dialog"),this.$bubble.focus())}close(){this.isOpen&&(this.isOpen=!1,this.removeClass("active"),this.$bubble.exit(this.animation,150),this.$bubble.removeAttr("role"))}};vr=t([xs("x-popup")],vr);window.Polypad={create(t,s={}){return e(this,void 0,void 0,(function*(){const i=Ne(t);if(!i)throw new Error(`Unable to find element ${t}`);const o=s.apiKey||"unknown",n=s.userKey;return fetch(`https://mathigon.org/api/polypad?api=${o}&user=${n}`),i.removeChildren(),yield function(t,s){var i;return e(this,void 0,void 0,(function*(){const o=t._el.attachShadow({mode:"open"}),n=document.createElement("style");n.textContent='.icon,.sketch{display:inline-block;fill:currentColor}.button .icon{margin:-10px 3px -10px -8px}.polypad{position:relative;font-size:18px;font-family:Source Sans Pro,Helvetica,sans-serif;line-height:1.6;touch-action:manipulation;-webkit-user-select:none;-ms-user-select:none;user-select:none;overflow:hidden;width:100%;height:100%}.polypad[theme=dark]{background:#22212e}.polypad.grabbing *{cursor:grabbing!important}.polypad:not(.ready) *{transition:none!important;animation:none!important}.polypad:not(.is-tabbing) :focus{outline:none!important}svg.overlay,x-polypad{position:absolute;top:0;left:0;width:100%;height:100%}x-polypad .panels{right:56px}svg.overlay{pointer-events:none;z-index:10}svg{display:block;overflow:hidden}circle,g,image,line,path,polyline,use{transform-origin:center;transform-box:fill-box}*{-webkit-tap-highlight-color:transparent;cursor:inherit;color:inherit}.hidden,[hidden]{display:none!important;visibility:hidden!important}a{cursor:pointer}a,a:hover{text-decoration:none}a,button{touch-action:manipulation}button{-webkit-user-select:none;-ms-user-select:none;user-select:none;box-sizing:initial}.break{word-break:break-all;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.nowrap{white-space:nowrap}.r{position:relative}.row{display:flex;flex-wrap:wrap;justify-content:center}.row .grow{flex-grow:1}.row .shrink{flex-shrink:1}.m-red{color:#cd0e66}.m-blue{color:#0f82f2}.m-green{color:#22ab24}.m-yellow{color:#fd8c00}.m-orange{color:#eb4726}.m-purple{color:#6d3bbf}.m-teal{color:#009ea6}.m-lime{color:#bfc212}button,form,input,select,textarea{border:none;margin:0;padding:0}button,input,select,textarea{display:inline-block;background:transparent;font-family:inherit;font-size:inherit;font-weight:inherit}input[type=date],input[type=email],input[type=password],input[type=text],textarea{cursor:text}select{cursor:pointer}.form-field-style{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:no-repeat top 12px right 10px/24px 24px;background-color:#f6f6f6;border:1px solid rgba(0,0,0,.1);color:#000;border-radius:4px;box-sizing:border-box;display:block;line-height:1.4em;padding:18px 16px 4px;transition:border .2s,background .2s,box-shadow .2s;width:100%}html[theme=dark] .form-field-style{background-color:#43424d;border-color:hsla(0,0%,100%,.5);color:#fff}.form-field-style:not([disabled]):focus,.form-field-style:not([disabled]):hover{background-color:#eee}html[theme=dark] .form-field-style:not([disabled]):focus,html[theme=dark] .form-field-style:not([disabled]):hover{background-color:#64646d}.form-field-style:not([disabled]):focus{border-color:#0f82f2;box-shadow:0 0 0 3px rgba(15,130,242,.5);outline:none}.form-field-style:not([disabled]):focus+.placeholder{color:#0f82f2}.form-field-style[disabled]{cursor:default!important;opacity:.6}.form-checkbox{padding-left:40px;min-height:28px;cursor:pointer;display:block;position:relative;margin:16px 8px}.form-checkbox input{position:absolute;left:5px;top:7px;opacity:0}.form-checkbox .control{background:#f6f6f6;border:1px solid rgba(0,0,0,.1);border-radius:4px;height:22px;left:0;position:absolute;top:2px;width:22px;transition:border .2s,background .2s,box-shadow .2s}.form-checkbox .control:after{display:block;content:" ";width:21px;height:21px;background:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox=\'0 0 24 24\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M19.7 6.3l-.2-.4-.3-.2c-.1-.1-.3 0-.4 0A36.6 36.6 0 009 14.1a36.1 36.1 0 00-4.8-2.9h-.5l-1 .9a.4.4 0 00-.1.3c0 .2 0 .3.1.4a72.1 72.1 0 016.6 7h.4a.5.5 0 00.4-.2c3.8-6.8 5.7-9.6 9.4-13 .2.1.2-.1.2-.3z\' fill=\'%23fff\'/%3E%3C/svg%3E");top:0;left:1px;position:absolute;transform:scale(0);transition:transform .4s cubic-bezier(.33,1.9,.52,.7)}.form-checkbox:hover .control,.form-checkbox input:focus+.control{border-color:#0f82f2;background:#eee}.form-checkbox input:focus+.control{box-shadow:0 0 0 3px rgba(15,130,242,.5);outline:none}.form-checkbox input:checked+.control{background:#0f82f2}.form-checkbox input:checked+.control:after{transform:none}.form-checkbox:hover input:checked+.control,.form-checkbox input:focus:checked+.control{border-color:#053563}.input-field{display:block;border-radius:4px;cursor:text;text-align:center;padding:0;color:inherit;line-height:1.7em;border:1px solid;transition:border .2s,background .2s,box-shadow .2s,color .2s;-webkit-appearance:none;-moz-appearance:textfield}.input-field:focus{border-color:#0f82f2;box-shadow:0 0 0 3px rgba(15,130,242,.5);outline:none}.input-field::-webkit-inner-spin-button,.input-field::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.btn{display:inline-block;width:auto;text-align:center;border:none;border-radius:24px;cursor:pointer;color:hsla(0,0%,100%,.95);transition:background .2s,color .2s,box-shadow .2s;min-width:48px;padding:0 1.2em;height:2em;line-height:2em;font-weight:600;letter-spacing:.2px;background-color:#181824;-webkit-appearance:none;-moz-appearance:none;appearance:none;outline:none;transition:transform .3s,background .2s,color .2s,box-shadow .2s,opacity .2s}.btn.on,.btn:hover{z-index:10;color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.25)}.btn.disabled,.btn[disabled]{box-shadow:none;cursor:default;pointer-events:none}.btn:hover{transform:scale(1.08)}.btn:active{transform:scale(.92)}.btn:active,.btn:hover{background-color:#504b5c}html.is-tabbing .btn:focus{box-shadow:0 0 0 2px currentColor,0 0 0 4px #181824}.btn.disabled,.btn[disabled]{background-color:#ddd!important;color:#999!important}.btn .icon{opacity:.95;transition:opacity .2s;margin:0 6px -6px 0;fill:currentColor}.btn:active .icon,.btn:hover .icon{opacity:1}.btn .arrow{margin:0 -5px -3px 11px}.btn-blue{background-color:#0f82f2}.btn-blue:active,.btn-blue:hover{background-color:#3696f4}html.is-tabbing .btn-blue:focus{box-shadow:0 0 0 2px currentColor,0 0 0 4px #0f82f2}.tooltip{position:absolute;top:-22px;white-space:nowrap;left:50%;transform:translateX(-50%);font-size:14px;background:#181824;opacity:0;border-radius:16px;pointer-events:none;padding:2px 12px;transition:opacity .1s;color:#fff;border:1px solid #fff;line-height:18px;z-index:9999}.is-tabbing.not-mobile :focus>.tooltip,.not-mobile :hover>.tooltip{opacity:.8}.ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tile{transform-origin:0 0;transform-box:view-box}.group-outline,.rotate-bar,.tile .outline{stroke:#181824;stroke-width:6px;stroke-linejoin:round;stroke-linecap:round;fill:none}html[theme=dark] .group-outline,html[theme=dark] .rotate-bar,html[theme=dark] .tile .outline{stroke:#e2e1e6}.group-outline,.rotate-bar{pointer-events:none}.group-outline{fill:rgba(0,0,0,.25)}html[theme=dark] .group-outline{fill:hsla(0,0%,100%,.25)}.rotate-circle,.tile .handle{fill:#181824;cursor:grab;stroke:transparent;stroke-linejoin:round;stroke-width:6px}html[theme=dark] .rotate-circle,html[theme=dark] .tile .handle{fill:#e2e1e6}.tile .handle{cursor:ew-resize}.tile path.handle{stroke:#181824}html[theme=dark] .tile path.handle{stroke:#e2e1e6}.tile .handle,.tile .outline{display:none}.active .tile .handle,.active .tile .outline,.tile .handle.active,.tile .outline.active{display:block}.balance,.number-tile,.polygon-tile{stroke:#fff;stroke-width:1px;stroke-linejoin:round}x-polypad .balance,x-polypad .number-tile,x-polypad .polygon-tile{stroke:#fff}html[theme=dark] x-polypad .balance,html[theme=dark] x-polypad .number-tile,html[theme=dark] x-polypad .polygon-tile{stroke:#22212e}.fraction line{stroke:#fff;stroke-width:2}.source .fraction line{stroke-width:1}.no-labels .fraction line{display:none}.prime-background{fill:#fff}html[theme=dark] .prime-background{fill:#22212e}x-polypad .prime-move{stroke:#181824;stroke-width:6px;stroke-linejoin:round}html[theme=dark] x-polypad .prime-move{stroke:#e2e1e6}.grid-axis,.number-line-ticks{stroke-width:3px;stroke-linecap:round;stroke-linejoin:round}.active .grid-axis,.active .number-line-ticks{stroke-width:6px}x-polypad-sidebar .grid-axis,x-polypad-sidebar .number-line-ticks{stroke:#fff;stroke-width:2px}.axis-gridlines{stroke-width:2px;opacity:.15;stroke-linecap:round;pointer-events:none}.penrose-circles{fill:none;stroke-width:2px;stroke:#fff;opacity:.4}.dice-face{stroke-width:4px;stroke-linejoin:round}.dice-dot{fill:#fff;opacity:.85}.balance-beam{fill:none;stroke-width:8px;stroke-linejoin:round}.active .balance,.active .balance-beam{stroke:#181824!important;stroke-width:6px}html[theme=dark] .active .balance,html[theme=dark] .active .balance-beam{stroke:#e2e1e6!important}.balance-target{display:none;fill:transparent;stroke:#181824;stroke-width:4px;stroke-linejoin:round;stroke-dasharray:12px 10px}html[theme=dark] .balance-target{stroke:#e2e1e6}.spinner{fill:#181824;stroke:#fff;stroke-width:1px;stroke-linejoin:round}html[theme=dark] .spinner{fill:#e2e1e6;stroke:#22212e}x-polypad-sidebar .spinner{stroke-width:1px}.utensil .glass{fill:rgba(197,194,204,.7)}html[theme=dark] .utensil .glass{fill:rgba(101,96,115,.7)}.utensil .ticks{pointer-events:none;stroke-width:.6;stroke:#000}html[theme=dark] .utensil .ticks{stroke:#fff}.utensil text{font-size:12px;text-anchor:middle;fill:#000}html[theme=dark] .utensil text{fill:#fff}.dot-cell{fill:none;stroke-width:20px;stroke-linejoin:round;fill-opacity:.3}.dot-label{text-anchor:middle;font-weight:600;fill:#fff}html[theme=dark] .dot-label{fill:#22212e}.axis-labels text{stroke:#fff;stroke-width:4px;paint-order:stroke;stroke-linejoin:round;font-weight:700;font-size:16px}html[theme=dark] .axis-labels text{stroke:#22212e}html.is-safari .axis-labels text{stroke:none}.fraction text,.number-line text,.polygon-label,.prime-label{font-weight:600;text-anchor:middle;font-size:18px}.fraction text,.polygon-label,.prime-label{fill:#fff}.no-labels .fraction text,.no-labels .polygon-label,.no-labels .prime-label{display:none}.prime-label{fill:#181824;stroke:#fff;stroke-width:4px;paint-order:stroke;stroke-linejoin:round}html[theme=dark] .prime-label{fill:#e2e1e6;stroke:#22212e}html.is-safari .prime-label{stroke:none}.number-line text{transform-origin:center;transform-box:fill-box}x-polypad-sidebar .polygon-label{font-size:16px}x-polypad-sidebar .fraction text{font-size:10px}x-polypad-sidebar .number-line text{font-size:15px;fill:#fff}.problem-box{stroke:#0f82f2;stroke-width:4px;fill:#cfe6fc;transition:stroke .3s,fill .3s}html[theme=dark] .problem-box{fill:#1e3455}.correct .problem-box{stroke:#22ab24;fill:#d3eed3}html[theme=dark] .correct .problem-box{fill:#223d2c}.incorrect .problem-box{stroke:#cd0e66;fill:#f5cfe0}html[theme=dark] .incorrect .problem-box{fill:#441d39}.active .problem-box{stroke-width:6px}.problem-text{text-anchor:middle;font-size:32px;fill:#181824;color:#181824;text-align:center}html[theme=dark] .problem-text{fill:#e2e1e6;color:#e2e1e6}.problem-marker{transform:scale(0);transition:transform .2s cubic-bezier(.33,1.9,.52,.7)}.problem-marker.show{transform:none}.polypad-settings{background:#c5c2cc;box-shadow:0 2px 6px rgba(0,0,0,.12);border-radius:6px;font-size:14px;padding:6px 0 8px}html[theme=dark] .polypad-settings{background:#3a3645}.polypad-settings h3{margin:0 12px 4px;font-size:15px;line-height:26px;text-align:center}.polypad-settings .row{padding:2px 12px 2px 16px}.polypad-settings .label{flex-grow:1;margin-right:8px;text-align:right;line-height:26px}.polypad-settings .input-field{width:60px;border-color:#807c89;background:hsla(0,0%,100%,.5)}html[theme=dark] .polypad-settings .input-field{border-color:hsla(0,0%,100%,.5);background:hsla(0,0%,100%,.15)}.polypad-settings .input-field:focus,.polypad-settings .input-field:hover{background:#fff}html[theme=dark] .polypad-settings .input-field:focus,html[theme=dark] .polypad-settings .input-field:hover{background:hsla(0,0%,100%,.3)}.polypad-settings .input-field:focus,html[theme=dark] .polypad-settings .input-field:focus{border-color:#0f82f2}.geo-path{fill:none;stroke:currentColor;stroke-width:3px;stroke-linecap:round;stroke-linejoin:round}.geo-point{fill:currentColor}.geo-point.locked{stroke:currentColor;stroke-width:3px;fill:#f5f5f6}html[theme=dark] .geo-point.locked{fill:#2d2c38}svg:not(:hover) .geo-point.pending{display:none!important}.geo-shadow{display:none;stroke-width:10px;stroke:currentColor;fill:none}x-polypad{display:block;position:relative;-webkit-user-select:none;-ms-user-select:none;user-select:none;overflow:hidden;touch-action:none}x-polypad .canvas{width:100%;height:100%;outline:none}x-polypad .html-overlay,x-polypad .html-overlay>*{position:absolute;top:0;left:0}x-polypad .selection{stroke:#87c1f9;fill:rgba(135,192,249,.5);display:none}x-polypad .stroke{stroke-width:3px;fill:none;stroke-linecap:round;stroke-linejoin:round}x-polypad .stroke.marker{stroke-width:8px}x-polypad .stroke.highlighter{stroke-width:24px;opacity:.4;mix-blend-mode:multiply}html[theme=dark] x-polypad .stroke.highlighter{mix-blend-mode:normal}x-polypad .stroke.cut{stroke:#000;stroke-dasharray:10px}html[theme=dark] x-polypad .stroke.cut{stroke:#fff}x-polypad[data-tool=text]{cursor:text}x-polypad[data-tool=cutPolygon],x-polypad[data-tool=geo],x-polypad[data-tool=geoPending]{cursor:crosshair}x-polypad[data-tool=pen]{cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAZUlEQVR4AWJwL/AB8DEGJgDCQAz8EX7EbOZIHeFHiV4hKKAWrjzJkY1tXSzfj1vpIx0zY0muKnf3vsnocJBEQIn0gCyyEFeW3qDDQczaJzz+X4mRiOeIsppoz6AHD0wDRvAQHeAAguXO6bw3SrQAAAAASUVORK5CYII=) 5 5,auto;cursor:-webkit-image-set(url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAZUlEQVR4AWJwL/AB8DEGJgDCQAz8EX7EbOZIHeFHiV4hKKAWrjzJkY1tXSzfj1vpIx0zY0muKnf3vsnocJBEQIn0gCyyEFeW3qDDQczaJzz+X4mRiOeIsppoz6AHD0wDRvAQHeAAguXO6bw3SrQAAAAASUVORK5CYII=) 1x,url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAJ1BMVEVHcEz///////////////////////8AAAD///9wcHAwMDDf399gYGCQhTdXAAAAB3RSTlMA759wYBCvzmM0WgAAAGdJREFUeNptkVsKwCAMBJP6yKi9/3kLxQYsO5/DisnGXlrtDt5rs6Q4Gy+fu2CNGTHHgivdiM3YtsAdyQ3FrPnOZdabVVYcLKr1DGa0mzNPOXGD+AFSyufyIzmSHF6tqQrR1emS5TkegZUJJUoarYQAAAAASUVORK5CYII=) 2x) 5 5,auto}x-polypad[data-tool=eraser]{cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAMFBMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAD////v7+8gICC/v79AQEDT09MAAACfn58wMDBKyk2zAAAAB3RSTlMA759wEGCvta0l/AAAAGRJREFUCNdjYGBgCZO9mOrAAAKG+47XvBYGsZhmlQPBSgUgU78dxKz4xMDAPKMcDDoNGByXQ5hVIgzR5VCwlSEPxnzGIANjHmS4DmPWIjORFCBpQzIMyQoki5Gcg+xIJKfDPQQAeUtQWzzU2P8AAAAASUVORK5CYII=) 10 10,auto;cursor:-webkit-image-set(url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAMFBMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAD////v7+8gICC/v79AQEDT09MAAACfn58wMDBKyk2zAAAAB3RSTlMA759wEGCvta0l/AAAAGRJREFUCNdjYGBgCZO9mOrAAAKG+47XvBYGsZhmlQPBSgUgU78dxKz4xMDAPKMcDDoNGByXQ5hVIgzR5VCwlSEPxnzGIANjHmS4DmPWIjORFCBpQzIMyQoki5Gcg+xIJKfDPQQAeUtQWzzU2P8AAAAASUVORK5CYII=) 1x,url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAMFBMVEVHcEwAAAAAAAAAAAAAAAABAQEAAAAAAAAAAAAgICBYWFiXl5e/v7////9AQEDPz8/yxGM3AAAACXRSTlMAQHi/z/8Zn+8OOe6YAAAAzklEQVR42sWV0a6EIBBDETmIMKP//7d34zUb3cjStz3PTQs4U8OdKc6JF2mOU+iSl8KFsuSODFhrM39hra7AkzQWqOYXrEKJD3bb7h/s26dpTtD8gQYp33Xmj9hNucDuHXZY3vc4/bqe8QwuNP9Co+QzePOvbP/h+XLA7jHzYVh9QD0sC+YDjBLCxOpDVqYQj+RhdgwzzYc05pAwH2KkAC4APxTKl5GfR35w+ROqQyGPmTy46irIy6Wuq1oAcqXIJaXXnl6kejXrZS//Pv4AjK46OUdio5kAAAAASUVORK5CYII=) 2x) 10 10,auto}x-polypad .geo-paths,x-polypad .geo-points,x-polypad .geo-shadows,x-polypad .grid,x-polypad .selection,x-polypad .strokes,x-polypad:not([data-tool=move]) .tiles{pointer-events:none}x-polypad .geo-shadows{opacity:.3}x-polypad .grid-pattern line,x-polypad .grid-pattern rect{stroke:#000;fill:none}html[theme=dark] x-polypad .grid-pattern line,html[theme=dark] x-polypad .grid-pattern rect{stroke:#fff}x-polypad .grid-pattern .filled,x-polypad .grid-pattern circle{fill:#000;stroke:none}html[theme=dark] x-polypad .grid-pattern .filled,html[theme=dark] x-polypad .grid-pattern circle{fill:#fff}x-polypad .text-tile{alignment-baseline:hanging;font-size:20px}x-polypad .text-edit{position:absolute;top:0;padding:2px 8px;font-size:20px;line-height:1.4em;transform-origin:0 0;-webkit-user-modify:read-write-plaintext-only;cursor:text;-webkit-user-select:text;-ms-user-select:text;user-select:text}x-polypad .image-drop{position:absolute;top:0;left:0;width:100%;height:100%;display:none;border:6px dashed #0f82f2;box-sizing:border-box;background:rgba(15,130,242,.1);pointer-events:none}x-polypad .panels{position:absolute;top:8px;right:8px}x-polypad.handdrawn .canvas{filter:url(#handdrawn)}x-polypad.handdrawn .geo-paths,x-polypad.handdrawn .strokes{filter:url(#pencil)}x-polypad-sidebar{position:absolute;top:8px;left:8px;z-index:6;border-radius:6px;color:hsla(0,0%,100%,.8);overflow:hidden;box-shadow:0 3px 8px rgba(0,0,0,.3);display:none;transition:height .4s ease-out,width .4s ease-out;height:40px}x-polypad-sidebar[tabs="1"]{width:48px}x-polypad-sidebar[tabs="2"]{width:97px}x-polypad-sidebar[tabs="3"]{width:146px}x-polypad-sidebar.open{width:300px;height:calc(100% - 16px)}.webview x-polypad-sidebar.open{height:calc(100% - 16px - env(safe-area-inset-bottom))}x-polypad-sidebar .sidebar-header{display:flex;margin-bottom:1px}x-polypad-sidebar .sidebar-header button{height:40px;display:block;flex-grow:1;border-right:1px solid #3a3645;overflow:hidden;cursor:pointer;background:#3a3645;position:relative;color:hsla(0,0%,100%,.6);transition:color .2s,background .2s,border .2s}x-polypad-sidebar .sidebar-header button:last-child{border-right:0}x-polypad-sidebar .sidebar-header button .icon{margin:0 12px;display:block}x-polypad-sidebar .sidebar-header button span{position:absolute;white-space:nowrap;top:8px;left:42px;opacity:0;transition:opacity .2s}x-polypad-sidebar .sidebar-header button .close{opacity:0;transition:opacity .2s;position:absolute;right:8px;top:8px;margin:0}x-polypad-sidebar .sidebar-header button.active,x-polypad-sidebar .sidebar-header button:focus,x-polypad-sidebar .sidebar-header button:hover{background:#181824;color:#fff}x-polypad-sidebar[tabs="3"] .sidebar-header button .close{display:none}x-polypad-sidebar[tabs="3"] .sidebar-header button:nth-child(2) span{left:38px}x-polypad-sidebar.open .sidebar-header button{background:#504e59;border-color:#65636d}x-polypad-sidebar.open .sidebar-header button:focus,x-polypad-sidebar.open .sidebar-header button:hover{background:#3e3d49}x-polypad-sidebar.open .sidebar-header button.active{background:#292735}x-polypad-sidebar.open .sidebar-header button span{opacity:1}x-polypad-sidebar.open .sidebar-header button.active:hover .close{opacity:.5;transition-delay:.6s}x-polypad-sidebar .sidebar-body{position:absolute;width:300px;background:#292735;top:40px;border-top:1px solid #65636d;bottom:0}x-polypad-sidebar .sidebar-panel{position:absolute;top:0;left:0;width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;background:#292735;display:none;transition:transform .4s ease-out}x-polypad-sidebar .sidebar-panel.left{transform:translateX(-100%)}x-polypad-sidebar .sidebar-panel.right{transform:translateX(100%)}x-polypad-sidebar h2,x-polypad-sidebar h3{font-weight:600;border-top:1px solid #65636d;padding:2px 16px;margin:0}x-polypad-sidebar h2{font-size:18px;line-height:36px}x-polypad-sidebar h2:first-child{border:none;margin-top:6px}x-polypad-sidebar h3{font-size:16px;line-height:30px;padding-left:9px;letter-spacing:.01em}x-polypad-sidebar h2 .icon{background:currentColor;fill:#fff;border-radius:100%;padding:3px;margin:0 3px -6px -6px}x-polypad-sidebar x-accordion{display:block}x-polypad-sidebar x-accordion .subsection{margin-left:32px}x-polypad-sidebar x-accordion h2,x-polypad-sidebar x-accordion h3{cursor:pointer;transition:background .2s,border .2s}x-polypad-sidebar x-accordion h2:focus,x-polypad-sidebar x-accordion h2:hover,x-polypad-sidebar x-accordion h3:focus,x-polypad-sidebar x-accordion h3:hover{background:hsla(0,0%,100%,.15)}x-polypad-sidebar x-accordion h2:focus+.subsection h3:first-child,x-polypad-sidebar x-accordion h2:hover+.subsection h3:first-child,x-polypad-sidebar x-accordion h3:focus+.subsection h3:first-child,x-polypad-sidebar x-accordion h3:hover+.subsection h3:first-child{border-color:transparent}x-polypad-sidebar p{margin:6px 16px;color:hsla(0,0%,100%,.85);font-size:16px;line-height:28px}x-polypad-sidebar .source-wrap{display:flex;flex-wrap:wrap;justify-content:space-evenly;padding-right:6px;margin:0 auto}x-polypad-sidebar .source-wrap:first-child{margin-top:4px}x-polypad-sidebar .source-wrap:last-child{margin-bottom:12px}x-polypad-sidebar .source-wrap>.source,x-polypad-sidebar .source-wrap>svg{margin:3px 0}x-polypad-sidebar .source-wrap .source{cursor:grab;touch-action:none}x-polypad-sidebar .caption,x-polypad-sidebar .source:after,x-polypad-sidebar .subtitle{display:block;font-size:14px;color:hsla(0,0%,100%,.5);line-height:1.2;text-align:center;width:100%}x-polypad-sidebar .source:after{content:attr(data-caption);font-size:12px}x-polypad-sidebar .caption{margin:0;padding:0 16px;box-sizing:border-box}x-polypad-sidebar .subtitle{margin:16px 0 4px;font-weight:600;font-size:15px;color:hsla(0,0%,100%,.7);border-top:1px solid #65636d;padding-top:12px}x-polypad-sidebar .subtitle:first-child{margin-top:6px;padding:0;border:0}x-polypad-sidebar .polypad-library .caption{margin-bottom:16px}x-polypad-sidebar .primes{display:flex;align-items:center;flex-grow:1;justify-content:center;margin:8px 20px 6px}x-polypad-sidebar .primes input{width:64px;margin-right:12px}x-polypad-sidebar .input-field{border-color:hsla(0,0%,100%,.5);background:hsla(0,0%,100%,.15)}x-polypad-sidebar .input-field:focus,x-polypad-sidebar .input-field:hover{background:hsla(0,0%,100%,.25)}x-polypad-sidebar .warn{line-height:1.4;margin:20px 16px;text-align:center}x-polypad-sidebar .warn .icon{display:block;margin:0 auto 6px}x-polypad-sidebar .s-btn{background:hsla(0,0%,100%,.2);cursor:pointer;display:block;text-align:center;transition:background .2s,color .2s,opacity .15s;font-size:16px;font-weight:600}x-polypad-sidebar .s-btn .icon{margin:0 2px -4px -2px}x-polypad-sidebar .s-btn:focus,x-polypad-sidebar .s-btn:hover{background:hsla(0,0%,100%,.35);color:#fff}x-polypad-sidebar .canvas-grid{display:flex;flex-wrap:wrap;justify-content:center;margin:-2px 0 8px}x-polypad-sidebar .canvas-grid.current{border-bottom:1px solid hsla(0,0%,100%,.2)}x-polypad-sidebar .new-btn{margin:12px 30px;border-radius:40px;line-height:32px}x-polypad-sidebar .canvas{padding:8px 0;width:132px;border-radius:4px;transition:background .2s}x-polypad-sidebar .canvas .thumb{margin:0 auto 3px;width:108px;height:72px;background:#fff 50%;border-radius:4px;background-size:contain}x-polypad-sidebar .canvas .title{text-align:center;margin:0;font-size:14px;font-weight:600;color:hsla(0,0%,100%,.75);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}x-polypad-sidebar .canvas .status{color:hsla(0,0%,100%,.4);font-size:12px;line-height:1.4;text-align:center}x-polypad-sidebar .canvas .status .icon{margin:0 1px -3px 0}x-polypad-sidebar .current .title{width:94px;margin:3px 4px;line-height:24px;padding:0 20px 0 6px;text-align:left}x-polypad-sidebar .current .title:not(:hover):not(:focus){border-color:transparent;background:transparent}x-polypad-sidebar .current .canvas{position:relative}x-polypad-sidebar .current .canvas .icon{position:absolute;top:88px;right:10px}x-polypad-sidebar .buttons{width:124px;margin:8px 4px 0;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}x-polypad-sidebar .buttons .s-btn{margin-top:1px;width:100%;font-size:16px;height:32px;line-height:32px}x-polypad-sidebar .buttons .s-btn:first-child{margin-top:0;border-radius:16px 16px 0 0}x-polypad-sidebar .buttons .s-btn:last-child{border-bottom-left-radius:16px;border-bottom-right-radius:16px}x-polypad-sidebar .buttons .s-btn.delete:focus,x-polypad-sidebar .buttons .s-btn.delete:hover{background:rgba(205,14,102,.8)}x-polypad-sidebar .buttons .s-btn.save{background:rgba(34,171,36,.8)}x-polypad-sidebar .buttons .s-btn.save:focus,x-polypad-sidebar .buttons .s-btn.save:hover{background:#22ab24}x-polypad-sidebar .loading{width:20px;height:20px;background:url(/images/loading-white.gif);background-size:20px 20px;margin:20px auto}x-polypad-sidebar a.canvas:focus,x-polypad-sidebar a.canvas:hover{background:hsla(0,0%,100%,.15)}x-polypad-sidebar a.canvas.active{background:hsla(0,0%,100%,.25);pointer-events:none}x-polypad-sidebar .canvas+h2{margin-top:6px}x-polypad-sidebar .help-links{margin:4px 15px 10px}x-polypad-sidebar .help-links .s-btn{font-size:13px;margin:1px;flex:1 1 20px;text-align:center;padding-bottom:4px}x-polypad-sidebar .help-links .s-btn:first-child{border-radius:6px 0 0 6px}x-polypad-sidebar .help-links .s-btn:last-child{border-radius:0 6px 6px 0}x-polypad-sidebar .help-links .s-btn .sketch{display:block;margin:0 auto}x-polypad-sidebar .classroom h2{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:40px}x-polypad-sidebar .title-options{position:absolute;display:flex;right:8px;margin-top:-38px}x-polypad-sidebar .title-options .icon,x-polypad-sidebar .title-options a,x-polypad-sidebar .title-options button{display:block}x-polypad-sidebar .title-options a,x-polypad-sidebar .title-options button{padding:6px;cursor:pointer;transition:color .2s;color:hsla(0,0%,100%,.7)}x-polypad-sidebar .title-options a:focus,x-polypad-sidebar .title-options a:hover,x-polypad-sidebar .title-options button:focus,x-polypad-sidebar .title-options button:hover{color:#fff}x-polypad-sidebar .title-options .popup-body{position:relative;position:absolute;background:#4e4a58;width:180px;right:0;z-index:10;box-shadow:0 3px 8px rgba(0,0,0,.3);border-radius:6px;padding:4px;transform-origin:172px -4px}x-polypad-sidebar .title-options .popup-body:after{content:"";display:block;position:absolute;bottom:100%;left:50%;margin-left:-6px;border-bottom:6px solid #4e4a58;border-left:6px solid transparent;border-right:6px solid transparent;left:auto;right:12px}x-polypad-sidebar .title-options .popup-body>*{font-size:16px;padding:4px 10px;cursor:pointer;border-radius:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:background .2s,color .2s;color:hsla(0,0%,100%,.8);position:relative}x-polypad-sidebar .title-options .popup-body>:before{content:" ";display:block;height:1px;background:hsla(0,0%,100%,.4);transition:background-color .2s;position:absolute;width:160px;top:0}x-polypad-sidebar .title-options .popup-body>:first-child:before{display:none}x-polypad-sidebar .title-options .popup-body>.active,x-polypad-sidebar .title-options .popup-body>.on,x-polypad-sidebar .title-options .popup-body>:focus,x-polypad-sidebar .title-options .popup-body>:hover{background:hsla(0,0%,100%,.2);color:#fff}x-polypad-sidebar .title-options .popup-body>.active+:before,x-polypad-sidebar .title-options .popup-body>.active:before,x-polypad-sidebar .title-options .popup-body>.on+:before,x-polypad-sidebar .title-options .popup-body>.on:before,x-polypad-sidebar .title-options .popup-body>:focus+:before,x-polypad-sidebar .title-options .popup-body>:focus:before,x-polypad-sidebar .title-options .popup-body>:hover+:before,x-polypad-sidebar .title-options .popup-body>:hover:before{background:transparent}x-polypad-sidebar .title-options .popup-body>.active,x-polypad-sidebar .title-options .popup-body>.on{background:hsla(0,0%,100%,.32)}x-polypad-sidebar .title-options .popup-body>:focus,x-polypad-sidebar .title-options .popup-body>:hover{color:#fff}x-polypad-sidebar .title-options .popup-body>.active{background:#009ea6;font-weight:600;cursor:default}x-polypad-sidebar .form-checkbox.s-btn{margin:0;text-align:left;box-sizing:border-box;padding-left:44px}x-polypad-sidebar .form-checkbox.s-btn .control{left:14px;top:4px}x-polypad-sidebar p.help{font-size:14px;line-height:1.6;margin:0 16px 8px}x-polypad-sidebar .progress{background:hsla(0,0%,100%,.2);height:8px;border-radius:4px;margin:6px 12px 2px;overflow:hidden;display:flex}x-polypad-sidebar .progress *{height:8px;float:left;background:#22ab24}x-polypad-sidebar .progress :nth-child(2){background:#fd8c00}x-polypad-sidebar .progress :nth-child(3){background:#cd0e66}x-polypad-sidebar .canvas-grid.hide-names .progress,x-polypad-sidebar .canvas-grid.hide-names .title{display:none!important}#accessibility code{background:#f5f5f6;border:1px solid #c5c2cc;border-radius:4px;padding:0 3px;font-size:95%}x-color-picker{display:flex;position:relative;-webkit-user-select:none;-ms-user-select:none;user-select:none;justify-content:center}x-color-picker x-select{width:32px;margin-right:18px}x-color-picker .color-content{width:270px;height:90px}x-color-picker.custom .palette,x-color-picker:not(.custom) .sliders{display:none}x-color-picker .switch{cursor:pointer;transition:opacity .2s;opacity:.4}x-color-picker .switch.icon{fill:#fff}x-color-picker .switch:hover{opacity:.6}x-color-picker .switch.active{opacity:1}x-color-picker .palette{display:flex;flex-wrap:wrap}x-color-picker .palette button{width:30px;height:30px;box-sizing:border-box;cursor:pointer}x-color-picker .palette button.active{border:3px solid #fff;transform:scale(1.2);border-radius:4px}html.is-tabbing x-color-picker .palette button:focus,x-color-picker .palette button.active{z-index:1}x-color-picker .slider-row{display:flex}x-color-picker .slider-row:first-child{margin-top:-3px}x-color-picker .slider-row label{width:40px;display:block;line-height:32px;font-size:12px;margin:0 12px 0 0;text-transform:uppercase;color:hsla(0,0%,100%,.6)}x-color-picker .slider{height:16px;position:relative;margin:8px 0;border-radius:4px;width:210px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.2)}x-color-picker .handle{width:24px;height:24px;position:absolute;margin:-4px -12px;background:#fff;border-radius:100%;box-shadow:0 2px 4px rgba(0,0,0,.4);cursor:pointer;transition:transform .2s}x-color-picker .handle.active,x-color-picker .handle:hover{transform:scale(1.2);box-shadow:0 4px 8px rgba(0,0,0,.3)}x-polypad-toolbar{position:absolute;bottom:8px;left:50%;z-index:5;transition:transform .4s;transform:translateX(-50%);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}@media screen and (min-width:680px){x-polypad-toolbar.shifted{transform:translateX(calc(144px - 50%))}}x-polypad-toolbar .bar{background:#3a3645;height:44px;border-radius:26px;display:flex;padding:1px 12px;box-shadow:0 3px 8px rgba(0,0,0,.3);z-index:1}html.webview x-polypad-toolbar{bottom:calc(8px + env(safe-area-inset-bottom))}x-polypad-toolbar>x-select{display:flex}x-polypad-toolbar .tool{cursor:pointer;padding:6px;position:relative}x-polypad-toolbar .tool .icon{display:block;opacity:.35;transition:opacity .1s;fill:#fff}x-polypad-toolbar .tool:focus .icon,x-polypad-toolbar .tool:hover .icon{opacity:.7}x-polypad-toolbar .tool.active{cursor:default;pointer-events:none}x-polypad-toolbar .tool.active .icon{opacity:1}x-polypad-toolbar .tooltip{top:-28px}@media screen and (max-width:410px){x-polypad-toolbar{padding:2px 8px}x-polypad-toolbar .tool{padding:6px 3px}}@media screen and (max-width:370px){x-polypad-toolbar .tool{padding:6px 2px}}x-polypad-toolbar .color-picker{display:block;position:relative;color:#fff}x-polypad-toolbar .color-picker .popup-target{display:block;cursor:pointer;width:30px;height:30px;border-radius:100%;margin:6px;border:1px solid hsla(0,0%,100%,.8);background:linear-gradient(180deg,transparent,rgba(0,0,0,.25))}x-polypad-toolbar .color-picker .popup-target.rainbow{background:radial-gradient(#fff,hsla(0,0%,100%,0) 60%),conic-gradient(#cd0e66,#6d3bbf,#0f82f2,#009ea6,#22ab24,#bfc212,#fd8c00,#eb4726,#cd0e66)}x-polypad-toolbar .color-picker .popup-body{position:relative;display:none;position:absolute;padding:12px;left:-151px;bottom:56px;background:#3a3645;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,.3);transform-origin:center bottom;z-index:10}x-polypad-toolbar .color-picker .popup-body:after{content:"";display:block;position:absolute;top:100%;left:50%;margin-left:-8px;border-top:8px solid #3a3645;border-left:8px solid transparent;border-right:8px solid transparent}@media screen and (max-width:880px){x-polypad-toolbar .color-picker .popup-body{left:-280px;transform-origin:302px bottom}x-polypad-toolbar .color-picker .popup-body:after{left:302px}}x-polypad-toolbar .buttons{display:flex;position:absolute;bottom:54px;left:50%;transform:translateX(-50%)}x-polypad-toolbar .buttons button{-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:16px;background:#89868f;margin:0 4px;white-space:nowrap;font-weight:400;border-radius:20px;border:none;cursor:pointer;transition:background .2s,color .2s;position:relative;padding:0 20px;color:hsla(0,0%,100%,.95);height:2em;line-height:2em;box-shadow:0 2px 4px rgba(0,0,0,.2)}x-polypad-toolbar .buttons button:focus,x-polypad-toolbar .buttons button:hover{background:#615e6a;color:#fff}x-polypad-toolbar .buttons button.icon-only{padding:0 12px}x-polypad-toolbar .buttons button.active{background:#3a3645;pointer-events:none}x-polypad-toolbar .buttons button .icon{display:block;fill:currentColor}x-polypad-toolbar .btn-group{display:flex;margin:0 3px;border-radius:24px;box-shadow:0 2px 4px rgba(0,0,0,.2)}x-polypad-toolbar .btn-group button{border-radius:0;margin:0 0 0 1px;box-shadow:none}x-polypad-toolbar .btn-group button:first-child{border-radius:20px 0 0 20px;margin-left:0}x-polypad-toolbar .btn-group button:last-child{border-bottom-right-radius:20px;border-top-right-radius:20px}x-polypad-toolbar .btn-group button.icon-only:first-child{padding-left:14px}x-polypad-toolbar .btn-group button.icon-only:last-child{padding-right:14px}x-polypad-toolbar .brushes{position:absolute;bottom:26px;left:50%;transform:translateX(-50%)}x-polypad-toolbar .brushes svg{margin:0 6px;filter:saturate(0) contrast(.3) brightness(1.5);transition:transform .2s,filter .2s;cursor:pointer}x-polypad-toolbar .brushes svg:focus,x-polypad-toolbar .brushes svg:hover{transform:translateY(-10px)}x-polypad-toolbar .brushes svg.active{filter:none;transform:translateY(-20px);cursor:default}x-polypad-settings{position:absolute;top:8px;right:8px;z-index:4;display:block}x-polypad-settings .settings-group{border-radius:6px;margin-bottom:8px;box-shadow:0 3px 8px rgba(0,0,0,.3)}x-polypad-settings .settings-group:last-child{margin:0}x-polypad-settings .settings-btn{display:block;padding:8px;cursor:pointer;background:#3a3645;transition:background .2s,color .2s;color:hsla(0,0%,100%,.7);position:relative}x-polypad-settings .settings-btn.dark{background:#292735}x-polypad-settings .settings-btn:focus,x-polypad-settings .settings-btn:not([disabled]):hover{background:#181824;color:#fff}x-polypad-settings .settings-btn .icon{display:block}x-polypad-settings .settings-btn[disabled]{cursor:default;color:hsla(0,0%,100%,.3)}x-polypad-settings .settings-group>.settings-btn:first-child,x-polypad-settings .settings-group>x-popup:first-child .settings-btn{border-radius:6px 6px 0 0}x-polypad-settings .settings-group>.settings-btn:last-child,x-polypad-settings .settings-group>x-popup:last-child .settings-btn{border-bottom-left-radius:6px;border-bottom-right-radius:6px}x-polypad-settings .tooltip{transform:none;right:44px;left:auto;top:8px}x-polypad-settings .active .tooltip{opacity:0!important}x-polypad-settings x-popup{display:block;position:relative}x-polypad-settings .popup-body{position:relative;position:absolute;top:0;right:48px;padding:6px;background:#3a3645;border-radius:6px;transform-origin:right 20px;box-shadow:0 3px 8px rgba(0,0,0,.3)}x-polypad-settings .popup-body:after{content:"";display:block;position:absolute;left:100%;top:50%;margin-top:-6px;border-left:6px solid #3a3645;border-top:6px solid transparent;border-bottom:6px solid transparent;top:20px}x-polypad-settings .grid-popup{width:116px;display:flex;flex-wrap:wrap}x-polypad-settings .grid{cursor:pointer;width:48px;height:48px;border:3px solid #3a3645;border-radius:6px;margin:2px;transition:border .2s,opacity .2s;opacity:.6;background:hsla(0,0%,100%,.15)}x-polypad-settings .grid:focus,x-polypad-settings .grid:hover{border-color:#1873cf;opacity:.8}x-polypad-settings .grid.active{border-color:#0f82f2;cursor:default;opacity:1}x-polypad-settings .grid svg{display:block;width:48px;height:48px;border-radius:3px}x-polypad-settings .grid path{stroke:#fff}x-polypad-settings .grid.fill path,x-polypad-settings .grid circle{fill:#fff;stroke:none}x-polypad-settings .options-popup{width:220px;color:#fff;font-size:16px;padding:10px}x-polypad-settings .options-popup .row .icon{margin:0 4px -4px 0}x-polypad-settings .options-popup .row{justify-content:space-between;align-items:center}x-polypad-settings .options-popup .row,x-polypad-settings .options-popup button{margin-bottom:8px}x-polypad-settings .options-popup .form-checkbox{margin:0;padding:0 12px}x-polypad-settings .options-popup .form-field{padding:0}x-polypad-settings .options-popup button:last-child{margin-bottom:0}#share .warn{background:rgba(205,14,102,.2);padding:6px;text-align:center;border-radius:6px}x-polypad-embed{font-size:16px}x-polypad-embed pre{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:no-repeat top 12px right 10px/24px 24px;background-color:#f6f6f6;border:1px solid rgba(0,0,0,.1);color:#000;border-radius:4px;box-sizing:border-box;display:block;line-height:1.4em;transition:border .2s,background .2s,box-shadow .2s;width:100%;white-space:normal;word-break:break-all;padding:6px 12px;cursor:text}html[theme=dark] x-polypad-embed pre{background-color:#43424d;border-color:hsla(0,0%,100%,.5);color:#fff}x-polypad-embed pre:not([disabled]):focus,x-polypad-embed pre:not([disabled]):hover{background-color:#eee}html[theme=dark] x-polypad-embed pre:not([disabled]):focus,html[theme=dark] x-polypad-embed pre:not([disabled]):hover{background-color:#64646d}x-polypad-embed pre:not([disabled]):focus{border-color:#0f82f2;box-shadow:0 0 0 3px rgba(15,130,242,.5);outline:none}x-polypad-embed pre:not([disabled]):focus+.placeholder{color:#0f82f2}x-polypad-embed pre[disabled]{cursor:default!important;opacity:.6}x-polypad-embed h3{font-size:18px;margin:18px 0 6px}x-polypad-embed .form-checkbox{padding-left:28px;min-height:0;margin:0 0 6px}x-polypad-embed .form-checkbox .control,x-polypad-embed .form-checkbox .control:after{height:18px;width:18px}',o.appendChild(n);const a=Re("div",{class:"polypad",dir:"ltr",lang:"en"});o.appendChild(a._el),a.addClass((Je.isMobile?"is":"not")+"-mobile"),Je.isSafari&&a.addClass("is-safari"),setTimeout((()=>a.addClass("ready"))),window.addEventListener("keydown",(t=>{9===t.keyCode&&a.addClass("is-tabbing")})),window.addEventListener("mousedown",(()=>{a.removeClass("is-tabbing")}));let r="";!1!==s.sidebar&&(r+='<x-polypad-sidebar tabs="1"><div class="sidebar-header"><button><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M13,14v6a1,1,0,0,0,1,1h6a1.1,1.1,0,0,0,1-1V14a1,1,0,0,0-1-1H14A.9.9,0,0,0,13,14ZM4,21h6a1,1,0,0,0,1-1V14a.9.9,0,0,0-1-1H4a1,1,0,0,0-1,1v6A1.1,1.1,0,0,0,4,21ZM3,4v6a1,1,0,0,0,1,1h6a.9.9,0,0,0,1-1V4a1,1,0,0,0-1-1H4A1.1,1.1,0,0,0,3,4ZM15.9,2.4,11.7,6.6a1.1,1.1,0,0,0,0,1.5l4.2,4.2a1.1,1.1,0,0,0,1.5,0l4.2-4.2a1.1,1.1,0,0,0,0-1.5L17.4,2.4A1.1,1.1,0,0,0,15.9,2.4Z"/>></svg><span>Tiles</span><svg class="icon close" viewBox="0 0 24 24" width="24" height="24"><path d="M18.7,16.5,14.1,12l4.6-4.5a2.1,2.1,0,0,0,.4-1.1,1.5,1.5,0,0,0-.4-1h0a1.6,1.6,0,0,0-2.2,0L12,9.9,7.5,5.3a1.8,1.8,0,0,0-2.2,0,2.1,2.1,0,0,0-.4,1.1,2.1,2.1,0,0,0,.4,1.1L9.9,12,5.3,16.5a2.1,2.1,0,0,0-.4,1.1,2.1,2.1,0,0,0,.4,1.1,1.8,1.8,0,0,0,2.2,0L12,14.1l4.5,4.6a2.1,2.1,0,0,0,1.1.4,2.1,2.1,0,0,0,1.1-.4,2.1,2.1,0,0,0,.4-1.1A2.1,2.1,0,0,0,18.7,16.5Z"/>></svg></button></div><div class="sidebar-body"><x-accordion class="sidebar-panel"><h2 class="m-red" data-key="geometry"><svg class="icon" viewBox="0 0 24 24" width="18" height="18"><path d="M22.3,13.1,16.7,3.2a1.9,1.9,0,0,0-3.4,0L12.3,5l-.6-.5a3,3,0,0,0-3.4,0L2.5,8.8A3,3,0,0,0,1.4,12l2.3,6.9a2.8,2.8,0,0,0,2.7,1.9h7.2a2.8,2.8,0,0,0,2.7-1.9l1-2.9h3.3a1.9,1.9,0,0,0,1.6-.9A2,2,0,0,0,22.3,13.1Zm-7.9,5.1a.8.8,0,0,1-.8.6H6.4a.8.8,0,0,1-.8-.6L3.3,11.4a.9.9,0,0,1,.3-1L9.5,6.2a.7.7,0,0,1,1,0l.8.6L7.7,13.1a2,2,0,0,0,.1,2,1.9,1.9,0,0,0,1.6.9h5.8ZM9.6,14,15,4.3,20.4,14Z"/>></svg> Geometry</h2><x-accordion class="subsection" storage="polypad.tiles-geometry"><h3 data-key="polygons" tabindex="0">Polygons</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="equ-triangle" data-type="polygon" data-options="equ-triangle"></div><div class="source" tabindex="0" aria-label="square" data-type="polygon" data-options="square"></div><div class="source" tabindex="0" aria-label="reg-pentagon" data-type="polygon" data-options="reg-pentagon"></div><div class="source" tabindex="0" aria-label="reg-hexagon" data-type="polygon" data-options="reg-hexagon"></div><div class="source" tabindex="0" aria-label="reg-heptagon" data-type="polygon" data-options="reg-heptagon"></div><div class="source" tabindex="0" aria-label="reg-octagon" data-type="polygon" data-options="reg-octagon"></div><div class="source" tabindex="0" aria-label="reg-decagon" data-type="polygon" data-options="reg-decagon"></div><div class="source" tabindex="0" aria-label="reg-dodecagon" data-type="polygon" data-options="reg-dodecagon"></div><div class="source" tabindex="0" aria-label="Custom Polygon" data-type="custom-polygon"></div><div class="source" tabindex="0" aria-label="trapezium" data-type="polygon" data-options="trapezium"></div><div class="source" tabindex="0" aria-label="rhombus" data-type="polygon" data-options="rhombus"></div><div class="source" tabindex="0" aria-label="rhombus-2" data-type="polygon" data-options="rhombus-2"></div><div class="source" tabindex="0" aria-label="rectangle" data-type="polygon" data-options="rectangle"></div><div class="source" tabindex="0" aria-label="right-triangle" data-type="polygon" data-options="right-triangle"></div><div class="source" tabindex="0" aria-label="right-triangle-2" data-type="polygon" data-options="right-triangle-2"></div><div class="source" tabindex="0" aria-label="chevron" data-type="polygon" data-options="chevron"></div><div class="source" tabindex="0" aria-label="kite" data-type="polygon" data-options="kite"></div><div class="source" tabindex="0" aria-label="dart" data-type="polygon" data-options="dart"></div></div></section><h3 data-key="tangram" tabindex="0">Tangram</h3><section><div class="subtitle">Classic Tangram</div><div class="source-wrap"><svg width="148" height="148"><path class="source polygon-tile" tabindex="0" aria-label="Tangram Tile 1" data-type="tangram" data-options="0"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Tile 2" data-type="tangram" data-options="1"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Tile 3" data-type="tangram" data-options="2"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Tile 4" data-type="tangram" data-options="3"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Tile 5" data-type="tangram" data-options="4"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Tile 6" data-type="tangram" data-options="5"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Tile 7" data-type="tangram" data-options="6"></path></svg></div><div class="subtitle">Magic Egg</div><div class="source-wrap"><svg width="148" height="190"><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 1" data-type="egg" data-options="0"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 2" data-type="egg" data-options="1"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 3" data-type="egg" data-options="2"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 4" data-type="egg" data-options="3"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 5" data-type="egg" data-options="4"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 6" data-type="egg" data-options="5"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 7" data-type="egg" data-options="6"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 8" data-type="egg" data-options="7"></path><path class="source polygon-tile" tabindex="0" aria-label="Tangram Egg Tile 9" data-type="egg" data-options="8"></path></svg></div></section><h3 data-key="polyominoes" tabindex="0">Polyominoes</h3><section><div class="subtitle">Pentominoes</div><div class="source-wrap"><svg width="242" height="102"><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 1" data-type="pentomino" data-options="0"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 2" data-type="pentomino" data-options="1"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 3" data-type="pentomino" data-options="2"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 4" data-type="pentomino" data-options="3"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 5" data-type="pentomino" data-options="4"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 6" data-type="pentomino" data-options="5"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 7" data-type="pentomino" data-options="6"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 8" data-type="pentomino" data-options="7"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 9" data-type="pentomino" data-options="8"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 10" data-type="pentomino" data-options="9"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 11" data-type="pentomino" data-options="10"></path><path class="source polygon-tile" tabindex="0" aria-label="Pentomino 12" data-type="pentomino" data-options="11"></path></svg></div><div class="subtitle">Tetrominoes</div><div class="source-wrap"><svg width="122" height="82"><path class="source polygon-tile" tabindex="0" aria-label="Tetromino 1" data-type="pentomino" data-options="12"></path><path class="source polygon-tile" tabindex="0" aria-label="Tetromino 2" data-type="pentomino" data-options="13"></path><path class="source polygon-tile" tabindex="0" aria-label="Tetromino 3" data-type="pentomino" data-options="14"></path><path class="source polygon-tile" tabindex="0" aria-label="Tetromino 4" data-type="pentomino" data-options="15"></path><path class="source polygon-tile" tabindex="0" aria-label="Tetromino 5" data-type="pentomino" data-options="16"></path></svg></div></section><h3 data-key="utensils" tabindex="0">Utensils</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Ruler" data-type="ruler" data-options="400"><svg width="80" height="80" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><rect fill="#fff" height="12.05" opacity=".5" rx="2" transform="matrix(.70710678 -.70710678 .70710678 .70710678 -12.4 29.9)" width="72.3" x="-6.2" y="23.9"/><g fill="none" stroke="#fff" stroke-miterlimit="10"><path d="m2.4 48.9 3.9 3.9" stroke-width=".4"/><path d="m3.2 48.1 2.3 2.4" stroke-width=".3"/><path d="m4 47.4 2.3 2.3" stroke-width=".3"/><path d="m4.8 46.6 2.3 2.3" stroke-width=".3"/><path d="m5.5 45.8 2.4 2.3" stroke-width=".3"/><path d="m6.3 45 2.3 2.4" stroke-width=".3"/><path d="m7.1 44.3 2.3 2.3" stroke-width=".3"/><path d="m7.9 43.5 2.3 2.3" stroke-width=".3"/><path d="m8.6 42.7 2.4 2.3" stroke-width=".3"/><path d="m9.4 41.9 2.3 2.4" stroke-width=".3"/><path d="m10.2 41.2 3.9 3.8" stroke-width=".3"/><path d="m11 40.4 2.3 2.3" stroke-width=".3"/><path d="m11.7 39.6 2.4 2.3" stroke-width=".3"/><path d="m12.5 38.8 2.3 2.4" stroke-width=".3"/><path d="m13.3 38.1 2.3 2.3" stroke-width=".3"/><path d="m14.1 37.3 2.3 2.3" stroke-width=".3"/><path d="m14.8 36.5 2.4 2.3" stroke-width=".3"/><path d="m15.6 35.7 2.3 2.4" stroke-width=".3"/><path d="m16.4 35 2.3 2.3" stroke-width=".3"/><path d="m17.2 34.2 2.3 2.3" stroke-width=".3"/><path d="m17.9 33.4 3.9 3.9" stroke-width=".3"/><path d="m18.7 32.7 2.3 2.3" stroke-width=".3"/><path d="m19.5 31.9 2.3 2.3" stroke-width=".3"/><path d="m20.3 31.1 2.3 2.3" stroke-width=".3"/><path d="m21 30.3 2.4 2.4" stroke-width=".3"/><path d="m21.8 29.6 2.3 2.3" stroke-width=".3"/><path d="m22.6 28.8 2.3 2.3" stroke-width=".3"/><path d="m23.4 28 2.3 2.3" stroke-width=".3"/><path d="m24.1 27.2 2.4 2.4" stroke-width=".3"/><path d="m24.9 26.5 2.3 2.3" stroke-width=".3"/><path d="m25.7 25.7 3.9 3.9" stroke-width=".3"/><path d="m26.5 24.9 2.3 2.3" stroke-width=".3"/><path d="m27.2 24.1 2.4 2.4" stroke-width=".3"/><path d="m28 23.4 2.3 2.3" stroke-width=".3"/><path d="m28.8 22.6 2.3 2.3" stroke-width=".3"/><path d="m29.6 21.8 2.3 2.3" stroke-width=".3"/><path d="m30.3 21 2.4 2.4" stroke-width=".3"/><path d="m31.1 20.3 2.3 2.3" stroke-width=".3"/><path d="m31.9 19.5 2.3 2.3" stroke-width=".3"/><path d="m32.7 18.7 2.3 2.3" stroke-width=".3"/><path d="m33.4 17.9 3.9 3.9" stroke-width=".3"/><path d="m34.2 17.2 2.3 2.3" stroke-width=".3"/><path d="m35 16.4 2.3 2.3" stroke-width=".3"/><path d="m35.7 15.6 2.4 2.3" stroke-width=".3"/><path d="m36.5 14.8 2.3 2.4" stroke-width=".3"/><path d="m37.3 14.1 2.3 2.3" stroke-width=".3"/><path d="m38.1 13.3 2.3 2.3" stroke-width=".3"/><path d="m38.8 12.5 2.4 2.3" stroke-width=".3"/><path d="m39.6 11.7 2.3 2.4" stroke-width=".3"/><path d="m40.4 11 2.3 2.3" stroke-width=".3"/><path d="m41.2 10.2 3.8 3.9" stroke-width=".3"/><path d="m41.9 9.4 2.4 2.3" stroke-width=".3"/><path d="m42.7 8.6 2.3 2.4" stroke-width=".3"/><path d="m43.5 7.9 2.3 2.3" stroke-width=".3"/><path d="m44.3 7.1 2.3 2.3" stroke-width=".3"/><path d="m45 6.3 2.4 2.3" stroke-width=".3"/><path d="m45.8 5.5 2.3 2.4" stroke-width=".3"/><path d="m46.6 4.8 2.3 2.3" stroke-width=".3"/><path d="m47.4 4 2.3 2.3" stroke-width=".3"/><path d="m48.1 3.2 2.4 2.3" stroke-width=".3"/><path d="m48.9 2.4 3.9 3.9" stroke-width=".3"/></g></svg></div><div class="source" tabindex="0" aria-label="Protractor" data-type="protractor" data-options="200"><svg width="80" height="80" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><path d="m10.8 10.8a33.6 33.6 0 0 0 0 47.5l.4.4a1.2 1.2 0 0 0 1.6 0l45.9-45.9a1.2 1.2 0 0 0 0-1.6l-.4-.4a33.6 33.6 0 0 0 -47.5 0z" fill="#fff" opacity=".5"/><g fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width=".3"><path d="m10.8 10.8 19.8 19.8"/><path d="m10.8 10.8 19.8 19.8"/><path d="m11.7 10 3 3.3"/><path d="m12.5 9.2 3 3.4"/><path d="m13.4 8.5 2.9 3.5"/><path d="m14.4 7.8 2.7 3.5"/><path d="m15.3 7.1 16 22.9"/><path d="m15.3 7.1 16 22.9"/><path d="m16.3 6.4 2.4 3.8"/><path d="m17.3 5.8 2.3 3.8"/><path d="m18.3 5.2 2.2 3.9"/><path d="m19.3 4.7 2.1 3.9"/><path d="m20.4 4.1 11.8 25.4"/><path d="m20.4 4.1 11.8 25.4"/><path d="m21.4 3.7 1.8 4.1"/><path d="m22.5 3.2 1.6 4.2"/><path d="m23.6 2.8 1.5 4.3"/><path d="m24.7 2.5 1.4 4.2"/><path d="m25.9 2.1 7.2 27.1"/><path d="m25.9 2.1 7.2 27.1"/><path d="m27 1.9 1 4.3"/><path d="m28.2 1.6.8 4.4"/><path d="m29.3 1.4.7 4.4"/><path d="m30.5 1.3.5 4.4"/><path d="m31.6 1.1 2.5 27.9"/><path d="m31.6 1.1 2.5 27.9"/><path d="m32.8 1 .2 4.5"/><path d="m34 1v4.5"/><path d="m35.1 1v4.5"/><path d="m36.3 1-.2 4.5"/><path d="m37.5 1.1-2.5 27.9"/><path d="m37.5 1.1-2.5 27.9"/><path d="m38.6 1.3-.5 4.4"/><path d="m39.8 1.4-.7 4.4"/><path d="m41 1.6-.9 4.4"/><path d="m42.1 1.9-1 4.3"/><path d="m43.2 2.1-7.2 27.1"/><path d="m43.2 2.1-7.2 27.1"/><path d="m44.4 2.5-1.3 4.2"/><path d="m45.5 2.8-1.5 4.3"/><path d="m46.6 3.2-1.6 4.2"/><path d="m47.7 3.7-1.8 4.1"/><path d="m48.7 4.1-11.8 25.4"/><path d="m48.7 4.1-11.8 25.4"/><path d="m49.8 4.7-2 3.9"/><path d="m50.8 5.2-2.2 3.9"/><path d="m51.8 5.8-2.3 3.8"/><path d="m52.8 6.4-2.4 3.8"/><path d="m53.8 7.1-16 22.9"/><path d="m53.8 7.1-16 22.9"/><path d="m54.7 7.8-2.6 3.5"/><path d="m55.7 8.5-2.8 3.5"/><path d="m56.6 9.2-3 3.4"/><path d="m57.4 10-3 3.3"/><path d="m58.3 10.8-19.8 19.8"/><path d="m10.8 10.8 19.8 19.8"/><path d="m10 11.7 3.3 3"/><path d="m9.2 12.5 3.4 3"/><path d="m8.5 13.4 3.5 2.9"/><path d="m7.8 14.4 3.5 2.7"/><path d="m7.1 15.3 22.9 16"/><path d="m7.1 15.3 22.9 16"/><path d="m6.4 16.3 3.8 2.4"/><path d="m5.8 17.3 3.8 2.3"/><path d="m5.2 18.3 3.9 2.2"/><path d="m4.7 19.3 3.9 2.1"/><path d="m4.1 20.4 25.4 11.8"/><path d="m4.1 20.4 25.4 11.8"/><path d="m3.7 21.4 4.1 1.8"/><path d="m3.2 22.5 4.2 1.6"/><path d="m2.8 23.6 4.3 1.5"/><path d="m2.5 24.7 4.2 1.4"/><path d="m2.1 25.9 27.1 7.2"/><path d="m2.1 25.9 27.1 7.2"/><path d="m1.9 27 4.3 1"/><path d="m1.6 28.2 4.4.8"/><path d="m1.4 29.3 4.4.7"/><path d="m1.3 30.5 4.4.5"/><path d="m1.1 31.6 27.9 2.5"/><path d="m1.1 31.6 27.9 2.5"/><path d="m1 32.8 4.5.2"/><path d="m1 34h4.5"/><path d="m1 35.1h4.5"/><path d="m1 36.3 4.5-.2"/><path d="m1.1 37.5 27.9-2.5"/><path d="m1.1 37.5 27.9-2.5"/><path d="m1.3 38.6 4.4-.5"/><path d="m1.4 39.8 4.4-.7"/><path d="m1.6 41 4.4-.9"/><path d="m1.9 42.1 4.3-1"/><path d="m2.1 43.2 27.1-7.2"/><path d="m2.1 43.2 27.1-7.2"/><path d="m2.5 44.4 4.2-1.3"/><path d="m2.8 45.5 4.3-1.5"/><path d="m3.2 46.6 4.2-1.6"/><path d="m3.7 47.7 4.1-1.8"/><path d="m4.1 48.7 25.4-11.8"/><path d="m4.1 48.7 25.4-11.8"/><path d="m4.7 49.8 3.9-2"/><path d="m5.2 50.8 3.9-2.2"/><path d="m5.8 51.8 3.8-2.3"/><path d="m6.4 52.8 3.8-2.4"/><path d="m7.1 53.8 22.9-16"/><path d="m7.1 53.8 22.9-16"/><path d="m7.8 54.7 3.5-2.6"/><path d="m8.5 55.7 3.5-2.8"/><path d="m9.2 56.6 3.4-3"/><path d="m10 57.4 3.3-3"/><path d="m10.8 58.3 19.8-19.8"/></g></svg></div></div></section><h3 data-key="penrose" tabindex="0">Penrose Tiles</h3><section><div class="subtitle">Kite and Dart</div><div class="source-wrap"><div class="source" tabindex="0" aria-label="0" data-type="penrose" data-options="0"></div><div class="source" tabindex="0" aria-label="1" data-type="penrose" data-options="1"></div><p class="caption">The white circle arcs have to line up when connecting adjacent tiles.</p></div><div class="subtitle">Nature Tiles</div><div class="source-wrap"><div class="source" tabindex="0" aria-label="Garden tile 1" data-type="garden" data-options="1"></div><div class="source" tabindex="0" aria-label="Garden tile 3" data-type="garden" data-options="3"></div><div class="source" tabindex="0" aria-label="Garden tile 4" data-type="garden" data-options="4"></div><div class="source" tabindex="0" aria-label="Garden tile 0" data-type="garden" data-options="0"></div><div class="source" tabindex="0" aria-label="Garden tile 6" data-type="garden" data-options="6"></div><div class="source" tabindex="0" aria-label="Garden tile 7" data-type="garden" data-options="7"></div><div class="source" tabindex="0" aria-label="Garden tile 2" data-type="garden" data-options="2"></div><div class="source" tabindex="0" aria-label="Garden tile 5" data-type="garden" data-options="5"></div></div></section><h3 data-key="kolam" tabindex="0">Kolam Tiles</h3><section><div class="source-wrap" style="max-width: 220px"><div class="source" tabindex="0" data-type="kolam" data-options="0"></div><div class="source" tabindex="0" data-type="kolam" data-options="1"></div><div class="source" tabindex="0" data-type="kolam" data-options="2"></div><div class="source" tabindex="0" data-type="kolam" data-options="3"></div><div class="source" tabindex="0" data-type="kolam" data-options="4"></div><div class="source" tabindex="0" data-type="kolam" data-options="5"></div><p class="caption">Learn more at $0</p></div></section><h3 data-key="fractals" tabindex="0">Fractals</h3><section><div class="source-wrap"><div class="source" tabindex="0" data-type="fractal" data-options="0"></div><div class="source" tabindex="0" data-type="fractal" data-options="1"></div><div class="source" tabindex="0" data-type="fractal" data-options="2"></div><div class="source" tabindex="0" data-type="fractal" data-options="3"></div><div class="source" tabindex="0" data-type="fractal" data-options="4"></div></div></section><h3 data-key="tantrix" tabindex="0">Tantrix Tiles</h3><section><div class="source-wrap"><div class="source" tabindex="0" data-type="tantrix" data-options="0"></div><div class="source" tabindex="0" data-type="tantrix" data-options="1"></div><div class="source" tabindex="0" data-type="tantrix" data-options="2"></div><div class="source" tabindex="0" data-type="tantrix" data-options="3"></div><div class="source" tabindex="0" data-type="tantrix" data-options="4"></div><div class="source" tabindex="0" data-type="tantrix" data-options="5"></div><div class="source" tabindex="0" data-type="tantrix" data-options="6"></div><div class="source" tabindex="0" data-type="tantrix" data-options="7"></div><div class="source" tabindex="0" data-type="tantrix" data-options="8"></div><div class="source" tabindex="0" data-type="tantrix" data-options="9"></div><div class="source" tabindex="0" data-type="tantrix" data-options="10"></div><div class="source" tabindex="0" data-type="tantrix" data-options="11"></div><div class="source" tabindex="0" data-type="tantrix" data-options="12"></div><div class="source" tabindex="0" data-type="tantrix" data-options="13"></div></div></section></x-accordion><h2 class="m-orange" data-key="numbers"><svg class="icon" viewBox="0 0 24 24" width="18" height="18"><path d="m2.1 9.5.2 1.8 2.1-.7v8.2h2.2v-10.5h-1.9z"/><path d="m20.7 12.3a2.5 2.5 0 0 0 1.5-2.4c0-1.7-1.4-2.8-3.5-2.8a5.8 5.8 0 0 0 -3.2 1h-.1l.3 1.9.2-.2a5 5 0 0 1 2.6-.8c.7 0 1.5.1 1.5 1.1s-.7 1.2-2.1 1.2h-1l.3 1.8h.7c2.1 0 2.3.9 2.3 1.5s-1.1 1.4-1.7 1.4a4.3 4.3 0 0 1 -2.7-.8h-.2l-.3 2a6.9 6.9 0 0 0 3.2.8c2.4 0 3.9-1.3 3.9-3.2a2.5 2.5 0 0 0 -1.7-2.5z"/><path d="m10.9 11.9 2.2-2.2c1.2-1.3 1.9-2.1 1.9-3.5s-1.3-3-3.4-3a4.7 4.7 0 0 0 -3.3 1.1h-.1l.3 2.1.2-.2a4.5 4.5 0 0 1 2.7-1.1c.9 0 1.4.4 1.4 1.3s-.4 1.2-1.1 2l-3.7 3.7v1.6h7.2l-.3-1.9z"/>></svg> Numbers</h2><x-accordion class="subsection" storage="polypad.tiles-numbers"><h3 data-key="number-tiles" tabindex="0">Number Tiles</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="One" data-type="number-tile" data-options="1:1"></div><div class="source" tabindex="0" aria-label="Ten" data-type="number-tile" data-options="10:10"></div><div class="source" tabindex="0" aria-label="Hundred" data-type="number-tile" data-options="10:100"></div></div></section><h3 data-key="number-bars" tabindex="0">Number Bars</h3><section><div class="source-wrap" style="max-width: 250px"><div class="source" tabindex="0" data-type="number-bar" data-options="1"></div><div class="source" tabindex="0" data-type="number-bar" data-options="10"></div><div class="source" tabindex="0" data-type="number-bar" data-options="2"></div><div class="source" tabindex="0" data-type="number-bar" data-options="9"></div><div class="source" tabindex="0" data-type="number-bar" data-options="3"></div><div class="source" tabindex="0" data-type="number-bar" data-options="8"></div><div class="source" tabindex="0" data-type="number-bar" data-options="4"></div><div class="source" tabindex="0" data-type="number-bar" data-options="7"></div><div class="source" tabindex="0" data-type="number-bar" data-options="5"></div><div class="source" tabindex="0" data-type="number-bar" data-options="6"></div></div></section><h3 data-key="number-line" tabindex="0">Number Line</h3><section><div class="source-wrap"><div class="source" tabindex="0" data-type="number-line" data-options="0:1:10:2:1"></div></div></section><h3 data-key="primes" tabindex="0">Prime Factor Circles</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Prime Disk for 1" data-type="prime-disk" data-options="1"></div><div class="source" tabindex="0" aria-label="Prime Disk for 2" data-type="prime-disk" data-options="2"></div><div class="source" tabindex="0" aria-label="Prime Disk for 3" data-type="prime-disk" data-options="3"></div><div class="source" tabindex="0" aria-label="Prime Disk for 4" data-type="prime-disk" data-options="4"></div><div class="source" tabindex="0" aria-label="Prime Disk for 5" data-type="prime-disk" data-options="5"></div><div class="source" tabindex="0" aria-label="Prime Disk for 6" data-type="prime-disk" data-options="6"></div><div class="source" tabindex="0" aria-label="Prime Disk for 7" data-type="prime-disk" data-options="7"></div><div class="source" tabindex="0" aria-label="Prime Disk for 8" data-type="prime-disk" data-options="8"></div><div class="source" tabindex="0" aria-label="Prime Disk for 9" data-type="prime-disk" data-options="9"></div><div class="source" tabindex="0" aria-label="Prime Disk for 10" data-type="prime-disk" data-options="10"></div><div class="source" tabindex="0" aria-label="Prime Disk for 11" data-type="prime-disk" data-options="11"></div><div class="source" tabindex="0" aria-label="Prime Disk for 12" data-type="prime-disk" data-options="12"></div><div class="source" tabindex="0" aria-label="Prime Disk for 13" data-type="prime-disk" data-options="13"></div><div class="source" tabindex="0" aria-label="Prime Disk for 14" data-type="prime-disk" data-options="14"></div><div class="source" tabindex="0" aria-label="Prime Disk for 15" data-type="prime-disk" data-options="15"></div><div class="source" tabindex="0" aria-label="Prime Disk for 16" data-type="prime-disk" data-options="16"></div><div class="source" tabindex="0" aria-label="Prime Disk for 17" data-type="prime-disk" data-options="17"></div><div class="source" tabindex="0" aria-label="Prime Disk for 18" data-type="prime-disk" data-options="18"></div><div class="source" tabindex="0" aria-label="Prime Disk for 19" data-type="prime-disk" data-options="19"></div><div class="source" tabindex="0" aria-label="Prime Disk for 20" data-type="prime-disk" data-options="20"></div><div class="source" tabindex="0" aria-label="Prime Disk for 21" data-type="prime-disk" data-options="21"></div><div class="source" tabindex="0" aria-label="Prime Disk for 22" data-type="prime-disk" data-options="22"></div><div class="source" tabindex="0" aria-label="Prime Disk for 23" data-type="prime-disk" data-options="23"></div><div class="source" tabindex="0" aria-label="Prime Disk for 24" data-type="prime-disk" data-options="24"></div><div class="primes"><input class="input-field" type="number" min="1" max="10000" :bind="p" value="25"><div class="source" tabindex="0" aria-label="Prime Disk for" data-type="prime-disk" data-options="${p}"></div></div></div></section><h3 data-key="number-cards" tabindex="0">Number Cards</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Number Card for 1" data-type="number-card" data-options="1"></div><div class="source" tabindex="0" aria-label="Number Card for 2" data-type="number-card" data-options="2"></div><div class="source" tabindex="0" aria-label="Number Card for 3" data-type="number-card" data-options="3"></div><div class="source" tabindex="0" aria-label="Number Card for 4" data-type="number-card" data-options="4"></div><div class="source" tabindex="0" aria-label="Number Card for 5" data-type="number-card" data-options="5"></div><div class="source" tabindex="0" aria-label="Number Card for 6" data-type="number-card" data-options="6"></div><div class="source" tabindex="0" aria-label="Number Card for 7" data-type="number-card" data-options="7"></div><div class="source" tabindex="0" aria-label="Number Card for 8" data-type="number-card" data-options="8"></div><div class="source" tabindex="0" aria-label="Number Card for 9" data-type="number-card" data-options="9"></div><div class="source" tabindex="0" aria-label="Number Card for 10" data-type="number-card" data-options="10"></div><div class="source" tabindex="0" aria-label="Number Card for 11" data-type="number-card" data-options="11"></div><div class="source" tabindex="0" aria-label="Number Card for 12" data-type="number-card" data-options="12"></div><div class="primes"><input class="input-field" type="number" min="-9999" max="9999" :bind="q" value="25"><div class="source" tabindex="0" aria-label="Number Card for" data-type="number-card" data-options="${q}"></div></div></div></section><h3 data-key="decimal-grid" tabindex="0">Multiplication Grid</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Multiplication Grid" data-type="decimal-grid" data-options="23:12:10"></div></div></section><h3 data-key="dots" tabindex="0">Exploding Dots (preview)</h3><section><div class="source-wrap" style="justify-content: center"><div class="source" tabindex="0" aria-label="Dot" data-type="dot" data-options="1"></div><div class="source" tabindex="0" aria-label="Antidot" data-type="dot" data-options="-1"></div><div class="source" tabindex="0" aria-label="Exploding Dots Machine" data-type="dot-machine" data-options="10:3" style="margin: 3px 15px 8px"></div></div></section></x-accordion><h2 class="m-yellow" data-key="fractions"><svg class="icon" viewBox="0 0 24 24" width="18" height="18"><path d="m11.6 3.9v6.2h2v-8.1h-1.8l-2.1 1 .2 1.5z"/><path d="m11.5 20.6 1.6-1.6c1-1 1.6-1.7 1.6-2.8s-1.1-2.3-2.7-2.3a4.3 4.3 0 0 0 -2.7.8l.2 1.7a4 4 0 0 1 2.2-.8c.6 0 1 .3 1 .8a2.1 2.1 0 0 1 -.8 1.5l-2.8 2.8v1.4h5.7l-.2-1.5z"/><path d="m17 11h-10a1 1 0 0 0 0 2h10a1 1 0 0 0 0-2z"/>></svg> Fractions</h2><x-accordion class="subsection" storage="polypad.tiles-fractions"><h3 data-key="fraction-bars" tabindex="0">Fraction Bars</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Fraction Bar 1/1" data-type="fraction-bar" data-options="1:1"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/2" data-type="fraction-bar" data-options="2:2"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/3" data-type="fraction-bar" data-options="3:3"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/4" data-type="fraction-bar" data-options="4:4"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/5" data-type="fraction-bar" data-options="5:5"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/6" data-type="fraction-bar" data-options="6:6"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/7" data-type="fraction-bar" data-options="7:7"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/8" data-type="fraction-bar" data-options="8:8"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/9" data-type="fraction-bar" data-options="9:9"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/10" data-type="fraction-bar" data-options="10:10"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/11" data-type="fraction-bar" data-options="11:11"></div><div class="source" tabindex="0" aria-label="Fraction Bar 1/12" data-type="fraction-bar" data-options="12:12"></div></div></section><h3 data-key="fraction-circles" tabindex="0">Fraction Circles</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Fraction Circle 1/1" data-type="fraction-circle" data-options="1"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/2" data-type="fraction-circle" data-options="2"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/3" data-type="fraction-circle" data-options="3"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/4" data-type="fraction-circle" data-options="4"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/5" data-type="fraction-circle" data-options="5"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/6" data-type="fraction-circle" data-options="6"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/7" data-type="fraction-circle" data-options="7"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/8" data-type="fraction-circle" data-options="8"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/9" data-type="fraction-circle" data-options="9"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/10" data-type="fraction-circle" data-options="10"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/11" data-type="fraction-circle" data-options="11"></div><div class="source" tabindex="0" aria-label="Fraction Circle 1/12" data-type="fraction-circle" data-options="12"></div></div></section></x-accordion><h2 class="m-green" data-key="algebra"><svg class="icon" viewBox="0 0 24 24" width="18" height="18"><path d="m19.5 9h-2.6l1.3-1.2c.9-.9 1.4-1.5 1.4-2.5s-1-2.2-2.5-2.2a4 4 0 0 0 -2.4.7h-.1l.2 1.7h.2a2.9 2.9 0 0 1 1.8-.7c.3 0 .9.1.9.6s-.3.8-.7 1.3l-2.5 2.5v1.4h5.2z"/><path d="m9.2 13-1.2-2.9-2.4.4 2 4.4-3.7 4.8h2.7l2.1-2.9 1.3 3v.1l2.4-.3-2.1-4.7 3.3-4.5.2-.1h-2.7z"/>></svg> Algebra</h2><x-accordion class="subsection" storage="polypad.tiles-algebra"><h3 data-key="algebra" tabindex="0">Algebra Tiles</h3><section><div class="source-wrap" style="max-width:220px"><div class="source" tabindex="0" aria-label="1" data-type="algebra-tile" data-options="1"></div><div class="source" tabindex="0" aria-label="x" data-type="algebra-tile" data-options="x"></div><div class="source" tabindex="0" aria-label="x squared" data-type="algebra-tile" data-options="x2"></div><div class="source" tabindex="0" aria-label="minus 1" data-type="algebra-tile" data-options="-1"></div><div class="source" tabindex="0" aria-label="minus x" data-type="algebra-tile" data-options="-x"></div><div class="source" tabindex="0" aria-label="minus x squared" data-type="algebra-tile" data-options="-x2"></div><div class="source" tabindex="0" aria-label="grid" data-type="grid" data-options="7:7"></div></div></section><h3 data-key="balance" tabindex="0">Balance Scale (preview)</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Algebra circle token" data-type="token" data-options="circle"></div><div class="source" tabindex="0" aria-label="Algebra square token" data-type="token" data-options="square"></div><div class="source" tabindex="0" aria-label="Algebra cross token" data-type="token" data-options="cross"></div><div class="source" tabindex="0" aria-label="Algebra weight token" data-type="token" data-options="weight"></div><div class="source" tabindex="0" aria-label="Algebra star token" data-type="token" data-options="star"></div><div class="source" tabindex="0" aria-label="Algebra heart token" data-type="token" data-options="heart"></div><div class="source" tabindex="0" aria-label="Balance Scale" data-type="balance" data-options=""></div></div></section><h3 data-key="axes" tabindex="0">Coordinate Axes (preview)</h3><section><div class="source-wrap"><div class="source" tabindex="0" aria-label="Coordinate Axes" data-type="axes" data-options="-5:1:5:-5:1:5"></div></div></section></x-accordion><h2 class="m-teal" data-key="probability"><svg class="icon" viewBox="0 0 24 24" width="18" height="18"><path d="M17.3,3H6.7A3.8,3.8,0,0,0,3,6.7V17.3A3.8,3.8,0,0,0,6.7,21H17.3A3.8,3.8,0,0,0,21,17.3V6.7A3.8,3.8,0,0,0,17.3,3ZM19,17.3A1.8,1.8,0,0,1,17.3,19H6.7A1.8,1.8,0,0,1,5,17.3V6.7A1.8,1.8,0,0,1,6.7,5H17.3A1.8,1.8,0,0,1,19,6.7Z"/><circle cx="8.5" cy="8.5" r="1.5"/><circle cx="15.5" cy="8.5" r="1.5"/><circle cx="8.5" cy="15.5" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="15.5" cy="15.5" r="1.5"/>></svg> Probability</h2><x-accordion class="subsection" storage="polypad.tiles-probability"><h3 data-key="probability" tabindex="0">Coins, Dice and Spinners</h3><section><div class="source-wrap" style="max-width: 195px"><div class="source" tabindex="0" aria-label="die" data-type="dice" data-options=""></div><div class="source" tabindex="0" aria-label="coin" data-type="coin" data-options=""></div><div class="source" tabindex="0" aria-label="spinner" data-type="spinner" data-options="0:5" data-caption="Uniform"></div><div class="source" tabindex="0" aria-label="non-uniform spinner" data-type="custom-spinner" data-options="0:60,180,270,330" data-caption="Custom"></div></div></section><h3 data-key="non-trans-dice" tabindex="0">Non-transitive Dice</h3><section><div class="subtitle">Classic Dice</div><div class="source-wrap"><div class="source" tabindex="0" aria-label="Classic dice type 1" data-type="dice" data-options="0:3,3,3,3,3,6" data-thumb="net" data-colour="#cd0e66"></div><div class="source" tabindex="0" aria-label="Classic dice type 2" data-type="dice" data-options="0:2,2,2,5,5,5" data-thumb="net" data-colour="#0f82f2"></div><div class="source" tabindex="0" aria-label="Classic dice type 3" data-type="dice" data-options="0:1,4,4,4,4,4" data-thumb="net" data-colour="#22ab24"></div></div><div class="subtitle">Efron Dice</div><div class="source-wrap"><div class="source" tabindex="0" aria-label="Efron dice type 1" data-type="dice" data-options="0:3,3,3,3,3,3" data-thumb="net" data-colour="#cd0e66"></div><div class="source" tabindex="0" aria-label="Efron dice type 2" data-type="dice" data-options="0:2,2,2,2,6,6" data-thumb="net" data-colour="#0f82f2"></div><div class="source" tabindex="0" aria-label="Efron dice type 3" data-type="dice" data-options="0:1,1,1,5,5,5" data-thumb="net" data-colour="#22ab24"></div><div class="source" tabindex="0" aria-label="Efron dice type 4" data-type="dice" data-options="0:0,0,4,4,4,4" data-thumb="net" data-colour="#fd8c00"></div></div><div class="subtitle">Grime Dice</div><div class="source-wrap" style="max-width: 220px"><div class="source" tabindex="0" aria-label="Grime dice type 1" data-type="dice" data-options="0:2,2,2,7,7,7" data-thumb="net" data-colour="#cd0e66"></div><div class="source" tabindex="0" aria-label="Grime dice type 2" data-type="dice" data-options="0:1,1,6,6,6,6" data-thumb="net" data-colour="#0f82f2"></div><div class="source" tabindex="0" aria-label="Grime dice type 3" data-type="dice" data-options="0:0,5,5,5,5,5" data-thumb="net" data-colour="#22ab24"></div><div class="source" tabindex="0" aria-label="Grime dice type 4" data-type="dice" data-options="0:4,4,4,4,4,9" data-thumb="net" data-colour="#fd8c00"></div><div class="source" tabindex="0" aria-label="Grime dice type 5" data-type="dice" data-options="0:3,3,3,3,8,8" data-thumb="net" data-colour="#eb4726"></div></div></section></x-accordion></x-accordion></div></x-polypad-sidebar>'),!1!==s.toolbar&&(r+='<x-polypad-toolbar hidden data-display="flex"><div class="bar"><x-select :bind="tool"><button class="tool" value="move" title="Move Tool"><svg class="icon" viewBox="0 0 24 24" width="32" height="32"><path d="M8.3,3.2,17.8,12a.8.8,0,0,1-.5,1.3l-4.1.4L16,19.9a1.2,1.2,0,0,1-.6,1.6h0a1.2,1.2,0,0,1-1.6-.6l-2.7-6.3L8.3,17.3A.8.8,0,0,1,7,16.8V3.8A.8.8,0,0,1,8.3,3.2Z"/>></svg><div class="tooltip">Move Tool</div></button><button class="tool" value="pen" title="Drawing Tools"><svg class="icon" viewBox="0 0 24 24" width="32" height="32" :show="brush === \'pen\'"><path d="m15.9 11.8-3.7-3.7-7.8 7.7-1.2 1.3c-.2.1-.2.2-.2.4v3a.5.5 0 0 0 .5.5h3c.2 0 .3 0 .4-.2l2.8-2.7 1.1-1.2 1.7-1.6z"/><path d="m21.6 10.4c0-.4-.5-.9-.9-1.4s-.7-.6-.7-1 .4-.6.7-1h.1a1.4 1.4 0 0 0 .2-.6.9.9 0 0 0 -.3-.6l-2.3-2.5h-.1l-.6-.3a.9.9 0 0 0 -.7.3l-.5.5-3.4 3.3 3.8 3.8 1.4-1.4.9.9-3.5 3.6a.8.8 0 0 0 -.3.7 1.1 1.1 0 0 0 1 1 1.1 1.1 0 0 0 .7-.3l3.4-3.5c.6-.5 1.1-1 1.1-1.5z"/>></svg><svg class="icon" viewBox="0 0 24 24" width="32" height="32" :show="brush === \'marker\'"><path d="m9.7 9.5 4.3 4.3-6.6 6.5-.7-.7-1.4 1.4a2.1 2.1 0 0 1 -2.9 0 1.9 1.9 0 0 1 0-2.8l1.5-1.5-.8-.7zm11.6-5.8-1.5-1.5a1.9 1.9 0 0 0 -2.8 0l-6.2 6.2 4.2 4.3 6.3-6.2a2.1 2.1 0 0 0 0-2.8z" fill-rule="evenodd"/>></svg><svg class="icon" viewBox="0 0 24 24" width="32" height="32" :show="brush === \'highlighter\'"><path d="M10.2,9.5l-5.9,6a1.9,1.9,0,0,0,.1,2.8L.8,22H6.4l.8-.8a1.8,1.8,0,0,0,2.7.1l6-6.1Zm12.5-4L19.9,2.6a2.1,2.1,0,0,0-2.9,0L11.3,8.4l5.6,5.8,5.7-5.8A2.1,2.1,0,0,0,22.7,5.5Z" fill-rule="evenodd"/>></svg><svg class="icon" viewBox="0 0 24 24" width="32" height="32" :show="brush === \'straight\'"><path d="m17.7 2.1-1.1 1.1 1.6 1.6a.7.7 0 0 1 0 1 .8.8 0 0 1 -1.1 0l-1.6-1.6-1.4 1.4.9.9a.8.8 0 0 1 -1.1 1.1l-.8-.9-1.5 1.4 1.6 1.6a.8.8 0 0 1 0 1.1.7.7 0 0 1 -1 0l-1.6-1.6-1.4 1.4.9.9a.9.9 0 0 1 0 1 .8.8 0 0 1 -1.1 0l-.9-.9-1.4 1.5 1.6 1.6a.7.7 0 0 1 0 1 .8.8 0 0 1 -1.1 0l-1.6-1.6-1.4 1.4.9.9a.8.8 0 0 1 -1.1 1.1l-.8-.9-1.1 1.1a1 1 0 0 0 0 1.4l2.8 2.8a1 1 0 0 0 1.4 0l15.6-15.6a1 1 0 0 0 0-1.4l-2.8-2.8a1 1 0 0 0 -1.4 0z"/>></svg><div class="tooltip">Drawing Tools</div></button><button class="tool" value="geo" title="Construction Tools"><svg class="icon" viewBox="0 0 24 24" width="32" height="32" :show="geoType === \'line\'"><path d="M19.5,2A2.5,2.5,0,0,0,17,4.5a2.9,2.9,0,0,0,.2.9L5.4,17.2,4.5,17a2.5,2.5,0,0,0,0,5A2.5,2.5,0,0,0,7,19.5a2.9,2.9,0,0,0-.2-.9L18.6,6.8l.9.2A2.5,2.5,0,0,0,22,4.5,2.5,2.5,0,0,0,19.5,2Z"/>></svg><svg class="icon" viewBox="0 0 24 24" width="32" height="32" :show="geoType === \'circle\'"><circle cx="12" cy="12" r="2.5"/><path d="M14.4,2.3A2.6,2.6,0,0,0,12,.5,2.6,2.6,0,0,0,9.6,2.3a10,10,0,1,0,4.8,0ZM12,20A8,8,0,0,1,9.9,4.3a2.4,2.4,0,0,0,4.2,0A8,8,0,0,1,12,20Z"/>></svg><div class="tooltip">Construction Tools</div></button><button class="tool" value="text" title="Text Box"><svg class="icon" viewBox="0 0 24 24" width="32" height="32"><path d="M22,5V3a.9.9,0,0,0-1-1H19a.9.9,0,0,0-1,1H6A.9.9,0,0,0,5,2H3A.9.9,0,0,0,2,3V5A.9.9,0,0,0,3,6V18a.9.9,0,0,0-1,1v2a.9.9,0,0,0,1,1H5a.9.9,0,0,0,1-1H18a.9.9,0,0,0,1,1h2a.9.9,0,0,0,1-1V19a.9.9,0,0,0-1-1V6A.9.9,0,0,0,22,5ZM19,18a.9.9,0,0,0-1,1H6a.9.9,0,0,0-1-1V6A.9.9,0,0,0,6,5H18a.9.9,0,0,0,1,1Z"/><path d="M15,7H9A.9.9,0,0,0,8,8,.9.9,0,0,0,9,9h2v7a1,1,0,0,0,2,0V9h2a.9.9,0,0,0,1-1A.9.9,0,0,0,15,7Z"/>></svg><div class="tooltip">Text Box</div></button><button class="tool" value="eraser" title="Eraser"><svg class="icon" viewBox="0 0 24 24" width="32" height="32"><path d="M20.4,8.4,16.6,4.6A2.2,2.2,0,0,0,15.1,4a2,2,0,0,0-1.4.6L3.6,14.7a2.1,2.1,0,0,0,0,2.9L6,20h5.7l8.7-8.7A2.1,2.1,0,0,0,20.4,8.4Z"/><path d="M20,18H16l-2,2h6a1,1,0,0,0,0-2Z"/>></svg><div class="tooltip">Eraser</div></button></x-select><label class="tool" for="image-upload"><svg class="icon" viewBox="0 0 24 24" width="32" height="32"><path d="M21,5H19V3a.9.9,0,0,0-1-1h0a.9.9,0,0,0-1,1V5H15a.9.9,0,0,0-1,1h0a.9.9,0,0,0,1,1h2V9a.9.9,0,0,0,1,1h0a.9.9,0,0,0,1-1V7h2a.9.9,0,0,0,1-1h0A.9.9,0,0,0,21,5ZM16,9V8H15a2.1,2.1,0,0,1-2-2,1.7,1.7,0,0,1,.3-1H5A2,2,0,0,0,3,7V19a2,2,0,0,0,2,2H17a2,2,0,0,0,2-2V10.7a1.7,1.7,0,0,1-1,.3A2,2,0,0,1,16,9Zm0,10H6c-.4,0-.7-.5-.4-.8l2-2.6a.5.5,0,0,1,.8,0L10,18l2.6-3.5a.5.5,0,0,1,.8,0l3,3.7A.5.5,0,0,1,16,19Z"/>></svg><div class="tooltip">Upload Image</div></label><input id="image-upload" type="file" multiple hidden><x-popup class="color-picker"><button class="popup-target rainbow" title="Colour Picker"></button><div class="popup-body"><x-color-picker></x-color-picker></div></x-popup></div><div class="buttons"><button :show="tool === \'move\' &amp;&amp; tiles.length === 1 &amp;&amp; tileType(\'number-tile\') &amp;&amp; canSplitNumberTiles()" @click="action(\'number-tile\', \'split\')">Split Tiles</button><button :show="tool === \'move\' &amp;&amp; tiles.length &gt; 1 &amp;&amp; tileType(\'number-tile\')" @click="action(\'number-tile\', \'merge\')">Merge Tiles</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'algebra-tile\')" @click="action(\'algebra-tile\', \'negate\')">Negate</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'fraction-bar\')" @click="action(\'fraction-bar\', \'split\')">Split Tiles</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'fraction-bar\') &amp;&amp; tiles.length &gt; 1 &amp;&amp; canMergeFractionBars()" @click="action(\'fraction-bar\', \'merge\')">Merge Tiles</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'polygon tangram pentomino custom-polygon penrose egg fractal garden\')" @click="action(\'polygon\', \'flip\')">Flip</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'polygon custom-polygon\')" @click="cutPolygon()">Cut</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'custom-polygon\')" @click="action(\'custom-polygon\', \'lock\')">Lock</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'dice coin spinner non-trans-dice custom-spinner\')" @click="action(\'dice\', \'roll\')">Randomise</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'balance\')" @click="action(\'balance\', \'balance\')">Balance</button><button :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'dot\')" @click="action(\'dot\', \'negate\')">Negate</button><div class="btn-group" :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'dot-machine\')" data-display="flex"><button @click="action(\'dot-machine\', \'explode\')">Explode</button><button @click="action(\'dot-machine\', \'annihilate\')">Annihilate</button></div><div class="btn-group" :show="tool === \'move\' &amp;&amp; tiles.length &amp;&amp; tileType(\'text\')" data-display="flex"><button class="icon-only" @click="action(\'text\', \'smaller\')"><svg class="icon" viewBox="0 0 14 14" width="14" height="14" style="margin: 0 2px;"><path d="M20.4,19.4l-6.5-16-.2-.3a2.1,2.1,0,0,0-1.7-1,2.1,2.1,0,0,0-1.7,1l-.2.3-6.5,16a1.6,1.6,0,0,0,.8,2H5a1.6,1.6,0,0,0,1.4-.9L7.8,17h8.4l1.4,3.6a1.6,1.6,0,0,0,1.4.9h.6A1.6,1.6,0,0,0,20.4,19.4ZM9.1,14,12,6.8,14.9,14Z"/>></svg></button><button class="icon-only" @click="action(\'text\', \'larger\')"><svg class="icon" viewBox="0 0 22 22" width="22" height="22"><path d="M20.4,19.4l-6.5-16-.2-.3a2.1,2.1,0,0,0-1.7-1,2.1,2.1,0,0,0-1.7,1l-.2.3-6.5,16a1.6,1.6,0,0,0,.8,2H5a1.6,1.6,0,0,0,1.4-.9L7.8,17h8.4l1.4,3.6a1.6,1.6,0,0,0,1.4.9h.6A1.6,1.6,0,0,0,20.4,19.4ZM9.1,14,12,6.8,14.9,14Z"/>></svg></button></div><div class="btn-group" :show="geo &amp;&amp; geo.type !== \'point\'" data-display="flex"><button class="icon-only" @click="construct(\'$0.midpoint\')" :if="geo.type === \'segment\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M20.5,1A2.5,2.5,0,0,0,18,3.5a2.9,2.9,0,0,0,.2.9L4.4,18.2,3.5,18a2.5,2.5,0,0,0,0,5A2.5,2.5,0,0,0,6,20.5a2.9,2.9,0,0,0-.2-.9L19.6,5.8l.9.2A2.5,2.5,0,0,0,23,3.5,2.5,2.5,0,0,0,20.5,1Z" opacity=".4"/><circle cx="12" cy="12" r="2.5"/>></svg><div class="tooltip">Midpoint</div></button><button class="icon-only" @click="construct(\'$0.perpendicularBisector\')" :if="geo.type === \'segment\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M21,22a.9.9,0,0,1-.7-.3l-18-18a1,1,0,0,1,0-1.4,1,1,0,0,1,1.4,0l18,18a1,1,0,0,1,0,1.4A.9.9,0,0,1,21,22Z"/><path d="M20.5,1A2.5,2.5,0,0,0,18,3.5a2.9,2.9,0,0,0,.2.9L4.4,18.2,3.5,18a2.5,2.5,0,0,0,0,5A2.5,2.5,0,0,0,6,20.5a2.9,2.9,0,0,0-.2-.9L19.6,5.8l.9.2A2.5,2.5,0,0,0,23,3.5,2.5,2.5,0,0,0,20.5,1Z" opacity=".4"/>></svg><div class="tooltip">Perpendicular Bisector</div></button><button class="icon-only" @click="construct(\'$0.parallel($1)\')" :if="geo.type === \'line\' || geo.type === \'segment\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M3,23a1.2,1.2,0,0,1-.8-.4,1.1,1.1,0,0,1,.2-1.4l18-12a1,1,0,1,1,1.2,1.6l-18,12Z" opacity=".4"/><path d="M21.8,2.4a1.1,1.1,0,0,0-1.4-.2L13.3,6.9A1.8,1.8,0,0,0,12,6.5,2.5,2.5,0,0,0,9.5,9v.4L2.4,14.2a1.1,1.1,0,0,0-.2,1.4A1.2,1.2,0,0,0,3,16l.6-.2,7.1-4.7a1.8,1.8,0,0,0,1.3.4A2.5,2.5,0,0,0,14.5,9V8.6l7.1-4.8A1.1,1.1,0,0,0,21.8,2.4Z"/>></svg><div class="tooltip">Parallel Line</div></button><button class="icon-only" @click="construct(\'$0.perpendicular($1)\')" :if="geo.type === \'line\' || geo.type === \'segment\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M3,23a1.2,1.2,0,0,1-.8-.4,1.1,1.1,0,0,1,.2-1.4l18-12a1,1,0,1,1,1.2,1.6l-18,12Z" opacity=".4"/><path d="M16.8,20.4,8.1,7.3A1.8,1.8,0,0,0,8.5,6,2.5,2.5,0,0,0,6,3.5H5.6L4.8,2.4a1.1,1.1,0,0,0-1.4-.2,1.1,1.1,0,0,0-.2,1.4l.7,1.1A1.8,1.8,0,0,0,3.5,6,2.5,2.5,0,0,0,6,8.5h.4l8.8,13.1a1.2,1.2,0,0,0,.8.4l.6-.2A1.1,1.1,0,0,0,16.8,20.4Z"/>></svg><div class="tooltip">Perpendicular Line</div></button><button class="icon-only" @click="construct(\'line($0.c,$1).perpendicular($1)\')" :if="geo.type === \'circle\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M10,22.9A8.9,8.9,0,1,1,18.9,14,8.9,8.9,0,0,1,10,22.9Zm0-16A7.1,7.1,0,1,0,17.1,14,7.1,7.1,0,0,0,10,6.9Z" opacity=".4"/><path d="M22.4,9.4,15.5,6.5h0A2.5,2.5,0,0,0,13,4a2.9,2.9,0,0,0-1.8.7L2.4,1.1a1,1,0,0,0-.8,1.8l8.9,3.7A2.6,2.6,0,0,0,13,9a2.8,2.8,0,0,0,1.7-.7l6.9,2.9H22a.9.9,0,0,0,.9-.6A1,1,0,0,0,22.4,9.4Z"/>></svg><div class="tooltip">Tangent Line</div></button><button class="icon-only" @click="construct(\'$0.centroid\')" :if="geo.type === \'polygon\' || geo.type === \'triangle\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M4,23a1,1,0,0,1-1-.8l-2-8a1.3,1.3,0,0,1,.1-.6l6-12a.9.9,0,0,1,1.2-.5l11,4a.8.8,0,0,1,.7.7l3,13a1.3,1.3,0,0,1-.2.8c-.1.2-.4.3-.6.4l-18,3Zm-.9-8.9,1.6,6.8,16.1-2.7L18.1,6.8,8.5,3.2Z" opacity=".4"/><circle cx="12.5" cy="13" r="2.5"/>></svg><div class="tooltip">Centroid</div></button><button class="icon-only" @click="construct(\'$0.circumcircle\')" :if="geo.type === \'triangle\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M12,23A11,11,0,1,1,23,12,11,11,0,0,1,12,23ZM12,3a9,9,0,1,0,9,9A9,9,0,0,0,12,3Z"/><path d="M4.7,20,3.6,18.5l9.7-17H15l7.4,13L21.7,16ZM14.1,4,6.5,17.5,20,14.3Z" opacity=".4"/>></svg><div class="tooltip">Circumcircle</div></button><button class="icon-only" @click="construct(\'$0.incircle\')" :if="geo.type === \'triangle\'"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M13.9,19.2a6.5,6.5,0,1,1,6.4-6.4A6.4,6.4,0,0,1,13.9,19.2Zm0-10.9a4.5,4.5,0,1,0,4.4,4.5A4.5,4.5,0,0,0,13.9,8.3Z"/><path d="M2,23a.9.9,0,0,1-.8-.4,1.1,1.1,0,0,1-.1-1.1l12-20a1.1,1.1,0,0,1,1.8,0l8,14a1.4,1.4,0,0,1,0,.9.9.9,0,0,1-.6.6l-20,6ZM14,4,4.2,20.3l16.3-4.9Z" opacity=".4"/>></svg><div class="tooltip">Incircle</div></button></div><div class="btn-group" :show="tool === \'move\' &amp;&amp; tiles.length" data-display="flex"><button class="icon-only" @click="action(\'\', \'copy\')"><svg class="icon" viewBox="0 0 22 22" width="22" height="22"><path d="M19,7H9A2,2,0,0,0,7,9V19a2,2,0,0,0,2,2H19a2,2,0,0,0,2-2V9A2,2,0,0,0,19,7Zm-1,8H15v3a1.1,1.1,0,0,1-1,1,1.1,1.1,0,0,1-1-1V15H10a1.1,1.1,0,0,1-1-1,1.1,1.1,0,0,1,1-1h3V10a1.1,1.1,0,0,1,1-1,1.1,1.1,0,0,1,1,1v3h3a1.1,1.1,0,0,1,1,1A1.1,1.1,0,0,1,18,15Z"/><path d="M17,3H5A2,2,0,0,0,3,5V17a2,2,0,0,0,2,2V6A1.1,1.1,0,0,1,6,5H19A2,2,0,0,0,17,3Z"/>></svg><div class="tooltip">Copy</div></button><button class="icon-only" @click="action(\'\', \'delete\')"><svg class="icon" viewBox="0 0 22 22" width="22" height="22"><path d="M6,19a2,2,0,0,0,2,2h8a2,2,0,0,0,2-2V7H6Zm3.2-6.4a1,1,0,1,1,1.4-1.4L12,12.6l1.4-1.4a1,1,0,1,1,1.4,1.4L13.4,14l1.4,1.4a1,1,0,1,1-1.4,1.4L12,15.4l-1.4,1.4a1,1,0,1,1-1.4-1.4L10.6,14ZM18,4H15.5l-.7-.7a.9.9,0,0,0-.7-.3H9.9a.9.9,0,0,0-.7.3L8.5,4H6A.9.9,0,0,0,5,5,.9.9,0,0,0,6,6H18a1,1,0,0,0,0-2Z"/>></svg><div class="tooltip">Delete</div></button></div><x-select class="btn-group" :show="tool === \'geo\'" :bind="geoType" data-display="flex"><button class="icon-only" value="line"><svg class="icon" viewBox="0 0 22 22" width="22" height="22"><path d="M19.5,2A2.5,2.5,0,0,0,17,4.5a2.9,2.9,0,0,0,.2.9L5.4,17.2,4.5,17a2.5,2.5,0,0,0,0,5A2.5,2.5,0,0,0,7,19.5a2.9,2.9,0,0,0-.2-.9L18.6,6.8l.9.2A2.5,2.5,0,0,0,22,4.5,2.5,2.5,0,0,0,19.5,2Z"/>></svg></button><button class="icon-only" value="circle"><svg class="icon" viewBox="0 0 22 22" width="22" height="22"><circle cx="12" cy="12" r="2.5"/><path d="M14.4,2.3A2.6,2.6,0,0,0,12,.5,2.6,2.6,0,0,0,9.6,2.3a10,10,0,1,0,4.8,0ZM12,20A8,8,0,0,1,9.9,4.3a2.4,2.4,0,0,0,4.2,0A8,8,0,0,1,12,20Z"/>></svg></button></x-select></div><x-select class="brushes" :show="tool === \'pen\'" :bind="brush" data-display="flex"><svg width="36" height="80" value="pen" title="Pen"><path d="M36,48c-.5,0-3-5-3-5H3S.5,48,0,48H0V80H36V48Z" :fill="color"></path><rect x="11" y="43" width="14" height="37" transform="translate(36 123) rotate(180)" opacity="0.3"></rect><path d="M1.4,47.3l2.2-2.6a2,2,0,0,1,3-.2l2.8,3.9a2.6,2.6,0,0,0,3.3.2l3.6-3.2a2.7,2.7,0,0,1,3.4,0l3.6,3.2a2.6,2.6,0,0,0,3.3-.2l2.8-3.9a2,2,0,0,1,3,.2l2.2,2.6A1.7,1.7,0,0,0,36,48L25.4,19.6a20.3,20.3,0,0,1-14.8,0L0,48A1.7,1.7,0,0,0,1.4,47.3Z" fill="#f7eecb"></path><path d="M10.6,19.6a20.3,20.3,0,0,0,14.8,0L18,0Z" :fill="color"></path></svg><svg width="36" height="80" value="marker" title="Marker"><path d="M27,21H9V15a11.4,11.4,0,0,1,2.6-7.2L18,0l6.4,7.8A11.4,11.4,0,0,1,27,15Z" :fill="color"></path><rect y="37" width="36" height="43" fill="#ccc"></rect><rect x="2" y="29" width="32" height="8" :fill="color"></rect><rect x="5" y="21" width="26" height="8" fill="#3a3645"></rect><rect x="26" y="37" width="10" height="43" opacity="0.15"></rect><rect y="50" width="18" height="30" :fill="color"></rect></svg><svg width="40" height="80" value="highlighter" title="Highlighter"><rect y="38" width="40" height="7" fill="#3a3645"></rect><rect x="13" y="14" width="14" height="3" fill="#3a3645"></rect><path d="M27,17H13C10.9,25.1,8.2,31.8,0,38H40C31,32.2,28.6,25.5,27,17Z" fill="#615e6a"></path><rect y="45" width="40" height="35" :fill="color"></rect><rect x="7" y="52" width="26" height="28" opacity="0.2"></rect><polygon points="13 0 13 14 27 14 27 7 13 0" :fill="color"></polygon></svg><svg width="36" height="80" value="straight" title="Straight lines"><path d="M5,0H31a5,5,0,0,1,5,5V80a0,0,0,0,1,0,0H0a0,0,0,0,1,0,0V5A5,5,0,0,1,5,0Z" fill="#ccc"></path><path d="M5,0h5a0,0,0,0,1,0,0V80a0,0,0,0,1,0,0H0a0,0,0,0,1,0,0V5A5,5,0,0,1,5,0Z" :fill="color"></path><path d="M36,10v2H24V10Zm-7,8v2h7V18Zm-5,8v2H36V26Zm5,8v2h7V34Zm-5,8v2H36V42Zm5,8v2h7V50Zm-5,8v2H36V58Zm5,8v2h7V66Zm-5,8v2H36V74Z" :fill="color"></path></svg></x-select></x-polypad-toolbar>'),r+='<svg class="overlay"><g class="tiles active"></g></svg>',r+='<x-polypad pan="yes"></x-polypad>',!1!==s.settings&&(r+='<x-polypad-settings><div class="settings-group"><button class="settings-btn" title="Toggle Fullscreen" @click="expand()"><svg class="icon" viewBox="0 0 24 24" width="24" height="24" :show="!fullscreen"><path d="m15.9 3.8 1.4 1.5-2.2 2.2a1 1 0 0 0 0 1.4 1 1 0 0 0 1.4 0l2.2-2.2 1.5 1.4a.4.4 0 0 0 .8-.3v-4.3a.5.5 0 0 0 -.5-.5h-4.3a.4.4 0 0 0 -.3.8zm-12.1 4.3 1.5-1.4 2.2 2.2a1 1 0 0 0 1.4 0 1 1 0 0 0 0-1.4l-2.2-2.2 1.4-1.4a.5.5 0 0 0 -.3-.9h-4.3a.5.5 0 0 0 -.5.5v4.3a.4.4 0 0 0 .8.3zm4.3 12-1.4-1.4 2.2-2.2a1 1 0 0 0 0-1.4 1 1 0 0 0 -1.4 0l-2.2 2.2-1.4-1.5a.6.6 0 0 0 -.9.4v4.3a.5.5 0 0 0 .5.5h4.3a.5.5 0 0 0 .3-.9zm12-4.2-1.4 1.4-2.2-2.2a1 1 0 0 0 -1.4 0 1 1 0 0 0 0 1.4l2.2 2.2-1.4 1.4a.5.5 0 0 0 .3.9h4.3a.5.5 0 0 0 .5-.5v-4.3a.5.5 0 0 0 -.9-.3z"/>></svg><svg class="icon" viewBox="0 0 24 24" width="24" height="24" :show="fullscreen" hidden><path d="m20.1 8.2-1.4-1.5 2.2-2.2a1 1 0 0 0 0-1.4 1 1 0 0 0 -1.4 0l-2.2 2.2-1.5-1.4a.4.4 0 0 0 -.8.3v4.3a.5.5 0 0 0 .5.5h4.3a.4.4 0 0 0 .3-.8z"/><path d="m8.2 3.9-1.5 1.4-2.2-2.2a1 1 0 0 0 -1.4 0 1 1 0 0 0 0 1.4l2.2 2.2-1.4 1.4a.5.5 0 0 0 .3.9h4.3a.5.5 0 0 0 .5-.5v-4.3a.4.4 0 0 0 -.8-.3z"/><path d="m3.9 15.9 1.4 1.4-2.2 2.2a1 1 0 0 0 0 1.4 1 1 0 0 0 1.4 0l2.2-2.2 1.4 1.5a.6.6 0 0 0 .9-.4v-4.3a.5.5 0 0 0 -.5-.5h-4.3a.5.5 0 0 0 -.3.9z"/><path d="m15.9 20.1 1.4-1.4 2.2 2.2a1 1 0 0 0 1.4 0 1 1 0 0 0 0-1.4l-2.2-2.2 1.4-1.4a.5.5 0 0 0 -.3-.9h-4.3a.5.5 0 0 0 -.5.5v4.3a.5.5 0 0 0 .9.3z"/>></svg><div class="tooltip">Toggle Fullscreen</div></button><button class="settings-btn" title="Undo" @click="undo()" :disabled="canUndo ? undefined : true"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M12.5,8a10.4,10.4,0,0,0-6.9,2.6L3.7,8.7a1,1,0,0,0-1.4,0,.9.9,0,0,0-.3.7V15a.9.9,0,0,0,1,1H8.6a1,1,0,0,0,1-1,.9.9,0,0,0-.3-.7L7.4,12.4a8,8,0,0,1,11.3,1,8.6,8.6,0,0,1,1,1.6,1.2,1.2,0,0,0,1.5.6,1.1,1.1,0,0,0,.9-1.5v-.2A10.7,10.7,0,0,0,12.5,8Z"/>></svg><div class="tooltip">Undo</div></button><button class="settings-btn" title="Redo" @click="redo()" :disabled="canRedo ? undefined : true"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M18.4,10.6a10.5,10.5,0,0,0-14.8,1,11.4,11.4,0,0,0-1.5,2.3,1.2,1.2,0,0,0,.6,1.7h.1A1.2,1.2,0,0,0,4.3,15,8,8,0,0,1,15,11.3a9.1,9.1,0,0,1,1.6,1.1l-1.9,1.9a1,1,0,0,0,0,1.4.9.9,0,0,0,.7.3H21a.9.9,0,0,0,1-1V9.4a1,1,0,0,0-1-1,.9.9,0,0,0-.7.3Z"/>></svg><div class="tooltip">Redo</div></button><x-popup animation="pop"><button class="settings-btn popup-target" title="Grid"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M20,2H4A2,2,0,0,0,2,4V20a2,2,0,0,0,2,2H20a2,2,0,0,0,2-2V4A2,2,0,0,0,20,2ZM8,20H4V16H8Zm0-6H4V10H8ZM8,8H4V4H8Zm6,12H10V16h4Zm0-6H10V10h4Zm0-6H10V4h4Zm6,12H16V16h4Zm0-6H16V10h4Zm0-6H16V4h4Z"/>></svg><div class="tooltip">Grid Settings</div></button><x-select class="popup-body grid-popup" hidden :bind="grid" data-display="flex"><button class="grid" value="none" title="No Grid"></button><button class="grid" value="square2-grid" title="Large Square Grid"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="#000" stroke-miterlimit="10"><path d="m0 24h48"/><path d="m24 48v-48"/><path d="m42 48v-48"/><path d="m6 48v-48"/><path d="m0 42h48"/><path d="m0 6h48"/></g></svg>\n</button><button class="grid" value="square-dots" title="Square Dots"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><circle cx="44" cy="4" r="1.5"/><circle cx="34" cy="4" r="1.5"/><circle cx="24" cy="4" r="1.5"/><circle cx="14" cy="4" r="1.5"/><circle cx="4" cy="4" r="1.5"/><circle cx="44" cy="14" r="1.5"/><circle cx="34" cy="14" r="1.5"/><circle cx="24" cy="14" r="1.5"/><circle cx="14" cy="14" r="1.5"/><circle cx="4" cy="14" r="1.5"/><circle cx="44" cy="24" r="1.5"/><circle cx="34" cy="24" r="1.5"/><circle cx="24" cy="24" r="1.5"/><circle cx="14" cy="24" r="1.5"/><circle cx="4" cy="24" r="1.5"/><circle cx="44" cy="34" r="1.5"/><circle cx="34" cy="34" r="1.5"/><circle cx="24" cy="34" r="1.5"/><circle cx="14" cy="34" r="1.5"/><circle cx="4" cy="34" r="1.5"/><circle cx="44" cy="44" r="1.5"/><circle cx="34" cy="44" r="1.5"/><circle cx="24" cy="44" r="1.5"/><circle cx="14" cy="44" r="1.5"/><circle cx="4" cy="44" r="1.5"/></svg></button><button class="grid" value="square-grid" title="Square Grid"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="#000" stroke-miterlimit="10"><path d="m0 24h48" stroke-width="2"/><path d="m24 48v-48" stroke-width="2"/><path d="m34 48v-48"/><path d="m44 48v-48"/><path d="m4 48v-48"/><path d="m14 48v-48"/><path d="m0 34h48"/><path d="m0 44h48"/><path d="m0 4h48"/><path d="m0 14h48"/></g></svg>\n</button><button class="grid" value="tri-dots" title="Isometric Dots"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><circle cx="15" cy="4" r="1.5"/><circle cx="3.5" cy="4" r="1.5"/><circle cx="26.5" cy="4" r="1.5"/><circle cx="38" cy="4" r="1.5"/><circle cx="15" cy="44" r="1.5"/><circle cx="3.5" cy="44" r="1.5"/><circle cx="26.5" cy="44" r="1.5"/><circle cx="38" cy="44" r="1.5"/><circle cx="21" cy="14" r="1.5"/><circle cx="9.5" cy="14" r="1.5"/><circle cx="32.5" cy="14" r="1.5"/><circle cx="44" cy="14" r="1.5"/><circle cx="15" cy="24" r="1.5"/><circle cx="3.5" cy="24" r="1.5"/><circle cx="26.5" cy="24" r="1.5"/><circle cx="38" cy="24" r="1.5"/><circle cx="21" cy="34" r="1.5"/><circle cx="9.5" cy="34" r="1.5"/><circle cx="32.5" cy="34" r="1.5"/><circle cx="44" cy="34" r="1.5"/></svg></button><button class="grid" value="tri-grid" title="Isometric Grid"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="#000" stroke-linecap="round" stroke-miterlimit="10"><path d="m.5 44h48"/><path d="m0 24h48"/><path d="m0 34h48"/><path d="m0 44h48"/><path d="m0 4h48"/><path d="m0 14h48"/><path d="m-.5 48 28-48"/><path d="m-.5 27.8 16.2-27.8"/><path d="m-.5 8.4 4.9-8.4"/><path d="m3.9 48-4.4-7.5"/><path d="m11.3 48 28-48"/><path d="m27.5 48-28-48"/><path d="m22.8 48 25.7-44"/><path d="m39 48-28-48"/><path d="m34.5 48 14-24"/><path d="m49.2 45.5-26.5-45.5"/><path d="m48.5 24-14-24"/><path d="m48.5 4-2.2-4"/><path d="m46.3 48 2.2-4"/><path d="m15.7 48-16.2-27.8"/></g></svg></button><button class="grid" value="tri2-dots" title="Rotated Isometric Dots"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><circle cx="4" cy="15" r="1.5"/><circle cx="4" cy="3.5" r="1.5"/><circle cx="4" cy="26.5" r="1.5"/><circle cx="4" cy="38" r="1.5"/><circle cx="44" cy="15" r="1.5"/><circle cx="44" cy="3.5" r="1.5"/><circle cx="44" cy="26.5" r="1.5"/><circle cx="44" cy="38" r="1.5"/><circle cx="14" cy="21" r="1.5"/><circle cx="14" cy="9.5" r="1.5"/><circle cx="14" cy="32.5" r="1.5"/><circle cx="14" cy="44" r="1.5"/><circle cx="24" cy="15" r="1.5"/><circle cx="24" cy="3.5" r="1.5"/><circle cx="24" cy="26.5" r="1.5"/><circle cx="24" cy="38" r="1.5"/><circle cx="34" cy="21" r="1.5"/><circle cx="34" cy="9.5" r="1.5"/><circle cx="34" cy="32.5" r="1.5"/><circle cx="34" cy="44" r="1.5"/></svg></button><button class="grid" value="tri2-grid" title="Rotated Isometric Grid"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="#000" stroke-linecap="round" stroke-miterlimit="10"><path d="m44 47.8v-48"/><path d="m24 48.3v-48"/><path d="m34 48.3v-48"/><path d="m44 48.3v-48"/><path d="m4 48.3v-48"/><path d="m14 48.3v-48"/><path d="m48 48.8-48-28"/><path d="m27.8 48.8-27.8-16.2"/><path d="m8.4 48.8-8.4-4.9"/><path d="m48 44.5-7.5 4.3"/><path d="m48 37.1-48-28"/><path d="m48 20.8-48 28"/><path d="m48 25.5-44-25.7"/><path d="m48 9.3-48 28"/><path d="m48 13.9-24-14.1"/><path d="m45.5-.8-45.5 26.5"/><path d="m24-.2-24 14.1"/><path d="m4-.2-4 2.2"/><path d="m48 2-4-2.2"/><path d="m48 32.6-27.8 16.2"/></g></svg></button><button class="grid fill" value="square-checked" title="Checked Square Grid"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="m4 4h10v10h-10z"/><path d="m24 4h10v10h-10z"/><path d="m44 4h4v10h-4z"/><path d="m4 24h10v10h-10z"/><path d="m24 24h10v10h-10z"/><path d="m44 24h4v10h-4z"/><path d="m4 44h10v4h-10z"/><path d="m24 44h10v4h-10z"/><path d="m44 44h4v4h-4z"/><path d="m0 0h4v4h-4z"/><path d="m14 0h10v4h-10z"/><path d="m34 0h10v4h-10z"/><path d="m0 14h4v10h-4z"/><path d="m14 14h10v10h-10z"/><path d="m34 14h10v10h-10z"/><path d="m0 34h4v10h-4z"/><path d="m14 34h10v10h-10z"/><path d="m34 34h10v10h-10z"/></svg></button></x-select></x-popup><x-popup animation="pop"><button class="settings-btn popup-target" title="Options"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="m13.4 15.5 4.4 4.4a1.5 1.5 0 0 0 2.1 0 1.4 1.4 0 0 0 0-2.1l-4.4-4.4z"/><path d="m16.3 9.8a3.6 3.6 0 0 0 3.1-.4 3.1 3.1 0 0 0 1.5-2.3 2.7 2.7 0 0 0 -.2-2l-2.4 2.4-1.8-1.8 2.4-2.4a3.4 3.4 0 0 0 -2-.3 3.5 3.5 0 0 0 -2.3 1.6 3.6 3.6 0 0 0 -.4 3.1l-2.2 2.2-1.7-1.7a1 1 0 0 0 0-1.4l-.5-.6 2.3-2.3a3.5 3.5 0 0 0 -2.3-.9 3.1 3.1 0 0 0 -2.2.9l-2.9 2.9a1 1 0 0 0 0 1.4l.5.5h-1.7l-.5.2a.7.7 0 0 0 0 1l2 2a.7.7 0 0 0 1 0 .8.8 0 0 0 .2-.5v-1.7l.6.5a1 1 0 0 0 1.4 0l1.7 1.8-5.8 5.8a1.4 1.4 0 0 0 0 2.1 1.4 1.4 0 0 0 2.1 0l5.4-5.3z"/>></svg><div class="tooltip">Settings</div></button><div class="popup-body options-popup" hidden><div class="row"><div><svg class="icon" viewBox="0 0 24 24" width="20" height="20"><path d="M22,5V3a.9.9,0,0,0-1-1H19a.9.9,0,0,0-1,1H6A.9.9,0,0,0,5,2H3A.9.9,0,0,0,2,3V5A.9.9,0,0,0,3,6V18a.9.9,0,0,0-1,1v2a.9.9,0,0,0,1,1H5a.9.9,0,0,0,1-1H18a.9.9,0,0,0,1,1h2a.9.9,0,0,0,1-1V19a.9.9,0,0,0-1-1V6A.9.9,0,0,0,22,5ZM19,18a.9.9,0,0,0-1,1H6a.9.9,0,0,0-1-1V6A.9.9,0,0,0,6,5H18a.9.9,0,0,0,1,1Z"/><path d="M15,7H9A.9.9,0,0,0,8,8,.9.9,0,0,0,9,9h2v7a1,1,0,0,0,2,0V9h2a.9.9,0,0,0,1-1A.9.9,0,0,0,15,7Z"/>></svg> Hide Number Labels:</div><label class="form-checkbox"><input class="show-labels" type="checkbox" :bind="noLabels"><div class="control"></div></label></div><div class="row"><div><svg class="icon" viewBox="0 0 24 24" width="20" height="20"><path d="M12,3a9,9,0,0,0,0,18,1.5,1.5,0,0,0,1.5-1.5,1.3,1.3,0,0,0-.4-1,1.8,1.8,0,0,1-.4-1A1.5,1.5,0,0,1,14.2,16H16a5,5,0,0,0,5-5C21,6.6,17,3,12,3ZM6.5,12a1.5,1.5,0,0,1,0-3,1.5,1.5,0,0,1,0,3Zm3-4A1.5,1.5,0,0,1,8,6.5a1.5,1.5,0,0,1,3,0A1.5,1.5,0,0,1,9.5,8Zm5,0A1.5,1.5,0,0,1,13,6.5a1.5,1.5,0,0,1,3,0A1.5,1.5,0,0,1,14.5,8Zm3,4A1.5,1.5,0,1,1,19,10.5,1.5,1.5,0,0,1,17.5,12Z"/>></svg> Alternate Colours:</div><label class="form-checkbox"><input class="show-labels" type="checkbox" :bind="altColors"><div class="control"></div></label></div><div class="row" :if="showHanddrawn"><div><svg class="icon" viewBox="0 0 24 24" width="20" height="20"><path d="m15.9 11.8-3.7-3.7-7.8 7.7-1.2 1.3c-.2.1-.2.2-.2.4v3a.5.5 0 0 0 .5.5h3c.2 0 .3 0 .4-.2l2.8-2.7 1.1-1.2 1.7-1.6z"/><path d="m21.6 10.4c0-.4-.5-.9-.9-1.4s-.7-.6-.7-1 .4-.6.7-1h.1a1.4 1.4 0 0 0 .2-.6.9.9 0 0 0 -.3-.6l-2.3-2.5h-.1l-.6-.3a.9.9 0 0 0 -.7.3l-.5.5-3.4 3.3 3.8 3.8 1.4-1.4.9.9-3.5 3.6a.8.8 0 0 0 -.3.7 1.1 1.1 0 0 0 1 1 1.1 1.1 0 0 0 .7-.3l3.4-3.5c.6-.5 1.1-1 1.1-1.5z"/>></svg> Hand Drawn Mode:</div><label class="form-checkbox"><input class="show-labels" type="checkbox" :bind="handdrawn"><div class="control"></div></label></div><button class="btn btn-small btn-blue" @click="resetZoom()"><svg class="icon" viewBox="0 0 22 22" width="22" height="22"><path d="M22.2,16.5,15.9,14c-.2,0-.4,0-.5.2s-.2.3-.1.5l.6,1.3H8V8.1l1.3.6h.2l.3-.2c.2-.1.2-.3.2-.5L7.5,1.8a.6.6,0,0,0-1,0L4,8.1c0,.2,0,.4.2.5s.3.2.5.1L6,8.1V16H2a1,1,0,0,0,0,2H6v4a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V18h7.9l-.6,1.3c-.1.2-.1.4.1.5a.5.5,0,0,0,.4.2h.1l6.3-2.5a.6.6,0,0,0,0-1Z"/>></svg> Reset Pan and Zoom</button></div></x-popup><button class="settings-btn" title="Download Image" @click="download()"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M21.2,16H19V10.5a1,1,0,0,0-1-1,.9.9,0,0,0-1,1V16H14.8a1,1,0,0,0-.8,1.7L17.3,21a1.2,1.2,0,0,0,1.4,0L22,17.7A1,1,0,0,0,21.2,16Z"/><path d="M12.8,17H6a.5.5,0,0,1-.4-.8l1.9-2.6a.6.6,0,0,1,.9,0L10,16l2.6-3.5a.5.5,0,0,1,.8,0l2,2.5H16V10.5a2,2,0,0,1,2-2,1.7,1.7,0,0,1,1,.3V5a2,2,0,0,0-2-2H5A2,2,0,0,0,3,5V17a2,2,0,0,0,2,2h8.9l-.6-.6A2.4,2.4,0,0,1,12.8,17Z"/>></svg><div class="tooltip">Download Image</div></button></div><div class="settings-group"><button class="settings-btn" title="Zoom In" @click="zoom(1.1)"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M10.5,8.5V6a.9.9,0,0,0-1-1,.9.9,0,0,0-1,1V8.5H6a.9.9,0,0,0-1,1,.9.9,0,0,0,1,1H8.5V13a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V10.5H13a.9.9,0,0,0,1-1,.9.9,0,0,0-1-1Z"/><path d="M21.6,19.4l-4-4a1.6,1.6,0,0,0-1.5-.3l-.8-.9A7,7,0,0,0,17,9.5,7.6,7.6,0,0,0,9.5,2,7.6,7.6,0,0,0,2,9.5,7.6,7.6,0,0,0,9.5,17a7,7,0,0,0,4.7-1.7l.9.8a1.6,1.6,0,0,0,.3,1.5l4,4a1.7,1.7,0,0,0,2.2,0A1.8,1.8,0,0,0,21.6,19.4ZM9.5,15A5.5,5.5,0,0,1,4,9.5,5.5,5.5,0,0,1,9.5,4,5.5,5.5,0,0,1,15,9.5,5.5,5.5,0,0,1,9.5,15Z"/>></svg></button><button class="settings-btn" title="Zoom Out" @click="zoom(0.9)"><svg class="icon" viewBox="0 0 24 24" width="24" height="24"><path d="M6,8.5a.9.9,0,0,0-1,1,.9.9,0,0,0,1,1h7a.9.9,0,0,0,1-1,.9.9,0,0,0-1-1Z"/><path d="M21.6,19.4l-4-4a1.6,1.6,0,0,0-1.5-.3l-.8-.9A7,7,0,0,0,17,9.5,7.6,7.6,0,0,0,9.5,2,7.6,7.6,0,0,0,2,9.5,7.6,7.6,0,0,0,9.5,17a7,7,0,0,0,4.7-1.7l.9.8a1.6,1.6,0,0,0,.3,1.5l4,4a1.7,1.7,0,0,0,2.2,0A1.8,1.8,0,0,0,21.6,19.4ZM9.5,15A5.5,5.5,0,0,1,4,9.5,5.5,5.5,0,0,1,9.5,4,5.5,5.5,0,0,1,15,9.5,5.5,5.5,0,0,1,9.5,15Z"/>></svg></button></div></x-polypad-settings>'),a.html=r;const l=new w,h=a.$("x-polypad");yield new Promise((t=>setTimeout(t))),s.themeColours&&Object.assign(Ts,s.themeColours),s.bindKeyboardEvents&&h.enableHotkeys(),Je.onResize((()=>h.setViewport(h.origin,h.zoom)));const d=a.$("x-polypad-sidebar"),p=a.$("x-polypad-toolbar"),u=a.$("x-polypad-settings"),f=a.$(".overlay");null==d||d.bindPolypad(h,f),null==p||p.bindPolypad(h),null==u||u.bindPolypad(h),h.margins=[32,u?64:32,p?106:32,(null==d?void 0:d.isOpen)?324:32],s.initial&&h.load(s.initial),null==p||p.setClass("shifted",void 0!==(null==d?void 0:d.active)),null==d||d.on("toggle",(({open:t})=>null==p?void 0:p.setClass("shifted",t))),s.imageUpload?h.enableImageDrop(((t,i)=>e(this,void 0,void 0,(function*(){i.options="";try{i.options=yield s.imageUpload(t)}catch(t){i.delete(),console.error("Failed to upload image :(")}}))),null==p?void 0:p.$imageUpload):null===(i=null==p?void 0:p.$('[for="image-upload"]'))||void 0===i||i.hide(),h.on("change",(t=>{const e={},s=((null==t?void 0:t.tilesAdded)||[]).map((t=>t.toJSON())),i=((null==t?void 0:t.strokesAdded)||[]).map((t=>t.serialize()));(s.length||i.length)&&(e.added=[...s,...i]);const o=((null==t?void 0:t.tilesDeleted)||[]).map((t=>t.toJSON())),n=((null==t?void 0:t.strokesDeleted)||[]).map((t=>t.serialize()));(o.length||n.length)&&(e.deleted=[...o,...n]);const a=((null==t?void 0:t.tilesChanged)||[]).map((t=>t.toJSON()));a.length&&(e.changed=a),l.trigger("change",e)})),h.on("undo",(()=>l.trigger("undo"))),h.on("redo",(()=>l.trigger("redo"))),h.on("viewport",(()=>{l.trigger("viewport",{x:h.origin.x,y:h.origin.y,zoom:h.zoom})}));let g=0;return h.options.watch((()=>{const t=h.options.grid;g&&l.trigger("grid",{grid:t}),g=1})),h.on("move-selection",c((()=>{const t=Array.from(h.selection.tiles).map((t=>({id:t.id,x:t.posn.x,y:t.posn.y})));l.trigger("move",{tiles:t})}),1e3)),{on(t,e){l.on(t,e)},off(t,e){l.off(t,e)},undo(){h.undo()},redo(){h.redo()},serialize:()=>h.serialize(),unSerialize(t){h.load(t)},setGrid(t){h.options.grid=t},pngImage:(t,e)=>h.thumbnail(t,e),add(t){if(t.name){const e=Ls.unSerialize(t,h);return null==e?void 0:e.id}if(t.points)return zs.unSerialize(t,h).id},update(t,e){const s=h.tileMap.get(t);return s?e.options?(e=Object.assign(s.toJSON(),e),s.delete(),void Ls.unSerialize(e,h)):((e.x||e.y||e.rot)&&s.setTransform(new rt(e.x||0,e.y||0),e.rot||0),e.colour&&s.setColour(e.colour),e.size&&s.setSize(e.size),void("flipped"in e&&s.flipped!==!!e.flipped&&s.flip())):Ls.unSerialize(e,h)},delete(...t){var e,s;for(const i of t)null===(e=h.tileMap.get(i))||void 0===e||e.delete(),null===(s=h.strokeMap.get(i))||void 0===s||s.delete()},select(...t){h.selection.clear(),h.selection.select(t.map((t=>h.tileMap.get(t))).filter((t=>t)))},getSelection(){Array.from(h.selection.tiles).map((t=>t.id))},getViewport:()=>({x:h.origin.x,y:h.origin.y,zoom:h.zoom}),setViewport(t,e,s){h.setViewport(new rt(t,e),s)},resetViewport(){h.resetViewport()},clear(){h.unSerialize({}),h.options.grid="none",h.resetViewport(),h.change()},setTheme(t){throw new Error(".setTheme() is not yet implemented.")}}}))}(i,s)}))}}}();